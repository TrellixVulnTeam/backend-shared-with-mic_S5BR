!function(){"use strict";function t(o,e,n){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,o,e){var n=function(t,o){for(;!Object.prototype.hasOwnProperty.call(t,o)&&null!==(t=l(t)););return t}(t,o);if(n){var r=Object.getOwnPropertyDescriptor(n,o);return r.get?r.get.call(e):r.value}})(o,e,n||o)}function o(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}function e(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function n(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,o,e){return o&&n(t.prototype,o),e&&n(t,e),t}function i(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(o&&o.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),o&&a(t,o)}function a(t,o){return(a=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t})(t,o)}function c(t){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var e,n=l(t);if(o){var r=l(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return s(this,e)}}function s(t,o){if(o&&("object"==typeof o||"function"==typeof o))return o;if(void 0!==o)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(self.webpackChunk_vendure_admin_ui=self.webpackChunk_vendure_admin_ui||[]).push([[598],{26598:function(n,a,s){s.r(a),s.d(a,{MarketingModule:function(){return vt},PromotionDetailComponent:function(){return G},PromotionListComponent:function(){return dt},PromotionResolver:function(){return mt},marketingRoutes:function(){return pt},promotionBreadcrumb:function(){return ft}});var d=s(1707),m=s(30724),p=s(83671),f=s(53466),v=s(85816),g=s(30464),Z=s(16320),h=s(27346),b=s(33146),A=s(59416),y=s(38276),C=s(54364),x=s(34652),P=s(57890),k=s(56852),q=s(82505),F=s(51546),O=s(50837),T=s(54116),U=s(30735),_=s(41519),w=s(28854),J=s(15111),L=s(70325),N=s(97388),Q=function(){return["enabled"]};function I(t,o){if(1&t&&(g.TgZ(0,"clr-toggle-wrapper"),g._UZ(1,"input",25),g.TgZ(2,"label"),g._uU(3),g.ALo(4,"translate"),g.qZA(),g.qZA()),2&t){var e=g.oxw();g.xp6(1),g.Q6J("formControl",e.detailForm.get(g.DdM(4,Q))),g.xp6(2),g.Oqu(g.lcZ(4,2,"common.enabled"))}}function D(t,o){if(1&t){var e=g.EpF();g.TgZ(0,"button",26),g.NdJ("click",function(){return g.CHM(e),g.oxw().create()}),g._uU(1),g.ALo(2,"translate"),g.qZA()}if(2&t){var n=g.oxw();g.Q6J("disabled",!n.saveButtonEnabled()),g.xp6(1),g.hij(" ",g.lcZ(2,2,"common.create")," ")}}function j(t,o){if(1&t){var e=g.EpF();g.TgZ(0,"button",26),g.NdJ("click",function(){return g.CHM(e),g.oxw(2).save()}),g._uU(1),g.ALo(2,"translate"),g.qZA()}if(2&t){var n=g.oxw(2);g.Q6J("disabled",!n.saveButtonEnabled()),g.xp6(1),g.hij(" ",g.lcZ(2,2,"common.update")," ")}}function Y(t,o){1&t&&g.YNc(0,j,3,4,"button",27),2&t&&g.Q6J("vdrIfPermissions","UpdatePromotion")}function E(t,o){if(1&t&&(g.TgZ(0,"section",28),g.TgZ(1,"label"),g._uU(2),g.ALo(3,"translate"),g.qZA(),g._UZ(4,"vdr-tabbed-custom-fields",29),g.ALo(5,"hasPermission"),g.qZA()),2&t){var e=g.oxw();g.xp6(2),g.Oqu(g.lcZ(3,4,"common.custom-fields")),g.xp6(2),g.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get("customFields"))("readonly",!g.lcZ(5,6,"UpdatePromotion"))}}function S(t,o){if(1&t){var e=g.EpF();g.ynx(0),g.TgZ(1,"vdr-configurable-input",30),g.NdJ("remove",function(t){return g.CHM(e),g.oxw().removeCondition(t)}),g.ALo(2,"hasPermission"),g.qZA(),g.BQk()}if(2&t){var n=o.$implicit,r=o.index,i=g.oxw();g.xp6(1),g.Q6J("readonly",!g.lcZ(2,4,"UpdatePromotion"))("operation",n)("operationDefinition",i.getConditionDefinition(n))("formControlName",r)}}function $(t,o){if(1&t){var e=g.EpF();g.TgZ(0,"button",35),g.NdJ("click",function(){var t=g.CHM(e).$implicit;return g.oxw(2).addCondition(t)}),g._uU(1),g.qZA()}if(2&t){var n=o.$implicit;g.xp6(1),g.hij(" ",n.description," ")}}function B(t,o){if(1&t&&(g.TgZ(0,"vdr-dropdown"),g.TgZ(1,"button",31),g._UZ(2,"clr-icon",32),g._uU(3),g.ALo(4,"translate"),g.qZA(),g.TgZ(5,"vdr-dropdown-menu",33),g.YNc(6,$,2,1,"button",34),g.qZA(),g.qZA()),2&t){var e=g.oxw();g.xp6(3),g.hij(" ",g.lcZ(4,2,"marketing.add-condition")," "),g.xp6(3),g.Q6J("ngForOf",e.getAvailableConditions())}}function M(t,o){if(1&t){var e=g.EpF();g.TgZ(0,"vdr-configurable-input",36),g.NdJ("remove",function(t){return g.CHM(e),g.oxw().removeAction(t)}),g.ALo(1,"hasPermission"),g.qZA()}if(2&t){var n=o.$implicit,r=o.index,i=g.oxw();g.Q6J("operation",n)("readonly",!g.lcZ(1,4,"UpdatePromotion"))("operationDefinition",i.getActionDefinition(n))("formControlName",r)}}function R(t,o){if(1&t){var e=g.EpF();g.TgZ(0,"button",35),g.NdJ("click",function(){var t=g.CHM(e).$implicit;return g.oxw(2).addAction(t)}),g._uU(1),g.qZA()}if(2&t){var n=o.$implicit;g.xp6(1),g.hij(" ",n.description," ")}}function H(t,o){if(1&t&&(g.TgZ(0,"vdr-dropdown"),g.TgZ(1,"button",31),g._UZ(2,"clr-icon",32),g._uU(3),g.ALo(4,"translate"),g.qZA(),g.TgZ(5,"vdr-dropdown-menu",33),g.YNc(6,R,2,1,"button",34),g.qZA(),g.qZA()),2&t){var e=g.oxw();g.xp6(3),g.hij(" ",g.lcZ(4,2,"marketing.add-action")," "),g.xp6(3),g.Q6J("ngForOf",e.getAvailableActions())}}var G=function(t){i(a,t);var n=c(a);function a(t,r,i,c,s,u,l){var m;return e(this,a),(m=n.call(this,r,t,i,s)).changeDetector=c,m.dataService=s,m.formBuilder=u,m.notificationService=l,m.conditions=[],m.actions=[],m.allConditions=[],m.allActions=[],m.customFields=m.getCustomFieldConfig("Promotion"),m.detailForm=m.formBuilder.group({name:["",d.kI.required],enabled:!0,couponCode:null,perCustomerUsageLimit:null,startsAt:null,endsAt:null,conditions:m.formBuilder.array([]),actions:m.formBuilder.array([]),customFields:m.formBuilder.group(m.customFields.reduce(function(t,e){return Object.assign(Object.assign({},t),o({},e.name,""))},{}))}),m}return r(a,[{key:"ngOnInit",value:function(){var t=this;this.init(),this.promotion$=this.entity$,this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(function(o){t.allActions=o.promotionActions,t.allConditions=o.promotionConditions,t.changeDetector.markForCheck()})}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"getAvailableConditions",value:function(){var t=this;return this.allConditions.filter(function(o){return!t.conditions.find(function(t){return t.code===o.code})})}},{key:"getConditionDefinition",value:function(t){return this.allConditions.find(function(o){return o.code===t.code})}},{key:"getAvailableActions",value:function(){var t=this;return this.allActions.filter(function(o){return!t.actions.find(function(t){return t.code===o.code})})}},{key:"getActionDefinition",value:function(t){return this.allActions.find(function(o){return o.code===t.code})}},{key:"saveButtonEnabled",value:function(){return this.detailForm.dirty&&this.detailForm.valid&&(0!==this.conditions.length||this.detailForm.value.couponCode)&&0!==this.actions.length}},{key:"addCondition",value:function(t){this.addOperation("conditions",t),this.detailForm.markAsDirty()}},{key:"addAction",value:function(t){this.addOperation("actions",t),this.detailForm.markAsDirty()}},{key:"removeCondition",value:function(t){this.removeOperation("conditions",t),this.detailForm.markAsDirty()}},{key:"removeAction",value:function(t){this.removeOperation("actions",t),this.detailForm.markAsDirty()}},{key:"formArrayOf",value:function(t){return this.detailForm.get(t)}},{key:"create",value:function(){var t=this;if(this.detailForm.dirty){var o=this.detailForm.value,e={name:o.name,enabled:!0,couponCode:o.couponCode,perCustomerUsageLimit:o.perCustomerUsageLimit,startsAt:o.startsAt,endsAt:o.endsAt,conditions:this.mapOperationsToInputs(this.conditions,o.conditions),actions:this.mapOperationsToInputs(this.actions,o.actions),customFields:o.customFields};this.dataService.promotion.createPromotion(e).subscribe(function(o){var e=o.createPromotion;switch(e.__typename){case"Promotion":t.notificationService.success((0,m.J)("common.notify-create-success"),{entity:"Promotion"}),t.detailForm.markAsPristine(),t.changeDetector.markForCheck(),t.router.navigate(["../",e.id],{relativeTo:t.route});break;case"MissingConditionsError":t.notificationService.error(e.message)}},function(o){t.notificationService.error((0,m.J)("common.notify-create-error"),{entity:"Promotion"})})}}},{key:"save",value:function(){var t=this;if(this.detailForm.dirty){var o=this.detailForm.value;this.promotion$.pipe((0,f.q)(1),(0,v.zg)(function(e){var n={id:e.id,name:o.name,enabled:o.enabled,couponCode:o.couponCode,perCustomerUsageLimit:o.perCustomerUsageLimit,startsAt:o.startsAt,endsAt:o.endsAt,conditions:t.mapOperationsToInputs(t.conditions,o.conditions),actions:t.mapOperationsToInputs(t.actions,o.actions),customFields:o.customFields};return t.dataService.promotion.updatePromotion(n)})).subscribe(function(o){t.notificationService.success((0,m.J)("common.notify-update-success"),{entity:"Promotion"}),t.detailForm.markAsPristine(),t.changeDetector.markForCheck()},function(o){t.notificationService.error((0,m.J)("common.notify-update-error"),{entity:"Promotion"})})}}},{key:"setFormValues",value:function(t,o){var e=this;this.detailForm.patchValue({name:t.name,enabled:t.enabled,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt}),t.conditions.forEach(function(t){e.addOperation("conditions",t)}),t.actions.forEach(function(t){return e.addOperation("actions",t)}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),t)}},{key:"mapOperationsToInputs",value:function(t,o){return t.map(function(t,e){return{code:t.code,arguments:Object.values(o[e].args).map(function(o,e){return{name:t.args[e].name,value:(0,p.qrw)(o)}})}})}},{key:"addOperation",value:function(t,e){var n=this,r=this.formArrayOf(t),i="conditions"===t?this.conditions:this.actions;if(-1===r.value.findIndex(function(t){return t.code===e.code})){var a=e.args.reduce(function(r,i){var a;return Object.assign(Object.assign({},r),o({},i.name,null!==(a=(0,p.sux)(i.value))&&void 0!==a?a:n.getDefaultArgValue(t,e,i.name)))},{});r.push(this.formBuilder.control({code:e.code,args:a})),i.push({code:e.code,args:e.args.map(function(t){return{name:t.name,value:(0,p.sux)(t.value)}})})}}},{key:"getDefaultArgValue",value:function(t,o,e){var n="conditions"===t?this.allConditions.find(function(t){return t.code===o.code}):this.allActions.find(function(t){return t.code===o.code});if(n){var r=n.args.find(function(t){return t.name===e});if(r)return(0,p.NWQ)(r)}throw new Error('Could not determine default value for "argName"')}},{key:"removeOperation",value:function(t,o){var e=this.formArrayOf(t),n="conditions"===t?this.conditions:this.actions,r=e.value.findIndex(function(t){return t.code===o.code});-1!==r&&(e.removeAt(r),n.splice(r,1))}}]),a}(p.UT_);G.\u0275fac=function(t){return new(t||G)(g.Y36(Z.F0),g.Y36(Z.gz),g.Y36(p.iHG),g.Y36(g.sBO),g.Y36(p.DoR),g.Y36(d.qu),g.Y36(p.gqp))},G.\u0275cmp=g.Xpm({type:G,selectors:[["vdr-promotion-detail"]],features:[g.qOj],decls:48,vars:46,consts:[[1,"flex","clr-align-items-center"],[3,"entity"],[4,"vdrIfPermissions"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","promotion-detail",3,"entity$","detailForm"],[1,"clr-row"],["formArrayName","conditions",1,"clr-col"],[1,"clr-control-label"],[4,"ngFor","ngForOf"],["formArrayName","actions",1,"clr-col"],[3,"operation","readonly","operationDefinition","formControlName","remove",4,"ngFor","ngForOf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["formGroupName","customFields"],["entityName","Promotion",3,"customFields","customFieldsFormGroup","readonly"],[3,"readonly","operation","operationDefinition","formControlName","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[3,"operation","readonly","operationDefinition","formControlName","remove"]],template:function(t,o){if(1&t&&(g.TgZ(0,"vdr-action-bar"),g.TgZ(1,"vdr-ab-left"),g.TgZ(2,"div",0),g._UZ(3,"vdr-entity-info",1),g.ALo(4,"async"),g.YNc(5,I,5,5,"clr-toggle-wrapper",2),g.qZA(),g.qZA(),g.TgZ(6,"vdr-ab-right"),g._UZ(7,"vdr-action-bar-items",3),g.YNc(8,D,3,4,"button",4),g.ALo(9,"async"),g.YNc(10,Y,1,1,"ng-template",null,5,g.W1O),g.qZA(),g.qZA(),g.TgZ(12,"form",6),g.TgZ(13,"vdr-form-field",7),g.ALo(14,"translate"),g._UZ(15,"input",8),g.ALo(16,"hasPermission"),g.qZA(),g.TgZ(17,"vdr-form-field",9),g.ALo(18,"translate"),g._UZ(19,"vdr-datetime-picker",10),g.qZA(),g.TgZ(20,"vdr-form-field",11),g.ALo(21,"translate"),g._UZ(22,"vdr-datetime-picker",12),g.qZA(),g.TgZ(23,"vdr-form-field",13),g.ALo(24,"translate"),g._UZ(25,"input",14),g.ALo(26,"hasPermission"),g.qZA(),g.TgZ(27,"vdr-form-field",15),g.ALo(28,"translate"),g._UZ(29,"input",16),g.ALo(30,"hasPermission"),g.qZA(),g.YNc(31,E,6,8,"section",17),g._UZ(32,"vdr-custom-detail-component-host",18),g.TgZ(33,"div",19),g.TgZ(34,"div",20),g.TgZ(35,"label",21),g._uU(36),g.ALo(37,"translate"),g.qZA(),g.YNc(38,S,3,6,"ng-container",22),g.TgZ(39,"div"),g.YNc(40,B,7,4,"vdr-dropdown",2),g.qZA(),g.qZA(),g.TgZ(41,"div",23),g.TgZ(42,"label",21),g._uU(43),g.ALo(44,"translate"),g.qZA(),g.YNc(45,M,2,6,"vdr-configurable-input",24),g.TgZ(46,"div"),g.YNc(47,H,7,4,"vdr-dropdown",2),g.qZA(),g.qZA(),g.qZA(),g.qZA()),2&t){var e=g.MAs(11);g.xp6(3),g.Q6J("entity",g.lcZ(4,22,o.entity$)),g.xp6(2),g.Q6J("vdrIfPermissions","UpdatePromotion"),g.xp6(3),g.Q6J("ngIf",g.lcZ(9,24,o.isNew$))("ngIfElse",e),g.xp6(4),g.Q6J("formGroup",o.detailForm),g.xp6(1),g.Q6J("label",g.lcZ(14,26,"common.name")),g.xp6(2),g.Q6J("readonly",!g.lcZ(16,28,"UpdatePromotion")),g.xp6(2),g.Q6J("label",g.lcZ(18,30,"marketing.starts-at")),g.xp6(3),g.Q6J("label",g.lcZ(21,32,"marketing.ends-at")),g.xp6(3),g.Q6J("label",g.lcZ(24,34,"marketing.coupon-code")),g.xp6(2),g.Q6J("readonly",!g.lcZ(26,36,"UpdatePromotion")),g.xp6(2),g.Q6J("label",g.lcZ(28,38,"marketing.per-customer-limit")),g.xp6(2),g.Q6J("readonly",!g.lcZ(30,40,"UpdatePromotion")),g.xp6(2),g.Q6J("ngIf",o.customFields.length),g.xp6(1),g.Q6J("entity$",o.entity$)("detailForm",o.detailForm),g.xp6(4),g.Oqu(g.lcZ(37,42,"marketing.conditions")),g.xp6(2),g.Q6J("ngForOf",o.conditions),g.xp6(2),g.Q6J("vdrIfPermissions","UpdatePromotion"),g.xp6(3),g.Oqu(g.lcZ(44,44,"marketing.actions")),g.xp6(2),g.Q6J("ngForOf",o.actions),g.xp6(2),g.Q6J("vdrIfPermissions","UpdatePromotion")}},directives:[h.Kk,h.BN,b.V,A.H,h.mz,y.W,C.O5,d._Y,d.JL,d.sg,x.h,P.y,d.Fj,d.JJ,d.u,k.I,d.qQ,d.Fd,d.wV,q.C,d.CE,F.MgK,C.sg,F.PEh,d.Wl,F.KKC,d.oH,d.x0,O.y,T.q,U.J,_.U,F.qvL,w.N,J.H],pipes:[C.Ov,L.X$,N.j],styles:[""],changeDetection:0});var V=s(89919),z=s(8117),K=s(80639),W=s(22663),X=s(79902),tt=s(20365),ot=s(30901),et=s(28899),nt=s(74447),rt=s(2651),it=function(){return["./create"]};function at(t,o){1&t&&(g.TgZ(0,"a",6),g._UZ(1,"clr-icon",7),g._uU(2),g.ALo(3,"translate"),g.qZA()),2&t&&(g.Q6J("routerLink",g.DdM(4,it)),g.xp6(2),g.hij(" ",g.lcZ(3,2,"marketing.create-new-promotion")," "))}function ct(t,o){if(1&t&&(g.TgZ(0,"vdr-chip"),g._uU(1),g.qZA()),2&t){var e=g.oxw().item;g.xp6(1),g.hij(" ",e.couponCode," ")}}function st(t,o){1&t&&(g.TgZ(0,"vdr-chip"),g._uU(1),g.ALo(2,"translate"),g.qZA()),2&t&&(g.xp6(1),g.Oqu(g.lcZ(2,1,"common.disabled")))}var ut=function(t){return["./",t]};function lt(t,o){if(1&t){var e=g.EpF();g.TgZ(0,"td",8),g._uU(1),g.qZA(),g.TgZ(2,"td",8),g.YNc(3,ct,2,1,"vdr-chip",9),g.qZA(),g.TgZ(4,"td",8),g._uU(5),g.ALo(6,"localeDate"),g.qZA(),g.TgZ(7,"td",8),g._uU(8),g.ALo(9,"localeDate"),g.qZA(),g.TgZ(10,"td",10),g.YNc(11,st,3,3,"vdr-chip",9),g.qZA(),g.TgZ(12,"td",11),g._UZ(13,"vdr-table-row-action",12),g.ALo(14,"translate"),g.qZA(),g.TgZ(15,"td",11),g.TgZ(16,"vdr-dropdown"),g.TgZ(17,"button",13),g._uU(18),g.ALo(19,"translate"),g._UZ(20,"clr-icon",14),g.qZA(),g.TgZ(21,"vdr-dropdown-menu",15),g.TgZ(22,"button",16),g.NdJ("click",function(){var t=g.CHM(e).item;return g.oxw().deletePromotion(t.id)}),g.ALo(23,"hasPermission"),g._UZ(24,"clr-icon",17),g._uU(25),g.ALo(26,"translate"),g.qZA(),g.qZA(),g.qZA(),g.qZA()}if(2&t){var n=o.item;g.xp6(1),g.Oqu(n.name),g.xp6(2),g.Q6J("ngIf",n.couponCode),g.xp6(2),g.Oqu(g.xi3(6,10,n.startsAt,"longDate")),g.xp6(3),g.Oqu(g.xi3(9,13,n.endsAt,"longDate")),g.xp6(3),g.Q6J("ngIf",!n.enabled),g.xp6(2),g.Q6J("label",g.lcZ(14,16,"common.edit"))("linkTo",g.VKq(24,ut,n.id)),g.xp6(5),g.hij(" ",g.lcZ(19,18,"common.actions")," "),g.xp6(4),g.Q6J("disabled",!g.lcZ(23,20,"DeletePromotion")),g.xp6(3),g.hij(" ",g.lcZ(26,22,"common.delete")," ")}}var dt=function(o){i(a,o);var n=c(a);function a(o,r,i,c,s){var m,p;return e(this,a),(p=n.call(this,r,i)).dataService=o,p.notificationService=c,p.modalService=s,p.searchForm=new d.cw({name:new d.NI(""),couponCode:new d.NI("")}),t((m=u(p),l(a.prototype)),"setQueryFn",m).call(m,function(){var t;return(t=p.dataService.promotion).getPromotions.apply(t,arguments).refetchOnChannelChange()},function(t){return t.promotions},function(t,o){return p.createQueryOptions(t,o,p.searchForm.value)}),p}return r(a,[{key:"ngOnInit",value:function(){var o=this;t(l(a.prototype),"ngOnInit",this).call(this),(0,V.T)(this.searchForm.valueChanges.pipe((0,K.b)(250)),this.route.queryParamMap).pipe((0,W.R)(this.destroy$)).subscribe(function(t){t.params||o.setPageNumber(1),o.refresh()})}},{key:"deletePromotion",value:function(t){var o=this;this.modalService.dialog({title:(0,m.J)("catalog.confirm-delete-promotion"),buttons:[{type:"secondary",label:(0,m.J)("common.cancel")},{type:"danger",label:(0,m.J)("common.delete"),returnValue:!0}]}).pipe((0,X.w)(function(e){return e?o.dataService.promotion.deletePromotion(t):z.E})).subscribe(function(){o.notificationService.success((0,m.J)("common.notify-delete-success"),{entity:"Promotion"}),o.refresh()},function(t){o.notificationService.error((0,m.J)("common.notify-delete-error"),{entity:"Promotion"})})}},{key:"createQueryOptions",value:function(t,o,e){var n={};return e.couponCode&&(n.couponCode={contains:e.couponCode}),e.name&&(n.name={contains:e.name}),{options:{skip:t,take:o,filter:n}}}}]),a}(p.t7C);dt.\u0275fac=function(t){return new(t||dt)(g.Y36(p.DoR),g.Y36(Z.F0),g.Y36(Z.gz),g.Y36(p.gqp),g.Y36(p.Z7U))},dt.\u0275cmp=g.Xpm({type:dt,selectors:[["vdr-promotion-list"]],features:[g.qOj],decls:31,vars:32,consts:[[1,"search-form",3,"formGroup"],["type","text","formControlName","name",1,"search-input",3,"placeholder"],["type","text","formControlName","couponCode",1,"search-input",3,"placeholder"],["locationId","promotion-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[4,"ngIf"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"]],template:function(t,o){1&t&&(g.TgZ(0,"vdr-action-bar"),g.TgZ(1,"vdr-ab-left"),g.TgZ(2,"form",0),g._UZ(3,"input",1),g.ALo(4,"translate"),g._UZ(5,"input",2),g.ALo(6,"translate"),g.qZA(),g.qZA(),g.TgZ(7,"vdr-ab-right"),g._UZ(8,"vdr-action-bar-items",3),g.YNc(9,at,4,5,"a",4),g.qZA(),g.qZA(),g.TgZ(10,"vdr-data-table",5),g.NdJ("pageChange",function(t){return o.setPageNumber(t)})("itemsPerPageChange",function(t){return o.setItemsPerPage(t)}),g.ALo(11,"async"),g.ALo(12,"async"),g.ALo(13,"async"),g.ALo(14,"async"),g.TgZ(15,"vdr-dt-column"),g._uU(16),g.ALo(17,"translate"),g.qZA(),g.TgZ(18,"vdr-dt-column"),g._uU(19),g.ALo(20,"translate"),g.qZA(),g.TgZ(21,"vdr-dt-column"),g._uU(22),g.ALo(23,"translate"),g.qZA(),g.TgZ(24,"vdr-dt-column"),g._uU(25),g.ALo(26,"translate"),g.qZA(),g._UZ(27,"vdr-dt-column"),g._UZ(28,"vdr-dt-column"),g._UZ(29,"vdr-dt-column"),g.YNc(30,lt,27,26,"ng-template"),g.qZA()),2&t&&(g.xp6(2),g.Q6J("formGroup",o.searchForm),g.xp6(1),g.Q6J("placeholder",g.lcZ(4,12,"marketing.search-by-name")),g.xp6(2),g.Q6J("placeholder",g.lcZ(6,14,"marketing.search-by-coupon-code")),g.xp6(4),g.Q6J("vdrIfPermissions","CreatePromotion"),g.xp6(1),g.Q6J("items",g.lcZ(11,16,o.items$))("itemsPerPage",g.lcZ(12,18,o.itemsPerPage$))("totalItems",g.lcZ(13,20,o.totalItems$))("currentPage",g.lcZ(14,22,o.currentPage$)),g.xp6(6),g.Oqu(g.lcZ(17,24,"common.name")),g.xp6(3),g.Oqu(g.lcZ(20,26,"marketing.coupon-code")),g.xp6(3),g.Oqu(g.lcZ(23,28,"marketing.starts-at")),g.xp6(3),g.Oqu(g.lcZ(26,30,"marketing.ends-at")))},directives:[h.Kk,h.BN,d._Y,d.JL,d.sg,P.y,d.Fj,d.JJ,d.u,h.mz,y.W,A.H,tt.Q,ot.E,Z.yS,F.qvL,C.O5,et.v,U.J,_.U,w.N,J.H,nt.Y],pipes:[L.X$,C.Ov,rt.H,N.j],styles:[".search-form[_ngcontent-%COMP%]{padding:0}.search-input[_ngcontent-%COMP%]{margin:6px 8px 0 0;min-width:200px}"],changeDetection:0});var mt=function(t){i(n,t);var o=c(n);function n(t,r){return e(this,n),o.call(this,t,{__typename:"Promotion",id:"",createdAt:"",updatedAt:"",name:"",enabled:!1,conditions:[],actions:[]},function(t){return r.promotion.getPromotion(t).mapStream(function(t){return t.promotion})})}return n}(p.p_9);mt.\u0275fac=function(t){return new(t||mt)(g.LFG(Z.F0),g.LFG(p.DoR))},mt.\u0275prov=g.Yz7({token:mt,factory:mt.\u0275fac,providedIn:"root"});var pt=[{path:"promotions",component:dt,data:{breadcrumb:(0,m.J)("breadcrumb.promotions")}},{path:"promotions/:id",component:G,resolve:(0,p.Po4)(mt),canDeactivate:[p.TSp],data:{breadcrumb:ft}}];function ft(t,o){return(0,p.YWC)({entity:t.entity,id:o.id,breadcrumbKey:"breadcrumb.promotions",getName:function(t){return t.name},route:"promotions"})}var vt=function t(){e(this,t)};vt.\u0275fac=function(t){return new(t||vt)},vt.\u0275mod=g.oAB({type:vt}),vt.\u0275inj=g.cJS({imports:[[p.m81,Z.Bz.forChild(pt)]]})}}])}();
//# sourceMappingURL=598-es5.c627e3801a2dad3ec02d.js.map