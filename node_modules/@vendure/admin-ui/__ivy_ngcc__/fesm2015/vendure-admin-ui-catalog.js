import * as i0 from '@angular/core';
import { Component, ChangeDetectionStrategy, ChangeDetectorRef, ViewChild, Injectable, EventEmitter, Input, HostBinding, Output, ContentChild, TemplateRef, SkipSelf, Optional, forwardRef, NgModule } from '@angular/core';
import * as i1 from '@angular/router';
import { Router, ActivatedRoute, RouterModule } from '@angular/router';
import * as i2 from '@vendure/admin-ui/core';
import { BaseDetailComponent, ServerConfigService, NotificationService, DataService, BaseListComponent, SortOrder, LogicalOperator, DeletionResult, ModalService, Permission, unicodePatternValidator, findTranslation, getConfigArgValue, createUpdatedTranslatable, encodeConfigArgValue, FacetValueSelectorComponent, flattenFacetValues, JobState, JobQueueService, getDefaultUiLanguage, BaseEntityResolver, AssetType, createResolveData, CanDeactivateDetailGuard, detailBreadcrumb, AssetPickerDialogComponent, AssetPreviewDialogComponent, SingleSearchSelectionModelFactory, GlobalFlag, SharedModule } from '@vendure/admin-ui/core';
import { marker } from '@biesbjerg/ngx-translate-extract-marker';
import { map, debounceTime, takeUntil, finalize, switchMap, take, mergeMap, shareReplay, distinctUntilChanged, tap, mapTo, filter, startWith, skipUntil, skip, withLatestFrom, delay } from 'rxjs/operators';
import { FormGroup, FormControl, FormBuilder, Validators, FormArray, NG_VALUE_ACCESSOR } from '@angular/forms';
import { BehaviorSubject, combineLatest, EMPTY, Subject, forkJoin, of, throwError, from, merge } from 'rxjs';
import { normalizeString } from '@vendure/common/lib/normalize-string';
import { notNullOrUndefined, generateAllCombinations } from '@vendure/common/lib/shared-utils';
import { SortOrder as SortOrder$1 } from '@vendure/common/lib/generated-shop-types';
import { Location } from '@angular/common';
import { DEFAULT_CHANNEL_CODE } from '@vendure/common/lib/shared-constants';
import { unique } from '@vendure/common/lib/unique';
import { __awaiter } from 'tslib';
import { pick } from '@vendure/common/lib/pick';
import { moveItemInArray } from '@angular/cdk/drag-drop';
import { SELECTION_MODEL_FACTORY } from '@ng-select/ng-select';

import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';
import * as ɵngcc2 from '@vendure/admin-ui/core';
import * as ɵngcc3 from '@angular/forms';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '@ngx-translate/core';
import * as ɵngcc6 from 'ngx-pagination';
import * as ɵngcc7 from '@clr/angular';
import * as ɵngcc8 from '@angular/cdk/drag-drop';
import * as ɵngcc9 from '@ng-select/ng-select';

function AssetDetailComponent_button_6_Template(rf, ctx) { if (rf & 1) {
    const _r2 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 4);
    ɵngcc0.ɵɵlistener("click", function AssetDetailComponent_button_6_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r2); const ctx_r1 = ɵngcc0.ɵɵnextContext(); return ctx_r1.save(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r0.detailForm.invalid || ctx_r0.detailForm.pristine);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.update"), " ");
} }
const _c0 = function () { return ["UpdateCatalog", "UpdateAsset"]; };
const _c1 = function () { return {}; };
const _c2 = function () { return ["DeleteCatalog", "DeleteAsset"]; };
const _c3 = ["collectionContents"];
function CollectionDetailComponent_button_10_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 6);
    ɵngcc0.ɵɵlistener("click", function CollectionDetailComponent_button_10_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.create(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r0.detailForm.invalid || ctx_r0.detailForm.pristine);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.create"), " ");
} }
function CollectionDetailComponent_ng_template_12_button_0_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 6);
    ɵngcc0.ɵɵlistener("click", function CollectionDetailComponent_ng_template_12_button_0_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r8); const ctx_r7 = ɵngcc0.ɵɵnextContext(2); return ctx_r7.save(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("disabled", (ctx_r6.detailForm.invalid || ctx_r6.detailForm.pristine) && !ctx_r6.assetsChanged());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.update"), " ");
} }
function CollectionDetailComponent_ng_template_12_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, CollectionDetailComponent_ng_template_12_button_0_Template, 3, 4, "button", 7);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r2.updatePermission);
} }
function CollectionDetailComponent_form_14_ng_container_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "catalog.public"));
} }
function CollectionDetailComponent_form_14_ng_template_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.private"));
} }
const _c4 = function () { return ["customFields"]; };
function CollectionDetailComponent_form_14_section_24_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 30);
    ɵngcc0.ɵɵelementStart(1, "label");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(4, "vdr-tabbed-custom-fields", 31);
    ɵngcc0.ɵɵpipe(5, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r13 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 4, "common.custom-fields"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("customFields", ctx_r13.customFields)("customFieldsFormGroup", ctx_r13.detailForm.get(ɵngcc0.ɵɵpureFunction0(8, _c4)))("readonly", !ɵngcc0.ɵɵpipeBind1(5, 6, ctx_r13.updatePermission));
} }
function CollectionDetailComponent_form_14_ng_container_33_Template(rf, ctx) { if (rf & 1) {
    const _r21 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "vdr-configurable-input", 32);
    ɵngcc0.ɵɵlistener("remove", function CollectionDetailComponent_form_14_ng_container_33_Template_vdr_configurable_input_remove_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r21); const ctx_r20 = ɵngcc0.ɵɵnextContext(2); return ctx_r20.removeFilter($event); });
    ɵngcc0.ɵɵpipe(2, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const filter_r18 = ctx.$implicit;
    const i_r19 = ctx.index;
    const ctx_r14 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("operation", filter_r18)("operationDefinition", ctx_r14.getFilterDefinition(filter_r18))("formControlName", i_r19)("readonly", !ɵngcc0.ɵɵpipeBind1(2, 4, ctx_r14.updatePermission));
} }
function CollectionDetailComponent_form_14_div_34_button_7_Template(rf, ctx) { if (rf & 1) {
    const _r25 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 37);
    ɵngcc0.ɵɵlistener("click", function CollectionDetailComponent_form_14_div_34_button_7_Template_button_click_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r25); const filter_r23 = restoredCtx.$implicit; const ctx_r24 = ɵngcc0.ɵɵnextContext(3); return ctx_r24.addFilter(filter_r23); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const filter_r23 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", filter_r23.description, " ");
} }
function CollectionDetailComponent_form_14_div_34_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "vdr-dropdown");
    ɵngcc0.ɵɵelementStart(2, "button", 33);
    ɵngcc0.ɵɵelement(3, "clr-icon", 34);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "vdr-dropdown-menu", 35);
    ɵngcc0.ɵɵtemplate(7, CollectionDetailComponent_form_14_div_34_button_7_Template, 2, 1, "button", 36);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r15 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 2, "marketing.add-condition"), " ");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r15.allFilters);
} }
const _c5 = function (a0) { return { count: a0 }; };
function CollectionDetailComponent_form_14_ng_template_38_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 38);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const count_r26 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "catalog.collection-contents"), " (", ɵngcc0.ɵɵpipeBind2(3, 4, "common.results-count", ɵngcc0.ɵɵpureFunction1(7, _c5, count_r26)), ") ");
} }
const _c6 = function (a0) { return { pattern: a0 }; };
function CollectionDetailComponent_form_14_Template(rf, ctx) { if (rf & 1) {
    const _r28 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "form", 8);
    ɵngcc0.ɵɵelementStart(1, "div", 9);
    ɵngcc0.ɵɵelementStart(2, "div", 10);
    ɵngcc0.ɵɵelementStart(3, "vdr-form-field", 11);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementStart(5, "clr-toggle-wrapper");
    ɵngcc0.ɵɵelement(6, "input", 12);
    ɵngcc0.ɵɵpipe(7, "hasPermission");
    ɵngcc0.ɵɵelementStart(8, "label", 13);
    ɵngcc0.ɵɵtemplate(9, CollectionDetailComponent_form_14_ng_container_9_Template, 3, 3, "ng-container", 14);
    ɵngcc0.ɵɵtemplate(10, CollectionDetailComponent_form_14_ng_template_10_Template, 2, 3, "ng-template", null, 15, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "vdr-form-field", 16);
    ɵngcc0.ɵɵpipe(13, "translate");
    ɵngcc0.ɵɵelementStart(14, "input", 17);
    ɵngcc0.ɵɵlistener("input", function CollectionDetailComponent_form_14_Template_input_input_14_listener($event) { ɵngcc0.ɵɵrestoreView(_r28); const ctx_r27 = ɵngcc0.ɵɵnextContext(); return ctx_r27.updateSlug($event.target.value); });
    ɵngcc0.ɵɵpipe(15, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(16, "vdr-form-field", 18);
    ɵngcc0.ɵɵpipe(17, "translate");
    ɵngcc0.ɵɵpipe(18, "translate");
    ɵngcc0.ɵɵelement(19, "input", 19);
    ɵngcc0.ɵɵpipe(20, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(21, "vdr-rich-text-editor", 20);
    ɵngcc0.ɵɵpipe(22, "hasPermission");
    ɵngcc0.ɵɵpipe(23, "translate");
    ɵngcc0.ɵɵtemplate(24, CollectionDetailComponent_form_14_section_24_Template, 6, 9, "section", 21);
    ɵngcc0.ɵɵelement(25, "vdr-custom-detail-component-host", 22);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(26, "div", 23);
    ɵngcc0.ɵɵelementStart(27, "vdr-assets", 24);
    ɵngcc0.ɵɵlistener("change", function CollectionDetailComponent_form_14_Template_vdr_assets_change_27_listener($event) { ɵngcc0.ɵɵrestoreView(_r28); const ctx_r29 = ɵngcc0.ɵɵnextContext(); return ctx_r29.assetChanges = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(28, "div", 25);
    ɵngcc0.ɵɵelementStart(29, "div", 10);
    ɵngcc0.ɵɵelementStart(30, "label");
    ɵngcc0.ɵɵtext(31);
    ɵngcc0.ɵɵpipe(32, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(33, CollectionDetailComponent_form_14_ng_container_33_Template, 3, 6, "ng-container", 26);
    ɵngcc0.ɵɵtemplate(34, CollectionDetailComponent_form_14_div_34_Template, 8, 4, "div", 27);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(35, "div", 10);
    ɵngcc0.ɵɵelementStart(36, "vdr-collection-contents", 28, 29);
    ɵngcc0.ɵɵtemplate(38, CollectionDetailComponent_form_14_ng_template_38_Template, 4, 9, "ng-template");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const category_r9 = ctx.ngIf;
    const _r11 = ɵngcc0.ɵɵreference(11);
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("formGroup", ctx_r3.detailForm);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(4, 22, "catalog.visibility"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("vdrDisabled", !ɵngcc0.ɵɵpipeBind1(7, 24, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.detailForm.value.visible)("ngIfElse", _r11);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(13, 26, "common.name"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(15, 28, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(17, 30, "catalog.slug"))("errors", ɵngcc0.ɵɵpureFunction1(42, _c6, ɵngcc0.ɵɵpipeBind1(18, 32, "catalog.slug-pattern-error")));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(20, 34, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(22, 36, ctx_r3.updatePermission))("label", ɵngcc0.ɵɵpipeBind1(23, 38, "common.description"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.customFields.length);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("entity$", ctx_r3.entity$)("detailForm", ctx_r3.detailForm);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("assets", category_r9.assets)("featuredAsset", category_r9.featuredAsset)("updatePermissions", ctx_r3.updatePermission);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(32, 40, "catalog.filters"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r3.filters);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r3.updatePermission);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("collectionId", ctx_r3.id);
} }
const _c7 = function () { return ["./create"]; };
function CollectionListComponent_a_16_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 11);
    ɵngcc0.ɵɵelement(1, "clr-icon", 12);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction0(4, _c7));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 2, "catalog.create-new-collection"), " ");
} }
function CollectionListComponent_ng_template_25_Template(rf, ctx) { if (rf & 1) {
    const _r4 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 13);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "button", 14);
    ɵngcc0.ɵɵlistener("click", function CollectionListComponent_ng_template_25_Template_button_click_4_listener() { ɵngcc0.ɵɵrestoreView(_r4); const ctx_r3 = ɵngcc0.ɵɵnextContext(); return ctx_r3.closeContents(); });
    ɵngcc0.ɵɵelement(5, "clr-icon", 15);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const count_r2 = ctx.$implicit;
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2(" ", ɵngcc0.ɵɵpipeBind1(2, 2, ctx_r1.activeCollectionTitle$), " (", ɵngcc0.ɵɵpipeBind2(3, 4, "common.results-count", ɵngcc0.ɵɵpureFunction1(7, _c5, count_r2)), ") ");
} }
const _c8 = function () { return ["CreateCatalog", "CreateCollection"]; };
function FacetDetailComponent_button_10_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 6);
    ɵngcc0.ɵɵlistener("click", function FacetDetailComponent_button_10_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.create(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r0.detailForm.invalid || ctx_r0.detailForm.pristine);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.create"), " ");
} }
function FacetDetailComponent_ng_template_12_button_0_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 6);
    ɵngcc0.ɵɵlistener("click", function FacetDetailComponent_ng_template_12_button_0_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r8); const ctx_r7 = ɵngcc0.ɵɵnextContext(2); return ctx_r7.save(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("disabled", ctx_r6.detailForm.invalid || ctx_r6.detailForm.pristine);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.update"), " ");
} }
function FacetDetailComponent_ng_template_12_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, FacetDetailComponent_ng_template_12_button_0_Template, 3, 4, "button", 7);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r2.updatePermission);
} }
function FacetDetailComponent_form_14_ng_container_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "catalog.public"));
} }
function FacetDetailComponent_form_14_ng_template_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.private"));
} }
const _c9 = function () { return ["facet", "customFields"]; };
function FacetDetailComponent_form_14_section_20_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 22);
    ɵngcc0.ɵɵelementStart(1, "label");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(4, "vdr-tabbed-custom-fields", 23);
    ɵngcc0.ɵɵpipe(5, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r13 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 4, "common.custom-fields"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("customFields", ctx_r13.customFields)("customFieldsFormGroup", ctx_r13.detailForm.get(ɵngcc0.ɵɵpureFunction0(8, _c9)))("readonly", !ɵngcc0.ɵɵpipeBind1(5, 6, ctx_r13.updatePermission));
} }
function FacetDetailComponent_form_14_section_22_table_4_ng_container_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "th");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, "common.custom-fields"));
} }
const _c10 = function (a1) { return ["values", a1, "customFields"]; };
function FacetDetailComponent_form_14_section_22_table_4_tr_13_td_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "td", 40);
    ɵngcc0.ɵɵelement(1, "vdr-tabbed-custom-fields", 41);
    ɵngcc0.ɵɵpipe(2, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const i_r20 = ɵngcc0.ɵɵnextContext().index;
    const ctx_r21 = ɵngcc0.ɵɵnextContext(4);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("customFields", ctx_r21.customValueFields)("compact", true)("customFieldsFormGroup", ctx_r21.detailForm.get(ɵngcc0.ɵɵpureFunction1(6, _c10, i_r20)))("readonly", !ɵngcc0.ɵɵpipeBind1(2, 4, ctx_r21.updatePermission));
} }
function FacetDetailComponent_form_14_section_22_table_4_tr_13_Template(rf, ctx) { if (rf & 1) {
    const _r25 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "tr", 30);
    ɵngcc0.ɵɵelementStart(1, "td", 31);
    ɵngcc0.ɵɵelement(2, "vdr-entity-info", 0);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "td", 31);
    ɵngcc0.ɵɵelementStart(4, "input", 32);
    ɵngcc0.ɵɵlistener("input", function FacetDetailComponent_form_14_section_22_table_4_tr_13_Template_input_input_4_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r25); const i_r20 = restoredCtx.index; const facet_r9 = ɵngcc0.ɵɵnextContext(3).ngIf; const ctx_r23 = ɵngcc0.ɵɵnextContext(); return ctx_r23.updateValueCode(facet_r9.values[i_r20] == null ? null : facet_r9.values[i_r20].code, $event.target.value, i_r20); });
    ɵngcc0.ɵɵpipe(5, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "td", 31);
    ɵngcc0.ɵɵelement(7, "input", 33);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(8, FacetDetailComponent_form_14_section_22_table_4_tr_13_td_8_Template, 3, 8, "td", 34);
    ɵngcc0.ɵɵelementStart(9, "td", 31);
    ɵngcc0.ɵɵelementStart(10, "vdr-dropdown");
    ɵngcc0.ɵɵelementStart(11, "button", 35);
    ɵngcc0.ɵɵtext(12);
    ɵngcc0.ɵɵpipe(13, "translate");
    ɵngcc0.ɵɵelement(14, "clr-icon", 36);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(15, "vdr-dropdown-menu", 37);
    ɵngcc0.ɵɵelementStart(16, "button", 38);
    ɵngcc0.ɵɵlistener("click", function FacetDetailComponent_form_14_section_22_table_4_tr_13_Template_button_click_16_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r25); const i_r20 = restoredCtx.index; const facet_r9 = ɵngcc0.ɵɵnextContext(3).ngIf; const ctx_r26 = ɵngcc0.ɵɵnextContext(); return ctx_r26.deleteFacetValue(facet_r9.values[i_r20] == null ? null : facet_r9.values[i_r20].id, i_r20); });
    ɵngcc0.ɵɵpipe(17, "hasPermission");
    ɵngcc0.ɵɵelement(18, "clr-icon", 39);
    ɵngcc0.ɵɵtext(19);
    ɵngcc0.ɵɵpipe(20, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const value_r19 = ctx.$implicit;
    const i_r20 = ctx.index;
    const ctx_r18 = ɵngcc0.ɵɵnextContext(4);
    ɵngcc0.ɵɵproperty("formGroupName", i_r20);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("entity", value_r19);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(5, 7, ctx_r18.updatePermission));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r18.customValueFields.length);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(13, 9, "common.actions"), " ");
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(17, 11, ctx_r18.updatePermission));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(20, 13, "common.delete"), " ");
} }
function FacetDetailComponent_form_14_section_22_table_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "table", 27);
    ɵngcc0.ɵɵelementStart(1, "thead");
    ɵngcc0.ɵɵelementStart(2, "tr");
    ɵngcc0.ɵɵelement(3, "th");
    ɵngcc0.ɵɵelementStart(4, "th");
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "th");
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(10, FacetDetailComponent_form_14_section_22_table_4_ng_container_10_Template, 4, 3, "ng-container", 28);
    ɵngcc0.ɵɵelement(11, "th");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "tbody");
    ɵngcc0.ɵɵtemplate(13, FacetDetailComponent_form_14_section_22_table_4_tr_13_Template, 21, 15, "tr", 29);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r15 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(6, 4, "common.name"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(9, 6, "common.code"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r15.customValueFields.length);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r15.values);
} }
function FacetDetailComponent_form_14_section_22_button_6_Template(rf, ctx) { if (rf & 1) {
    const _r29 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 42);
    ɵngcc0.ɵɵlistener("click", function FacetDetailComponent_form_14_section_22_button_6_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r29); const ctx_r28 = ɵngcc0.ɵɵnextContext(3); return ctx_r28.addFacetValue(); });
    ɵngcc0.ɵɵelement(1, "clr-icon", 43);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 1, "catalog.add-facet-value"), " ");
} }
const _c11 = function () { return ["CreateCatalog", "CreateFacet"]; };
function FacetDetailComponent_form_14_section_22_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 24);
    ɵngcc0.ɵɵelementStart(1, "label");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(4, FacetDetailComponent_form_14_section_22_table_4_Template, 14, 8, "table", 25);
    ɵngcc0.ɵɵelementStart(5, "div");
    ɵngcc0.ɵɵtemplate(6, FacetDetailComponent_form_14_section_22_button_6_Template, 4, 3, "button", 26);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r14 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 3, "catalog.facet-values"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", 0 < ctx_r14.getValuesFormArray().length);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(5, _c11));
} }
function FacetDetailComponent_form_14_Template(rf, ctx) { if (rf & 1) {
    const _r31 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "form", 8);
    ɵngcc0.ɵɵelementStart(1, "section", 9);
    ɵngcc0.ɵɵelementStart(2, "vdr-form-field", 10);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementStart(4, "clr-toggle-wrapper");
    ɵngcc0.ɵɵelement(5, "input", 11);
    ɵngcc0.ɵɵpipe(6, "hasPermission");
    ɵngcc0.ɵɵelementStart(7, "label", 12);
    ɵngcc0.ɵɵtemplate(8, FacetDetailComponent_form_14_ng_container_8_Template, 3, 3, "ng-container", 13);
    ɵngcc0.ɵɵtemplate(9, FacetDetailComponent_form_14_ng_template_9_Template, 2, 3, "ng-template", null, 14, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(11, "vdr-form-field", 15);
    ɵngcc0.ɵɵpipe(12, "translate");
    ɵngcc0.ɵɵelementStart(13, "input", 16);
    ɵngcc0.ɵɵlistener("input", function FacetDetailComponent_form_14_Template_input_input_13_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r31); const facet_r9 = restoredCtx.ngIf; const ctx_r30 = ɵngcc0.ɵɵnextContext(); return ctx_r30.updateCode(facet_r9.code, $event.target.value); });
    ɵngcc0.ɵɵpipe(14, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(15, "vdr-form-field", 17);
    ɵngcc0.ɵɵpipe(16, "translate");
    ɵngcc0.ɵɵpipe(17, "hasPermission");
    ɵngcc0.ɵɵelement(18, "input", 18);
    ɵngcc0.ɵɵpipe(19, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(20, FacetDetailComponent_form_14_section_20_Template, 6, 9, "section", 19);
    ɵngcc0.ɵɵelement(21, "vdr-custom-detail-component-host", 20);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(22, FacetDetailComponent_form_14_section_22_Template, 7, 6, "section", 21);
    ɵngcc0.ɵɵpipe(23, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r11 = ɵngcc0.ɵɵreference(10);
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("formGroup", ctx_r3.detailForm);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(3, 14, "catalog.visibility"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("vdrDisabled", !ɵngcc0.ɵɵpipeBind1(6, 16, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.detailForm.value.facet.visible)("ngIfElse", _r11);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(12, 18, "common.name"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(14, 20, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(16, 22, "common.code"))("readOnlyToggle", ɵngcc0.ɵɵpipeBind1(17, 24, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(19, 26, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.customFields.length);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("entity$", ctx_r3.entity$)("detailForm", ctx_r3.detailForm);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ɵngcc0.ɵɵpipeBind1(23, 28, ctx_r3.isNew$));
} }
const _c12 = ".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}";
function FacetListComponent_a_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 7);
    ɵngcc0.ɵɵelement(1, "clr-icon", 8);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction0(4, _c7));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 2, "catalog.create-new-facet"), " ");
} }
function FacetListComponent_ng_template_30_vdr_facet_value_chip_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-facet-value-chip", 21);
} if (rf & 2) {
    const value_r8 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("facetValue", value_r8)("removable", false)("displayFacetName", false);
} }
function FacetListComponent_ng_template_30_button_7_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelement(1, "clr-icon", 8);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const facet_r2 = ɵngcc0.ɵɵnextContext(2).item;
    const ctx_r9 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", facet_r2.values.length - ctx_r9.initialLimit, " ");
} }
function FacetListComponent_ng_template_30_button_7_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "clr-icon", 24);
} }
function FacetListComponent_ng_template_30_button_7_Template(rf, ctx) { if (rf & 1) {
    const _r15 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 22);
    ɵngcc0.ɵɵlistener("click", function FacetListComponent_ng_template_30_button_7_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r15); const facet_r2 = ɵngcc0.ɵɵnextContext().item; const ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.toggleDisplayLimit(facet_r2); });
    ɵngcc0.ɵɵtemplate(1, FacetListComponent_ng_template_30_button_7_ng_container_1_Template, 3, 1, "ng-container", 12);
    ɵngcc0.ɵɵtemplate(2, FacetListComponent_ng_template_30_button_7_ng_template_2_Template, 1, 0, "ng-template", null, 23, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r10 = ɵngcc0.ɵɵreference(3);
    const facet_r2 = ɵngcc0.ɵɵnextContext().item;
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (ctx_r4.displayLimit[facet_r2.id] || 0) < facet_r2.values.length)("ngIfElse", _r10);
} }
function FacetListComponent_ng_template_30_ng_container_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "catalog.public"));
} }
function FacetListComponent_ng_template_30_ng_template_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.private"));
} }
const _c13 = function (a1) { return ["./", a1]; };
const _c14 = function () { return ["DeleteCatalog", "DeleteFacet"]; };
function FacetListComponent_ng_template_30_Template(rf, ctx) { if (rf & 1) {
    const _r18 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "td", 9);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(2, "td", 9);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "td", 9);
    ɵngcc0.ɵɵtemplate(5, FacetListComponent_ng_template_30_vdr_facet_value_chip_5_Template, 1, 3, "vdr-facet-value-chip", 10);
    ɵngcc0.ɵɵpipe(6, "slice");
    ɵngcc0.ɵɵtemplate(7, FacetListComponent_ng_template_30_button_7_Template, 4, 2, "button", 11);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(8, "td", 9);
    ɵngcc0.ɵɵelementStart(9, "vdr-chip");
    ɵngcc0.ɵɵtemplate(10, FacetListComponent_ng_template_30_ng_container_10_Template, 3, 3, "ng-container", 12);
    ɵngcc0.ɵɵtemplate(11, FacetListComponent_ng_template_30_ng_template_11_Template, 2, 3, "ng-template", null, 13, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(13, "td", 14);
    ɵngcc0.ɵɵelement(14, "vdr-table-row-action", 15);
    ɵngcc0.ɵɵpipe(15, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(16, "td", 14);
    ɵngcc0.ɵɵelementStart(17, "vdr-dropdown");
    ɵngcc0.ɵɵelementStart(18, "button", 16);
    ɵngcc0.ɵɵtext(19);
    ɵngcc0.ɵɵpipe(20, "translate");
    ɵngcc0.ɵɵelement(21, "clr-icon", 17);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(22, "vdr-dropdown-menu", 18);
    ɵngcc0.ɵɵelementStart(23, "button", 19);
    ɵngcc0.ɵɵlistener("click", function FacetListComponent_ng_template_30_Template_button_click_23_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r18); const facet_r2 = restoredCtx.item; const ctx_r17 = ɵngcc0.ɵɵnextContext(); return ctx_r17.deleteFacet(facet_r2.id); });
    ɵngcc0.ɵɵpipe(24, "hasPermission");
    ɵngcc0.ɵɵelement(25, "clr-icon", 20);
    ɵngcc0.ɵɵtext(26);
    ɵngcc0.ɵɵpipe(27, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const facet_r2 = ctx.item;
    const _r6 = ɵngcc0.ɵɵreference(12);
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassProp("private", facet_r2.isPrivate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(facet_r2.code);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("private", facet_r2.isPrivate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(facet_r2.name);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("private", facet_r2.isPrivate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind3(6, 23, facet_r2.values, 0, ctx_r1.displayLimit[facet_r2.id] || 3));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", facet_r2.values.length > ctx_r1.initialLimit);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("private", facet_r2.isPrivate);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !facet_r2.isPrivate)("ngIfElse", _r6);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵclassProp("private", facet_r2.isPrivate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(15, 27, "common.edit"))("linkTo", ɵngcc0.ɵɵpureFunction1(35, _c13, facet_r2.id));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("private", facet_r2.isPrivate);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(20, 29, "common.actions"), " ");
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(24, 31, ɵngcc0.ɵɵpureFunction0(37, _c14)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(27, 33, "common.delete"), " ");
} }
function ApplyFacetDialogComponent_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.add-facets"));
} }
function ApplyFacetDialogComponent_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    const _r3 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 3);
    ɵngcc0.ɵɵlistener("click", function ApplyFacetDialogComponent_ng_template_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r2 = ɵngcc0.ɵɵnextContext(); return ctx_r2.cancel(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "button", 4);
    ɵngcc0.ɵɵlistener("click", function ApplyFacetDialogComponent_ng_template_2_Template_button_click_3_listener() { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.selectValues(); });
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 3, "common.cancel"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", ctx_r1.selectedValues.length === 0);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 5, "catalog.add-facets"), " ");
} }
function AssignProductsToChannelDialogComponent_ng_template_0_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "catalog.assign-variants-to-channel"));
} }
function AssignProductsToChannelDialogComponent_ng_template_0_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.assign-products-to-channel"));
} }
function AssignProductsToChannelDialogComponent_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, AssignProductsToChannelDialogComponent_ng_template_0_ng_container_0_Template, 3, 3, "ng-container", 12);
    ɵngcc0.ɵɵtemplate(1, AssignProductsToChannelDialogComponent_ng_template_0_ng_template_1_Template, 2, 3, "ng-template", null, 13, ɵngcc0.ɵɵtemplateRefExtractor);
} if (rf & 2) {
    const _r7 = ɵngcc0.ɵɵreference(2);
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.isProductVariantMode)("ngIfElse", _r7);
} }
const _c15 = function (a0) { return { channel: a0 }; };
function AssignProductsToChannelDialogComponent_ng_template_29_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(1, 1, "catalog.price-in-channel", ɵngcc0.ɵɵpureFunction1(4, _c15, ctx_r1.selectedChannel == null ? null : ctx_r1.selectedChannel.code)), " ");
} }
function AssignProductsToChannelDialogComponent_ng_template_30_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.no-channel-selected"), " ");
} }
function AssignProductsToChannelDialogComponent_tr_33_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "localeCurrency");
} if (rf & 2) {
    const row_r9 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r10 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(1, 1, row_r9.pricePreview, ctx_r10.selectedChannel == null ? null : ctx_r10.selectedChannel.currencyCode), " ");
} }
function AssignProductsToChannelDialogComponent_tr_33_ng_template_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0, " - ");
} }
function AssignProductsToChannelDialogComponent_tr_33_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "tr");
    ɵngcc0.ɵɵelementStart(1, "td");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "td");
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "localeCurrency");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "td");
    ɵngcc0.ɵɵtemplate(7, AssignProductsToChannelDialogComponent_tr_33_ng_template_7_Template, 2, 4, "ng-template", 8);
    ɵngcc0.ɵɵtemplate(8, AssignProductsToChannelDialogComponent_tr_33_ng_template_8_Template, 1, 0, "ng-template", null, 14, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const row_r9 = ctx.$implicit;
    const _r11 = ɵngcc0.ɵɵreference(9);
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(row_r9.name);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind2(5, 4, row_r9.price, ctx_r4.currentChannel == null ? null : ctx_r4.currentChannel.currencyCode));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r4.selectedChannel)("ngIfElse", _r11);
} }
const _c16 = function (a0) { return { channelCode: a0 }; };
function AssignProductsToChannelDialogComponent_ng_template_35_ng_template_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    const ctx_r14 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(1, 1, "catalog.assign-to-named-channel", ɵngcc0.ɵɵpureFunction1(4, _c16, ctx_r14.selectedChannel == null ? null : ctx_r14.selectedChannel.code)), " ");
} }
function AssignProductsToChannelDialogComponent_ng_template_35_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.no-channel-selected"), " ");
} }
function AssignProductsToChannelDialogComponent_ng_template_35_Template(rf, ctx) { if (rf & 1) {
    const _r18 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 15);
    ɵngcc0.ɵɵlistener("click", function AssignProductsToChannelDialogComponent_ng_template_35_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r18); const ctx_r17 = ɵngcc0.ɵɵnextContext(); return ctx_r17.cancel(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "button", 16);
    ɵngcc0.ɵɵlistener("click", function AssignProductsToChannelDialogComponent_ng_template_35_Template_button_click_3_listener() { ɵngcc0.ɵɵrestoreView(_r18); const ctx_r19 = ɵngcc0.ɵɵnextContext(); return ctx_r19.assign(); });
    ɵngcc0.ɵɵtemplate(4, AssignProductsToChannelDialogComponent_ng_template_35_ng_template_4_Template, 2, 6, "ng-template", 8);
    ɵngcc0.ɵɵtemplate(5, AssignProductsToChannelDialogComponent_ng_template_35_ng_template_5_Template, 2, 3, "ng-template", null, 9, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r15 = ɵngcc0.ɵɵreference(6);
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 4, "common.cancel"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r5.selectedChannel);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.selectedChannel)("ngIfElse", _r15);
} }
const _c17 = function () { return ["product", "enabled"]; };
function ProductDetailComponent_clr_toggle_wrapper_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "clr-toggle-wrapper");
    ɵngcc0.ɵɵelement(1, "input", 8);
    ɵngcc0.ɵɵelementStart(2, "label");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("formControl", ctx_r0.detailForm.get(ɵngcc0.ɵɵpureFunction0(4, _c17)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 2, "common.enabled"));
} }
function ProductDetailComponent_button_12_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 9);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_button_12_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(); return ctx_r5.create(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r1.detailForm.invalid || ctx_r1.detailForm.pristine || !ctx_r1.variantsToCreateAreValid());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.create"), " ");
} }
function ProductDetailComponent_ng_template_14_button_0_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 9);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_ng_template_14_button_0_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r8 = ɵngcc0.ɵɵnextContext(2); return ctx_r8.save(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r7 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("disabled", (ctx_r7.detailForm.invalid || ctx_r7.detailForm.pristine) && !ctx_r7.assetsChanged() && !ctx_r7.variantAssetsChanged());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.update"), " ");
} }
const _c18 = function () { return ["UpdateCatalog", "UpdateProduct"]; };
function ProductDetailComponent_ng_template_14_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ProductDetailComponent_ng_template_14_button_0_Template, 3, 4, "button", 10);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(1, _c18));
} }
function ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_ng_container_3_vdr_chip_1_Template(rf, ctx) { if (rf & 1) {
    const _r25 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-chip", 41);
    ɵngcc0.ɵɵlistener("iconClick", function ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_ng_container_3_vdr_chip_1_Template_vdr_chip_iconClick_0_listener() { ɵngcc0.ɵɵrestoreView(_r25); const channel_r21 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r23 = ɵngcc0.ɵɵnextContext(6); return ctx_r23.removeFromChannel(channel_r21.id); });
    ɵngcc0.ɵɵelement(1, "vdr-channel-badge", 42);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "channelCodeToLabel");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const channel_r21 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("channelCode", channel_r21.code);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 2, channel_r21.code), " ");
} }
function ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_ng_container_3_vdr_chip_1_Template, 4, 4, "vdr-chip", 40);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const channel_r21 = ctx.$implicit;
    const ctx_r20 = ɵngcc0.ɵɵnextContext(6);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r20.isDefaultChannel(channel_r21.code));
} }
function ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_Template(rf, ctx) { if (rf & 1) {
    const _r28 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-form-item", 35);
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵelementStart(2, "div", 36);
    ɵngcc0.ɵɵtemplate(3, ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_ng_container_3_Template, 2, 1, "ng-container", 37);
    ɵngcc0.ɵɵpipe(4, "async");
    ɵngcc0.ɵɵelementStart(5, "button", 38);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_Template_button_click_5_listener() { ɵngcc0.ɵɵrestoreView(_r28); const ctx_r27 = ɵngcc0.ɵɵnextContext(5); return ctx_r27.assignToChannel(); });
    ɵngcc0.ɵɵelement(6, "clr-icon", 39);
    ɵngcc0.ɵɵtext(7);
    ɵngcc0.ɵɵpipe(8, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r19 = ɵngcc0.ɵɵnextContext(5);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(1, 3, "common.channels"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind1(4, 5, ctx_r19.productChannels$));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(8, 7, "catalog.assign-to-channel"), " ");
} }
function ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_vdr_form_item_1_Template, 9, 9, "vdr-form-item", 34);
    ɵngcc0.ɵɵelementContainerEnd();
} }
function ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_ng_container_1_Template, 2, 0, "ng-container", 33);
    ɵngcc0.ɵɵelementContainerEnd();
} }
const _c19 = function () { return ["product", "customFields"]; };
function ProductDetailComponent_form_16_clr_tab_content_7_section_25_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 43);
    ɵngcc0.ɵɵelementStart(1, "label");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(4, "vdr-tabbed-custom-fields", 44);
    ɵngcc0.ɵɵpipe(5, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r14 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 4, "common.custom-fields"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("customFields", ctx_r14.customFields)("customFieldsFormGroup", ctx_r14.detailForm.get(ɵngcc0.ɵɵpureFunction0(8, _c19)))("readonly", !ɵngcc0.ɵɵpipeBind1(5, 6, ɵngcc0.ɵɵpureFunction0(9, _c18)));
} }
function ProductDetailComponent_form_16_clr_tab_content_7_vdr_facet_value_chip_30_Template(rf, ctx) { if (rf & 1) {
    const _r31 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-facet-value-chip", 45);
    ɵngcc0.ɵɵlistener("remove", function ProductDetailComponent_form_16_clr_tab_content_7_vdr_facet_value_chip_30_Template_vdr_facet_value_chip_remove_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r31); const facetValue_r29 = restoredCtx.$implicit; const ctx_r30 = ɵngcc0.ɵɵnextContext(3); return ctx_r30.removeProductFacetValue(facetValue_r29.id); });
    ɵngcc0.ɵɵpipe(1, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const facetValue_r29 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("facetValue", facetValue_r29)("removable", ɵngcc0.ɵɵpipeBind1(1, 2, ɵngcc0.ɵɵpureFunction0(4, _c18)));
} }
function ProductDetailComponent_form_16_clr_tab_content_7_button_32_Template(rf, ctx) { if (rf & 1) {
    const _r33 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 46);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_form_16_clr_tab_content_7_button_32_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r33); const ctx_r32 = ɵngcc0.ɵɵnextContext(3); return ctx_r32.selectProductFacetValue(); });
    ɵngcc0.ɵɵelement(1, "clr-icon", 47);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 1, "catalog.add-facets"), " ");
} }
function ProductDetailComponent_form_16_clr_tab_content_7_div_33_Template(rf, ctx) { if (rf & 1) {
    const _r35 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "h4");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "vdr-generate-product-variants", 48);
    ɵngcc0.ɵɵlistener("variantsChange", function ProductDetailComponent_form_16_clr_tab_content_7_div_33_Template_vdr_generate_product_variants_variantsChange_4_listener($event) { ɵngcc0.ɵɵrestoreView(_r35); const ctx_r34 = ɵngcc0.ɵɵnextContext(3); return ctx_r34.createVariantsConfig = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, "catalog.product-variants"));
} }
const _c20 = function () { return ["product", "name"]; };
function ProductDetailComponent_form_16_clr_tab_content_7_Template(rf, ctx) { if (rf & 1) {
    const _r37 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "clr-tab-content");
    ɵngcc0.ɵɵelementStart(1, "div", 16);
    ɵngcc0.ɵɵelementStart(2, "div", 17);
    ɵngcc0.ɵɵelementStart(3, "section", 18);
    ɵngcc0.ɵɵtemplate(4, ProductDetailComponent_form_16_clr_tab_content_7_ng_container_4_Template, 2, 0, "ng-container", 15);
    ɵngcc0.ɵɵpipe(5, "async");
    ɵngcc0.ɵɵelementStart(6, "vdr-form-field", 19);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelementStart(8, "input", 20);
    ɵngcc0.ɵɵlistener("input", function ProductDetailComponent_form_16_clr_tab_content_7_Template_input_input_8_listener($event) { ɵngcc0.ɵɵrestoreView(_r37); const ctx_r36 = ɵngcc0.ɵɵnextContext(2); return ctx_r36.updateSlug($event.target.value); });
    ɵngcc0.ɵɵpipe(9, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "div", 21);
    ɵngcc0.ɵɵpipe(11, "async");
    ɵngcc0.ɵɵelementStart(12, "clr-checkbox-wrapper");
    ɵngcc0.ɵɵelement(13, "input", 22);
    ɵngcc0.ɵɵelementStart(14, "label");
    ɵngcc0.ɵɵtext(15);
    ɵngcc0.ɵɵpipe(16, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(17, "vdr-form-field", 23);
    ɵngcc0.ɵɵpipe(18, "translate");
    ɵngcc0.ɵɵpipe(19, "translate");
    ɵngcc0.ɵɵelement(20, "input", 24);
    ɵngcc0.ɵɵpipe(21, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(22, "vdr-rich-text-editor", 25);
    ɵngcc0.ɵɵpipe(23, "hasPermission");
    ɵngcc0.ɵɵpipe(24, "translate");
    ɵngcc0.ɵɵtemplate(25, ProductDetailComponent_form_16_clr_tab_content_7_section_25_Template, 6, 10, "section", 26);
    ɵngcc0.ɵɵelement(26, "vdr-custom-detail-component-host", 27);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(27, "div", 28);
    ɵngcc0.ɵɵelementStart(28, "vdr-assets", 29);
    ɵngcc0.ɵɵlistener("change", function ProductDetailComponent_form_16_clr_tab_content_7_Template_vdr_assets_change_28_listener($event) { ɵngcc0.ɵɵrestoreView(_r37); const ctx_r38 = ɵngcc0.ɵɵnextContext(2); return ctx_r38.assetChanges = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(29, "div", 30);
    ɵngcc0.ɵɵtemplate(30, ProductDetailComponent_form_16_clr_tab_content_7_vdr_facet_value_chip_30_Template, 2, 5, "vdr-facet-value-chip", 31);
    ɵngcc0.ɵɵpipe(31, "async");
    ɵngcc0.ɵɵtemplate(32, ProductDetailComponent_form_16_clr_tab_content_7_button_32_Template, 4, 3, "button", 32);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(33, ProductDetailComponent_form_16_clr_tab_content_7_div_33_Template, 5, 3, "div", 15);
    ɵngcc0.ɵɵpipe(34, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const product_r10 = ɵngcc0.ɵɵnextContext().ngIf;
    const ctx_r11 = ɵngcc0.ɵɵnextContext();
    let tmp_3_0;
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngIf", !ɵngcc0.ɵɵpipeBind1(5, 20, ctx_r11.isNew$));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(7, 22, "catalog.product-name"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(9, 24, ɵngcc0.ɵɵpureFunction0(44, _c18)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("visible", ɵngcc0.ɵɵpipeBind1(11, 26, ctx_r11.isNew$) === false && ((tmp_3_0 = ctx_r11.detailForm.get(ɵngcc0.ɵɵpureFunction0(45, _c20))) == null ? null : tmp_3_0.dirty));
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(16, 28, "catalog.auto-update-product-variant-name"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(18, 30, "catalog.slug"))("errors", ɵngcc0.ɵɵpureFunction1(46, _c6, ɵngcc0.ɵɵpipeBind1(19, 32, "catalog.slug-pattern-error")));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(21, 34, ɵngcc0.ɵɵpureFunction0(48, _c18)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(23, 36, ɵngcc0.ɵɵpureFunction0(49, _c18)))("label", ɵngcc0.ɵɵpipeBind1(24, 38, "common.description"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r11.customFields.length);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("entity$", ctx_r11.entity$)("detailForm", ctx_r11.detailForm);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("assets", ctx_r11.assetChanges.assets || product_r10.assets)("featuredAsset", ctx_r11.assetChanges.featuredAsset || product_r10.featuredAsset)("updatePermissions", ctx_r11.updatePermissions);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind1(31, 40, ctx_r11.facetValues$));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(50, _c18));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(34, 42, ctx_r11.isNew$));
} }
const _c21 = function () { return ["./", "manage-variants"]; };
function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_a_18_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 65);
    ɵngcc0.ɵɵelement(1, "clr-icon", 66);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction0(4, _c21));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 2, "catalog.manage-variants"), " ");
} }
function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_19_Template(rf, ctx) { if (rf & 1) {
    const _r47 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 67);
    ɵngcc0.ɵɵelementStart(1, "vdr-items-per-page-controls", 68);
    ɵngcc0.ɵɵlistener("itemsPerPageChange", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_19_Template_vdr_items_per_page_controls_itemsPerPageChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r47); const ctx_r46 = ɵngcc0.ɵɵnextContext(4); return ctx_r46.setItemsPerPage($event); });
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "vdr-pagination-controls", 69);
    ɵngcc0.ɵɵlistener("pageChange", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_19_Template_vdr_pagination_controls_pageChange_3_listener($event) { ɵngcc0.ɵɵrestoreView(_r47); const ctx_r48 = ɵngcc0.ɵɵnextContext(4); return ctx_r48.setPage($event); });
    ɵngcc0.ɵɵpipe(4, "async");
    ɵngcc0.ɵɵpipe(5, "async");
    ɵngcc0.ɵɵpipe(6, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r42 = ɵngcc0.ɵɵnextContext(4);
    let tmp_1_0;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("itemsPerPage", ɵngcc0.ɵɵpipeBind1(2, 4, ctx_r42.itemsPerPage$));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("id", (tmp_1_0 = ɵngcc0.ɵɵpipeBind1(4, 6, ctx_r42.paginationConfig$)) == null ? null : tmp_1_0.id)("currentPage", ɵngcc0.ɵɵpipeBind1(5, 8, ctx_r42.currentPage$))("itemsPerPage", ɵngcc0.ɵɵpipeBind1(6, 10, ctx_r42.itemsPerPage$));
} }
function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_table_21_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-product-variants-table", 70);
    ɵngcc0.ɵɵpipe(1, "async");
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵpipe(3, "async");
} if (rf & 2) {
    const product_r10 = ɵngcc0.ɵɵnextContext(3).ngIf;
    const ctx_r43 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("variants", ɵngcc0.ɵɵpipeBind1(1, 6, ctx_r43.variants$))("paginationConfig", ɵngcc0.ɵɵpipeBind1(2, 8, ctx_r43.paginationConfig$))("optionGroups", product_r10.optionGroups)("channelPriceIncludesTax", ɵngcc0.ɵɵpipeBind1(3, 10, ctx_r43.channelPriceIncludesTax$))("productVariantsFormArray", ctx_r43.detailForm.get("variants"))("pendingAssetChanges", ctx_r43.variantAssetChanges);
} }
function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template(rf, ctx) { if (rf & 1) {
    const _r51 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-product-variants-list", 71);
    ɵngcc0.ɵɵlistener("assignToChannel", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template_vdr_product_variants_list_assignToChannel_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r51); const ctx_r50 = ɵngcc0.ɵɵnextContext(4); return ctx_r50.assignVariantToChannel($event); })("removeFromChannel", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template_vdr_product_variants_list_removeFromChannel_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r51); const ctx_r52 = ɵngcc0.ɵɵnextContext(4); return ctx_r52.removeVariantFromChannel($event); })("assetChange", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template_vdr_product_variants_list_assetChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r51); const ctx_r53 = ɵngcc0.ɵɵnextContext(4); return ctx_r53.variantAssetChange($event); })("updateProductOption", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template_vdr_product_variants_list_updateProductOption_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r51); const ctx_r54 = ɵngcc0.ɵɵnextContext(4); return ctx_r54.updateProductOption($event); })("selectionChange", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template_vdr_product_variants_list_selectionChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r51); const ctx_r55 = ɵngcc0.ɵɵnextContext(4); return ctx_r55.selectedVariantIds = $event; })("selectFacetValueClick", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template_vdr_product_variants_list_selectFacetValueClick_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r51); const ctx_r56 = ɵngcc0.ɵɵnextContext(4); return ctx_r56.selectVariantFacetValue($event); });
    ɵngcc0.ɵɵpipe(1, "async");
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵpipe(3, "async");
    ɵngcc0.ɵɵpipe(4, "async");
    ɵngcc0.ɵɵpipe(5, "async");
    ɵngcc0.ɵɵpipe(6, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const product_r10 = ɵngcc0.ɵɵnextContext(3).ngIf;
    const ctx_r44 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("variants", ɵngcc0.ɵɵpipeBind1(1, 11, ctx_r44.variants$))("paginationConfig", ɵngcc0.ɵɵpipeBind1(2, 13, ctx_r44.paginationConfig$))("channelPriceIncludesTax", ɵngcc0.ɵɵpipeBind1(3, 15, ctx_r44.channelPriceIncludesTax$))("facets", ɵngcc0.ɵɵpipeBind1(4, 17, ctx_r44.facets$))("optionGroups", product_r10.optionGroups)("productVariantsFormArray", ctx_r44.detailForm.get("variants"))("taxCategories", ɵngcc0.ɵɵpipeBind1(5, 19, ctx_r44.taxCategories$))("customFields", ctx_r44.customVariantFields)("customOptionFields", ctx_r44.customOptionFields)("activeLanguage", ɵngcc0.ɵɵpipeBind1(6, 21, ctx_r44.languageCode$))("pendingAssetChanges", ctx_r44.variantAssetChanges);
} }
function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_23_Template(rf, ctx) { if (rf & 1) {
    const _r59 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 67);
    ɵngcc0.ɵɵelementStart(1, "vdr-items-per-page-controls", 68);
    ɵngcc0.ɵɵlistener("itemsPerPageChange", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_23_Template_vdr_items_per_page_controls_itemsPerPageChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r59); const ctx_r58 = ɵngcc0.ɵɵnextContext(4); return ctx_r58.setItemsPerPage($event); });
    ɵngcc0.ɵɵpipe(2, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "vdr-pagination-controls", 69);
    ɵngcc0.ɵɵlistener("pageChange", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_23_Template_vdr_pagination_controls_pageChange_3_listener($event) { ɵngcc0.ɵɵrestoreView(_r59); const ctx_r60 = ɵngcc0.ɵɵnextContext(4); return ctx_r60.setPage($event); });
    ɵngcc0.ɵɵpipe(4, "async");
    ɵngcc0.ɵɵpipe(5, "async");
    ɵngcc0.ɵɵpipe(6, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r45 = ɵngcc0.ɵɵnextContext(4);
    let tmp_1_0;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("itemsPerPage", ɵngcc0.ɵɵpipeBind1(2, 4, ctx_r45.itemsPerPage$));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("id", (tmp_1_0 = ɵngcc0.ɵɵpipeBind1(4, 6, ctx_r45.paginationConfig$)) == null ? null : tmp_1_0.id)("currentPage", ɵngcc0.ɵɵpipeBind1(5, 8, ctx_r45.currentPage$))("itemsPerPage", ɵngcc0.ɵɵpipeBind1(6, 10, ctx_r45.itemsPerPage$));
} }
function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_Template(rf, ctx) { if (rf & 1) {
    const _r62 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "clr-tab-content");
    ɵngcc0.ɵɵelementStart(1, "section", 49);
    ɵngcc0.ɵɵelementStart(2, "div", 50);
    ɵngcc0.ɵɵelementStart(3, "div", 51);
    ɵngcc0.ɵɵelementStart(4, "button", 52);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_Template_button_click_4_listener() { ɵngcc0.ɵɵrestoreView(_r62); const ctx_r61 = ɵngcc0.ɵɵnextContext(3); return ctx_r61.variantDisplayMode = "card"; });
    ɵngcc0.ɵɵelement(5, "clr-icon", 53);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(8, "button", 54);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_Template_button_click_8_listener() { ɵngcc0.ɵɵrestoreView(_r62); const ctx_r63 = ɵngcc0.ɵɵnextContext(3); return ctx_r63.variantDisplayMode = "table"; });
    ɵngcc0.ɵɵelement(9, "clr-icon", 55);
    ɵngcc0.ɵɵtext(10);
    ɵngcc0.ɵɵpipe(11, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "div", 56);
    ɵngcc0.ɵɵelement(13, "input", 57);
    ɵngcc0.ɵɵpipe(14, "translate");
    ɵngcc0.ɵɵelementStart(15, "button", 58);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_Template_button_click_15_listener() { ɵngcc0.ɵɵrestoreView(_r62); const ctx_r64 = ɵngcc0.ɵɵnextContext(3); return ctx_r64.filterInput.setValue(""); });
    ɵngcc0.ɵɵelement(16, "clr-icon", 59);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(17, "div", 60);
    ɵngcc0.ɵɵtemplate(18, ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_a_18_Template, 4, 5, "a", 61);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(19, ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_19_Template, 7, 12, "div", 62);
    ɵngcc0.ɵɵpipe(20, "async");
    ɵngcc0.ɵɵtemplate(21, ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_table_21_Template, 4, 12, "vdr-product-variants-table", 63);
    ɵngcc0.ɵɵtemplate(22, ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_vdr_product_variants_list_22_Template, 7, 23, "vdr-product-variants-list", 64);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(23, ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_div_23_Template, 7, 12, "div", 62);
    ɵngcc0.ɵɵpipe(24, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r40 = ɵngcc0.ɵɵnextContext(3);
    let tmp_7_0;
    let tmp_10_0;
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵclassProp("btn-primary", ctx_r40.variantDisplayMode === "card");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(7, 13, "catalog.display-variant-cards"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("btn-primary", ctx_r40.variantDisplayMode === "table");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(11, 15, "catalog.display-variant-table"), " ");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("formControl", ctx_r40.filterInput)("placeholder", ɵngcc0.ɵɵpipeBind1(14, 17, "catalog.filter-by-name-or-sku"));
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(23, _c18));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", 10 < ((tmp_7_0 = ɵngcc0.ɵɵpipeBind1(20, 19, ctx_r40.paginationConfig$)) == null ? null : tmp_7_0.totalItems));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r40.variantDisplayMode === "table");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r40.variantDisplayMode === "card");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", 10 < ((tmp_10_0 = ɵngcc0.ɵɵpipeBind1(24, 21, ctx_r40.paginationConfig$)) == null ? null : tmp_10_0.totalItems));
} }
function ProductDetailComponent_form_16_clr_tab_9_Template(rf, ctx) { if (rf & 1) {
    const _r66 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "clr-tab");
    ɵngcc0.ɵɵelementStart(1, "button", 13);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_form_16_clr_tab_9_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r66); const ctx_r65 = ɵngcc0.ɵɵnextContext(2); return ctx_r65.navigateToTab("variants"); });
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(4, ProductDetailComponent_form_16_clr_tab_9_clr_tab_content_4_Template, 25, 24, "clr-tab-content", 14);
    ɵngcc0.ɵɵpipe(5, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r12 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 2, "catalog.product-variants"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("clrIfActive", ɵngcc0.ɵɵpipeBind1(5, 4, ctx_r12.activeTab$) === "variants");
} }
function ProductDetailComponent_form_16_Template(rf, ctx) { if (rf & 1) {
    const _r68 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "form", 11);
    ɵngcc0.ɵɵelement(1, "button", 12);
    ɵngcc0.ɵɵelementStart(2, "clr-tabs");
    ɵngcc0.ɵɵelementStart(3, "clr-tab");
    ɵngcc0.ɵɵelementStart(4, "button", 13);
    ɵngcc0.ɵɵlistener("click", function ProductDetailComponent_form_16_Template_button_click_4_listener() { ɵngcc0.ɵɵrestoreView(_r68); const ctx_r67 = ɵngcc0.ɵɵnextContext(); return ctx_r67.navigateToTab("details"); });
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(7, ProductDetailComponent_form_16_clr_tab_content_7_Template, 35, 51, "clr-tab-content", 14);
    ɵngcc0.ɵɵpipe(8, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(9, ProductDetailComponent_form_16_clr_tab_9_Template, 6, 6, "clr-tab", 15);
    ɵngcc0.ɵɵpipe(10, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("formGroup", ctx_r4.detailForm);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(6, 4, "catalog.product-details"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("clrIfActive", ɵngcc0.ɵɵpipeBind1(8, 6, ctx_r4.activeTab$) === "details");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !ɵngcc0.ɵɵpipeBind1(10, 8, ctx_r4.isNew$));
} }
const _c22 = ["productSearchInputComponent"];
function ProductListComponent_vdr_status_badge_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-status-badge", 19);
} }
function ProductListComponent_ng_container_15_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "button", 20);
    ɵngcc0.ɵɵlistener("click", function ProductListComponent_ng_container_15_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(); return ctx_r5.runPendingSearchIndexUpdates(); });
    ɵngcc0.ɵɵpipe(2, "hasPermission");
    ɵngcc0.ɵɵelement(3, "vdr-status-badge", 19);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(6, "div", 21);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(2, 2, ɵngcc0.ɵɵpureFunction0(7, _c18)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(5, 4, "catalog.run-pending-search-index-updates", ɵngcc0.ɵɵpureFunction1(8, _c5, ctx_r2.pendingSearchIndexUpdates)), " ");
} }
function ProductListComponent_a_31_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 22);
    ɵngcc0.ɵɵelement(1, "clr-icon", 23);
    ɵngcc0.ɵɵelementStart(2, "span", 24);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction0(4, _c7));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 2, "catalog.create-new-product"));
} }
function ProductListComponent_ng_template_37_img_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "img", 36);
    ɵngcc0.ɵɵpipe(1, "assetPreview");
} if (rf & 2) {
    const asset_r12 = ctx.ngIf;
    ɵngcc0.ɵɵproperty("src", ɵngcc0.ɵɵpipeBind2(1, 1, asset_r12, "tiny"), ɵngcc0.ɵɵsanitizeUrl);
} }
function ProductListComponent_ng_template_37_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 37);
    ɵngcc0.ɵɵelement(1, "clr-icon", 38);
    ɵngcc0.ɵɵelementEnd();
} }
function ProductListComponent_ng_template_37_vdr_chip_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "vdr-chip");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "common.disabled"));
} }
const _c23 = function () { return ["DeleteCatalog", "DeleteProduct"]; };
function ProductListComponent_ng_template_37_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "td", 25);
    ɵngcc0.ɵɵelementStart(1, "div", 26);
    ɵngcc0.ɵɵtemplate(2, ProductListComponent_ng_template_37_img_2_Template, 2, 4, "img", 27);
    ɵngcc0.ɵɵtemplate(3, ProductListComponent_ng_template_37_ng_template_3_Template, 2, 0, "ng-template", null, 28, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "td", 25);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "td", 29);
    ɵngcc0.ɵɵtemplate(8, ProductListComponent_ng_template_37_vdr_chip_8_Template, 3, 3, "vdr-chip", 10);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(9, "td", 30);
    ɵngcc0.ɵɵelement(10, "vdr-table-row-action", 31);
    ɵngcc0.ɵɵpipe(11, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "td", 30);
    ɵngcc0.ɵɵelementStart(13, "vdr-dropdown");
    ɵngcc0.ɵɵelementStart(14, "button", 32);
    ɵngcc0.ɵɵtext(15);
    ɵngcc0.ɵɵpipe(16, "translate");
    ɵngcc0.ɵɵelement(17, "clr-icon", 33);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(18, "vdr-dropdown-menu", 8);
    ɵngcc0.ɵɵelementStart(19, "button", 34);
    ɵngcc0.ɵɵlistener("click", function ProductListComponent_ng_template_37_Template_button_click_19_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r14); const result_r7 = restoredCtx.item; const ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.deleteProduct(result_r7.productId); });
    ɵngcc0.ɵɵpipe(20, "hasPermission");
    ɵngcc0.ɵɵelement(21, "clr-icon", 35);
    ɵngcc0.ɵɵtext(22);
    ɵngcc0.ɵɵpipe(23, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const result_r7 = ctx.item;
    const _r9 = ɵngcc0.ɵɵreference(4);
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassProp("disabled", !result_r7.enabled);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r4.groupByProduct ? result_r7.productAsset : result_r7.productVariantAsset || result_r7.productAsset)("ngIfElse", _r9);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵclassProp("disabled", !result_r7.enabled);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r4.groupByProduct ? result_r7.productName : result_r7.productVariantName, " ");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("disabled", !result_r7.enabled);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !result_r7.enabled);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("disabled", !result_r7.enabled);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(11, 19, "common.edit"))("linkTo", ɵngcc0.ɵɵpureFunction1(27, _c13, result_r7.productId));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("disabled", !result_r7.enabled);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(16, 21, "common.actions"), " ");
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(20, 23, ɵngcc0.ɵɵpureFunction0(29, _c23)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(23, 25, "common.delete"), " ");
} }
const _c24 = function () { return ["CreateCatalog", "CreateProduct"]; };
function ProductOptionsEditorComponent_button_13_Template(rf, ctx) { if (rf & 1) {
    const _r3 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 6);
    ɵngcc0.ɵɵlistener("click", function ProductOptionsEditorComponent_button_13_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r2 = ɵngcc0.ɵɵnextContext(); return ctx_r2.save(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r0.detailForm.pristine || ctx_r0.detailForm.invalid);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "common.update"), " ");
} }
function ProductOptionsEditorComponent_form_14_div_2_tr_27_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "tr", 22);
    ɵngcc0.ɵɵelementStart(1, "td", 23);
    ɵngcc0.ɵɵelement(2, "vdr-entity-info", 13);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "td", 23);
    ɵngcc0.ɵɵelement(4, "input", 24);
    ɵngcc0.ɵɵpipe(5, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "td", 23);
    ɵngcc0.ɵɵelement(7, "input", 25);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const option_r9 = ctx.$implicit;
    const i_r10 = ctx.index;
    const ctx_r8 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("formGroupName", i_r10);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("entity", option_r9.value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(5, 3, ctx_r8.updatePermission));
} }
function ProductOptionsEditorComponent_form_14_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 10);
    ɵngcc0.ɵɵelementStart(1, "section", 11);
    ɵngcc0.ɵɵelementStart(2, "div", 12);
    ɵngcc0.ɵɵelement(3, "vdr-entity-info", 13);
    ɵngcc0.ɵɵelementStart(4, "div", 14);
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 15);
    ɵngcc0.ɵɵelementStart(7, "vdr-form-field", 16);
    ɵngcc0.ɵɵpipe(8, "translate");
    ɵngcc0.ɵɵelement(9, "input", 17);
    ɵngcc0.ɵɵpipe(10, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(11, "vdr-form-field", 18);
    ɵngcc0.ɵɵpipe(12, "translate");
    ɵngcc0.ɵɵelement(13, "input", 19);
    ɵngcc0.ɵɵpipe(14, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(15, "section", 15);
    ɵngcc0.ɵɵelementStart(16, "table", 20);
    ɵngcc0.ɵɵelementStart(17, "thead");
    ɵngcc0.ɵɵelementStart(18, "tr");
    ɵngcc0.ɵɵelement(19, "th");
    ɵngcc0.ɵɵelementStart(20, "th");
    ɵngcc0.ɵɵtext(21);
    ɵngcc0.ɵɵpipe(22, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(23, "th");
    ɵngcc0.ɵɵtext(24);
    ɵngcc0.ɵɵpipe(25, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(26, "tbody");
    ɵngcc0.ɵɵtemplate(27, ProductOptionsEditorComponent_form_14_div_2_tr_27_Template, 8, 5, "tr", 21);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const optionGroup_r6 = ctx.$implicit;
    const i_r7 = ctx.index;
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("formArrayName", i_r7);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("entity", optionGroup_r6.value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(optionGroup_r6.value.code);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(8, 12, "common.name"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("id", "name-" + i_r7)("readonly", !ɵngcc0.ɵɵpipeBind1(10, 14, ctx_r5.updatePermission));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(12, 16, "common.code"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("id", "code-" + i_r7)("readonly", !ɵngcc0.ɵɵpipeBind1(14, 18, ctx_r5.updatePermission));
    ɵngcc0.ɵɵadvance(8);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(22, 20, "common.name"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(25, 22, "common.code"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r5.getOptions(optionGroup_r6));
} }
function ProductOptionsEditorComponent_form_14_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "form", 7);
    ɵngcc0.ɵɵelementStart(1, "div", 8);
    ɵngcc0.ɵɵtemplate(2, ProductOptionsEditorComponent_form_14_div_2_Template, 28, 24, "div", 9);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("formGroup", ctx_r1.detailForm);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.getOptionGroups());
} }
function ConfirmVariantDeletionDialogComponent_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.confirm-deletion-of-unused-variants-title"), "\n");
} }
function ConfirmVariantDeletionDialogComponent_li_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r3 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2("", variant_r3.name, " (", variant_r3.sku, ")");
} }
function ConfirmVariantDeletionDialogComponent_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 3);
    ɵngcc0.ɵɵlistener("click", function ConfirmVariantDeletionDialogComponent_ng_template_5_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.cancel(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "button", 4);
    ɵngcc0.ɵɵlistener("click", function ConfirmVariantDeletionDialogComponent_ng_template_5_Template_button_click_3_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r6 = ɵngcc0.ɵɵnextContext(); return ctx_r6.confirm(); });
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 2, "common.cancel"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 4, "common.confirm"), " ");
} }
function ProductVariantsEditorComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 7);
    ɵngcc0.ɵɵelementStart(1, "div", 8);
    ɵngcc0.ɵɵelementStart(2, "label");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "input", 9);
    ɵngcc0.ɵɵlistener("ngModelChange", function ProductVariantsEditorComponent_div_5_Template_input_ngModelChange_5_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r5); const group_r2 = restoredCtx.$implicit; return group_r2.name = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 10);
    ɵngcc0.ɵɵelementStart(7, "label");
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "vdr-option-value-input", 11, 12);
    ɵngcc0.ɵɵlistener("ngModelChange", function ProductVariantsEditorComponent_div_5_Template_vdr_option_value_input_ngModelChange_10_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r5); const group_r2 = restoredCtx.$implicit; return group_r2.values = $event; })("ngModelChange", function ProductVariantsEditorComponent_div_5_Template_vdr_option_value_input_ngModelChange_10_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.generateVariants(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const group_r2 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 7, "catalog.option"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngModel", group_r2.name)("readonly", !group_r2.isNew);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(9, 9, "catalog.option-values"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngModel", group_r2.values)("groupName", group_r2.name)("disabled", group_r2.name === "");
} }
function ProductVariantsEditorComponent_tr_30_input_2_Template(rf, ctx) { if (rf & 1) {
    const _r19 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "input", 15);
    ɵngcc0.ɵɵlistener("ngModelChange", function ProductVariantsEditorComponent_tr_30_input_2_Template_input_ngModelChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r19); const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit; return variant_r8.enabled = $event; })("ngModelChange", function ProductVariantsEditorComponent_tr_30_input_2_Template_input_ngModelChange_0_listener() { ɵngcc0.ɵɵrestoreView(_r19); const ctx_r20 = ɵngcc0.ɵɵnextContext(2); return ctx_r20.formValueChanged = true; });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("ngModel", variant_r8.enabled);
} }
function ProductVariantsEditorComponent_tr_30_clr_input_container_7_Template(rf, ctx) { if (rf & 1) {
    const _r24 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "clr-input-container");
    ɵngcc0.ɵɵelementStart(1, "input", 16);
    ɵngcc0.ɵɵlistener("ngModelChange", function ProductVariantsEditorComponent_tr_30_clr_input_container_7_Template_input_ngModelChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r24); const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit; return variant_r8.sku = $event; })("ngModelChange", function ProductVariantsEditorComponent_tr_30_clr_input_container_7_Template_input_ngModelChange_1_listener() { ɵngcc0.ɵɵrestoreView(_r24); const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r25 = ɵngcc0.ɵɵnextContext(); return ctx_r25.onFormChanged(variant_r8); });
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngModel", variant_r8.sku)("placeholder", ɵngcc0.ɵɵpipeBind1(2, 2, "catalog.sku"));
} }
function ProductVariantsEditorComponent_tr_30_span_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(variant_r8.sku);
} }
function ProductVariantsEditorComponent_tr_30_clr_input_container_10_Template(rf, ctx) { if (rf & 1) {
    const _r31 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "clr-input-container");
    ɵngcc0.ɵɵelementStart(1, "vdr-currency-input", 17);
    ɵngcc0.ɵɵlistener("ngModelChange", function ProductVariantsEditorComponent_tr_30_clr_input_container_10_Template_vdr_currency_input_ngModelChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r31); const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit; return variant_r8.price = $event; })("ngModelChange", function ProductVariantsEditorComponent_tr_30_clr_input_container_10_Template_vdr_currency_input_ngModelChange_1_listener() { ɵngcc0.ɵɵrestoreView(_r31); const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r32 = ɵngcc0.ɵɵnextContext(); return ctx_r32.onFormChanged(variant_r8); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r12 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngModel", variant_r8.price)("currencyCode", ctx_r12.currencyCode);
} }
function ProductVariantsEditorComponent_tr_30_span_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "localeCurrency");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r13 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind2(2, 1, variant_r8.price, ctx_r13.currencyCode));
} }
function ProductVariantsEditorComponent_tr_30_clr_input_container_13_Template(rf, ctx) { if (rf & 1) {
    const _r38 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "clr-input-container");
    ɵngcc0.ɵɵelementStart(1, "input", 18);
    ɵngcc0.ɵɵlistener("ngModelChange", function ProductVariantsEditorComponent_tr_30_clr_input_container_13_Template_input_ngModelChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r38); const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit; return variant_r8.stock = $event; })("ngModelChange", function ProductVariantsEditorComponent_tr_30_clr_input_container_13_Template_input_ngModelChange_1_listener() { ɵngcc0.ɵɵrestoreView(_r38); const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r39 = ɵngcc0.ɵɵnextContext(); return ctx_r39.onFormChanged(variant_r8); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngModel", variant_r8.stock);
} }
function ProductVariantsEditorComponent_tr_30_span_14_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(variant_r8.stock);
} }
function ProductVariantsEditorComponent_tr_30_vdr_dropdown_16_Template(rf, ctx) { if (rf & 1) {
    const _r45 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-dropdown");
    ɵngcc0.ɵɵelementStart(1, "button", 19);
    ɵngcc0.ɵɵelement(2, "clr-icon", 20);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "vdr-dropdown-menu", 21);
    ɵngcc0.ɵɵelementStart(4, "button", 22);
    ɵngcc0.ɵɵlistener("click", function ProductVariantsEditorComponent_tr_30_vdr_dropdown_16_Template_button_click_4_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r45); const productVariantId_r43 = restoredCtx.ngIf; const ctx_r44 = ɵngcc0.ɵɵnextContext(2); return ctx_r44.deleteVariant(productVariantId_r43); });
    ɵngcc0.ɵɵelement(5, "clr-icon", 23);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(7, 1, "common.delete"), " ");
} }
function ProductVariantsEditorComponent_tr_30_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "tr");
    ɵngcc0.ɵɵelementStart(1, "td");
    ɵngcc0.ɵɵtemplate(2, ProductVariantsEditorComponent_tr_30_input_2_Template, 1, 1, "input", 13);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "td");
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "td");
    ɵngcc0.ɵɵtemplate(7, ProductVariantsEditorComponent_tr_30_clr_input_container_7_Template, 3, 4, "clr-input-container", 14);
    ɵngcc0.ɵɵtemplate(8, ProductVariantsEditorComponent_tr_30_span_8_Template, 2, 1, "span", 14);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(9, "td");
    ɵngcc0.ɵɵtemplate(10, ProductVariantsEditorComponent_tr_30_clr_input_container_10_Template, 2, 2, "clr-input-container", 14);
    ɵngcc0.ɵɵtemplate(11, ProductVariantsEditorComponent_tr_30_span_11_Template, 3, 4, "span", 14);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "td");
    ɵngcc0.ɵɵtemplate(13, ProductVariantsEditorComponent_tr_30_clr_input_container_13_Template, 2, 1, "clr-input-container", 14);
    ɵngcc0.ɵɵtemplate(14, ProductVariantsEditorComponent_tr_30_span_14_Template, 2, 1, "span", 14);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(15, "td");
    ɵngcc0.ɵɵtemplate(16, ProductVariantsEditorComponent_tr_30_vdr_dropdown_16_Template, 8, 3, "vdr-dropdown", 14);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r8 = ctx.$implicit;
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassProp("disabled", !variant_r8.enabled || variant_r8.existing);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !variant_r8.existing);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 11, ctx_r1.getVariantName(variant_r8)), " ");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", !variant_r8.existing);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", variant_r8.existing);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !variant_r8.existing);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", variant_r8.existing);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !variant_r8.existing);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", variant_r8.existing);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", variant_r8.productVariantId);
} }
function AssetsComponent_div_0_img_3_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "img", 11);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_div_0_img_3_Template_img_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r9 = ɵngcc0.ɵɵnextContext(2); return ctx_r9.previewAsset(ctx_r9.featuredAsset); });
    ɵngcc0.ɵɵpipe(1, "assetPreview");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("src", ɵngcc0.ɵɵpipeBind2(1, 1, ctx_r5.featuredAsset, "small"), ɵngcc0.ɵɵsanitizeUrl);
} }
function AssetsComponent_div_0_div_4_Template(rf, ctx) { if (rf & 1) {
    const _r12 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_div_0_div_4_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r12); const ctx_r11 = ɵngcc0.ɵɵnextContext(2); return ctx_r11.selectAssets(); });
    ɵngcc0.ɵɵelement(1, "clr-icon", 13);
    ɵngcc0.ɵɵelementStart(2, "div");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 1, "catalog.no-featured-asset"));
} }
function AssetsComponent_div_0_ng_container_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
function AssetsComponent_div_0_div_7_Template(rf, ctx) { if (rf & 1) {
    const _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 14);
    ɵngcc0.ɵɵelementStart(1, "button", 15);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_div_0_div_7_Template_button_click_1_listener() { ɵngcc0.ɵɵrestoreView(_r14); const ctx_r13 = ɵngcc0.ɵɵnextContext(2); return ctx_r13.selectAssets(); });
    ɵngcc0.ɵɵelement(2, "clr-icon", 16);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 1, "asset.add-asset"), " ");
} }
function AssetsComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 3);
    ɵngcc0.ɵɵelementStart(1, "div", 4);
    ɵngcc0.ɵɵelementStart(2, "div", 5);
    ɵngcc0.ɵɵtemplate(3, AssetsComponent_div_0_img_3_Template, 2, 4, "img", 6);
    ɵngcc0.ɵɵtemplate(4, AssetsComponent_div_0_div_4_Template, 5, 3, "div", 7);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "div", 8);
    ɵngcc0.ɵɵtemplate(6, AssetsComponent_div_0_ng_container_6_Template, 1, 0, "ng-container", 9);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(7, AssetsComponent_div_0_div_7_Template, 5, 3, "div", 10);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    const _r3 = ɵngcc0.ɵɵreference(4);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.featuredAsset);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r0.featuredAsset);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r0.updatePermissions);
} }
function AssetsComponent_ng_template_1_img_1_Template(rf, ctx) { if (rf & 1) {
    const _r20 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "img", 11);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_ng_template_1_img_1_Template_img_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r20); const ctx_r19 = ɵngcc0.ɵɵnextContext(2); return ctx_r19.previewAsset(ctx_r19.featuredAsset); });
    ɵngcc0.ɵɵpipe(1, "assetPreview");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r15 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("src", ɵngcc0.ɵɵpipeBind2(1, 1, ctx_r15.featuredAsset, "thumb"), ɵngcc0.ɵɵsanitizeUrl);
} }
function AssetsComponent_ng_template_1_div_2_Template(rf, ctx) { if (rf & 1) {
    const _r22 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_ng_template_1_div_2_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r21 = ɵngcc0.ɵɵnextContext(2); return ctx_r21.selectAssets(); });
    ɵngcc0.ɵɵelement(1, "clr-icon", 19);
    ɵngcc0.ɵɵelementEnd();
} }
function AssetsComponent_ng_template_1_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
function AssetsComponent_ng_template_1_button_4_Template(rf, ctx) { if (rf & 1) {
    const _r24 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 20);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_ng_template_1_button_4_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r24); const ctx_r23 = ɵngcc0.ɵɵnextContext(2); return ctx_r23.selectAssets(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵelement(2, "clr-icon", 16);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(1, 2, "asset.add-asset"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 4, "asset.add-asset"), " ");
} }
function AssetsComponent_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 17);
    ɵngcc0.ɵɵtemplate(1, AssetsComponent_ng_template_1_img_1_Template, 2, 4, "img", 6);
    ɵngcc0.ɵɵtemplate(2, AssetsComponent_ng_template_1_div_2_Template, 2, 0, "div", 7);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(3, AssetsComponent_ng_template_1_ng_container_3_Template, 1, 0, "ng-container", 9);
    ɵngcc0.ɵɵtemplate(4, AssetsComponent_ng_template_1_button_4_Template, 5, 6, "button", 18);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    const _r3 = ɵngcc0.ɵɵreference(4);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.featuredAsset);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r2.featuredAsset);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", _r3);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r2.updatePermissions);
} }
function AssetsComponent_ng_template_3_div_1_Template(rf, ctx) { if (rf & 1) {
    const _r29 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 23);
    ɵngcc0.ɵɵlistener("cdkDropListDropped", function AssetsComponent_ng_template_3_div_1_Template_div_cdkDropListDropped_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r29); const ctx_r28 = ɵngcc0.ɵɵnextContext(2); return ctx_r28.dropListDropped($event); });
    ɵngcc0.ɵɵpipe(1, "hasPermission");
    ɵngcc0.ɵɵelementStart(2, "vdr-dropdown", 24);
    ɵngcc0.ɵɵelementStart(3, "div", 25);
    ɵngcc0.ɵɵelement(4, "img", 26);
    ɵngcc0.ɵɵpipe(5, "assetPreview");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "vdr-dropdown-menu", 27);
    ɵngcc0.ɵɵelementStart(7, "button", 28);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_ng_template_3_div_1_Template_button_click_7_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r29); const asset_r26 = restoredCtx.$implicit; const ctx_r30 = ɵngcc0.ɵɵnextContext(2); return ctx_r30.previewAsset(asset_r26); });
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "button", 29);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_ng_template_3_div_1_Template_button_click_10_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r29); const asset_r26 = restoredCtx.$implicit; const ctx_r31 = ɵngcc0.ɵɵnextContext(2); return ctx_r31.setAsFeatured(asset_r26); });
    ɵngcc0.ɵɵpipe(11, "hasPermission");
    ɵngcc0.ɵɵtext(12);
    ɵngcc0.ɵɵpipe(13, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(14, "div", 30);
    ɵngcc0.ɵɵelementStart(15, "button", 31);
    ɵngcc0.ɵɵlistener("click", function AssetsComponent_ng_template_3_div_1_Template_button_click_15_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r29); const asset_r26 = restoredCtx.$implicit; const ctx_r32 = ɵngcc0.ɵɵnextContext(2); return ctx_r32.removeAsset(asset_r26); });
    ɵngcc0.ɵɵpipe(16, "hasPermission");
    ɵngcc0.ɵɵtext(17);
    ɵngcc0.ɵɵpipe(18, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const asset_r26 = ctx.$implicit;
    const index_r27 = ctx.index;
    const ctx_r25 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("cdkDropListData", index_r27)("cdkDropListDisabled", !ɵngcc0.ɵɵpipeBind1(1, 10, ctx_r25.updatePermissions));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵclassProp("featured", ctx_r25.isFeatured(asset_r26));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("src", ɵngcc0.ɵɵpipeBind2(5, 12, asset_r26, "tiny"), ɵngcc0.ɵɵsanitizeUrl);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(9, 15, "asset.preview"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", ctx_r25.isFeatured(asset_r26) || !ɵngcc0.ɵɵpipeBind1(11, 17, ctx_r25.updatePermissions));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(13, 19, "asset.set-as-featured-asset"), " ");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(16, 21, ctx_r25.updatePermissions));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(18, 23, "asset.remove-asset"), " ");
} }
function AssetsComponent_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 21);
    ɵngcc0.ɵɵtemplate(1, AssetsComponent_ng_template_3_div_1_Template, 19, 25, "div", 22);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassProp("compact", ctx_r4.compact);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r4.assets);
} }
function CollectionContentsComponent_ng_container_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
const _c25 = function () { return { tab: "variants" }; };
const _c26 = function (a1, a2) { return ["/catalog/products", a1, a2]; };
function CollectionContentsComponent_ng_template_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "td", 5);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(2, "td", 6);
    ɵngcc0.ɵɵelement(3, "vdr-table-row-action", 7);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r2 = ctx.item;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(variant_r2.name);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(4, 3, "common.edit"))("linkTo", ɵngcc0.ɵɵpureFunction2(6, _c26, variant_r2.productId, ɵngcc0.ɵɵpureFunction0(5, _c25)));
} }
const _c27 = function (a0) { return { $implicit: a0 }; };
function CollectionTreeComponent_vdr_collection_tree_node_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-collection-tree-node", 1);
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("expandAll", ctx_r0.expandAll)("collectionTree", ctx_r0.collectionTree)("activeCollectionId", ctx_r0.activeCollectionId);
} }
function CollectionTreeNodeComponent_div_3_button_3_clr_icon_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "clr-icon", 31);
} }
function CollectionTreeNodeComponent_div_3_button_3_clr_icon_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "clr-icon", 32);
} }
function CollectionTreeNodeComponent_div_3_button_3_Template(rf, ctx) { if (rf & 1) {
    const _r16 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 28);
    ɵngcc0.ɵɵlistener("click", function CollectionTreeNodeComponent_div_3_button_3_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r16); const collection_r2 = ɵngcc0.ɵɵnextContext().$implicit; return collection_r2.expanded = !collection_r2.expanded; });
    ɵngcc0.ɵɵtemplate(1, CollectionTreeNodeComponent_div_3_button_3_clr_icon_1_Template, 1, 0, "clr-icon", 29);
    ɵngcc0.ɵɵtemplate(2, CollectionTreeNodeComponent_div_3_button_3_clr_icon_2_Template, 1, 0, "clr-icon", 30);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const collection_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r4.expandAll);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !collection_r2.expanded && !ctx_r4.expandAll);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", collection_r2.expanded || ctx_r4.expandAll);
} }
function CollectionTreeNodeComponent_div_3_ng_template_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 33);
} }
function CollectionTreeNodeComponent_div_3_vdr_chip_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "vdr-chip");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "catalog.private"));
} }
function CollectionTreeNodeComponent_div_3_div_17_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 34);
    ɵngcc0.ɵɵelement(1, "clr-icon", 35);
    ɵngcc0.ɵɵelementEnd();
} }
const _c28 = function (a0) { return { parentId: a0 }; };
const _c29 = function (a2) { return ["./", "create", a2]; };
function CollectionTreeNodeComponent_div_3_a_22_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 36);
    ɵngcc0.ɵɵelement(1, "clr-icon", 37);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const collection_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction1(6, _c29, ɵngcc0.ɵɵpureFunction1(4, _c28, collection_r2.id)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 2, "catalog.create-new-collection"), " ");
} }
function CollectionTreeNodeComponent_div_3_button_37_Template(rf, ctx) { if (rf & 1) {
    const _r22 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 20);
    ɵngcc0.ɵɵlistener("click", function CollectionTreeNodeComponent_div_3_button_37_Template_button_click_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r22); const item_r19 = restoredCtx.$implicit; const collection_r2 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r20 = ɵngcc0.ɵɵnextContext(); return ctx_r20.move(collection_r2, item_r19.id); });
    ɵngcc0.ɵɵpipe(1, "async");
    ɵngcc0.ɵɵelementStart(2, "div", 38);
    ɵngcc0.ɵɵelementStart(3, "div", 39);
    ɵngcc0.ɵɵelement(4, "clr-icon", 40);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "div", 41);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const item_r19 = ctx.$implicit;
    const ctx_r10 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r10.hasUpdatePermission$));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵtextInterpolate1(" ", item_r19.path, " ");
} }
function CollectionTreeNodeComponent_div_3_vdr_collection_tree_node_44_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-collection-tree-node", 42);
} if (rf & 2) {
    const collection_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r11 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("expandAll", ctx_r11.expandAll)("collectionTree", collection_r2)("activeCollectionId", ctx_r11.activeCollectionId);
} }
const _c30 = function (a0) { return { contents: a0 }; };
const _c31 = function (a1) { return ["/catalog/collections/", a1]; };
const _c32 = function () { return ["UpdateCatalog", "UpdateCollection"]; };
function CollectionTreeNodeComponent_div_3_Template(rf, ctx) { if (rf & 1) {
    const _r25 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 3);
    ɵngcc0.ɵɵelementStart(1, "div", 4);
    ɵngcc0.ɵɵelementStart(2, "div", 5);
    ɵngcc0.ɵɵtemplate(3, CollectionTreeNodeComponent_div_3_button_3_Template, 3, 3, "button", 6);
    ɵngcc0.ɵɵtemplate(4, CollectionTreeNodeComponent_div_3_ng_template_4_Template, 1, 0, "ng-template", null, 7, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(7, "div", 8);
    ɵngcc0.ɵɵtemplate(8, CollectionTreeNodeComponent_div_3_vdr_chip_8_Template, 3, 3, "vdr-chip", 9);
    ɵngcc0.ɵɵelementStart(9, "a", 10);
    ɵngcc0.ɵɵelement(10, "clr-icon", 11);
    ɵngcc0.ɵɵtext(11);
    ɵngcc0.ɵɵpipe(12, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(13, "a", 12);
    ɵngcc0.ɵɵelement(14, "clr-icon", 13);
    ɵngcc0.ɵɵtext(15);
    ɵngcc0.ɵɵpipe(16, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(17, CollectionTreeNodeComponent_div_3_div_17_Template, 2, 0, "div", 14);
    ɵngcc0.ɵɵelementStart(18, "vdr-dropdown");
    ɵngcc0.ɵɵelementStart(19, "button", 15);
    ɵngcc0.ɵɵlistener("click", function CollectionTreeNodeComponent_div_3_Template_button_click_19_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r25); const collection_r2 = restoredCtx.$implicit; const ctx_r24 = ɵngcc0.ɵɵnextContext(); return ctx_r24.getMoveListItems(collection_r2); });
    ɵngcc0.ɵɵelement(20, "clr-icon", 16);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(21, "vdr-dropdown-menu", 17);
    ɵngcc0.ɵɵtemplate(22, CollectionTreeNodeComponent_div_3_a_22_Template, 4, 8, "a", 18);
    ɵngcc0.ɵɵelement(23, "div", 19);
    ɵngcc0.ɵɵelementStart(24, "button", 20);
    ɵngcc0.ɵɵlistener("click", function CollectionTreeNodeComponent_div_3_Template_button_click_24_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r25); const collection_r2 = restoredCtx.$implicit; const i_r3 = restoredCtx.index; const ctx_r26 = ɵngcc0.ɵɵnextContext(); return ctx_r26.moveUp(collection_r2, i_r3); });
    ɵngcc0.ɵɵpipe(25, "async");
    ɵngcc0.ɵɵelement(26, "clr-icon", 21);
    ɵngcc0.ɵɵtext(27);
    ɵngcc0.ɵɵpipe(28, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(29, "button", 20);
    ɵngcc0.ɵɵlistener("click", function CollectionTreeNodeComponent_div_3_Template_button_click_29_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r25); const collection_r2 = restoredCtx.$implicit; const i_r3 = restoredCtx.index; const ctx_r27 = ɵngcc0.ɵɵnextContext(); return ctx_r27.moveDown(collection_r2, i_r3); });
    ɵngcc0.ɵɵpipe(30, "async");
    ɵngcc0.ɵɵelement(31, "clr-icon", 22);
    ɵngcc0.ɵɵtext(32);
    ɵngcc0.ɵɵpipe(33, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(34, "h4", 23);
    ɵngcc0.ɵɵtext(35);
    ɵngcc0.ɵɵpipe(36, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(37, CollectionTreeNodeComponent_div_3_button_37_Template, 7, 4, "button", 24);
    ɵngcc0.ɵɵelement(38, "div", 19);
    ɵngcc0.ɵɵelementStart(39, "button", 25);
    ɵngcc0.ɵɵlistener("click", function CollectionTreeNodeComponent_div_3_Template_button_click_39_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r25); const collection_r2 = restoredCtx.$implicit; const ctx_r28 = ɵngcc0.ɵɵnextContext(); return ctx_r28.delete(collection_r2.id); });
    ɵngcc0.ɵɵpipe(40, "async");
    ɵngcc0.ɵɵelement(41, "clr-icon", 26);
    ɵngcc0.ɵɵtext(42);
    ɵngcc0.ɵɵpipe(43, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(44, CollectionTreeNodeComponent_div_3_vdr_collection_tree_node_44_Template, 1, 3, "vdr-collection-tree-node", 27);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const collection_r2 = ctx.$implicit;
    const i_r3 = ctx.index;
    const _r5 = ɵngcc0.ɵɵreference(5);
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassProp("private", collection_r2.isPrivate);
    ɵngcc0.ɵɵproperty("cdkDragData", collection_r2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("active", collection_r2.id === ctx_r1.activeCollectionId);
    ɵngcc0.ɵɵproperty("ngClass", "depth-" + ctx_r1.depth);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", collection_r2.children == null ? null : collection_r2.children.length)("ngIfElse", _r5);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", collection_r2.name, " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", collection_r2.isPrivate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction1(45, _c13, ɵngcc0.ɵɵpureFunction1(43, _c30, collection_r2.id)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(12, 25, "catalog.view-contents"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction1(47, _c31, collection_r2.id));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(16, 27, "common.edit"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(49, _c32));
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(50, _c8));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", i_r3 === 0 || !ɵngcc0.ɵɵpipeBind1(25, 29, ctx_r1.hasUpdatePermission$));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(28, 31, "catalog.move-up"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", i_r3 === ctx_r1.collectionTree.children.length - 1 || !ɵngcc0.ɵɵpipeBind1(30, 33, ctx_r1.hasUpdatePermission$));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(33, 35, "catalog.move-down"), " ");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(36, 37, "catalog.move-to"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.moveListItems);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(40, 39, ctx_r1.hasDeletePermission$));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(43, 41, "common.delete"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", collection_r2.expanded || ctx_r1.expandAll);
} }
function GenerateProductVariantsComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    const _r7 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 7);
    ɵngcc0.ɵɵelementStart(1, "div", 8);
    ɵngcc0.ɵɵelementStart(2, "label");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(5, "input", 9);
    ɵngcc0.ɵɵlistener("ngModelChange", function GenerateProductVariantsComponent_div_0_Template_input_ngModelChange_5_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r7); const group_r4 = restoredCtx.$implicit; return group_r4.name = $event; })("keydown.enter", function GenerateProductVariantsComponent_div_0_Template_input_keydown_enter_5_listener($event) { ɵngcc0.ɵɵrestoreView(_r7); const _r5 = ɵngcc0.ɵɵreference(11); const ctx_r8 = ɵngcc0.ɵɵnextContext(); return ctx_r8.handleEnter($event, _r5); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "div", 10);
    ɵngcc0.ɵɵelementStart(7, "label");
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "vdr-option-value-input", 11, 12);
    ɵngcc0.ɵɵlistener("ngModelChange", function GenerateProductVariantsComponent_div_0_Template_vdr_option_value_input_ngModelChange_10_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r7); const group_r4 = restoredCtx.$implicit; return group_r4.values = $event; })("ngModelChange", function GenerateProductVariantsComponent_div_0_Template_vdr_option_value_input_ngModelChange_10_listener() { ɵngcc0.ɵɵrestoreView(_r7); const ctx_r10 = ɵngcc0.ɵɵnextContext(); return ctx_r10.generateVariants(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "div", 13);
    ɵngcc0.ɵɵelementStart(13, "button", 14);
    ɵngcc0.ɵɵlistener("click", function GenerateProductVariantsComponent_div_0_Template_button_click_13_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r7); const group_r4 = restoredCtx.$implicit; const ctx_r11 = ɵngcc0.ɵɵnextContext(); return ctx_r11.removeOption(group_r4.name); });
    ɵngcc0.ɵɵpipe(14, "translate");
    ɵngcc0.ɵɵelement(15, "clr-icon", 15);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const group_r4 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 7, "catalog.option"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngModel", group_r4.name);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(9, 9, "catalog.option-values"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngModel", group_r4.values)("groupName", group_r4.name)("disabled", group_r4.name === "");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(14, 11, "catalog.remove-option"));
} }
function GenerateProductVariantsComponent_th_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "th");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "common.create"));
} }
function GenerateProductVariantsComponent_th_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "th");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 1, "catalog.variant"));
} }
function GenerateProductVariantsComponent_tr_20_td_1_Template(rf, ctx) { if (rf & 1) {
    const _r16 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "td");
    ɵngcc0.ɵɵelementStart(1, "input", 19);
    ɵngcc0.ɵɵlistener("change", function GenerateProductVariantsComponent_tr_20_td_1_Template_input_change_1_listener() { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r15 = ɵngcc0.ɵɵnextContext(2); return ctx_r15.onFormChange(); })("ngModelChange", function GenerateProductVariantsComponent_tr_20_td_1_Template_input_ngModelChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r16); const variant_r12 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r17 = ɵngcc0.ɵɵnextContext(); return ctx_r17.variantFormValues[variant_r12.id].enabled = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r12 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r13 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r13.variantFormValues[variant_r12.id].enabled);
} }
function GenerateProductVariantsComponent_tr_20_td_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "td");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r12 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", variant_r12.values.join(" "), " ");
} }
function GenerateProductVariantsComponent_tr_20_Template(rf, ctx) { if (rf & 1) {
    const _r22 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "tr");
    ɵngcc0.ɵɵtemplate(1, GenerateProductVariantsComponent_tr_20_td_1_Template, 2, 1, "td", 5);
    ɵngcc0.ɵɵtemplate(2, GenerateProductVariantsComponent_tr_20_td_2_Template, 2, 1, "td", 5);
    ɵngcc0.ɵɵelementStart(3, "td");
    ɵngcc0.ɵɵelementStart(4, "clr-input-container");
    ɵngcc0.ɵɵelementStart(5, "input", 16);
    ɵngcc0.ɵɵlistener("change", function GenerateProductVariantsComponent_tr_20_Template_input_change_5_listener() { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r21 = ɵngcc0.ɵɵnextContext(); return ctx_r21.onFormChange(); })("ngModelChange", function GenerateProductVariantsComponent_tr_20_Template_input_ngModelChange_5_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r22); const variant_r12 = restoredCtx.$implicit; const ctx_r23 = ɵngcc0.ɵɵnextContext(); return ctx_r23.variantFormValues[variant_r12.id].sku = $event; });
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "td");
    ɵngcc0.ɵɵelementStart(8, "clr-input-container");
    ɵngcc0.ɵɵelementStart(9, "vdr-currency-input", 17);
    ɵngcc0.ɵɵlistener("ngModelChange", function GenerateProductVariantsComponent_tr_20_Template_vdr_currency_input_ngModelChange_9_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r22); const variant_r12 = restoredCtx.$implicit; const ctx_r24 = ɵngcc0.ɵɵnextContext(); return ctx_r24.variantFormValues[variant_r12.id].price = $event; })("ngModelChange", function GenerateProductVariantsComponent_tr_20_Template_vdr_currency_input_ngModelChange_9_listener() { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r25 = ɵngcc0.ɵɵnextContext(); return ctx_r25.onFormChange(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "td");
    ɵngcc0.ɵɵelementStart(11, "clr-input-container");
    ɵngcc0.ɵɵelementStart(12, "input", 18);
    ɵngcc0.ɵɵlistener("ngModelChange", function GenerateProductVariantsComponent_tr_20_Template_input_ngModelChange_12_listener($event) { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r22); const variant_r12 = restoredCtx.$implicit; const ctx_r26 = ɵngcc0.ɵɵnextContext(); return ctx_r26.variantFormValues[variant_r12.id].stock = $event; })("change", function GenerateProductVariantsComponent_tr_20_Template_input_change_12_listener() { ɵngcc0.ɵɵrestoreView(_r22); const ctx_r27 = ɵngcc0.ɵɵnextContext(); return ctx_r27.onFormChange(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r12 = ctx.$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassProp("disabled", !ctx_r3.variantFormValues[variant_r12.id].enabled);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", 1 < ctx_r3.variants.length);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", 1 < ctx_r3.variants.length);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r3.variantFormValues[variant_r12.id].sku)("placeholder", ɵngcc0.ɵɵpipeBind1(6, 9, "catalog.sku"));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r3.variantFormValues[variant_r12.id].price)("currencyCode", ctx_r3.currencyCode);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r3.variantFormValues[variant_r12.id].stock);
} }
const _c33 = ["textArea"];
function OptionValueInputComponent_div_1_vdr_chip_1_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-chip", 6);
    ɵngcc0.ɵɵlistener("iconClick", function OptionValueInputComponent_div_1_vdr_chip_1_Template_vdr_chip_iconClick_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r6); const option_r3 = restoredCtx.$implicit; const ctx_r5 = ɵngcc0.ɵɵnextContext(2); return ctx_r5.removeOption(option_r3); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const option_r3 = ctx.$implicit;
    const isLast_r4 = ctx.last;
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵclassProp("selected", isLast_r4 && ctx_r2.lastSelected)("locked", option_r3.locked);
    ɵngcc0.ɵɵproperty("icon", option_r3.locked ? "lock" : "times")("colorFrom", ctx_r2.groupName);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", option_r3.name, " ");
} }
function OptionValueInputComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 4);
    ɵngcc0.ɵɵtemplate(1, OptionValueInputComponent_div_1_vdr_chip_1_Template, 2, 7, "vdr-chip", 5);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r0.options);
} }
const _c34 = ["selectComponent"];
function ProductSearchInputComponent_ng_template_3_div_0_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 6);
    ɵngcc0.ɵɵlistener("click", function ProductSearchInputComponent_ng_template_3_div_0_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r6); ɵngcc0.ɵɵnextContext(2); const _r0 = ɵngcc0.ɵɵreference(1); return _r0.selectTag(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext(2);
    const _r0 = ɵngcc0.ɵɵreference(1);
    ɵngcc0.ɵɵclassProp("selected", ctx_r4.isSearchHeaderSelected());
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2(" ", ɵngcc0.ɵɵpipeBind1(2, 4, "catalog.search-for-term"), ": ", _r0.searchTerm, " ");
} }
function ProductSearchInputComponent_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ProductSearchInputComponent_ng_template_3_div_0_Template, 3, 6, "div", 5);
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    const _r0 = ɵngcc0.ɵɵreference(1);
    ɵngcc0.ɵɵproperty("ngIf", _r0.searchTerm);
} }
function ProductSearchInputComponent_ng_template_4_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    const _r13 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "vdr-facet-value-chip", 8);
    ɵngcc0.ɵɵlistener("remove", function ProductSearchInputComponent_ng_template_4_ng_container_0_Template_vdr_facet_value_chip_remove_1_listener() { ɵngcc0.ɵɵrestoreView(_r13); const ctx_r12 = ɵngcc0.ɵɵnextContext(); const item_r7 = ctx_r12.item; const clear_r8 = ctx_r12.clear; return clear_r8(item_r7); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const item_r7 = ɵngcc0.ɵɵnextContext().item;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("facetValue", item_r7.facetValue)("removable", true);
} }
function ProductSearchInputComponent_ng_template_4_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    const _r17 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "vdr-chip", 9);
    ɵngcc0.ɵɵlistener("iconClick", function ProductSearchInputComponent_ng_template_4_ng_container_1_Template_vdr_chip_iconClick_1_listener() { ɵngcc0.ɵɵrestoreView(_r17); const ctx_r16 = ɵngcc0.ɵɵnextContext(); const item_r7 = ctx_r16.item; const clear_r8 = ctx_r16.clear; return clear_r8(item_r7); });
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const item_r7 = ɵngcc0.ɵɵnextContext().item;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("icon", "times");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1("\"", item_r7.label, "\"");
} }
function ProductSearchInputComponent_ng_template_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ProductSearchInputComponent_ng_template_4_ng_container_0_Template, 2, 2, "ng-container", 7);
    ɵngcc0.ɵɵtemplate(1, ProductSearchInputComponent_ng_template_4_ng_container_1_Template, 3, 2, "ng-container", 7);
} if (rf & 2) {
    const item_r7 = ctx.item;
    ɵngcc0.ɵɵproperty("ngIf", item_r7.facetValue);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !item_r7.facetValue);
} }
function ProductSearchInputComponent_ng_template_5_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelement(1, "vdr-facet-value-chip", 10);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const item_r19 = ɵngcc0.ɵɵnextContext().item;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("facetValue", item_r19.facetValue)("removable", false);
} }
function ProductSearchInputComponent_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ProductSearchInputComponent_ng_template_5_ng_container_0_Template, 2, 2, "ng-container", 7);
} if (rf & 2) {
    const item_r19 = ctx.item;
    ɵngcc0.ɵɵproperty("ngIf", item_r19.facetValue);
} }
function UpdateProductOptionDialogComponent_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(1, 1, "catalog.update-product-option"));
} }
function UpdateProductOptionDialogComponent_section_14_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section");
    ɵngcc0.ɵɵelementStart(1, "label");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(4, "vdr-tabbed-custom-fields", 10);
    ɵngcc0.ɵɵpipe(5, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 4, "common.custom-fields"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("customFields", ctx_r3.customFields)("customFieldsFormGroup", ctx_r3.customFieldsForm)("readonly", !ɵngcc0.ɵɵpipeBind1(5, 6, ɵngcc0.ɵɵpureFunction0(8, _c18)));
} }
function UpdateProductOptionDialogComponent_ng_template_15_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 11);
    ɵngcc0.ɵɵlistener("click", function UpdateProductOptionDialogComponent_ng_template_15_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(); return ctx_r5.cancel(); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "button", 12);
    ɵngcc0.ɵɵlistener("click", function UpdateProductOptionDialogComponent_ng_template_15_Template_button_click_3_listener() { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.update(); });
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    const _r1 = ɵngcc0.ɵɵreference(4);
    const _r2 = ɵngcc0.ɵɵreference(8);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 3, "common.cancel"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", _r1.invalid || _r2.invalid || _r1.pristine && _r2.pristine && ctx_r4.customFieldsForm.pristine);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 5, "catalog.update-product-option"), " ");
} }
function ProductVariantsListComponent_div_1_ng_container_1_clr_toggle_wrapper_16_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "clr-toggle-wrapper");
    ɵngcc0.ɵɵelement(1, "input", 45);
    ɵngcc0.ɵɵelementStart(2, "label");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 1, "common.enabled"));
} }
function ProductVariantsListComponent_div_1_ng_container_1_clr_select_container_25_option_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "option", 48);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const taxCategory_r19 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("value", taxCategory_r19.id);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", taxCategory_r19.name, " ");
} }
function ProductVariantsListComponent_div_1_ng_container_1_clr_select_container_25_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "clr-select-container");
    ɵngcc0.ɵɵelementStart(1, "label");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "select", 46);
    ɵngcc0.ɵɵtemplate(5, ProductVariantsListComponent_div_1_ng_container_1_clr_select_container_25_option_5_Template, 2, 2, "option", 47);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r6 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 2, "catalog.tax-category"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r6.taxCategories);
} }
function ProductVariantsListComponent_div_1_ng_container_1_ng_template_26_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "label", 29);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 49);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const formGroup_r4 = ɵngcc0.ɵɵnextContext().ngIf;
    const ctx_r8 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 2, "catalog.tax-category"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r8.getTaxCategoryName(formGroup_r4), " ");
} }
function ProductVariantsListComponent_div_1_ng_container_1_vdr_currency_input_33_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-currency-input", 50);
    ɵngcc0.ɵɵpipe(1, "hasPermission");
} if (rf & 2) {
    const variant_r1 = ɵngcc0.ɵɵnextContext(2).$implicit;
    const ctx_r9 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("currencyCode", variant_r1.currencyCode)("readonly", !ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r9.updatePermission));
} }
function ProductVariantsListComponent_div_1_ng_container_1_vdr_currency_input_34_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-currency-input", 51);
    ɵngcc0.ɵɵpipe(1, "hasPermission");
} if (rf & 2) {
    const variant_r1 = ɵngcc0.ɵɵnextContext(2).$implicit;
    const ctx_r10 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("currencyCode", variant_r1.currencyCode)("readonly", !ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r10.updatePermission));
} }
function ProductVariantsListComponent_div_1_ng_container_1_clr_select_container_37_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "clr-select-container");
    ɵngcc0.ɵɵelementStart(1, "label");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelement(4, "vdr-help-tooltip", 27);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(6, "select", 52);
    ɵngcc0.ɵɵelementStart(7, "option", 48);
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "option", 48);
    ɵngcc0.ɵɵtext(11);
    ɵngcc0.ɵɵpipe(12, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(13, "option", 48);
    ɵngcc0.ɵɵtext(14);
    ɵngcc0.ɵɵpipe(15, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r11 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind1(3, 8, "catalog.track-inventory"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("content", ɵngcc0.ɵɵpipeBind1(5, 10, "catalog.track-inventory-tooltip"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("value", ctx_r11.GlobalFlag.TRUE);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(9, 12, "catalog.track-inventory-true"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("value", ctx_r11.GlobalFlag.FALSE);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(12, 14, "catalog.track-inventory-false"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("value", ctx_r11.GlobalFlag.INHERIT);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(15, 16, "catalog.track-inventory-inherit"), " ");
} }
function ProductVariantsListComponent_div_1_ng_container_1_section_81_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 53);
    ɵngcc0.ɵɵelement(1, "vdr-tabbed-custom-fields", 54);
    ɵngcc0.ɵɵpipe(2, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const formGroup_r4 = ɵngcc0.ɵɵnextContext().ngIf;
    const ctx_r12 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("customFields", ctx_r12.customFields)("compact", true)("customFieldsFormGroup", formGroup_r4.get("customFields"))("readonly", !ɵngcc0.ɵɵpipeBind1(2, 4, ctx_r12.updatePermission));
} }
function ProductVariantsListComponent_div_1_ng_container_1_div_85_vdr_chip_2_Template(rf, ctx) { if (rf & 1) {
    const _r27 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-chip", 58);
    ɵngcc0.ɵɵlistener("iconClick", function ProductVariantsListComponent_div_1_ng_container_1_div_85_vdr_chip_2_Template_vdr_chip_iconClick_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r27); const option_r25 = restoredCtx.$implicit; const ctx_r26 = ɵngcc0.ɵɵnextContext(4); return ctx_r26.editOption(option_r25); });
    ɵngcc0.ɵɵpipe(1, "hasPermission");
    ɵngcc0.ɵɵelementStart(2, "span", 59);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const option_r25 = ctx.$implicit;
    const ctx_r24 = ɵngcc0.ɵɵnextContext(4);
    ɵngcc0.ɵɵproperty("colorFrom", ctx_r24.optionGroupName(option_r25.groupId))("invert", true)("icon", ɵngcc0.ɵɵpipeBind1(1, 5, ctx_r24.updatePermission) && "pencil");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate(ctx_r24.optionGroupName(option_r25.groupId));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r24.optionName(option_r25), " ");
} }
const _c35 = function () { return ["./", "options"]; };
function ProductVariantsListComponent_div_1_ng_container_1_div_85_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵelementStart(1, "div", 55);
    ɵngcc0.ɵɵtemplate(2, ProductVariantsListComponent_div_1_ng_container_1_div_85_vdr_chip_2_Template, 5, 7, "vdr-chip", 56);
    ɵngcc0.ɵɵpipe(3, "sort");
    ɵngcc0.ɵɵelementStart(4, "a", 57);
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r1 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind2(3, 3, variant_r1.options, "groupId"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("routerLink", ɵngcc0.ɵɵpureFunction0(8, _c35));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind1(6, 6, "catalog.edit-options"), "...");
} }
function ProductVariantsListComponent_div_1_ng_container_1_vdr_facet_value_chip_88_Template(rf, ctx) { if (rf & 1) {
    const _r32 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-facet-value-chip", 60);
    ɵngcc0.ɵɵlistener("remove", function ProductVariantsListComponent_div_1_ng_container_1_vdr_facet_value_chip_88_Template_vdr_facet_value_chip_remove_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r32); const facetValue_r29 = restoredCtx.$implicit; const variant_r1 = ɵngcc0.ɵɵnextContext(2).$implicit; const ctx_r30 = ɵngcc0.ɵɵnextContext(); return ctx_r30.removeFacetValue(variant_r1, facetValue_r29.id); });
    ɵngcc0.ɵɵpipe(1, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const facetValue_r29 = ctx.$implicit;
    const ctx_r14 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("facetValue", facetValue_r29)("removable", ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r14.updatePermission));
} }
function ProductVariantsListComponent_div_1_ng_container_1_vdr_facet_value_chip_89_Template(rf, ctx) { if (rf & 1) {
    const _r36 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-facet-value-chip", 60);
    ɵngcc0.ɵɵlistener("remove", function ProductVariantsListComponent_div_1_ng_container_1_vdr_facet_value_chip_89_Template_vdr_facet_value_chip_remove_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r36); const facetValue_r33 = restoredCtx.$implicit; const variant_r1 = ɵngcc0.ɵɵnextContext(2).$implicit; const ctx_r34 = ɵngcc0.ɵɵnextContext(); return ctx_r34.removeFacetValue(variant_r1, facetValue_r33.id); });
    ɵngcc0.ɵɵpipe(1, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const facetValue_r33 = ctx.$implicit;
    const ctx_r15 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵproperty("facetValue", facetValue_r33)("removable", ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r15.updatePermission));
} }
function ProductVariantsListComponent_div_1_ng_container_1_button_90_Template(rf, ctx) { if (rf & 1) {
    const _r39 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 61);
    ɵngcc0.ɵɵlistener("click", function ProductVariantsListComponent_div_1_ng_container_1_button_90_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r39); const variant_r1 = ɵngcc0.ɵɵnextContext(2).$implicit; const ctx_r37 = ɵngcc0.ɵɵnextContext(); return ctx_r37.selectFacetValueClick.emit([variant_r1.id]); });
    ɵngcc0.ɵɵelement(1, "clr-icon", 62);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 1, "catalog.add-facets"), " ");
} }
function ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_ng_container_2_vdr_chip_1_Template(rf, ctx) { if (rf & 1) {
    const _r46 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "vdr-chip", 69);
    ɵngcc0.ɵɵlistener("iconClick", function ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_ng_container_2_vdr_chip_1_Template_vdr_chip_iconClick_0_listener() { ɵngcc0.ɵɵrestoreView(_r46); const channel_r42 = ɵngcc0.ɵɵnextContext().$implicit; const variant_r1 = ɵngcc0.ɵɵnextContext(4).$implicit; const ctx_r44 = ɵngcc0.ɵɵnextContext(); return ctx_r44.removeFromChannel.emit({ channelId: channel_r42.id, variant: variant_r1 }); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵelement(2, "vdr-channel-badge", 70);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "channelCodeToLabel");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const channel_r42 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(1, 3, "catalog.remove-from-channel"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("channelCode", channel_r42.code);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 5, channel_r42.code), " ");
} }
function ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_ng_container_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_ng_container_2_vdr_chip_1_Template, 5, 7, "vdr-chip", 68);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const channel_r42 = ctx.$implicit;
    const ctx_r41 = ɵngcc0.ɵɵnextContext(5);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r41.isDefaultChannel(channel_r42.code));
} }
function ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_Template(rf, ctx) { if (rf & 1) {
    const _r51 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 13);
    ɵngcc0.ɵɵelementStart(1, "div", 64);
    ɵngcc0.ɵɵtemplate(2, ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_ng_container_2_Template, 2, 1, "ng-container", 65);
    ɵngcc0.ɵɵelementStart(3, "button", 66);
    ɵngcc0.ɵɵlistener("click", function ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_Template_button_click_3_listener() { ɵngcc0.ɵɵrestoreView(_r51); const variant_r1 = ɵngcc0.ɵɵnextContext(3).$implicit; const ctx_r49 = ɵngcc0.ɵɵnextContext(); return ctx_r49.assignToChannel.emit(variant_r1); });
    ɵngcc0.ɵɵelement(4, "clr-icon", 67);
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r1 = ɵngcc0.ɵɵnextContext(3).$implicit;
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", variant_r1.channels);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(6, 2, "catalog.assign-to-channel"), " ");
} }
function ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_div_1_Template, 7, 4, "div", 63);
    ɵngcc0.ɵɵelementContainerEnd();
} }
function ProductVariantsListComponent_div_1_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    const _r55 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0, 4);
    ɵngcc0.ɵɵelementStart(1, "div", 5);
    ɵngcc0.ɵɵelementStart(2, "div", 6);
    ɵngcc0.ɵɵelementStart(3, "vdr-title-input", 7);
    ɵngcc0.ɵɵpipe(4, "hasPermission");
    ɵngcc0.ɵɵelementStart(5, "clr-input-container");
    ɵngcc0.ɵɵelement(6, "input", 8);
    ɵngcc0.ɵɵpipe(7, "hasPermission");
    ɵngcc0.ɵɵpipe(8, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(9, "vdr-title-input", 9);
    ɵngcc0.ɵɵpipe(10, "hasPermission");
    ɵngcc0.ɵɵelementStart(11, "clr-input-container");
    ɵngcc0.ɵɵelement(12, "input", 10);
    ɵngcc0.ɵɵpipe(13, "hasPermission");
    ɵngcc0.ɵɵpipe(14, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(15, "div", 11);
    ɵngcc0.ɵɵtemplate(16, ProductVariantsListComponent_div_1_ng_container_1_clr_toggle_wrapper_16_Template, 5, 3, "clr-toggle-wrapper", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(17, "div", 13);
    ɵngcc0.ɵɵelementStart(18, "div", 14);
    ɵngcc0.ɵɵelementStart(19, "div", 15);
    ɵngcc0.ɵɵelementStart(20, "vdr-assets", 16);
    ɵngcc0.ɵɵlistener("change", function ProductVariantsListComponent_div_1_ng_container_1_Template_vdr_assets_change_20_listener($event) { ɵngcc0.ɵɵrestoreView(_r55); const variant_r1 = ɵngcc0.ɵɵnextContext().$implicit; const ctx_r53 = ɵngcc0.ɵɵnextContext(); return ctx_r53.onAssetChange(variant_r1.id, $event); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(21, "div", 17);
    ɵngcc0.ɵɵelementStart(22, "div", 18);
    ɵngcc0.ɵɵelementStart(23, "div", 19);
    ɵngcc0.ɵɵelementStart(24, "div", 20);
    ɵngcc0.ɵɵtemplate(25, ProductVariantsListComponent_div_1_ng_container_1_clr_select_container_25_Template, 6, 4, "clr-select-container", 21);
    ɵngcc0.ɵɵtemplate(26, ProductVariantsListComponent_div_1_ng_container_1_ng_template_26_Template, 5, 4, "ng-template", null, 22, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(28, "div", 23);
    ɵngcc0.ɵɵelementStart(29, "clr-input-container");
    ɵngcc0.ɵɵelementStart(30, "label");
    ɵngcc0.ɵɵtext(31);
    ɵngcc0.ɵɵpipe(32, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(33, ProductVariantsListComponent_div_1_ng_container_1_vdr_currency_input_33_Template, 2, 4, "vdr-currency-input", 24);
    ɵngcc0.ɵɵtemplate(34, ProductVariantsListComponent_div_1_ng_container_1_vdr_currency_input_34_Template, 2, 4, "vdr-currency-input", 25);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(35, "vdr-variant-price-detail", 26);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(36, "div", 19);
    ɵngcc0.ɵɵtemplate(37, ProductVariantsListComponent_div_1_ng_container_1_clr_select_container_37_Template, 16, 18, "clr-select-container", 12);
    ɵngcc0.ɵɵelementStart(38, "clr-input-container");
    ɵngcc0.ɵɵelementStart(39, "label");
    ɵngcc0.ɵɵtext(40);
    ɵngcc0.ɵɵpipe(41, "translate");
    ɵngcc0.ɵɵelement(42, "vdr-help-tooltip", 27);
    ɵngcc0.ɵɵpipe(43, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(44, "input", 28);
    ɵngcc0.ɵɵpipe(45, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(46, "div");
    ɵngcc0.ɵɵelementStart(47, "label", 29);
    ɵngcc0.ɵɵtext(48);
    ɵngcc0.ɵɵpipe(49, "translate");
    ɵngcc0.ɵɵelement(50, "vdr-help-tooltip", 27);
    ɵngcc0.ɵɵpipe(51, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(52, "div", 30);
    ɵngcc0.ɵɵtext(53);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(54, "div");
    ɵngcc0.ɵɵelementStart(55, "label", 29);
    ɵngcc0.ɵɵtext(56);
    ɵngcc0.ɵɵpipe(57, "translate");
    ɵngcc0.ɵɵelement(58, "vdr-help-tooltip", 27);
    ɵngcc0.ɵɵpipe(59, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(60, "div", 30);
    ɵngcc0.ɵɵtext(61);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(62, "div", 19);
    ɵngcc0.ɵɵelementStart(63, "div", 31);
    ɵngcc0.ɵɵelementStart(64, "label", 29);
    ɵngcc0.ɵɵtext(65);
    ɵngcc0.ɵɵpipe(66, "translate");
    ɵngcc0.ɵɵelement(67, "vdr-help-tooltip", 27);
    ɵngcc0.ɵɵpipe(68, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(69, "div", 32);
    ɵngcc0.ɵɵelementStart(70, "clr-input-container");
    ɵngcc0.ɵɵelement(71, "input", 33);
    ɵngcc0.ɵɵpipe(72, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(73, "clr-toggle-wrapper");
    ɵngcc0.ɵɵelement(74, "input", 34);
    ɵngcc0.ɵɵpipe(75, "hasPermission");
    ɵngcc0.ɵɵelementStart(76, "label");
    ɵngcc0.ɵɵtext(77);
    ɵngcc0.ɵɵpipe(78, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(79, "div", 35);
    ɵngcc0.ɵɵelementStart(80, "div", 19);
    ɵngcc0.ɵɵtemplate(81, ProductVariantsListComponent_div_1_ng_container_1_section_81_Template, 3, 6, "section", 36);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(82, "div", 13);
    ɵngcc0.ɵɵelementStart(83, "div", 37);
    ɵngcc0.ɵɵelement(84, "vdr-entity-info", 38);
    ɵngcc0.ɵɵtemplate(85, ProductVariantsListComponent_div_1_ng_container_1_div_85_Template, 7, 9, "div", 39);
    ɵngcc0.ɵɵelement(86, "div", 40);
    ɵngcc0.ɵɵelementStart(87, "div", 41);
    ɵngcc0.ɵɵtemplate(88, ProductVariantsListComponent_div_1_ng_container_1_vdr_facet_value_chip_88_Template, 2, 4, "vdr-facet-value-chip", 42);
    ɵngcc0.ɵɵtemplate(89, ProductVariantsListComponent_div_1_ng_container_1_vdr_facet_value_chip_89_Template, 2, 4, "vdr-facet-value-chip", 42);
    ɵngcc0.ɵɵtemplate(90, ProductVariantsListComponent_div_1_ng_container_1_button_90_Template, 4, 3, "button", 43);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(91, ProductVariantsListComponent_div_1_ng_container_1_ng_container_91_Template, 2, 0, "ng-container", 44);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const formGroup_r4 = ctx.ngIf;
    const _r7 = ɵngcc0.ɵɵreference(27);
    const variant_r1 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    let tmp_40_0;
    ɵngcc0.ɵɵproperty("formGroup", formGroup_r4);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(4, 54, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(7, 56, ctx_r3.updatePermission))("placeholder", ɵngcc0.ɵɵpipeBind1(8, 58, "catalog.sku"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(10, 60, ctx_r3.updatePermission));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(13, 62, ctx_r3.updatePermission))("placeholder", ɵngcc0.ɵɵpipeBind1(14, 64, "common.name"));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r3.updatePermission);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("compact", true)("assets", (ctx_r3.pendingAssetChanges[variant_r1.id] == null ? null : ctx_r3.pendingAssetChanges[variant_r1.id].assets) || variant_r1.assets)("featuredAsset", (ctx_r3.pendingAssetChanges[variant_r1.id] == null ? null : ctx_r3.pendingAssetChanges[variant_r1.id].featuredAsset) || variant_r1.featuredAsset)("updatePermissions", ctx_r3.updatePermission);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r3.updatePermission)("vdrIfPermissionsElse", _r7);
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(32, 66, "catalog.price"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r3.channelPriceIncludesTax);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.channelPriceIncludesTax);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("price", formGroup_r4.get("price").value)("currencyCode", variant_r1.currencyCode)("priceIncludesTax", ctx_r3.channelPriceIncludesTax)("taxCategoryId", formGroup_r4.get("taxCategoryId").value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r3.updatePermission);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind1(41, 68, "catalog.stock-on-hand"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("content", ɵngcc0.ɵɵpipeBind1(43, 70, "catalog.stock-on-hand-tooltip"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("inventory-untracked", ctx_r3.inventoryIsNotTracked(formGroup_r4));
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(45, 72, ctx_r3.updatePermission))("vdrDisabled", ctx_r3.inventoryIsNotTracked(formGroup_r4));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("inventory-untracked", ctx_r3.inventoryIsNotTracked(formGroup_r4));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind1(49, 74, "catalog.stock-allocated"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("content", ɵngcc0.ɵɵpipeBind1(51, 76, "catalog.stock-allocated-tooltip"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", variant_r1.stockAllocated, " ");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("inventory-untracked", ctx_r3.inventoryIsNotTracked(formGroup_r4));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1("", ɵngcc0.ɵɵpipeBind1(57, 78, "catalog.stock-saleable"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("content", ɵngcc0.ɵɵpipeBind1(59, 80, "catalog.stock-saleable-tooltip"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r3.getSaleableStockLevel(variant_r1), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("inventory-untracked", ctx_r3.inventoryIsNotTracked(formGroup_r4));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(66, 82, "catalog.out-of-stock-threshold"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("content", ɵngcc0.ɵɵpipeBind1(68, 84, "catalog.out-of-stock-threshold-tooltip"));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("formControl", formGroup_r4.get("outOfStockThreshold"))("readonly", !ɵngcc0.ɵɵpipeBind1(72, 86, ctx_r3.updatePermission))("vdrDisabled", ((tmp_40_0 = formGroup_r4.get("useGlobalOutOfStockThreshold")) == null ? null : tmp_40_0.value) !== false || ctx_r3.inventoryIsNotTracked(formGroup_r4));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("vdrDisabled", !ɵngcc0.ɵɵpipeBind1(75, 88, ctx_r3.updatePermission) || ctx_r3.inventoryIsNotTracked(formGroup_r4));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate2("", ɵngcc0.ɵɵpipeBind1(78, 90, "catalog.use-global-value"), " (", ctx_r3.globalOutOfStockThreshold, ")");
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r3.customFields.length);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("entity", variant_r1);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", variant_r1.options.length);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r3.existingFacetValues(variant_r1));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r3.pendingFacetValues(variant_r1));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx_r3.updatePermission);
} }
function ProductVariantsListComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 2);
    ɵngcc0.ɵɵtemplate(1, ProductVariantsListComponent_div_1_ng_container_1_Template, 92, 92, "ng-container", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r1 = ctx.$implicit;
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    let tmp_0_0;
    let tmp_0_1;
    ɵngcc0.ɵɵclassProp("disabled", !((tmp_0_0 = ctx_r0.formGroupMap.get(variant_r1.id)) == null ? null : (tmp_0_1 = tmp_0_0.get("enabled")) == null ? null : tmp_0_1.value));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.formGroupMap.get(variant_r1.id));
} }
const _c36 = function () { return { itemsPerPage: 10, currentPage: 1 }; };
function ProductVariantsTableComponent_ng_container_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "th");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const optionGroup_r2 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(optionGroup_r2.name);
} }
function ProductVariantsTableComponent_tr_22_ng_container_1_img_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "img", 18);
    ɵngcc0.ɵɵpipe(1, "assetPreview");
} if (rf & 2) {
    const featuredAsset_r13 = ctx.ngIf;
    ɵngcc0.ɵɵproperty("src", ɵngcc0.ɵɵpipeBind2(1, 1, featuredAsset_r13, "tiny"), ɵngcc0.ɵɵsanitizeUrl);
} }
function ProductVariantsTableComponent_tr_22_ng_container_1_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 19);
    ɵngcc0.ɵɵelement(1, "clr-icon", 20);
    ɵngcc0.ɵɵelementEnd();
} }
function ProductVariantsTableComponent_tr_22_ng_container_1_ng_container_17_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "td", 5);
    ɵngcc0.ɵɵpipe(2, "stringToColor");
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const option_r14 = ctx.$implicit;
    const formGroup_r6 = ɵngcc0.ɵɵnextContext().ngIf;
    const ctx_r10 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵstyleProp("color", ɵngcc0.ɵɵpipeBind1(2, 5, ctx_r10.optionGroupName(option_r14.groupId)));
    ɵngcc0.ɵɵclassProp("disabled", !formGroup_r6.get("enabled").value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", option_r14.name, " ");
} }
function ProductVariantsTableComponent_tr_22_ng_container_1_vdr_currency_input_21_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-currency-input", 21);
    ɵngcc0.ɵɵpipe(1, "hasPermission");
} if (rf & 2) {
    const variant_r3 = ɵngcc0.ɵɵnextContext(2).$implicit;
    const ctx_r11 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("currencyCode", variant_r3.currencyCode)("readonly", !ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r11.updatePermission));
} }
function ProductVariantsTableComponent_tr_22_ng_container_1_vdr_currency_input_22_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "vdr-currency-input", 22);
    ɵngcc0.ɵɵpipe(1, "hasPermission");
} if (rf & 2) {
    const variant_r3 = ɵngcc0.ɵɵnextContext(2).$implicit;
    const ctx_r12 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("currencyCode", variant_r3.currencyCode)("readonly", !ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r12.updatePermission));
} }
function ProductVariantsTableComponent_tr_22_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0, 4);
    ɵngcc0.ɵɵelementStart(1, "td", 5);
    ɵngcc0.ɵɵelementStart(2, "div", 6);
    ɵngcc0.ɵɵelementStart(3, "div", 7);
    ɵngcc0.ɵɵtemplate(4, ProductVariantsTableComponent_tr_22_ng_container_1_img_4_Template, 2, 4, "img", 8);
    ɵngcc0.ɵɵtemplate(5, ProductVariantsTableComponent_tr_22_ng_container_1_ng_template_5_Template, 2, 0, "ng-template", null, 9, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "td", 5);
    ɵngcc0.ɵɵelementStart(8, "clr-input-container");
    ɵngcc0.ɵɵelement(9, "input", 10);
    ɵngcc0.ɵɵpipe(10, "hasPermission");
    ɵngcc0.ɵɵpipe(11, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "td", 5);
    ɵngcc0.ɵɵelementStart(13, "clr-input-container");
    ɵngcc0.ɵɵelement(14, "input", 11);
    ɵngcc0.ɵɵpipe(15, "hasPermission");
    ɵngcc0.ɵɵpipe(16, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(17, ProductVariantsTableComponent_tr_22_ng_container_1_ng_container_17_Template, 4, 7, "ng-container", 1);
    ɵngcc0.ɵɵpipe(18, "sort");
    ɵngcc0.ɵɵelementStart(19, "td", 12);
    ɵngcc0.ɵɵelementStart(20, "clr-input-container");
    ɵngcc0.ɵɵtemplate(21, ProductVariantsTableComponent_tr_22_ng_container_1_vdr_currency_input_21_Template, 2, 4, "vdr-currency-input", 13);
    ɵngcc0.ɵɵtemplate(22, ProductVariantsTableComponent_tr_22_ng_container_1_vdr_currency_input_22_Template, 2, 4, "vdr-currency-input", 14);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(23, "td", 15);
    ɵngcc0.ɵɵelementStart(24, "clr-input-container");
    ɵngcc0.ɵɵelement(25, "input", 16);
    ɵngcc0.ɵɵpipe(26, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(27, "td", 15);
    ɵngcc0.ɵɵelementStart(28, "clr-toggle-wrapper");
    ɵngcc0.ɵɵelement(29, "input", 17);
    ɵngcc0.ɵɵpipe(30, "hasPermission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const formGroup_r6 = ctx.ngIf;
    const _r8 = ɵngcc0.ɵɵreference(6);
    const variant_r3 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("formGroup", formGroup_r6);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("disabled", !formGroup_r6.get("enabled").value);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.getFeaturedAsset(variant_r3))("ngIfElse", _r8);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵclassProp("disabled", !formGroup_r6.get("enabled").value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(10, 24, ctx_r5.updatePermission))("placeholder", ɵngcc0.ɵɵpipeBind1(11, 26, "common.name"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵclassProp("disabled", !formGroup_r6.get("enabled").value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(15, 28, ctx_r5.updatePermission))("placeholder", ɵngcc0.ɵɵpipeBind1(16, 30, "catalog.sku"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind2(18, 32, variant_r3.options, "groupId"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("disabled", !formGroup_r6.get("enabled").value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r5.channelPriceIncludesTax);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.channelPriceIncludesTax);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵclassProp("disabled", !formGroup_r6.get("enabled").value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("readonly", !ɵngcc0.ɵɵpipeBind1(26, 35, ctx_r5.updatePermission));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵclassProp("disabled", !formGroup_r6.get("enabled").value);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("vdrDisabled", !ɵngcc0.ɵɵpipeBind1(30, 37, ctx_r5.updatePermission));
} }
function ProductVariantsTableComponent_tr_22_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "tr");
    ɵngcc0.ɵɵtemplate(1, ProductVariantsTableComponent_tr_22_ng_container_1_Template, 31, 39, "ng-container", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const variant_r3 = ctx.$implicit;
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.formGroupMap.get(variant_r3.id));
} }
const _c37 = function (a0) { return { rate: a0 }; };
function VariantPriceDetailComponent_div_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 2);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵpipe(3, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(2, 1, "catalog.price-includes-tax-at", ɵngcc0.ɵɵpureFunction1(6, _c37, ɵngcc0.ɵɵpipeBind1(3, 4, ctx_r0.taxRate$))), "\n");
} }
const _c38 = function (a0, a1) { return { price: a0, rate: a1 }; };
function VariantPriceDetailComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 2);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵpipe(3, "localeCurrency");
    ɵngcc0.ɵɵpipe(4, "async");
    ɵngcc0.ɵɵpipe(5, "async");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(2, 1, "catalog.price-with-tax-in-default-zone", ɵngcc0.ɵɵpureFunction2(11, _c38, ɵngcc0.ɵɵpipeBind2(3, 4, ɵngcc0.ɵɵpipeBind1(4, 7, ctx_r1.grossPrice$), ctx_r1.currencyCode), ɵngcc0.ɵɵpipeBind1(5, 9, ctx_r1.taxRate$))), "\n");
} }
class AssetDetailComponent extends BaseDetailComponent {
    constructor(router, route, serverConfigService, notificationService, dataService, formBuilder) {
        super(route, router, serverConfigService, dataService);
        this.notificationService = notificationService;
        this.dataService = dataService;
        this.formBuilder = formBuilder;
        this.detailForm = new FormGroup({});
        this.customFields = this.getCustomFieldConfig('Asset');
    }
    ngOnInit() {
        this.detailForm = new FormGroup({
            name: new FormControl(''),
            tags: new FormControl([]),
            customFields: this.formBuilder.group(this.customFields.reduce((hash, field) => (Object.assign(Object.assign({}, hash), { [field.name]: '' })), {})),
        });
        this.init();
    }
    ngOnDestroy() {
        this.destroy();
    }
    onAssetChange(event) {
        var _a, _b;
        (_a = this.detailForm.get('name')) === null || _a === void 0 ? void 0 : _a.setValue(event.name);
        (_b = this.detailForm.get('tags')) === null || _b === void 0 ? void 0 : _b.setValue(event.tags);
        this.detailForm.markAsDirty();
    }
    save() {
        this.dataService.product
            .updateAsset({
            id: this.id,
            name: this.detailForm.value.name,
            tags: this.detailForm.value.tags,
            customFields: this.detailForm.value.customFields,
        })
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-update-success'), { entity: 'Asset' });
        }, err => {
            this.notificationService.error(marker('common.notify-update-error'), {
                entity: 'Asset',
            });
        });
    }
    setFormValues(entity, languageCode) {
        var _a, _b;
        (_a = this.detailForm.get('name')) === null || _a === void 0 ? void 0 : _a.setValue(entity.name);
        (_b = this.detailForm.get('tags')) === null || _b === void 0 ? void 0 : _b.setValue(entity.tags);
        if (this.customFields.length) {
            this.setCustomFieldFormValues(this.customFields, this.detailForm.get(['customFields']), entity);
        }
    }
}
AssetDetailComponent.ɵfac = function AssetDetailComponent_Factory(t) { return new (t || AssetDetailComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.FormBuilder)); };
AssetDetailComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: AssetDetailComponent, selectors: [["vdr-asset-detail"]], features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 9, vars: 11, consts: [[3, "entity"], ["locationId", "asset-detail"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "vdrIfPermissions"], [3, "asset", "editable", "customFields", "customFieldsForm", "assetChange"], [1, "btn", "btn-primary", 3, "disabled", "click"]], template: function AssetDetailComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left");
        ɵngcc0.ɵɵelement(2, "vdr-entity-info", 0);
        ɵngcc0.ɵɵpipe(3, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "vdr-ab-right");
        ɵngcc0.ɵɵelement(5, "vdr-action-bar-items", 1);
        ɵngcc0.ɵɵtemplate(6, AssetDetailComponent_button_6_Template, 3, 4, "button", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "vdr-asset-preview", 3);
        ɵngcc0.ɵɵlistener("assetChange", function AssetDetailComponent_Template_vdr_asset_preview_assetChange_7_listener($event) { return ctx.onAssetChange($event); });
        ɵngcc0.ɵɵpipe(8, "async");
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("entity", ɵngcc0.ɵɵpipeBind1(3, 6, ctx.entity$));
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(10, _c0));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("asset", ɵngcc0.ɵɵpipeBind1(8, 8, ctx.entity$))("editable", true)("customFields", ctx.customFields)("customFieldsForm", ctx.detailForm.get("customFields"));
    } }, directives: [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.EntityInfoComponent, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc2.IfPermissionsDirective, ɵngcc2.AssetPreviewComponent], pipes: [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe], styles: ["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"], changeDetection: 0 });
AssetDetailComponent.ctorParameters = () => [
    { type: Router },
    { type: ActivatedRoute },
    { type: ServerConfigService },
    { type: NotificationService },
    { type: DataService },
    { type: FormBuilder }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(AssetDetailComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-asset-detail',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"asset-detail\"></vdr-action-bar-items>\r\n        <button\r\n            *vdrIfPermissions=\"['UpdateCatalog', 'UpdateAsset']\"\r\n            class=\"btn btn-primary\"\r\n            (click)=\"save()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n        >\r\n            {{ 'common.update' | translate }}\r\n        </button>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n<vdr-asset-preview\r\n    [asset]=\"entity$ | async\"\r\n    [editable]=\"true\"\r\n    [customFields]=\"customFields\"\r\n    [customFieldsForm]=\"detailForm.get('customFields')\"\r\n    (assetChange)=\"onAssetChange($event)\"\r\n></vdr-asset-preview>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host{display:flex;flex-direction:column;height:100%}\n"]
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }, { type: ɵngcc2.ServerConfigService }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.DataService }, { type: ɵngcc3.FormBuilder }]; }, null); })();

class AssetListComponent extends BaseListComponent {
    constructor(notificationService, modalService, dataService, router, route) {
        super(router, route);
        this.notificationService = notificationService;
        this.modalService = modalService;
        this.dataService = dataService;
        this.searchTerm$ = new BehaviorSubject(undefined);
        this.filterByTags$ = new BehaviorSubject(undefined);
        this.uploading = false;
        super.setQueryFn((...args) => this.dataService.product.getAssetList(...args), data => data.assets, (skip, take) => {
            var _a;
            const searchTerm = this.searchTerm$.value;
            const tags = (_a = this.filterByTags$.value) === null || _a === void 0 ? void 0 : _a.map(t => t.value);
            return {
                options: Object.assign(Object.assign({ skip,
                    take }, (searchTerm
                    ? {
                        filter: {
                            name: { contains: searchTerm },
                        },
                    }
                    : {})), { sort: {
                        createdAt: SortOrder.DESC,
                    }, tags, tagsOperator: LogicalOperator.AND }),
            };
        }, { take: 25, skip: 0 });
    }
    ngOnInit() {
        super.ngOnInit();
        this.paginationConfig$ = combineLatest(this.itemsPerPage$, this.currentPage$, this.totalItems$).pipe(map(([itemsPerPage, currentPage, totalItems]) => ({ itemsPerPage, currentPage, totalItems })));
        this.searchTerm$.pipe(debounceTime(250), takeUntil(this.destroy$)).subscribe(() => this.refresh());
        this.filterByTags$.pipe(takeUntil(this.destroy$)).subscribe(() => this.refresh());
        this.allTags$ = this.dataService.product.getTagList().mapStream(data => data.tags.items);
    }
    filesSelected(files) {
        if (files.length) {
            this.uploading = true;
            this.dataService.product
                .createAssets(files)
                .pipe(finalize(() => (this.uploading = false)))
                .subscribe(({ createAssets }) => {
                let successCount = 0;
                for (const result of createAssets) {
                    switch (result.__typename) {
                        case 'Asset':
                            successCount++;
                            break;
                        case 'MimeTypeError':
                            this.notificationService.error(result.message);
                            break;
                    }
                }
                if (0 < successCount) {
                    super.refresh();
                    this.notificationService.success(marker('asset.notify-create-assets-success'), {
                        count: successCount,
                    });
                }
            });
        }
    }
    deleteAssets(assets) {
        this.showModalAndDelete(assets.map(a => a.id))
            .pipe(switchMap(response => {
            if (response.result === DeletionResult.DELETED) {
                return [true];
            }
            else {
                return this.showModalAndDelete(assets.map(a => a.id), response.message || '').pipe(map(r => r.result === DeletionResult.DELETED));
            }
        }))
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-delete-success'), {
                entity: 'Assets',
            });
            this.refresh();
        }, err => {
            this.notificationService.error(marker('common.notify-delete-error'), {
                entity: 'Assets',
            });
        });
    }
    showModalAndDelete(assetIds, message) {
        return this.modalService
            .dialog({
            title: marker('catalog.confirm-delete-assets'),
            translationVars: {
                count: assetIds.length,
            },
            body: message,
            buttons: [
                { type: 'secondary', label: marker('common.cancel') },
                { type: 'danger', label: marker('common.delete'), returnValue: true },
            ],
        })
            .pipe(switchMap(res => (res ? this.dataService.product.deleteAssets(assetIds, !!message) : EMPTY)), map(res => res.deleteAssets));
    }
}
AssetListComponent.ɵfac = function AssetListComponent_Factory(t) { return new (t || AssetListComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute)); };
AssetListComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: AssetListComponent, selectors: [["vdr-asset-list"]], features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 19, vars: 31, consts: [[3, "grow"], [1, "pr4", "mt1", 3, "tags", "searchTermChange", "tagsChange"], ["locationId", "asset-list"], ["dropZoneTarget", ".content-area", 3, "uploading", "selectFiles"], [3, "assets", "multiSelect", "canDelete", "deleteAssets"], [1, "paging-controls"], [3, "itemsPerPage", "itemsPerPageChange"], [3, "currentPage", "itemsPerPage", "totalItems", "pageChange"]], template: function AssetListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left", 0);
        ɵngcc0.ɵɵelementStart(2, "vdr-asset-search-input", 1);
        ɵngcc0.ɵɵlistener("searchTermChange", function AssetListComponent_Template_vdr_asset_search_input_searchTermChange_2_listener($event) { return ctx.searchTerm$.next($event); })("tagsChange", function AssetListComponent_Template_vdr_asset_search_input_tagsChange_2_listener($event) { return ctx.filterByTags$.next($event); });
        ɵngcc0.ɵɵpipe(3, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "vdr-ab-right");
        ɵngcc0.ɵɵelement(5, "vdr-action-bar-items", 2);
        ɵngcc0.ɵɵelementStart(6, "vdr-asset-file-input", 3);
        ɵngcc0.ɵɵlistener("selectFiles", function AssetListComponent_Template_vdr_asset_file_input_selectFiles_6_listener($event) { return ctx.filesSelected($event); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "vdr-asset-gallery", 4);
        ɵngcc0.ɵɵlistener("deleteAssets", function AssetListComponent_Template_vdr_asset_gallery_deleteAssets_7_listener($event) { return ctx.deleteAssets($event); });
        ɵngcc0.ɵɵpipe(8, "paginate");
        ɵngcc0.ɵɵpipe(9, "async");
        ɵngcc0.ɵɵpipe(10, "async");
        ɵngcc0.ɵɵpipe(11, "hasPermission");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(12, "div", 5);
        ɵngcc0.ɵɵelementStart(13, "vdr-items-per-page-controls", 6);
        ɵngcc0.ɵɵlistener("itemsPerPageChange", function AssetListComponent_Template_vdr_items_per_page_controls_itemsPerPageChange_13_listener($event) { return ctx.setItemsPerPage($event); });
        ɵngcc0.ɵɵpipe(14, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(15, "vdr-pagination-controls", 7);
        ɵngcc0.ɵɵlistener("pageChange", function AssetListComponent_Template_vdr_pagination_controls_pageChange_15_listener($event) { return ctx.setPageNumber($event); });
        ɵngcc0.ɵɵpipe(16, "async");
        ɵngcc0.ɵɵpipe(17, "async");
        ɵngcc0.ɵɵpipe(18, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("grow", true);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("tags", ɵngcc0.ɵɵpipeBind1(3, 10, ctx.allTags$));
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("uploading", ctx.uploading);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("assets", ɵngcc0.ɵɵpipeBind2(8, 12, ɵngcc0.ɵɵpipeBind1(9, 15, ctx.items$), ɵngcc0.ɵɵpipeBind1(10, 17, ctx.paginationConfig$) || ɵngcc0.ɵɵpureFunction0(29, _c1)))("multiSelect", true)("canDelete", ɵngcc0.ɵɵpipeBind1(11, 19, ɵngcc0.ɵɵpureFunction0(30, _c2)));
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("itemsPerPage", ɵngcc0.ɵɵpipeBind1(14, 21, ctx.itemsPerPage$));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("currentPage", ɵngcc0.ɵɵpipeBind1(16, 23, ctx.currentPage$))("itemsPerPage", ɵngcc0.ɵɵpipeBind1(17, 25, ctx.itemsPerPage$))("totalItems", ɵngcc0.ɵɵpipeBind1(18, 27, ctx.totalItems$));
    } }, directives: [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.AssetSearchInputComponent, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc2.AssetFileInputComponent, ɵngcc2.AssetGalleryComponent, ɵngcc2.ItemsPerPageControlsComponent, ɵngcc2.PaginationControlsComponent], pipes: [ɵngcc4.AsyncPipe, ɵngcc6.PaginatePipe, ɵngcc2.HasPermissionPipe], styles: ["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"] });
AssetListComponent.ctorParameters = () => [
    { type: NotificationService },
    { type: ModalService },
    { type: DataService },
    { type: Router },
    { type: ActivatedRoute }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(AssetListComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-asset-list',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left [grow]=\"true\">\r\n        <vdr-asset-search-input\r\n            class=\"pr4 mt1\"\r\n            [tags]=\"allTags$ | async\"\r\n            (searchTermChange)=\"searchTerm$.next($event)\"\r\n            (tagsChange)=\"filterByTags$.next($event)\"\r\n        ></vdr-asset-search-input>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"asset-list\"></vdr-action-bar-items>\r\n        <vdr-asset-file-input\r\n            (selectFiles)=\"filesSelected($event)\"\r\n            [uploading]=\"uploading\"\r\n            dropZoneTarget=\".content-area\"\r\n        ></vdr-asset-file-input>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<vdr-asset-gallery\r\n    [assets]=\"(items$ | async)! | paginate: (paginationConfig$ | async) || {}\"\r\n    [multiSelect]=\"true\"\r\n    [canDelete]=\"['DeleteCatalog', 'DeleteAsset'] | hasPermission\"\r\n    (deleteAssets)=\"deleteAssets($event)\"\r\n></vdr-asset-gallery>\r\n\r\n<div class=\"paging-controls\">\r\n    <vdr-items-per-page-controls\r\n        [itemsPerPage]=\"itemsPerPage$ | async\"\r\n        (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n    ></vdr-items-per-page-controls>\r\n\r\n    <vdr-pagination-controls\r\n        [currentPage]=\"currentPage$ | async\"\r\n        [itemsPerPage]=\"itemsPerPage$ | async\"\r\n        [totalItems]=\"totalItems$ | async\"\r\n        (pageChange)=\"setPageNumber($event)\"\r\n    ></vdr-pagination-controls>\r\n</div>\r\n",
                styles: [":host{display:flex;flex-direction:column;height:100%}vdr-asset-gallery{flex:1}.paging-controls{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input{margin-top:6px;min-width:300px}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.NotificationService }, { type: ɵngcc2.ModalService }, { type: ɵngcc2.DataService }, { type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }]; }, null); })();

class CollectionDetailComponent extends BaseDetailComponent {
    constructor(router, route, serverConfigService, changeDetector, dataService, formBuilder, notificationService, modalService) {
        super(route, router, serverConfigService, dataService);
        this.changeDetector = changeDetector;
        this.dataService = dataService;
        this.formBuilder = formBuilder;
        this.notificationService = notificationService;
        this.modalService = modalService;
        this.assetChanges = {};
        this.filters = [];
        this.allFilters = [];
        this.updatePermission = [Permission.UpdateCatalog, Permission.UpdateCollection];
        this.customFields = this.getCustomFieldConfig('Collection');
        this.detailForm = this.formBuilder.group({
            name: ['', Validators.required],
            slug: ['', unicodePatternValidator(/^[\p{Letter}0-9_-]+$/)],
            description: '',
            visible: false,
            filters: this.formBuilder.array([]),
            customFields: this.formBuilder.group(this.customFields.reduce((hash, field) => (Object.assign(Object.assign({}, hash), { [field.name]: '' })), {})),
        });
    }
    ngOnInit() {
        this.init();
        this.dataService.collection.getCollectionFilters().single$.subscribe(res => {
            this.allFilters = res.collectionFilters;
        });
    }
    ngOnDestroy() {
        this.destroy();
    }
    getFilterDefinition(filter) {
        return this.allFilters.find(f => f.code === filter.code);
    }
    assetsChanged() {
        return !!Object.values(this.assetChanges).length;
    }
    /**
     * If creating a new Collection, automatically generate the slug based on the collection name.
     */
    updateSlug(nameValue) {
        combineLatest(this.entity$, this.languageCode$)
            .pipe(take(1))
            .subscribe(([entity, languageCode]) => {
            const slugControl = this.detailForm.get(['slug']);
            const currentTranslation = findTranslation(entity, languageCode);
            const currentSlugIsEmpty = !currentTranslation || !currentTranslation.slug;
            if (slugControl && slugControl.pristine && currentSlugIsEmpty) {
                slugControl.setValue(normalizeString(`${nameValue}`, '-'));
            }
        });
    }
    addFilter(collectionFilter) {
        const filtersArray = this.detailForm.get('filters');
        const index = filtersArray.value.findIndex(o => o.code === collectionFilter.code);
        if (index === -1) {
            const argsHash = collectionFilter.args.reduce((output, arg) => (Object.assign(Object.assign({}, output), { [arg.name]: getConfigArgValue(arg.value) })), {});
            filtersArray.push(this.formBuilder.control({
                code: collectionFilter.code,
                args: argsHash,
            }));
            this.filters.push({
                code: collectionFilter.code,
                args: collectionFilter.args.map(a => ({ name: a.name, value: getConfigArgValue(a.value) })),
            });
        }
    }
    removeFilter(collectionFilter) {
        const filtersArray = this.detailForm.get('filters');
        const index = filtersArray.value.findIndex(o => o.code === collectionFilter.code);
        if (index !== -1) {
            filtersArray.removeAt(index);
            this.filters.splice(index, 1);
        }
    }
    create() {
        if (!this.detailForm.dirty) {
            return;
        }
        combineLatest(this.entity$, this.languageCode$)
            .pipe(take(1), mergeMap(([category, languageCode]) => {
            const input = this.getUpdatedCollection(category, this.detailForm, languageCode);
            const parentId = this.route.snapshot.paramMap.get('parentId');
            if (parentId) {
                input.parentId = parentId;
            }
            return this.dataService.collection.createCollection(input);
        }))
            .subscribe(data => {
            this.notificationService.success(marker('common.notify-create-success'), {
                entity: 'Collection',
            });
            this.assetChanges = {};
            this.detailForm.markAsPristine();
            this.changeDetector.markForCheck();
            this.router.navigate(['../', data.createCollection.id], { relativeTo: this.route });
        }, err => {
            this.notificationService.error(marker('common.notify-create-error'), {
                entity: 'Collection',
            });
        });
    }
    save() {
        combineLatest(this.entity$, this.languageCode$)
            .pipe(take(1), mergeMap(([category, languageCode]) => {
            const input = this.getUpdatedCollection(category, this.detailForm, languageCode);
            return this.dataService.collection.updateCollection(input);
        }))
            .subscribe(() => {
            this.assetChanges = {};
            this.detailForm.markAsPristine();
            this.changeDetector.markForCheck();
            this.notificationService.success(marker('common.notify-update-success'), {
                entity: 'Collection',
            });
            this.contentsComponent.refresh();
        }, err => {
            this.notificationService.error(marker('common.notify-update-error'), {
                entity: 'Collection',
            });
        });
    }
    canDeactivate() {
        return super.canDeactivate() && !this.assetChanges.assets && !this.assetChanges.featuredAsset;
    }
    /**
     * Sets the values of the form on changes to the category or current language.
     */
    setFormValues(entity, languageCode) {
        const currentTranslation = findTranslation(entity, languageCode);
        this.detailForm.patchValue({
            name: currentTranslation ? currentTranslation.name : '',
            slug: currentTranslation ? currentTranslation.slug : '',
            description: currentTranslation ? currentTranslation.description : '',
            visible: !entity.isPrivate,
        });
        entity.filters.forEach(f => this.addFilter(f));
        if (this.customFields.length) {
            this.setCustomFieldFormValues(this.customFields, this.detailForm.get(['customFields']), entity, currentTranslation);
        }
    }
    /**
     * Given a category and the value of the form, this method creates an updated copy of the category which
     * can then be persisted to the API.
     */
    getUpdatedCollection(category, form, languageCode) {
        var _a, _b;
        const updatedCategory = createUpdatedTranslatable({
            translatable: category,
            updatedFields: form.value,
            customFieldConfig: this.customFields,
            languageCode,
            defaultTranslation: {
                languageCode,
                name: category.name || '',
                slug: category.slug || '',
                description: category.description || '',
            },
        });
        return Object.assign(Object.assign({}, updatedCategory), { assetIds: (_a = this.assetChanges.assets) === null || _a === void 0 ? void 0 : _a.map(a => a.id), featuredAssetId: (_b = this.assetChanges.featuredAsset) === null || _b === void 0 ? void 0 : _b.id, isPrivate: !form.value.visible, filters: this.mapOperationsToInputs(this.filters, this.detailForm.value.filters) });
    }
    /**
     * Maps an array of conditions or actions to the input format expected by the GraphQL API.
     */
    mapOperationsToInputs(operations, formValueOperations) {
        return operations.map((o, i) => {
            return {
                code: o.code,
                arguments: Object.values(formValueOperations[i].args).map((value, j) => ({
                    name: o.args[j].name,
                    value: encodeConfigArgValue(value),
                })),
            };
        });
    }
}
CollectionDetailComponent.ɵfac = function CollectionDetailComponent_Factory(t) { return new (t || CollectionDetailComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService)); };
CollectionDetailComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CollectionDetailComponent, selectors: [["vdr-collection-detail"]], viewQuery: function CollectionDetailComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c3, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.contentsComponent = _t.first);
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 16, vars: 19, consts: [[3, "entity"], [3, "disabled", "availableLanguageCodes", "currentLanguageCode", "languageCodeChange"], ["locationId", "collection-detail"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "ngIf", "ngIfElse"], ["updateButton", ""], ["class", "form", 3, "formGroup", 4, "ngIf"], [1, "btn", "btn-primary", 3, "disabled", "click"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "vdrIfPermissions"], [1, "form", 3, "formGroup"], [1, "clr-row"], [1, "clr-col"], ["for", "visibility", 3, "label"], ["type", "checkbox", "clrToggle", "", "formControlName", "visible", "id", "visibility", 3, "vdrDisabled"], [1, "visible-toggle"], [4, "ngIf", "ngIfElse"], ["private", ""], ["for", "name", 3, "label"], ["id", "name", "type", "text", "formControlName", "name", 3, "readonly", "input"], ["for", "slug", 3, "label", "errors"], ["id", "slug", "type", "text", "formControlName", "slug", 3, "readonly"], ["formControlName", "description", 3, "readonly", "label"], ["formGroupName", "customFields", 4, "ngIf"], ["locationId", "collection-detail", 3, "entity$", "detailForm"], [1, "clr-col-md-auto"], [3, "assets", "featuredAsset", "updatePermissions", "change"], ["formArrayName", "filters", 1, "clr-row"], [4, "ngFor", "ngForOf"], [4, "vdrIfPermissions"], [3, "collectionId"], ["collectionContents", ""], ["formGroupName", "customFields"], ["entityName", "Collection", 3, "customFields", "customFieldsFormGroup", "readonly"], [3, "operation", "operationDefinition", "formControlName", "readonly", "remove"], ["vdrDropdownTrigger", "", 1, "btn", "btn-outline"], ["shape", "plus"], ["vdrPosition", "bottom-left"], ["type", "button", "vdrDropdownItem", "", 3, "click", 4, "ngFor", "ngForOf"], ["type", "button", "vdrDropdownItem", "", 3, "click"], [1, "contents-title"]], template: function CollectionDetailComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left");
        ɵngcc0.ɵɵelement(2, "vdr-entity-info", 0);
        ɵngcc0.ɵɵpipe(3, "async");
        ɵngcc0.ɵɵelementStart(4, "vdr-language-selector", 1);
        ɵngcc0.ɵɵlistener("languageCodeChange", function CollectionDetailComponent_Template_vdr_language_selector_languageCodeChange_4_listener($event) { return ctx.setLanguage($event); });
        ɵngcc0.ɵɵpipe(5, "async");
        ɵngcc0.ɵɵpipe(6, "async");
        ɵngcc0.ɵɵpipe(7, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(8, "vdr-ab-right");
        ɵngcc0.ɵɵelement(9, "vdr-action-bar-items", 2);
        ɵngcc0.ɵɵtemplate(10, CollectionDetailComponent_button_10_Template, 3, 4, "button", 3);
        ɵngcc0.ɵɵpipe(11, "async");
        ɵngcc0.ɵɵtemplate(12, CollectionDetailComponent_ng_template_12_Template, 1, 1, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(14, CollectionDetailComponent_form_14_Template, 39, 44, "form", 5);
        ɵngcc0.ɵɵpipe(15, "async");
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(13);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("entity", ɵngcc0.ɵɵpipeBind1(3, 7, ctx.entity$));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("disabled", ɵngcc0.ɵɵpipeBind1(5, 9, ctx.isNew$))("availableLanguageCodes", ɵngcc0.ɵɵpipeBind1(6, 11, ctx.availableLanguages$))("currentLanguageCode", ɵngcc0.ɵɵpipeBind1(7, 13, ctx.languageCode$));
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(11, 15, ctx.isNew$))("ngIfElse", _r1);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(15, 17, ctx.entity$));
    } }, directives: function () { return [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.EntityInfoComponent, ɵngcc2.LanguageSelectorComponent, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc4.NgIf, ɵngcc2.IfPermissionsDirective, ɵngcc3.ɵNgNoValidate, ɵngcc3.NgControlStatusGroup, ɵngcc3.FormGroupDirective, ɵngcc2.FormFieldComponent, ɵngcc7.ClrCheckboxWrapper, ɵngcc2.FormFieldControlDirective, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc3.NgControlStatus, ɵngcc3.FormControlName, ɵngcc2.DisabledDirective, ɵngcc7.ClrLabel, ɵngcc3.DefaultValueAccessor, ɵngcc2.RichTextEditorComponent, ɵngcc2.CustomDetailComponentHostComponent, AssetsComponent, ɵngcc3.FormArrayName, ɵngcc4.NgForOf, CollectionContentsComponent, ɵngcc3.FormGroupName, ɵngcc2.TabbedCustomFieldsComponent, ɵngcc2.ConfigurableInputComponent, ɵngcc2.DropdownComponent, ɵngcc2.DropdownTriggerDirective, ɵngcc7.ClrIconCustomTag, ɵngcc2.DropdownMenuComponent, ɵngcc2.DropdownItemDirective]; }, pipes: function () { return [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe, ɵngcc2.HasPermissionPipe]; }, styles: [_c12], changeDetection: 0 });
CollectionDetailComponent.ctorParameters = () => [
    { type: Router },
    { type: ActivatedRoute },
    { type: ServerConfigService },
    { type: ChangeDetectorRef },
    { type: DataService },
    { type: FormBuilder },
    { type: NotificationService },
    { type: ModalService }
];
CollectionDetailComponent.propDecorators = {
    contentsComponent: [{ type: ViewChild, args: ['collectionContents',] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CollectionDetailComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-collection-detail',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n        <vdr-language-selector\r\n            [disabled]=\"isNew$ | async\"\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"languageCode$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"collection-detail\"></vdr-action-bar-items>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            *ngIf=\"isNew$ | async; else updateButton\"\r\n            (click)=\"create()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n        >\r\n            {{ 'common.create' | translate }}\r\n        </button>\r\n        <ng-template #updateButton>\r\n            <button\r\n                *vdrIfPermissions=\"updatePermission\"\r\n                class=\"btn btn-primary\"\r\n                (click)=\"save()\"\r\n                [disabled]=\"(detailForm.invalid || detailForm.pristine) && !assetsChanged()\"\r\n            >\r\n                {{ 'common.update' | translate }}\r\n            </button>\r\n        </ng-template>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<form class=\"form\" [formGroup]=\"detailForm\" *ngIf=\"entity$ | async as category\">\r\n    <div class=\"clr-row\">\r\n        <div class=\"clr-col\">\r\n            <vdr-form-field [label]=\"'catalog.visibility' | translate\" for=\"visibility\">\r\n                <clr-toggle-wrapper>\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        clrToggle\r\n                        formControlName=\"visible\"\r\n                        id=\"visibility\"\r\n                        [vdrDisabled]=\"!(updatePermission | hasPermission)\"\r\n                    />\r\n                    <label class=\"visible-toggle\">\r\n                        <ng-container *ngIf=\"detailForm.value.visible; else private\">{{ 'catalog.public' | translate }}</ng-container>\r\n                        <ng-template #private>{{ 'catalog.private' | translate }}</ng-template>\r\n                    </label>\r\n                </clr-toggle-wrapper>\r\n            </vdr-form-field>\r\n            <vdr-form-field [label]=\"'common.name' | translate\" for=\"name\">\r\n                <input\r\n                    id=\"name\"\r\n                    type=\"text\"\r\n                    formControlName=\"name\"\r\n                    [readonly]=\"!(updatePermission | hasPermission)\"\r\n                    (input)=\"updateSlug($event.target.value)\"\r\n                />\r\n            </vdr-form-field>\r\n            <vdr-form-field\r\n                [label]=\"'catalog.slug' | translate\"\r\n                for=\"slug\"\r\n                [errors]=\"{ pattern: ('catalog.slug-pattern-error' | translate) }\"\r\n            >\r\n                <input\r\n                    id=\"slug\"\r\n                    type=\"text\"\r\n                    formControlName=\"slug\"\r\n                    [readonly]=\"!(updatePermission | hasPermission)\"\r\n                />\r\n            </vdr-form-field>\r\n            <vdr-rich-text-editor\r\n                formControlName=\"description\"\r\n                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                [label]=\"'common.description' | translate\"\r\n            ></vdr-rich-text-editor>\r\n\r\n            <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n                <label>{{ 'common.custom-fields' | translate }}</label>\r\n                <vdr-tabbed-custom-fields\r\n                    entityName=\"Collection\"\r\n                    [customFields]=\"customFields\"\r\n                    [customFieldsFormGroup]=\"detailForm.get(['customFields'])\"\r\n                    [readonly]=\"!(updatePermission | hasPermission)\"\r\n                ></vdr-tabbed-custom-fields>\r\n            </section>\r\n            <vdr-custom-detail-component-host\r\n                locationId=\"collection-detail\"\r\n                [entity$]=\"entity$\"\r\n                [detailForm]=\"detailForm\"\r\n            ></vdr-custom-detail-component-host>\r\n        </div>\r\n        <div class=\"clr-col-md-auto\">\r\n            <vdr-assets\r\n                [assets]=\"category.assets\"\r\n                [featuredAsset]=\"category.featuredAsset\"\r\n                [updatePermissions]=\"updatePermission\"\r\n                (change)=\"assetChanges = $event\"\r\n            ></vdr-assets>\r\n        </div>\r\n    </div>\r\n    <div class=\"clr-row\" formArrayName=\"filters\">\r\n        <div class=\"clr-col\">\r\n            <label>{{ 'catalog.filters' | translate }}</label>\r\n            <ng-container *ngFor=\"let filter of filters; index as i\">\r\n                <vdr-configurable-input\r\n                    (remove)=\"removeFilter($event)\"\r\n                    [operation]=\"filter\"\r\n                    [operationDefinition]=\"getFilterDefinition(filter)\"\r\n                    [formControlName]=\"i\"\r\n                    [readonly]=\"!(updatePermission | hasPermission)\"\r\n                ></vdr-configurable-input>\r\n            </ng-container>\r\n\r\n            <div *vdrIfPermissions=\"updatePermission\">\r\n                <vdr-dropdown>\r\n                    <button class=\"btn btn-outline\" vdrDropdownTrigger>\r\n                        <clr-icon shape=\"plus\"></clr-icon>\r\n                        {{ 'marketing.add-condition' | translate }}\r\n                    </button>\r\n                    <vdr-dropdown-menu vdrPosition=\"bottom-left\">\r\n                        <button\r\n                            *ngFor=\"let filter of allFilters\"\r\n                            type=\"button\"\r\n                            vdrDropdownItem\r\n                            (click)=\"addFilter(filter)\"\r\n                        >\r\n                            {{ filter.description }}\r\n                        </button>\r\n                    </vdr-dropdown-menu>\r\n                </vdr-dropdown>\r\n            </div>\r\n        </div>\r\n        <div class=\"clr-col\">\r\n            <vdr-collection-contents [collectionId]=\"id\" #collectionContents>\r\n                <ng-template let-count>\r\n                    <div class=\"contents-title\">\r\n                        {{ 'catalog.collection-contents' | translate }} ({{\r\n                            'common.results-count' | translate: { count: count }\r\n                        }})\r\n                    </div>\r\n                </ng-template>\r\n            </vdr-collection-contents>\r\n        </div>\r\n    </div>\r\n</form>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".visible-toggle{margin-top:-3px!important}\n"]
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }, { type: ɵngcc2.ServerConfigService }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.DataService }, { type: ɵngcc3.FormBuilder }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.ModalService }]; }, { contentsComponent: [{
            type: ViewChild,
            args: ['collectionContents']
        }] }); })();

class CollectionListComponent {
    constructor(dataService, notificationService, modalService, router, route, serverConfigService) {
        this.dataService = dataService;
        this.notificationService = notificationService;
        this.modalService = modalService;
        this.router = router;
        this.route = route;
        this.serverConfigService = serverConfigService;
        this.filterTermControl = new FormControl('');
        this.expandAll = false;
        this.destroy$ = new Subject();
    }
    ngOnInit() {
        this.queryResult = this.dataService.collection.getCollections(1000, 0).refetchOnChannelChange();
        this.items$ = this.queryResult.mapStream(data => data.collections.items).pipe(shareReplay(1));
        this.activeCollectionId$ = this.route.paramMap.pipe(map(pm => pm.get('contents')), distinctUntilChanged());
        this.activeCollectionTitle$ = combineLatest(this.activeCollectionId$, this.items$).pipe(map(([id, collections]) => {
            if (id) {
                const match = collections.find(c => c.id === id);
                return match ? match.name : '';
            }
            return '';
        }));
        this.availableLanguages$ = this.serverConfigService.getAvailableLanguages();
        this.contentLanguage$ = this.dataService.client
            .uiState()
            .mapStream(({ uiState }) => uiState.contentLanguage)
            .pipe(tap(() => this.refresh()));
        this.filterTermControl.valueChanges
            .pipe(debounceTime(250), takeUntil(this.destroy$))
            .subscribe(() => this.refresh());
    }
    ngOnDestroy() {
        this.queryResult.completed$.next();
        this.destroy$.next(undefined);
        this.destroy$.complete();
    }
    onRearrange(event) {
        this.dataService.collection.moveCollection([event]).subscribe({
            next: () => {
                this.notificationService.success(marker('common.notify-saved-changes'));
                this.refresh();
            },
            error: err => {
                this.notificationService.error(marker('common.notify-save-changes-error'));
            },
        });
    }
    deleteCollection(id) {
        this.items$
            .pipe(take(1), map(items => -1 < items.findIndex(i => i.parent && i.parent.id === id)), switchMap(hasChildren => {
            return this.modalService.dialog({
                title: marker('catalog.confirm-delete-collection'),
                body: hasChildren
                    ? marker('catalog.confirm-delete-collection-and-children-body')
                    : undefined,
                buttons: [
                    { type: 'secondary', label: marker('common.cancel') },
                    { type: 'danger', label: marker('common.delete'), returnValue: true },
                ],
            });
        }), switchMap(response => (response ? this.dataService.collection.deleteCollection(id) : EMPTY)))
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-delete-success'), {
                entity: 'Collection',
            });
            this.refresh();
        }, err => {
            this.notificationService.error(marker('common.notify-delete-error'), {
                entity: 'Collection',
            });
        });
    }
    closeContents() {
        const params = Object.assign({}, this.route.snapshot.params);
        delete params.contents;
        this.router.navigate(['./', params], { relativeTo: this.route, queryParamsHandling: 'preserve' });
    }
    setLanguage(code) {
        this.dataService.client.setContentLanguage(code).subscribe();
    }
    refresh() {
        this.queryResult.ref.refetch({
            options: Object.assign({ skip: 0, take: 1000 }, (this.filterTermControl.value
                ? {
                    filter: {
                        name: {
                            contains: this.filterTermControl.value,
                        },
                    },
                }
                : {})),
        });
    }
}
CollectionListComponent.ɵfac = function CollectionListComponent_Factory(t) { return new (t || CollectionListComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService)); };
CollectionListComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CollectionListComponent, selectors: [["vdr-collection-list"]], decls: 26, vars: 33, consts: [[1, "flex", "center", "wrap"], [1, "mt2", 3, "availableLanguageCodes", "currentLanguageCode", "languageCodeChange"], [1, "expand-all-toggle", "ml3", 3, "ngClass"], ["type", "checkbox", "clrCheckbox", "", 3, "ngModel", "ngModelChange"], ["type", "text", "name", "searchTerm", 1, "clr-input", "search-input", "ml4", 3, "formControl", "placeholder"], ["locationId", "collection-list"], ["class", "btn btn-primary", 3, "routerLink", 4, "vdrIfPermissions"], [1, "collection-wrapper"], [3, "collections", "activeCollectionId", "expandAll", "rearrange", "deleteCollection"], [1, "collection-contents"], [3, "collectionId"], [1, "btn", "btn-primary", 3, "routerLink"], ["shape", "plus"], [1, "collection-title"], ["type", "button", 1, "close-button", 3, "click"], ["shape", "close"]], template: function CollectionListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left");
        ɵngcc0.ɵɵelementStart(2, "div", 0);
        ɵngcc0.ɵɵelementStart(3, "vdr-language-selector", 1);
        ɵngcc0.ɵɵlistener("languageCodeChange", function CollectionListComponent_Template_vdr_language_selector_languageCodeChange_3_listener($event) { return ctx.setLanguage($event); });
        ɵngcc0.ɵɵpipe(4, "async");
        ɵngcc0.ɵɵpipe(5, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "clr-checkbox-wrapper", 2);
        ɵngcc0.ɵɵpipe(7, "async");
        ɵngcc0.ɵɵelementStart(8, "input", 3);
        ɵngcc0.ɵɵlistener("ngModelChange", function CollectionListComponent_Template_input_ngModelChange_8_listener($event) { return ctx.expandAll = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(9, "label");
        ɵngcc0.ɵɵtext(10);
        ɵngcc0.ɵɵpipe(11, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(12, "input", 4);
        ɵngcc0.ɵɵpipe(13, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "vdr-ab-right");
        ɵngcc0.ɵɵelement(15, "vdr-action-bar-items", 5);
        ɵngcc0.ɵɵtemplate(16, CollectionListComponent_a_16_Template, 4, 5, "a", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(17, "div", 7);
        ɵngcc0.ɵɵelementStart(18, "vdr-collection-tree", 8);
        ɵngcc0.ɵɵlistener("rearrange", function CollectionListComponent_Template_vdr_collection_tree_rearrange_18_listener($event) { return ctx.onRearrange($event); })("deleteCollection", function CollectionListComponent_Template_vdr_collection_tree_deleteCollection_18_listener($event) { return ctx.deleteCollection($event); });
        ɵngcc0.ɵɵpipe(19, "async");
        ɵngcc0.ɵɵpipe(20, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(21, "div", 9);
        ɵngcc0.ɵɵpipe(22, "async");
        ɵngcc0.ɵɵelementStart(23, "vdr-collection-contents", 10);
        ɵngcc0.ɵɵpipe(24, "async");
        ɵngcc0.ɵɵtemplate(25, CollectionListComponent_ng_template_25_Template, 6, 9, "ng-template");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        let tmp_2_0;
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("availableLanguageCodes", ɵngcc0.ɵɵpipeBind1(4, 14, ctx.availableLanguages$))("currentLanguageCode", ɵngcc0.ɵɵpipeBind1(5, 16, ctx.contentLanguage$));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngClass", ((tmp_2_0 = ɵngcc0.ɵɵpipeBind1(7, 18, ctx.availableLanguages$)) == null ? null : tmp_2_0.length) === 1 ? "mt3" : "mt1");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngModel", ctx.expandAll);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(11, 20, "catalog.expand-all-collections"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("formControl", ctx.filterTermControl)("placeholder", ɵngcc0.ɵɵpipeBind1(13, 22, "catalog.filter-by-name"));
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(32, _c8));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("collections", ɵngcc0.ɵɵpipeBind1(19, 24, ctx.items$))("activeCollectionId", ɵngcc0.ɵɵpipeBind1(20, 26, ctx.activeCollectionId$))("expandAll", ctx.expandAll);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵclassProp("expanded", ɵngcc0.ɵɵpipeBind1(22, 28, ctx.activeCollectionId$));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("collectionId", ɵngcc0.ɵɵpipeBind1(24, 30, ctx.activeCollectionId$));
    } }, directives: function () { return [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.LanguageSelectorComponent, ɵngcc7.ClrCheckboxWrapper, ɵngcc4.NgClass, ɵngcc2.FormFieldControlDirective, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, ɵngcc7.ClrLabel, ɵngcc3.DefaultValueAccessor, ɵngcc3.FormControlDirective, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc2.IfPermissionsDirective, CollectionTreeComponent, CollectionContentsComponent, ɵngcc1.RouterLinkWithHref, ɵngcc7.ClrIconCustomTag]; }, pipes: function () { return [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe]; }, styles: ["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.expand-all-toggle[_ngcontent-%COMP%]{display:block}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:none;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"], changeDetection: 0 });
CollectionListComponent.ctorParameters = () => [
    { type: DataService },
    { type: NotificationService },
    { type: ModalService },
    { type: Router },
    { type: ActivatedRoute },
    { type: ServerConfigService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CollectionListComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-collection-list',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <div class=\"flex center wrap\">\r\n            <vdr-language-selector\r\n                class=\"mt2\"\r\n                [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n                [currentLanguageCode]=\"contentLanguage$ | async\"\r\n                (languageCodeChange)=\"setLanguage($event)\"\r\n            ></vdr-language-selector>\r\n            <clr-checkbox-wrapper\r\n                class=\"expand-all-toggle ml3\"\r\n                [ngClass]=\"(availableLanguages$ | async)?.length === 1 ? 'mt3' : 'mt1'\"\r\n            >\r\n                <input type=\"checkbox\" clrCheckbox [(ngModel)]=\"expandAll\" />\r\n                <label>{{ 'catalog.expand-all-collections' | translate }}</label>\r\n            </clr-checkbox-wrapper>\r\n            <input\r\n                type='text'\r\n                name='searchTerm'\r\n                [formControl]='filterTermControl'\r\n                [placeholder]=\"'catalog.filter-by-name' | translate\"\r\n                class='clr-input search-input ml4'\r\n            />\r\n        </div>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"collection-list\"></vdr-action-bar-items>\r\n        <a\r\n            class=\"btn btn-primary\"\r\n            *vdrIfPermissions=\"['CreateCatalog', 'CreateCollection']\"\r\n            [routerLink]=\"['./create']\"\r\n        >\r\n            <clr-icon shape=\"plus\"></clr-icon>\r\n            {{ 'catalog.create-new-collection' | translate }}\r\n        </a>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n<div class=\"collection-wrapper\">\r\n    <vdr-collection-tree\r\n        [collections]=\"items$ | async\"\r\n        [activeCollectionId]=\"activeCollectionId$ | async\"\r\n        [expandAll]=\"expandAll\"\r\n        (rearrange)=\"onRearrange($event)\"\r\n        (deleteCollection)=\"deleteCollection($event)\"\r\n    ></vdr-collection-tree>\r\n\r\n    <div class=\"collection-contents\" [class.expanded]=\"activeCollectionId$ | async\">\r\n        <vdr-collection-contents [collectionId]=\"activeCollectionId$ | async\">\r\n            <ng-template let-count>\r\n                <div class=\"collection-title\">\r\n                    {{ activeCollectionTitle$ | async }} ({{\r\n                        'common.results-count' | translate: { count: count }\r\n                    }})\r\n                </div>\r\n                <button type=\"button\" class=\"close-button\" (click)=\"closeContents()\">\r\n                    <clr-icon shape=\"close\"></clr-icon>\r\n                </button>\r\n            </ng-template>\r\n        </vdr-collection-contents>\r\n    </div>\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host{height:100%;display:flex;flex-direction:column}.expand-all-toggle{display:block}.collection-wrapper{display:flex;height:calc(100% - 50px)}.collection-wrapper vdr-collection-tree{flex:1;height:100%;overflow:auto}.collection-wrapper .collection-contents{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper .collection-contents.expanded{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper .collection-contents .close-button{margin:0;background:none;border:none;cursor:pointer}.paging-controls{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.DataService }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.ModalService }, { type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }, { type: ɵngcc2.ServerConfigService }]; }, null); })();

class FacetDetailComponent extends BaseDetailComponent {
    constructor(router, route, serverConfigService, changeDetector, dataService, formBuilder, notificationService, modalService) {
        super(route, router, serverConfigService, dataService);
        this.changeDetector = changeDetector;
        this.dataService = dataService;
        this.formBuilder = formBuilder;
        this.notificationService = notificationService;
        this.modalService = modalService;
        this.updatePermission = [Permission.UpdateCatalog, Permission.UpdateFacet];
        this.customFields = this.getCustomFieldConfig('Facet');
        this.customValueFields = this.getCustomFieldConfig('FacetValue');
        this.detailForm = this.formBuilder.group({
            facet: this.formBuilder.group({
                code: ['', Validators.required],
                name: '',
                visible: true,
                customFields: this.formBuilder.group(this.customFields.reduce((hash, field) => (Object.assign(Object.assign({}, hash), { [field.name]: '' })), {})),
            }),
            values: this.formBuilder.array([]),
        });
    }
    ngOnInit() {
        this.init();
    }
    ngOnDestroy() {
        this.destroy();
    }
    updateCode(currentCode, nameValue) {
        if (!currentCode) {
            const codeControl = this.detailForm.get(['facet', 'code']);
            if (codeControl && codeControl.pristine) {
                codeControl.setValue(normalizeString(nameValue, '-'));
            }
        }
    }
    updateValueCode(currentCode, nameValue, index) {
        if (!currentCode) {
            const codeControl = this.detailForm.get(['values', index, 'code']);
            if (codeControl && codeControl.pristine) {
                codeControl.setValue(normalizeString(nameValue, '-'));
            }
        }
    }
    customValueFieldIsSet(index, name) {
        return !!this.detailForm.get(['values', index, 'customFields', name]);
    }
    getValuesFormArray() {
        return this.detailForm.get('values');
    }
    addFacetValue() {
        const valuesFormArray = this.detailForm.get('values');
        if (valuesFormArray) {
            const valueGroup = this.formBuilder.group({
                id: '',
                name: ['', Validators.required],
                code: '',
            });
            const newValue = { name: '', code: '' };
            if (this.customValueFields.length) {
                const customValueFieldsGroup = new FormGroup({});
                newValue.customFields = {};
                for (const fieldDef of this.customValueFields) {
                    const key = fieldDef.name;
                    customValueFieldsGroup.addControl(key, new FormControl());
                }
                valueGroup.addControl('customFields', customValueFieldsGroup);
            }
            valuesFormArray.insert(valuesFormArray.length, valueGroup);
            this.values.push(newValue);
        }
    }
    create() {
        const facetForm = this.detailForm.get('facet');
        if (!facetForm || !facetForm.dirty) {
            return;
        }
        combineLatest(this.entity$, this.languageCode$)
            .pipe(take(1), mergeMap(([facet, languageCode]) => {
            const newFacet = this.getUpdatedFacet(facet, facetForm, languageCode);
            return this.dataService.facet.createFacet(newFacet);
        }), switchMap(data => this.dataService.facet.getAllFacets().single$.pipe(mapTo(data))))
            .subscribe(data => {
            this.notificationService.success(marker('common.notify-create-success'), { entity: 'Facet' });
            this.detailForm.markAsPristine();
            this.changeDetector.markForCheck();
            this.router.navigate(['../', data.createFacet.id], { relativeTo: this.route });
        }, err => {
            this.notificationService.error(marker('common.notify-create-error'), {
                entity: 'Facet',
            });
        });
    }
    save() {
        combineLatest(this.entity$, this.languageCode$)
            .pipe(take(1), mergeMap(([facet, languageCode]) => {
            const facetGroup = this.detailForm.get('facet');
            const updateOperations = [];
            if (facetGroup && facetGroup.dirty) {
                const newFacet = this.getUpdatedFacet(facet, facetGroup, languageCode);
                if (newFacet) {
                    updateOperations.push(this.dataService.facet.updateFacet(newFacet));
                }
            }
            const valuesArray = this.detailForm.get('values');
            if (valuesArray && valuesArray.dirty) {
                const createdValues = this.getCreatedFacetValues(facet, valuesArray, languageCode);
                if (createdValues.length) {
                    updateOperations.push(this.dataService.facet
                        .createFacetValues(createdValues)
                        .pipe(switchMap(() => this.dataService.facet.getFacet(this.id).single$)));
                }
                const updatedValues = this.getUpdatedFacetValues(facet, valuesArray, languageCode);
                if (updatedValues.length) {
                    updateOperations.push(this.dataService.facet.updateFacetValues(updatedValues));
                }
            }
            return forkJoin(updateOperations);
        }), switchMap(() => this.dataService.facet.getAllFacets().single$))
            .subscribe(() => {
            this.detailForm.markAsPristine();
            this.changeDetector.markForCheck();
            this.notificationService.success(marker('common.notify-update-success'), { entity: 'Facet' });
        }, err => {
            this.notificationService.error(marker('common.notify-update-error'), {
                entity: 'Facet',
            });
        });
    }
    deleteFacetValue(facetValueId, index) {
        if (!facetValueId) {
            // deleting a newly-added (not persisted) FacetValue
            const valuesFormArray = this.detailForm.get('values');
            if (valuesFormArray) {
                valuesFormArray.removeAt(index);
            }
            this.values.splice(index, 1);
            return;
        }
        this.showModalAndDelete(facetValueId)
            .pipe(switchMap(response => {
            if (response.result === DeletionResult.DELETED) {
                return [true];
            }
            else {
                return this.showModalAndDelete(facetValueId, response.message || '').pipe(map(r => r.result === DeletionResult.DELETED));
            }
        }), switchMap(deleted => (deleted ? this.dataService.facet.getFacet(this.id).single$ : [])))
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-delete-success'), {
                entity: 'FacetValue',
            });
        }, err => {
            this.notificationService.error(marker('common.notify-delete-error'), {
                entity: 'FacetValue',
            });
        });
    }
    showModalAndDelete(facetValueId, message) {
        return this.modalService
            .dialog({
            title: marker('catalog.confirm-delete-facet-value'),
            body: message,
            buttons: [
                { type: 'secondary', label: marker('common.cancel') },
                { type: 'danger', label: marker('common.delete'), returnValue: true },
            ],
        })
            .pipe(switchMap(result => result ? this.dataService.facet.deleteFacetValues([facetValueId], !!message) : EMPTY), map(result => result.deleteFacetValues[0]));
    }
    /**
     * Sets the values of the form on changes to the facet or current language.
     */
    setFormValues(facet, languageCode) {
        var _a;
        const currentTranslation = findTranslation(facet, languageCode);
        this.detailForm.patchValue({
            facet: {
                code: facet.code,
                visible: !facet.isPrivate,
                name: (_a = currentTranslation === null || currentTranslation === void 0 ? void 0 : currentTranslation.name) !== null && _a !== void 0 ? _a : '',
            },
        });
        if (this.customFields.length) {
            const customFieldsGroup = this.detailForm.get(['facet', 'customFields']);
            this.setCustomFieldFormValues(this.customFields, this.detailForm.get(['facet', 'customFields']), facet, currentTranslation);
        }
        const currentValuesFormArray = this.detailForm.get('values');
        this.values = [...facet.values];
        facet.values.forEach((value, i) => {
            var _a, _b, _c;
            const valueTranslation = findTranslation(value, languageCode);
            const group = {
                id: value.id,
                code: value.code,
                name: valueTranslation ? valueTranslation.name : '',
            };
            const valueControl = currentValuesFormArray.at(i);
            if (valueControl) {
                (_a = valueControl.get('id')) === null || _a === void 0 ? void 0 : _a.setValue(group.id);
                (_b = valueControl.get('code')) === null || _b === void 0 ? void 0 : _b.setValue(group.code);
                (_c = valueControl.get('name')) === null || _c === void 0 ? void 0 : _c.setValue(group.name);
            }
            else {
                currentValuesFormArray.insert(i, this.formBuilder.group(group));
            }
            if (this.customValueFields.length) {
                let customValueFieldsGroup = this.detailForm.get(['values', i, 'customFields']);
                if (!customValueFieldsGroup) {
                    customValueFieldsGroup = new FormGroup({});
                    this.detailForm.get(['values', i]).addControl('customFields', customValueFieldsGroup);
                }
                if (customValueFieldsGroup) {
                    for (const fieldDef of this.customValueFields) {
                        const key = fieldDef.name;
                        const fieldValue = fieldDef.type === 'localeString'
                            ? valueTranslation.customFields[key]
                            : value.customFields[key];
                        const control = customValueFieldsGroup.get(key);
                        if (control) {
                            control.setValue(fieldValue);
                        }
                        else {
                            customValueFieldsGroup.addControl(key, new FormControl(fieldValue));
                        }
                    }
                }
            }
        });
    }
    /**
     * Given a facet and the value of the detailForm, this method creates an updated copy of the facet which
     * can then be persisted to the API.
     */
    getUpdatedFacet(facet, facetFormGroup, languageCode) {
        const input = createUpdatedTranslatable({
            translatable: facet,
            updatedFields: facetFormGroup.value,
            customFieldConfig: this.customFields,
            languageCode,
            defaultTranslation: {
                languageCode,
                name: facet.name || '',
            },
        });
        input.isPrivate = !facetFormGroup.value.visible;
        return input;
    }
    /**
     * Given an array of facet values and the values from the detailForm, this method creates a new array
     * which can be persisted to the API via a createFacetValues mutation.
     */
    getCreatedFacetValues(facet, valuesFormArray, languageCode) {
        return valuesFormArray.controls
            .filter(c => !c.value.id)
            .map(c => c.value)
            .map(value => createUpdatedTranslatable({
            translatable: Object.assign(Object.assign({}, value), { translations: [] }),
            updatedFields: value,
            customFieldConfig: this.customValueFields,
            languageCode,
            defaultTranslation: {
                languageCode,
                name: '',
            },
        }))
            .map(input => (Object.assign({ facetId: facet.id }, input)));
    }
    /**
     * Given an array of facet values and the values from the detailForm, this method creates a new array
     * which can be persisted to the API via an updateFacetValues mutation.
     */
    getUpdatedFacetValues(facet, valuesFormArray, languageCode) {
        const dirtyValues = facet.values.filter((v, i) => {
            const formRow = valuesFormArray.get(i.toString());
            return formRow && formRow.dirty && formRow.value.id;
        });
        const dirtyValueValues = valuesFormArray.controls
            .filter(c => c.dirty && c.value.id)
            .map(c => c.value);
        if (dirtyValues.length !== dirtyValueValues.length) {
            throw new Error(marker(`error.facet-value-form-values-do-not-match`));
        }
        return dirtyValues
            .map((value, i) => {
            return createUpdatedTranslatable({
                translatable: value,
                updatedFields: dirtyValueValues[i],
                customFieldConfig: this.customValueFields,
                languageCode,
                defaultTranslation: {
                    languageCode,
                    name: '',
                },
            });
        })
            .filter(notNullOrUndefined);
    }
}
FacetDetailComponent.ɵfac = function FacetDetailComponent_Factory(t) { return new (t || FacetDetailComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService)); };
FacetDetailComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: FacetDetailComponent, selectors: [["vdr-facet-detail"]], features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 16, vars: 19, consts: [[3, "entity"], [3, "disabled", "availableLanguageCodes", "currentLanguageCode", "languageCodeChange"], ["locationId", "facet-detail"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "ngIf", "ngIfElse"], ["updateButton", ""], ["class", "form", 3, "formGroup", 4, "ngIf"], [1, "btn", "btn-primary", 3, "disabled", "click"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "vdrIfPermissions"], [1, "form", 3, "formGroup"], ["formGroupName", "facet", 1, "form-block"], ["for", "visibility", 3, "label"], ["type", "checkbox", "clrToggle", "", "formControlName", "visible", "id", "visibility", 3, "vdrDisabled"], [1, "visible-toggle"], [4, "ngIf", "ngIfElse"], ["private", ""], ["for", "name", 3, "label"], ["id", "name", "type", "text", "formControlName", "name", 3, "readonly", "input"], ["for", "code", 3, "label", "readOnlyToggle"], ["id", "code", "type", "text", "formControlName", "code", 3, "readonly"], ["formGroupName", "customFields", 4, "ngIf"], ["locationId", "facet-detail", 3, "entity$", "detailForm"], ["class", "form-block", 4, "ngIf"], ["formGroupName", "customFields"], ["entityName", "Facet", 3, "customFields", "customFieldsFormGroup", "readonly"], [1, "form-block"], ["class", "facet-values-list table", "formArrayName", "values", 4, "ngIf"], ["type", "button", "class", "btn btn-secondary", 3, "click", 4, "vdrIfPermissions"], ["formArrayName", "values", 1, "facet-values-list", "table"], [4, "ngIf"], ["class", "facet-value", 3, "formGroupName", 4, "ngFor", "ngForOf"], [1, "facet-value", 3, "formGroupName"], [1, "align-middle"], ["type", "text", "formControlName", "name", 3, "readonly", "input"], ["type", "text", "formControlName", "code", "readonly", ""], ["class", "", 4, "ngIf"], ["type", "button", "vdrDropdownTrigger", "", 1, "btn", "btn-link", "btn-sm"], ["shape", "caret down"], ["vdrPosition", "bottom-right"], ["type", "button", "vdrDropdownItem", "", 1, "delete-button", 3, "disabled", "click"], ["shape", "trash", 1, "is-danger"], [1, ""], ["entityName", "FacetValue", 3, "customFields", "compact", "customFieldsFormGroup", "readonly"], ["type", "button", 1, "btn", "btn-secondary", 3, "click"], ["shape", "add"]], template: function FacetDetailComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left");
        ɵngcc0.ɵɵelement(2, "vdr-entity-info", 0);
        ɵngcc0.ɵɵpipe(3, "async");
        ɵngcc0.ɵɵelementStart(4, "vdr-language-selector", 1);
        ɵngcc0.ɵɵlistener("languageCodeChange", function FacetDetailComponent_Template_vdr_language_selector_languageCodeChange_4_listener($event) { return ctx.setLanguage($event); });
        ɵngcc0.ɵɵpipe(5, "async");
        ɵngcc0.ɵɵpipe(6, "async");
        ɵngcc0.ɵɵpipe(7, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(8, "vdr-ab-right");
        ɵngcc0.ɵɵelement(9, "vdr-action-bar-items", 2);
        ɵngcc0.ɵɵtemplate(10, FacetDetailComponent_button_10_Template, 3, 4, "button", 3);
        ɵngcc0.ɵɵpipe(11, "async");
        ɵngcc0.ɵɵtemplate(12, FacetDetailComponent_ng_template_12_Template, 1, 1, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(14, FacetDetailComponent_form_14_Template, 24, 30, "form", 5);
        ɵngcc0.ɵɵpipe(15, "async");
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(13);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("entity", ɵngcc0.ɵɵpipeBind1(3, 7, ctx.entity$));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("disabled", ɵngcc0.ɵɵpipeBind1(5, 9, ctx.isNew$))("availableLanguageCodes", ɵngcc0.ɵɵpipeBind1(6, 11, ctx.availableLanguages$))("currentLanguageCode", ɵngcc0.ɵɵpipeBind1(7, 13, ctx.languageCode$));
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(11, 15, ctx.isNew$))("ngIfElse", _r1);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(15, 17, ctx.entity$));
    } }, directives: [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.EntityInfoComponent, ɵngcc2.LanguageSelectorComponent, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc4.NgIf, ɵngcc2.IfPermissionsDirective, ɵngcc3.ɵNgNoValidate, ɵngcc3.NgControlStatusGroup, ɵngcc3.FormGroupDirective, ɵngcc3.FormGroupName, ɵngcc2.FormFieldComponent, ɵngcc7.ClrCheckboxWrapper, ɵngcc2.FormFieldControlDirective, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc3.NgControlStatus, ɵngcc3.FormControlName, ɵngcc2.DisabledDirective, ɵngcc7.ClrLabel, ɵngcc3.DefaultValueAccessor, ɵngcc2.CustomDetailComponentHostComponent, ɵngcc2.TabbedCustomFieldsComponent, ɵngcc3.FormArrayName, ɵngcc4.NgForOf, ɵngcc2.DropdownComponent, ɵngcc2.DropdownTriggerDirective, ɵngcc7.ClrIconCustomTag, ɵngcc2.DropdownMenuComponent, ɵngcc2.DropdownItemDirective], pipes: [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe, ɵngcc2.HasPermissionPipe], styles: [_c12], changeDetection: 0 });
FacetDetailComponent.ctorParameters = () => [
    { type: Router },
    { type: ActivatedRoute },
    { type: ServerConfigService },
    { type: ChangeDetectorRef },
    { type: DataService },
    { type: FormBuilder },
    { type: NotificationService },
    { type: ModalService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(FacetDetailComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-facet-detail',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n        <vdr-language-selector\r\n            [disabled]=\"isNew$ | async\"\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"languageCode$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"facet-detail\"></vdr-action-bar-items>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            *ngIf=\"isNew$ | async; else updateButton\"\r\n            (click)=\"create()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n        >\r\n            {{ 'common.create' | translate }}\r\n        </button>\r\n        <ng-template #updateButton>\r\n            <button\r\n                *vdrIfPermissions=\"updatePermission\"\r\n                class=\"btn btn-primary\"\r\n                (click)=\"save()\"\r\n                [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n            >\r\n                {{ 'common.update' | translate }}\r\n            </button>\r\n        </ng-template>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<form class=\"form\" [formGroup]=\"detailForm\" *ngIf=\"entity$ | async as facet\">\r\n    <section class=\"form-block\" formGroupName=\"facet\">\r\n        <vdr-form-field [label]=\"'catalog.visibility' | translate\" for=\"visibility\">\r\n            <clr-toggle-wrapper>\r\n                <input\r\n                    type=\"checkbox\"\r\n                    clrToggle\r\n                    [vdrDisabled]=\"!(updatePermission | hasPermission)\"\r\n                    formControlName=\"visible\"\r\n                    id=\"visibility\"\r\n                />\r\n                <label class=\"visible-toggle\">\r\n                    <ng-container *ngIf=\"detailForm.value.facet.visible; else private\">{{\r\n                        'catalog.public' | translate\r\n                    }}</ng-container>\r\n                    <ng-template #private>{{ 'catalog.private' | translate }}</ng-template>\r\n                </label>\r\n            </clr-toggle-wrapper>\r\n        </vdr-form-field>\r\n        <vdr-form-field [label]=\"'common.name' | translate\" for=\"name\">\r\n            <input\r\n                id=\"name\"\r\n                type=\"text\"\r\n                formControlName=\"name\"\r\n                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                (input)=\"updateCode(facet.code, $event.target.value)\"\r\n            />\r\n        </vdr-form-field>\r\n        <vdr-form-field\r\n            [label]=\"'common.code' | translate\"\r\n            for=\"code\"\r\n            [readOnlyToggle]=\"updatePermission | hasPermission\"\r\n        >\r\n            <input\r\n                id=\"code\"\r\n                type=\"text\"\r\n                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                formControlName=\"code\"\r\n            />\r\n        </vdr-form-field>\r\n\r\n        <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n            <label>{{ 'common.custom-fields' | translate }}</label>\r\n            <vdr-tabbed-custom-fields\r\n                entityName=\"Facet\"\r\n                [customFields]=\"customFields\"\r\n                [customFieldsFormGroup]=\"detailForm.get(['facet', 'customFields'])\"\r\n                [readonly]=\"!(updatePermission | hasPermission)\"\r\n            ></vdr-tabbed-custom-fields>\r\n        </section>\r\n        <vdr-custom-detail-component-host\r\n            locationId=\"facet-detail\"\r\n            [entity$]=\"entity$\"\r\n            [detailForm]=\"detailForm\"\r\n        ></vdr-custom-detail-component-host>\r\n    </section>\r\n\r\n    <section class=\"form-block\" *ngIf=\"!(isNew$ | async)\">\r\n        <label>{{ 'catalog.facet-values' | translate }}</label>\r\n\r\n        <table class=\"facet-values-list table\" formArrayName=\"values\" *ngIf=\"0 < getValuesFormArray().length\">\r\n            <thead>\r\n                <tr>\r\n                    <th></th>\r\n                    <th>{{ 'common.name' | translate }}</th>\r\n                    <th>{{ 'common.code' | translate }}</th>\r\n                    <ng-container *ngIf=\"customValueFields.length\">\r\n                        <th>{{ 'common.custom-fields' | translate }}</th>\r\n                    </ng-container>\r\n                    <th></th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr class=\"facet-value\" *ngFor=\"let value of values; let i = index\" [formGroupName]=\"i\">\r\n                    <td class=\"align-middle\">\r\n                        <vdr-entity-info [entity]=\"value\"></vdr-entity-info>\r\n                    </td>\r\n                    <td class=\"align-middle\">\r\n                        <input\r\n                            type=\"text\"\r\n                            formControlName=\"name\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                            (input)=\"updateValueCode(facet.values[i]?.code, $event.target.value, i)\"\r\n                        />\r\n                    </td>\r\n                    <td class=\"align-middle\"><input type=\"text\" formControlName=\"code\" readonly /></td>\r\n                    <td class=\"\" *ngIf=\"customValueFields.length\">\r\n                        <vdr-tabbed-custom-fields\r\n                            entityName=\"FacetValue\"\r\n                            [customFields]=\"customValueFields\"\r\n                            [compact]=\"true\"\r\n                            [customFieldsFormGroup]=\"detailForm.get(['values', i, 'customFields'])\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                        ></vdr-tabbed-custom-fields>\r\n                    </td>\r\n                    <td class=\"align-middle\">\r\n                        <vdr-dropdown>\r\n                            <button type=\"button\" class=\"btn btn-link btn-sm\" vdrDropdownTrigger>\r\n                                {{ 'common.actions' | translate }}\r\n                                <clr-icon shape=\"caret down\"></clr-icon>\r\n                            </button>\r\n                            <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    class=\"delete-button\"\r\n                                    (click)=\"deleteFacetValue(facet.values[i]?.id, i)\"\r\n                                    [disabled]=\"!(updatePermission | hasPermission)\"\r\n                                    vdrDropdownItem\r\n                                >\r\n                                    <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                                    {{ 'common.delete' | translate }}\r\n                                </button>\r\n                            </vdr-dropdown-menu>\r\n                        </vdr-dropdown>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n        <div>\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn btn-secondary\"\r\n                *vdrIfPermissions=\"['CreateCatalog', 'CreateFacet']\"\r\n                (click)=\"addFacetValue()\"\r\n            >\r\n                <clr-icon shape=\"add\"></clr-icon>\r\n                {{ 'catalog.add-facet-value' | translate }}\r\n            </button>\r\n        </div>\r\n    </section>\r\n</form>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".visible-toggle{margin-top:-3px!important}\n"]
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }, { type: ɵngcc2.ServerConfigService }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.DataService }, { type: ɵngcc3.FormBuilder }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.ModalService }]; }, null); })();

class FacetListComponent extends BaseListComponent {
    constructor(dataService, modalService, notificationService, serverConfigService, router, route) {
        super(router, route);
        this.dataService = dataService;
        this.modalService = modalService;
        this.notificationService = notificationService;
        this.serverConfigService = serverConfigService;
        this.filterTermControl = new FormControl('');
        this.initialLimit = 3;
        this.displayLimit = {};
        super.setQueryFn((...args) => this.dataService.facet.getFacets(...args).refetchOnChannelChange(), data => data.facets, (skip, take) => ({
            options: {
                skip,
                take,
                filter: {
                    name: {
                        contains: this.filterTermControl.value,
                    },
                },
                sort: {
                    createdAt: SortOrder$1.DESC,
                },
            },
        }));
    }
    ngOnInit() {
        super.ngOnInit();
        this.availableLanguages$ = this.serverConfigService.getAvailableLanguages();
        this.contentLanguage$ = this.dataService.client
            .uiState()
            .mapStream(({ uiState }) => uiState.contentLanguage)
            .pipe(tap(() => this.refresh()));
        this.filterTermControl.valueChanges
            .pipe(filter(value => 2 <= value.length || value.length === 0), debounceTime(250), takeUntil(this.destroy$))
            .subscribe(() => this.refresh());
    }
    toggleDisplayLimit(facet) {
        if (this.displayLimit[facet.id] === facet.values.length) {
            this.displayLimit[facet.id] = this.initialLimit;
        }
        else {
            this.displayLimit[facet.id] = facet.values.length;
        }
    }
    deleteFacet(facetValueId) {
        this.showModalAndDelete(facetValueId)
            .pipe(switchMap(response => {
            if (response.result === DeletionResult.DELETED) {
                return [true];
            }
            else {
                return this.showModalAndDelete(facetValueId, response.message || '').pipe(map(r => r.result === DeletionResult.DELETED));
            }
        }), 
        // Refresh the cached facets to reflect the changes
        switchMap(() => this.dataService.facet.getAllFacets().single$))
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-delete-success'), {
                entity: 'FacetValue',
            });
            this.refresh();
        }, err => {
            this.notificationService.error(marker('common.notify-delete-error'), {
                entity: 'FacetValue',
            });
        });
    }
    setLanguage(code) {
        this.dataService.client.setContentLanguage(code).subscribe();
    }
    showModalAndDelete(facetId, message) {
        return this.modalService
            .dialog({
            title: marker('catalog.confirm-delete-facet'),
            body: message,
            buttons: [
                { type: 'secondary', label: marker('common.cancel') },
                { type: 'danger', label: marker('common.delete'), returnValue: true },
            ],
        })
            .pipe(switchMap(res => (res ? this.dataService.facet.deleteFacet(facetId, !!message) : EMPTY)), map(res => res.deleteFacet));
    }
}
FacetListComponent.ɵfac = function FacetListComponent_Factory(t) { return new (t || FacetListComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute)); };
FacetListComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: FacetListComponent, selectors: [["vdr-facet-list"]], features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 31, vars: 37, consts: [[1, "flex", "center", "wrap"], [3, "availableLanguageCodes", "currentLanguageCode", "languageCodeChange"], ["type", "text", "name", "searchTerm", 1, "clr-input", "search-input", "ml4", 3, "formControl", "placeholder"], ["locationId", "facet-list"], ["class", "btn btn-primary", 3, "routerLink", 4, "vdrIfPermissions"], [3, "items", "itemsPerPage", "totalItems", "currentPage", "pageChange", "itemsPerPageChange"], [3, "expand"], [1, "btn", "btn-primary", 3, "routerLink"], ["shape", "plus"], [1, "left", "align-middle"], [3, "facetValue", "removable", "displayFacetName", 4, "ngFor", "ngForOf"], ["class", "btn btn-sm btn-secondary btn-icon", 3, "click", 4, "ngIf"], [4, "ngIf", "ngIfElse"], ["private", ""], [1, "right", "align-middle"], ["iconShape", "edit", 3, "label", "linkTo"], ["type", "button", "vdrDropdownTrigger", "", 1, "btn", "btn-link", "btn-sm"], ["shape", "caret down"], ["vdrPosition", "bottom-right"], ["type", "button", "vdrDropdownItem", "", 1, "delete-button", 3, "disabled", "click"], ["shape", "trash", 1, "is-danger"], [3, "facetValue", "removable", "displayFacetName"], [1, "btn", "btn-sm", "btn-secondary", "btn-icon", 3, "click"], ["collapse", ""], ["shape", "minus"]], template: function FacetListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left");
        ɵngcc0.ɵɵelementStart(2, "div", 0);
        ɵngcc0.ɵɵelementStart(3, "vdr-language-selector", 1);
        ɵngcc0.ɵɵlistener("languageCodeChange", function FacetListComponent_Template_vdr_language_selector_languageCodeChange_3_listener($event) { return ctx.setLanguage($event); });
        ɵngcc0.ɵɵpipe(4, "async");
        ɵngcc0.ɵɵpipe(5, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(6, "input", 2);
        ɵngcc0.ɵɵpipe(7, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(8, "vdr-ab-right");
        ɵngcc0.ɵɵelement(9, "vdr-action-bar-items", 3);
        ɵngcc0.ɵɵtemplate(10, FacetListComponent_a_10_Template, 4, 5, "a", 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "vdr-data-table", 5);
        ɵngcc0.ɵɵlistener("pageChange", function FacetListComponent_Template_vdr_data_table_pageChange_11_listener($event) { return ctx.setPageNumber($event); })("itemsPerPageChange", function FacetListComponent_Template_vdr_data_table_itemsPerPageChange_11_listener($event) { return ctx.setItemsPerPage($event); });
        ɵngcc0.ɵɵpipe(12, "async");
        ɵngcc0.ɵɵpipe(13, "async");
        ɵngcc0.ɵɵpipe(14, "async");
        ɵngcc0.ɵɵpipe(15, "async");
        ɵngcc0.ɵɵelementStart(16, "vdr-dt-column");
        ɵngcc0.ɵɵtext(17);
        ɵngcc0.ɵɵpipe(18, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(19, "vdr-dt-column");
        ɵngcc0.ɵɵtext(20);
        ɵngcc0.ɵɵpipe(21, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(22, "vdr-dt-column", 6);
        ɵngcc0.ɵɵtext(23);
        ɵngcc0.ɵɵpipe(24, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(25, "vdr-dt-column");
        ɵngcc0.ɵɵtext(26);
        ɵngcc0.ɵɵpipe(27, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(28, "vdr-dt-column");
        ɵngcc0.ɵɵelement(29, "vdr-dt-column");
        ɵngcc0.ɵɵtemplate(30, FacetListComponent_ng_template_30_Template, 28, 38, "ng-template");
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("availableLanguageCodes", ɵngcc0.ɵɵpipeBind1(4, 14, ctx.availableLanguages$))("currentLanguageCode", ɵngcc0.ɵɵpipeBind1(5, 16, ctx.contentLanguage$));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("formControl", ctx.filterTermControl)("placeholder", ɵngcc0.ɵɵpipeBind1(7, 18, "catalog.filter-by-name"));
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(36, _c11));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("items", ɵngcc0.ɵɵpipeBind1(12, 20, ctx.items$))("itemsPerPage", ɵngcc0.ɵɵpipeBind1(13, 22, ctx.itemsPerPage$))("totalItems", ɵngcc0.ɵɵpipeBind1(14, 24, ctx.totalItems$))("currentPage", ɵngcc0.ɵɵpipeBind1(15, 26, ctx.currentPage$));
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(18, 28, "common.code"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(21, 30, "common.name"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("expand", true);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(24, 32, "catalog.values"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(27, 34, "catalog.visibility"));
    } }, directives: [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.LanguageSelectorComponent, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc3.NgControlStatus, ɵngcc3.FormControlDirective, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc2.IfPermissionsDirective, ɵngcc2.DataTableComponent, ɵngcc2.DataTableColumnComponent, ɵngcc1.RouterLinkWithHref, ɵngcc7.ClrIconCustomTag, ɵngcc4.NgForOf, ɵngcc4.NgIf, ɵngcc2.ChipComponent, ɵngcc2.TableRowActionComponent, ɵngcc2.DropdownComponent, ɵngcc2.DropdownTriggerDirective, ɵngcc2.DropdownMenuComponent, ɵngcc2.DropdownItemDirective, ɵngcc2.FacetValueChipComponent], pipes: [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe, ɵngcc4.SlicePipe, ɵngcc2.HasPermissionPipe], styles: ["td.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"] });
FacetListComponent.ctorParameters = () => [
    { type: DataService },
    { type: ModalService },
    { type: NotificationService },
    { type: ServerConfigService },
    { type: Router },
    { type: ActivatedRoute }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(FacetListComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-facet-list',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <div class=\"flex center wrap\">\r\n            <vdr-language-selector\r\n                [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n                [currentLanguageCode]=\"contentLanguage$ | async\"\r\n                (languageCodeChange)=\"setLanguage($event)\"\r\n            ></vdr-language-selector>\r\n            <input\r\n                type=\"text\"\r\n                name=\"searchTerm\"\r\n                [formControl]=\"filterTermControl\"\r\n                [placeholder]=\"'catalog.filter-by-name' | translate\"\r\n                class=\"clr-input search-input ml4\"\r\n            />\r\n        </div>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"facet-list\"></vdr-action-bar-items>\r\n        <a\r\n            class=\"btn btn-primary\"\r\n            *vdrIfPermissions=\"['CreateCatalog', 'CreateFacet']\"\r\n            [routerLink]=\"['./create']\"\r\n        >\r\n            <clr-icon shape=\"plus\"></clr-icon>\r\n            {{ 'catalog.create-new-facet' | translate }}\r\n        </a>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<vdr-data-table\r\n    [items]=\"items$ | async\"\r\n    [itemsPerPage]=\"itemsPerPage$ | async\"\r\n    [totalItems]=\"totalItems$ | async\"\r\n    [currentPage]=\"currentPage$ | async\"\r\n    (pageChange)=\"setPageNumber($event)\"\r\n    (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n>\r\n    <vdr-dt-column>{{ 'common.code' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ 'common.name' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column [expand]=\"true\">{{ 'catalog.values' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ 'catalog.visibility' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column></vdr-dt-column>\r\n    <vdr-dt-column></vdr-dt-column>\r\n    <ng-template let-facet=\"item\">\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">{{ facet.code }}</td>\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">{{ facet.name }}</td>\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-facet-value-chip\r\n                *ngFor=\"let value of facet.values | slice: 0:displayLimit[facet.id] || 3\"\r\n                [facetValue]=\"value\"\r\n                [removable]=\"false\"\r\n                [displayFacetName]=\"false\"\r\n            ></vdr-facet-value-chip>\r\n            <button\r\n                class=\"btn btn-sm btn-secondary btn-icon\"\r\n                *ngIf=\"facet.values.length > initialLimit\"\r\n                (click)=\"toggleDisplayLimit(facet)\"\r\n            >\r\n                <ng-container *ngIf=\"(displayLimit[facet.id] || 0) < facet.values.length; else collapse\">\r\n                    <clr-icon shape=\"plus\"></clr-icon>\r\n                    {{ facet.values.length - initialLimit }}\r\n                </ng-container>\r\n                <ng-template #collapse>\r\n                    <clr-icon shape=\"minus\"></clr-icon>\r\n                </ng-template>\r\n            </button>\r\n        </td>\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-chip>\r\n                <ng-container *ngIf=\"!facet.isPrivate; else private\">{{\r\n                    'catalog.public' | translate\r\n                }}</ng-container>\r\n                <ng-template #private>{{ 'catalog.private' | translate }}</ng-template>\r\n            </vdr-chip>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-table-row-action\r\n                iconShape=\"edit\"\r\n                [label]=\"'common.edit' | translate\"\r\n                [linkTo]=\"['./', facet.id]\"\r\n            ></vdr-table-row-action>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-dropdown>\r\n                <button type=\"button\" class=\"btn btn-link btn-sm\" vdrDropdownTrigger>\r\n                    {{ 'common.actions' | translate }}\r\n                    <clr-icon shape=\"caret down\"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <button\r\n                        type=\"button\"\r\n                        class=\"delete-button\"\r\n                        (click)=\"deleteFacet(facet.id)\"\r\n                        [disabled]=\"!(['DeleteCatalog', 'DeleteFacet'] | hasPermission)\"\r\n                        vdrDropdownItem\r\n                    >\r\n                        <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                        {{ 'common.delete' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n",
                styles: ["td.private{background-color:var(--color-component-bg-200)}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.DataService }, { type: ɵngcc2.ModalService }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.ServerConfigService }, { type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }]; }, null); })();

/**
 * @description
 * Like String.prototype.replace(), but replaces the last instance
 * rather than the first.
 */
function replaceLast(target, search, replace) {
    if (!target) {
        return '';
    }
    const lastIndex = target.lastIndexOf(search);
    if (lastIndex === -1) {
        return target;
    }
    const head = target.substr(0, lastIndex);
    const tail = target.substr(lastIndex).replace(search, replace);
    return head + tail;
}

/**
 * Handles the logic for making the API calls to perform CRUD operations on a Product and its related
 * entities. This logic was extracted out of the component because it became too large and hard to follow.
 */
class ProductDetailService {
    constructor(dataService) {
        this.dataService = dataService;
    }
    getFacets() {
        return this.dataService.facet.getAllFacets().mapSingle(data => data.facets.items);
    }
    getTaxCategories() {
        return this.dataService.settings
            .getTaxCategories()
            .mapSingle(data => data.taxCategories)
            .pipe(shareReplay(1));
    }
    createProductWithVariants(input, createVariantsConfig, languageCode) {
        const createProduct$ = this.dataService.product.createProduct(input);
        const nonEmptyOptionGroups = createVariantsConfig.groups.filter(g => 0 < g.values.length);
        const createOptionGroups$ = this.createProductOptionGroups(nonEmptyOptionGroups, languageCode);
        return forkJoin(createProduct$, createOptionGroups$).pipe(mergeMap(([{ createProduct }, optionGroups]) => {
            const addOptionsToProduct$ = optionGroups.length
                ? forkJoin(optionGroups.map(optionGroup => {
                    return this.dataService.product.addOptionGroupToProduct({
                        productId: createProduct.id,
                        optionGroupId: optionGroup.id,
                    });
                }))
                : of([]);
            return addOptionsToProduct$.pipe(map(() => {
                return { createProduct, optionGroups };
            }));
        }), mergeMap(({ createProduct, optionGroups }) => {
            const variants = createVariantsConfig.variants.map(v => {
                const optionIds = optionGroups.length
                    ? v.optionValues.map((optionName, index) => {
                        const option = optionGroups[index].options.find(o => o.name === optionName);
                        if (!option) {
                            throw new Error(`Could not find a matching ProductOption "${optionName}" when creating variant`);
                        }
                        return option.id;
                    })
                    : [];
                return Object.assign(Object.assign({}, v), { optionIds });
            });
            const options = optionGroups.map(og => og.options).reduce((flat, o) => [...flat, ...o], []);
            return this.createProductVariants(createProduct, variants, options, languageCode);
        }));
    }
    createProductOptionGroups(groups, languageCode) {
        return groups.length
            ? forkJoin(groups.map(c => {
                return this.dataService.product
                    .createProductOptionGroups({
                    code: normalizeString(c.name, '-'),
                    translations: [{ languageCode, name: c.name }],
                    options: c.values.map(v => ({
                        code: normalizeString(v, '-'),
                        translations: [{ languageCode, name: v }],
                    })),
                })
                    .pipe(map(data => data.createProductOptionGroup));
            }))
            : of([]);
    }
    createProductVariants(product, variantData, options, languageCode) {
        const variants = variantData.map(v => {
            const name = options.length
                ? `${product.name} ${v.optionIds
                    .map(id => options.find(o => o.id === id))
                    .filter(notNullOrUndefined)
                    .map(o => o.name)
                    .join(' ')}`
                : product.name;
            return {
                productId: product.id,
                price: v.price,
                sku: v.sku,
                stockOnHand: v.stock,
                translations: [
                    {
                        languageCode,
                        name,
                    },
                ],
                optionIds: v.optionIds,
            };
        });
        return this.dataService.product.createProductVariants(variants).pipe(map(({ createProductVariants }) => ({
            createProductVariants,
            productId: product.id,
        })));
    }
    updateProduct(updateOptions) {
        const { product, languageCode, autoUpdate, productInput, variantsInput } = updateOptions;
        const updateOperations = [];
        const updateVariantsInput = variantsInput || [];
        const variants$ = autoUpdate
            ? this.dataService.product
                .getProductVariants({}, product.id)
                .mapSingle(({ productVariants }) => productVariants.items)
            : of([]);
        return variants$.pipe(mergeMap(variants => {
            var _a, _b, _c, _d;
            if (productInput) {
                updateOperations.push(this.dataService.product.updateProduct(productInput));
                const productOldName = (_b = (_a = findTranslation(product, languageCode)) === null || _a === void 0 ? void 0 : _a.name) !== null && _b !== void 0 ? _b : '';
                const productNewName = (_c = findTranslation(productInput, languageCode)) === null || _c === void 0 ? void 0 : _c.name;
                if (productNewName && productOldName !== productNewName && autoUpdate) {
                    for (const variant of variants) {
                        const currentVariantName = ((_d = findTranslation(variant, languageCode)) === null || _d === void 0 ? void 0 : _d.name) || '';
                        let variantInput;
                        const existingVariantInput = updateVariantsInput.find(i => i.id === variant.id);
                        if (existingVariantInput) {
                            variantInput = existingVariantInput;
                        }
                        else {
                            variantInput = {
                                id: variant.id,
                                translations: [{ languageCode, name: currentVariantName }],
                            };
                            updateVariantsInput.push(variantInput);
                        }
                        const variantTranslation = findTranslation(variantInput, languageCode);
                        if (variantTranslation) {
                            if (variantTranslation.name) {
                                variantTranslation.name = replaceLast(variantTranslation.name, productOldName, productNewName);
                            }
                            else {
                                // The variant translation was falsy, which occurs
                                // when defining the product name for a new translation
                                // language that had not yet been defined.
                                variantTranslation.name = [
                                    productNewName,
                                    ...variant.options.map(o => o.name),
                                ].join(' ');
                            }
                        }
                    }
                }
            }
            if (updateVariantsInput.length) {
                updateOperations.push(this.dataService.product.updateProductVariants(updateVariantsInput));
            }
            return forkJoin(updateOperations);
        }));
    }
    updateProductOption(input, product, languageCode) {
        const variants$ = input.autoUpdate
            ? this.dataService.product
                .getProductVariants({}, product.id)
                .mapSingle(({ productVariants }) => productVariants.items)
            : of([]);
        return variants$.pipe(mergeMap(variants => {
            var _a, _b, _c;
            let updateProductVariantNames$ = of([]);
            if (input.autoUpdate) {
                // Update any ProductVariants' names which include the option name
                let oldOptionName;
                const newOptionName = (_a = findTranslation(input, languageCode)) === null || _a === void 0 ? void 0 : _a.name;
                if (!newOptionName) {
                    updateProductVariantNames$ = of([]);
                }
                const variantsToUpdate = [];
                for (const variant of variants) {
                    if (variant.options.map(o => o.id).includes(input.id)) {
                        if (!oldOptionName) {
                            oldOptionName = (_b = findTranslation(variant.options.find(o => o.id === input.id), languageCode)) === null || _b === void 0 ? void 0 : _b.name;
                        }
                        const variantName = ((_c = findTranslation(variant, languageCode)) === null || _c === void 0 ? void 0 : _c.name) || '';
                        if (oldOptionName && newOptionName && variantName.includes(oldOptionName)) {
                            variantsToUpdate.push({
                                id: variant.id,
                                translations: [
                                    {
                                        languageCode,
                                        name: replaceLast(variantName, oldOptionName, newOptionName),
                                    },
                                ],
                            });
                        }
                    }
                }
                if (variantsToUpdate.length) {
                    updateProductVariantNames$ =
                        this.dataService.product.updateProductVariants(variantsToUpdate);
                }
            }
            return this.dataService.product
                .updateProductOption(input)
                .pipe(mergeMap(() => updateProductVariantNames$));
        }));
    }
    deleteProductVariant(id, productId) {
        return this.dataService.product.deleteProductVariant(id).pipe(switchMap(result => {
            if (result.deleteProductVariant.result === DeletionResult.DELETED) {
                return this.dataService.product.getProduct(productId).single$;
            }
            else {
                return throwError(result.deleteProductVariant.message);
            }
        }));
    }
}
ProductDetailService.ɵfac = function ProductDetailService_Factory(t) { return new (t || ProductDetailService)(ɵngcc0.ɵɵinject(ɵngcc2.DataService)); };
ProductDetailService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ProductDetailService_Factory() { return new ProductDetailService(i0.ɵɵinject(i2.DataService)); }, token: ProductDetailService, providedIn: "root" });
ProductDetailService.ctorParameters = () => [
    { type: DataService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductDetailService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc2.DataService }]; }, null); })();

class ApplyFacetDialogComponent {
    constructor(changeDetector) {
        this.changeDetector = changeDetector;
        this.selectedValues = [];
    }
    ngAfterViewInit() {
        setTimeout(() => this.selector.focus(), 0);
    }
    selectValues() {
        this.resolveWith(this.selectedValues);
    }
    cancel() {
        this.resolveWith();
    }
}
ApplyFacetDialogComponent.ɵfac = function ApplyFacetDialogComponent_Factory(t) { return new (t || ApplyFacetDialogComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
ApplyFacetDialogComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ApplyFacetDialogComponent, selectors: [["vdr-apply-facet-dialog"]], viewQuery: function ApplyFacetDialogComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(FacetValueSelectorComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.selector = _t.first);
    } }, decls: 3, vars: 1, consts: [["vdrDialogTitle", ""], [3, "facets", "selectedValuesChange"], ["vdrDialogButtons", ""], ["type", "button", 1, "btn", 3, "click"], ["type", "submit", 1, "btn", "btn-primary", 3, "disabled", "click"]], template: function ApplyFacetDialogComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ApplyFacetDialogComponent_ng_template_0_Template, 2, 3, "ng-template", 0);
        ɵngcc0.ɵɵelementStart(1, "vdr-facet-value-selector", 1);
        ɵngcc0.ɵɵlistener("selectedValuesChange", function ApplyFacetDialogComponent_Template_vdr_facet_value_selector_selectedValuesChange_1_listener($event) { return ctx.selectedValues = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(2, ApplyFacetDialogComponent_ng_template_2_Template, 6, 7, "ng-template", 2);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("facets", ctx.facets);
    } }, directives: [ɵngcc2.DialogTitleDirective, ɵngcc2.FacetValueSelectorComponent, ɵngcc2.DialogButtonsDirective], pipes: [ɵngcc5.TranslatePipe], styles: [""], changeDetection: 0 });
ApplyFacetDialogComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
ApplyFacetDialogComponent.propDecorators = {
    selector: [{ type: ViewChild, args: [FacetValueSelectorComponent,] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ApplyFacetDialogComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-apply-facet-dialog',
                template: "<ng-template vdrDialogTitle>{{ 'catalog.add-facets' | translate }}</ng-template>\r\n\r\n<vdr-facet-value-selector\r\n    [facets]=\"facets\"\r\n    (selectedValuesChange)=\"selectedValues = $event\"\r\n></vdr-facet-value-selector>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button\r\n        type=\"submit\"\r\n        (click)=\"selectValues()\"\r\n        [disabled]=\"selectedValues.length === 0\"\r\n        class=\"btn btn-primary\"\r\n    >\r\n        {{ 'catalog.add-facets' | translate }}\r\n    </button>\r\n</ng-template>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [""]
            }]
    }], function () { return [{ type: ɵngcc0.ChangeDetectorRef }]; }, { selector: [{
            type: ViewChild,
            args: [FacetValueSelectorComponent]
        }] }); })();

class AssignProductsToChannelDialogComponent {
    constructor(dataService, notificationService) {
        this.dataService = dataService;
        this.notificationService = notificationService;
        this.priceFactorControl = new FormControl(1);
        this.selectedChannelIdControl = new FormControl();
    }
    get isProductVariantMode() {
        return this.productVariantIds != null;
    }
    ngOnInit() {
        const activeChannelId$ = this.dataService.client
            .userStatus()
            .mapSingle(({ userStatus }) => userStatus.activeChannelId);
        const allChannels$ = this.dataService.settings.getChannels().mapSingle(data => data.channels);
        combineLatest(activeChannelId$, allChannels$).subscribe(([activeChannelId, channels]) => {
            // tslint:disable-next-line:no-non-null-assertion
            this.currentChannel = channels.find(c => c.id === activeChannelId);
            this.availableChannels = channels;
        });
        this.selectedChannelIdControl.valueChanges.subscribe(ids => {
            this.selectChannel(ids);
        });
        this.variantsPreview$ = combineLatest(from(this.getTopVariants(10)), this.priceFactorControl.valueChanges.pipe(startWith(1))).pipe(map(([variants, factor]) => {
            return variants.map(v => ({
                id: v.id,
                name: v.name,
                price: v.price,
                pricePreview: v.price * +factor,
            }));
        }));
    }
    selectChannel(channelIds) {
        this.selectedChannel = this.availableChannels.find(c => c.id === channelIds[0]);
    }
    assign() {
        const selectedChannel = this.selectedChannel;
        if (selectedChannel) {
            if (!this.isProductVariantMode) {
                this.dataService.product
                    .assignProductsToChannel({
                    channelId: selectedChannel.id,
                    productIds: this.productIds,
                    priceFactor: +this.priceFactorControl.value,
                })
                    .subscribe(() => {
                    this.notificationService.success(marker('catalog.assign-product-to-channel-success'), {
                        channel: selectedChannel.code,
                    });
                    this.resolveWith(true);
                });
            }
            else if (this.productVariantIds) {
                this.dataService.product
                    .assignVariantsToChannel({
                    channelId: selectedChannel.id,
                    productVariantIds: this.productVariantIds,
                    priceFactor: +this.priceFactorControl.value,
                })
                    .subscribe(() => {
                    this.notificationService.success(marker('catalog.assign-variant-to-channel-success'), {
                        channel: selectedChannel.code,
                    });
                    this.resolveWith(true);
                });
            }
        }
    }
    cancel() {
        this.resolveWith();
    }
    getTopVariants(take) {
        return __awaiter(this, void 0, void 0, function* () {
            const variants = [];
            for (let i = 0; i < this.productIds.length && variants.length < take; i++) {
                const productVariants = yield this.dataService.product
                    .getProduct(this.productIds[i], { take: this.isProductVariantMode ? undefined : take })
                    .mapSingle(({ product }) => {
                    const _variants = product ? product.variantList.items : [];
                    return _variants.filter(v => { var _a; return this.isProductVariantMode ? (_a = this.productVariantIds) === null || _a === void 0 ? void 0 : _a.includes(v.id) : true; });
                })
                    .toPromise();
                variants.push(...(productVariants || []));
            }
            return variants.slice(0, take);
        });
    }
}
AssignProductsToChannelDialogComponent.ɵfac = function AssignProductsToChannelDialogComponent_Factory(t) { return new (t || AssignProductsToChannelDialogComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService)); };
AssignProductsToChannelDialogComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: AssignProductsToChannelDialogComponent, selectors: [["vdr-assign-products-to-channel-dialog"]], decls: 36, vars: 32, consts: [["vdrDialogTitle", ""], [1, "flex"], ["clrInput", "", 3, "multiple", "includeDefaultChannel", "disableChannelIds", "formControl"], [1, "flex-spacer"], ["clrInput", "", "type", "number", "min", "0", "max", "99999", 3, "formControl"], [1, "channel-price-preview"], [1, "clr-control-label"], [1, "table"], [3, "ngIf", "ngIfElse"], ["noSelection", ""], [4, "ngFor", "ngForOf"], ["vdrDialogButtons", ""], [4, "ngIf", "ngIfElse"], ["productModeTitle", ""], ["noChannelSelected", ""], ["type", "button", 1, "btn", 3, "click"], ["type", "submit", 1, "btn", "btn-primary", 3, "disabled", "click"]], template: function AssignProductsToChannelDialogComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, AssignProductsToChannelDialogComponent_ng_template_0_Template, 3, 2, "ng-template", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "clr-input-container");
        ɵngcc0.ɵɵelementStart(3, "label");
        ɵngcc0.ɵɵtext(4);
        ɵngcc0.ɵɵpipe(5, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(6, "vdr-channel-assignment-control", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(7, "div", 3);
        ɵngcc0.ɵɵelementStart(8, "clr-input-container");
        ɵngcc0.ɵɵelementStart(9, "label");
        ɵngcc0.ɵɵtext(10);
        ɵngcc0.ɵɵpipe(11, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(12, "input", 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(13, "div", 5);
        ɵngcc0.ɵɵelementStart(14, "label", 6);
        ɵngcc0.ɵɵtext(15);
        ɵngcc0.ɵɵpipe(16, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(17, "table", 7);
        ɵngcc0.ɵɵelementStart(18, "thead");
        ɵngcc0.ɵɵelementStart(19, "tr");
        ɵngcc0.ɵɵelementStart(20, "th");
        ɵngcc0.ɵɵtext(21);
        ɵngcc0.ɵɵpipe(22, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(23, "th");
        ɵngcc0.ɵɵtext(24);
        ɵngcc0.ɵɵpipe(25, "translate");
        ɵngcc0.ɵɵpipe(26, "translate");
        ɵngcc0.ɵɵpipe(27, "channelCodeToLabel");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(28, "th");
        ɵngcc0.ɵɵtemplate(29, AssignProductsToChannelDialogComponent_ng_template_29_Template, 2, 6, "ng-template", 8);
        ɵngcc0.ɵɵtemplate(30, AssignProductsToChannelDialogComponent_ng_template_30_Template, 2, 3, "ng-template", null, 9, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(32, "tbody");
        ɵngcc0.ɵɵtemplate(33, AssignProductsToChannelDialogComponent_tr_33_Template, 10, 7, "tr", 10);
        ɵngcc0.ɵɵpipe(34, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(35, AssignProductsToChannelDialogComponent_ng_template_35_Template, 7, 6, "ng-template", 11);
    } if (rf & 2) {
        const _r2 = ɵngcc0.ɵɵreference(31);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 13, "common.channel"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("multiple", false)("includeDefaultChannel", false)("disableChannelIds", ctx.currentChannelIds)("formControl", ctx.selectedChannelIdControl);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(11, 15, "catalog.price-conversion-factor"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("formControl", ctx.priceFactorControl);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(16, 17, "catalog.channel-price-preview"));
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(22, 19, "common.name"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(25, 21, "catalog.price-in-channel", ɵngcc0.ɵɵpureFunction1(30, _c15, ɵngcc0.ɵɵpipeBind1(26, 24, ɵngcc0.ɵɵpipeBind1(27, 26, ctx.currentChannel == null ? null : ctx.currentChannel.code)))), " ");
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("ngIf", ctx.selectedChannel)("ngIfElse", _r2);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind1(34, 28, ctx.variantsPreview$));
    } }, directives: [ɵngcc2.DialogTitleDirective, ɵngcc7.ClrInputContainer, ɵngcc7.ClrLabel, ɵngcc2.ChannelAssignmentControlComponent, ɵngcc7.ClrInput, ɵngcc3.NgControlStatus, ɵngcc3.FormControlDirective, ɵngcc2.FormFieldControlDirective, ɵngcc3.MinValidator, ɵngcc3.MaxValidator, ɵngcc3.NumberValueAccessor, ɵngcc3.DefaultValueAccessor, ɵngcc4.NgIf, ɵngcc4.NgForOf, ɵngcc2.DialogButtonsDirective], pipes: [ɵngcc5.TranslatePipe, ɵngcc2.ChannelLabelPipe, ɵngcc4.AsyncPipe, ɵngcc2.LocaleCurrencyPipe], styles: ["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"], changeDetection: 0 });
AssignProductsToChannelDialogComponent.ctorParameters = () => [
    { type: DataService },
    { type: NotificationService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(AssignProductsToChannelDialogComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-assign-products-to-channel-dialog',
                template: "<ng-template vdrDialogTitle>\r\n    <ng-container *ngIf=\"isProductVariantMode; else productModeTitle\">{{\r\n        'catalog.assign-variants-to-channel' | translate\r\n    }}</ng-container>\r\n    <ng-template #productModeTitle>{{ 'catalog.assign-products-to-channel' | translate }}</ng-template>\r\n</ng-template>\r\n\r\n<div class=\"flex\">\r\n    <clr-input-container>\r\n        <label>{{ 'common.channel' | translate }}</label>\r\n        <vdr-channel-assignment-control\r\n            clrInput\r\n            [multiple]=\"false\"\r\n            [includeDefaultChannel]=\"false\"\r\n            [disableChannelIds]=\"currentChannelIds\"\r\n            [formControl]=\"selectedChannelIdControl\"\r\n        ></vdr-channel-assignment-control>\r\n    </clr-input-container>\r\n    <div class=\"flex-spacer\"></div>\r\n    <clr-input-container>\r\n        <label>{{ 'catalog.price-conversion-factor' | translate }}</label>\r\n        <input clrInput type=\"number\" min=\"0\" max=\"99999\" [formControl]=\"priceFactorControl\" />\r\n    </clr-input-container>\r\n</div>\r\n\r\n<div class=\"channel-price-preview\">\r\n    <label class=\"clr-control-label\">{{ 'catalog.channel-price-preview' | translate }}</label>\r\n    <table class=\"table\">\r\n        <thead>\r\n            <tr>\r\n                <th>{{ 'common.name' | translate }}</th>\r\n                <th>\r\n                    {{\r\n                        'catalog.price-in-channel'\r\n                            | translate: { channel: currentChannel?.code | channelCodeToLabel | translate }\r\n                    }}\r\n                </th>\r\n                <th>\r\n                    <ng-template [ngIf]=\"selectedChannel\" [ngIfElse]=\"noSelection\">\r\n                        {{ 'catalog.price-in-channel' | translate: { channel: selectedChannel?.code } }}\r\n                    </ng-template>\r\n                    <ng-template #noSelection>\r\n                        {{ 'catalog.no-channel-selected' | translate }}\r\n                    </ng-template>\r\n                </th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            <tr *ngFor=\"let row of variantsPreview$ | async\">\r\n                <td>{{ row.name }}</td>\r\n                <td>{{ row.price | localeCurrency: currentChannel?.currencyCode }}</td>\r\n                <td>\r\n                    <ng-template [ngIf]=\"selectedChannel\" [ngIfElse]=\"noChannelSelected\">\r\n                        {{ row.pricePreview | localeCurrency: selectedChannel?.currencyCode }}\r\n                    </ng-template>\r\n                    <ng-template #noChannelSelected> - </ng-template>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</div>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button type=\"submit\" (click)=\"assign()\" [disabled]=\"!selectedChannel\" class=\"btn btn-primary\">\r\n        <ng-template [ngIf]=\"selectedChannel\" [ngIfElse]=\"noSelection\">\r\n            {{ 'catalog.assign-to-named-channel' | translate: { channelCode: selectedChannel?.code } }}\r\n        </ng-template>\r\n        <ng-template #noSelection>\r\n            {{ 'catalog.no-channel-selected' | translate }}\r\n        </ng-template>\r\n    </button>\r\n</ng-template>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: ["vdr-channel-assignment-control{min-width:200px}.channel-price-preview{margin-top:24px}.channel-price-preview table.table{margin-top:6px}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.DataService }, { type: ɵngcc2.NotificationService }]; }, null); })();

class ProductDetailComponent extends BaseDetailComponent {
    constructor(route, router, serverConfigService, productDetailService, formBuilder, modalService, notificationService, dataService, location, changeDetector) {
        super(route, router, serverConfigService, dataService);
        this.productDetailService = productDetailService;
        this.formBuilder = formBuilder;
        this.modalService = modalService;
        this.notificationService = notificationService;
        this.dataService = dataService;
        this.location = location;
        this.changeDetector = changeDetector;
        this.filterInput = new FormControl('');
        this.assetChanges = {};
        this.variantAssetChanges = {};
        this.variantFacetValueChanges = {};
        this.currentPage$ = new BehaviorSubject(1);
        this.itemsPerPage$ = new BehaviorSubject(10);
        this.selectedVariantIds = [];
        this.variantDisplayMode = 'card';
        this.createVariantsConfig = { groups: [], variants: [] };
        // Used to store all ProductVariants which have been loaded.
        // It is needed when saving changes to variants.
        this.productVariantMap = new Map();
        this.updatePermissions = [Permission.UpdateCatalog, Permission.UpdateProduct];
        this.customFields = this.getCustomFieldConfig('Product');
        this.customVariantFields = this.getCustomFieldConfig('ProductVariant');
        this.customOptionGroupFields = this.getCustomFieldConfig('ProductOptionGroup');
        this.customOptionFields = this.getCustomFieldConfig('ProductOption');
        this.detailForm = this.formBuilder.group({
            product: this.formBuilder.group({
                enabled: true,
                name: ['', Validators.required],
                autoUpdateVariantNames: true,
                slug: ['', unicodePatternValidator(/^[\p{Letter}0-9_-]+$/)],
                description: '',
                facetValueIds: [[]],
                customFields: this.formBuilder.group(this.customFields.reduce((hash, field) => (Object.assign(Object.assign({}, hash), { [field.name]: '' })), {})),
            }),
            variants: this.formBuilder.array([]),
        });
    }
    ngOnInit() {
        this.init();
        this.product$ = this.entity$;
        this.totalItems$ = this.product$.pipe(map(product => product.variantList.totalItems));
        this.paginationConfig$ = combineLatest(this.totalItems$, this.itemsPerPage$, this.currentPage$).pipe(map(([totalItems, itemsPerPage, currentPage]) => ({
            totalItems,
            itemsPerPage,
            currentPage,
        })));
        const variants$ = this.product$.pipe(map(product => product.variantList.items));
        const filterTerm$ = this.filterInput.valueChanges.pipe(startWith(''), debounceTime(200), shareReplay());
        const initialVariants$ = this.product$.pipe(map(p => p.variantList.items));
        const updatedVariants$ = combineLatest(filterTerm$, this.currentPage$, this.itemsPerPage$).pipe(skipUntil(initialVariants$), skip(1), switchMap(([term, currentPage, itemsPerPage]) => {
            return this.dataService.product
                .getProductVariants(Object.assign(Object.assign({ skip: (currentPage - 1) * itemsPerPage, take: itemsPerPage }, (term
                ? { filter: { name: { contains: term }, sku: { contains: term } } }
                : {})), { filterOperator: LogicalOperator.OR }), this.id)
                .mapStream(({ productVariants }) => productVariants.items);
        }), shareReplay({ bufferSize: 1, refCount: true }));
        this.variants$ = merge(initialVariants$, updatedVariants$).pipe(tap(variants => {
            for (const variant of variants) {
                this.productVariantMap.set(variant.id, variant);
            }
        }));
        this.taxCategories$ = this.productDetailService.getTaxCategories().pipe(takeUntil(this.destroy$));
        this.activeTab$ = this.route.paramMap.pipe(map(qpm => qpm.get('tab')));
        combineLatest(updatedVariants$, this.languageCode$)
            .pipe(takeUntil(this.destroy$))
            .subscribe(([variants, languageCode]) => {
            this.buildVariantFormArray(variants, languageCode);
        });
        // FacetValues are provided initially by the nested array of the
        // Product entity, but once a fetch to get all Facets is made (as when
        // opening the FacetValue selector modal), then these additional values
        // are concatenated onto the initial array.
        this.facets$ = this.productDetailService.getFacets();
        const productFacetValues$ = this.product$.pipe(map(product => product.facetValues));
        const allFacetValues$ = this.facets$.pipe(map(flattenFacetValues));
        const productGroup = this.getProductFormGroup();
        const formFacetValueIdChanges$ = productGroup.valueChanges.pipe(map(val => val.facetValueIds), distinctUntilChanged());
        const formChangeFacetValues$ = combineLatest(formFacetValueIdChanges$, productFacetValues$, allFacetValues$).pipe(map(([ids, productFacetValues, allFacetValues]) => {
            const combined = [...productFacetValues, ...allFacetValues];
            return ids.map(id => combined.find(fv => fv.id === id)).filter(notNullOrUndefined);
        }));
        this.facetValues$ = merge(productFacetValues$, formChangeFacetValues$);
        this.productChannels$ = this.product$.pipe(map(p => p.channels));
        this.channelPriceIncludesTax$ = this.dataService.settings
            .getActiveChannel('cache-first')
            .refetchOnChannelChange()
            .mapStream(data => data.activeChannel.pricesIncludeTax)
            .pipe(shareReplay(1));
    }
    ngOnDestroy() {
        this.destroy();
    }
    navigateToTab(tabName) {
        this.location.replaceState(this.router
            .createUrlTree(['./', Object.assign(Object.assign({}, this.route.snapshot.params), { tab: tabName })], {
            queryParamsHandling: 'merge',
            relativeTo: this.route,
        })
            .toString());
    }
    isDefaultChannel(channelCode) {
        return channelCode === DEFAULT_CHANNEL_CODE;
    }
    setPage(page) {
        this.currentPage$.next(page);
    }
    setItemsPerPage(value) {
        this.itemsPerPage$.next(+value);
        this.currentPage$.next(1);
    }
    assignToChannel() {
        this.productChannels$
            .pipe(take(1), switchMap(channels => {
            return this.modalService.fromComponent(AssignProductsToChannelDialogComponent, {
                size: 'lg',
                locals: {
                    productIds: [this.id],
                    currentChannelIds: channels.map(c => c.id),
                },
            });
        }))
            .subscribe();
    }
    removeFromChannel(channelId) {
        this.modalService
            .dialog({
            title: marker('catalog.remove-product-from-channel'),
            buttons: [
                { type: 'secondary', label: marker('common.cancel') },
                { type: 'danger', label: marker('catalog.remove-from-channel'), returnValue: true },
            ],
        })
            .pipe(switchMap(response => response
            ? this.dataService.product.removeProductsFromChannel({
                channelId,
                productIds: [this.id],
            })
            : EMPTY))
            .subscribe(() => {
            this.notificationService.success(marker('catalog.notify-remove-product-from-channel-success'));
        }, err => {
            this.notificationService.error(marker('catalog.notify-remove-product-from-channel-error'));
        });
    }
    assignVariantToChannel(variant) {
        return this.modalService
            .fromComponent(AssignProductsToChannelDialogComponent, {
            size: 'lg',
            locals: {
                productIds: [this.id],
                productVariantIds: [variant.id],
                currentChannelIds: variant.channels.map(c => c.id),
            },
        })
            .subscribe();
    }
    removeVariantFromChannel({ channelId, variant, }) {
        this.modalService
            .dialog({
            title: marker('catalog.remove-product-variant-from-channel'),
            buttons: [
                { type: 'secondary', label: marker('common.cancel') },
                { type: 'danger', label: marker('catalog.remove-from-channel'), returnValue: true },
            ],
        })
            .pipe(switchMap(response => response
            ? this.dataService.product.removeVariantsFromChannel({
                channelId,
                productVariantIds: [variant.id],
            })
            : EMPTY))
            .subscribe(() => {
            this.notificationService.success(marker('catalog.notify-remove-variant-from-channel-success'));
        }, err => {
            this.notificationService.error(marker('catalog.notify-remove-variant-from-channel-error'));
        });
    }
    assetsChanged() {
        return !!Object.values(this.assetChanges).length;
    }
    variantAssetsChanged() {
        return !!Object.keys(this.variantAssetChanges).length;
    }
    variantAssetChange(event) {
        this.variantAssetChanges[event.variantId] = event;
    }
    /**
     * If creating a new product, automatically generate the slug based on the product name.
     */
    updateSlug(nameValue) {
        combineLatest(this.entity$, this.languageCode$)
            .pipe(take(1))
            .subscribe(([entity, languageCode]) => {
            const slugControl = this.detailForm.get(['product', 'slug']);
            const currentTranslation = findTranslation(entity, languageCode);
            const currentSlugIsEmpty = !currentTranslation || !currentTranslation.slug;
            if (slugControl && slugControl.pristine && currentSlugIsEmpty) {
                slugControl.setValue(normalizeString(`${nameValue}`, '-'));
            }
        });
    }
    selectProductFacetValue() {
        this.displayFacetValueModal().subscribe(facetValueIds => {
            if (facetValueIds) {
                const productGroup = this.getProductFormGroup();
                const currentFacetValueIds = productGroup.value.facetValueIds;
                productGroup.patchValue({
                    facetValueIds: unique([...currentFacetValueIds, ...facetValueIds]),
                });
                productGroup.markAsDirty();
            }
        });
    }
    updateProductOption(input) {
        combineLatest(this.product$, this.languageCode$)
            .pipe(take(1), mergeMap(([product, languageCode]) => this.productDetailService.updateProductOption(input, product, languageCode)))
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-update-success'), {
                entity: 'ProductOption',
            });
        }, err => {
            this.notificationService.error(marker('common.notify-update-error'), {
                entity: 'ProductOption',
            });
        });
    }
    removeProductFacetValue(facetValueId) {
        const productGroup = this.getProductFormGroup();
        const currentFacetValueIds = productGroup.value.facetValueIds;
        productGroup.patchValue({
            facetValueIds: currentFacetValueIds.filter(id => id !== facetValueId),
        });
        productGroup.markAsDirty();
    }
    /**
     * Opens a dialog to select FacetValues to apply to the select ProductVariants.
     */
    selectVariantFacetValue(selectedVariantIds) {
        this.displayFacetValueModal()
            .pipe(withLatestFrom(this.variants$))
            .subscribe(([facetValueIds, variants]) => {
            if (facetValueIds) {
                for (const variantId of selectedVariantIds) {
                    const index = variants.findIndex(v => v.id === variantId);
                    const variant = variants[index];
                    const existingFacetValueIds = variant ? variant.facetValues.map(fv => fv.id) : [];
                    const variantFormGroup = this.detailForm.get('variants').controls.find(c => c.value.id === variantId);
                    if (variantFormGroup) {
                        const uniqueFacetValueIds = unique([...existingFacetValueIds, ...facetValueIds]);
                        variantFormGroup.patchValue({
                            facetValueIds: uniqueFacetValueIds,
                        });
                        variantFormGroup.markAsDirty();
                        this.variantFacetValueChanges[variantId] = uniqueFacetValueIds;
                    }
                }
                this.changeDetector.markForCheck();
            }
        });
    }
    variantsToCreateAreValid() {
        return (0 < this.createVariantsConfig.variants.length &&
            this.createVariantsConfig.variants.every(v => {
                return v.sku !== '';
            }));
    }
    displayFacetValueModal() {
        return this.productDetailService.getFacets().pipe(mergeMap(facets => this.modalService.fromComponent(ApplyFacetDialogComponent, {
            size: 'md',
            closable: true,
            locals: { facets },
        })), map(facetValues => facetValues && facetValues.map(v => v.id)));
    }
    create() {
        const productGroup = this.getProductFormGroup();
        if (!productGroup.dirty) {
            return;
        }
        combineLatest(this.product$, this.languageCode$)
            .pipe(take(1), mergeMap(([product, languageCode]) => {
            const newProduct = this.getUpdatedProduct(product, productGroup, languageCode);
            return this.productDetailService.createProductWithVariants(newProduct, this.createVariantsConfig, languageCode);
        }))
            .subscribe(({ createProductVariants, productId }) => {
            this.notificationService.success(marker('common.notify-create-success'), {
                entity: 'Product',
            });
            this.assetChanges = {};
            this.variantAssetChanges = {};
            this.detailForm.markAsPristine();
            this.router.navigate(['../', productId], { relativeTo: this.route });
        }, err => {
            // tslint:disable-next-line:no-console
            console.error(err);
            this.notificationService.error(marker('common.notify-create-error'), {
                entity: 'Product',
            });
        });
    }
    save() {
        combineLatest(this.product$, this.languageCode$, this.channelPriceIncludesTax$)
            .pipe(take(1), mergeMap(([product, languageCode, priceIncludesTax]) => {
            var _a, _b;
            const productGroup = this.getProductFormGroup();
            let productInput;
            let variantsInput;
            if (productGroup.dirty || this.assetsChanged()) {
                productInput = this.getUpdatedProduct(product, productGroup, languageCode);
            }
            const variantsArray = this.detailForm.get('variants');
            if ((variantsArray && variantsArray.dirty) || this.variantAssetsChanged()) {
                variantsInput = this.getUpdatedProductVariants(product, variantsArray, languageCode, priceIncludesTax);
            }
            return this.productDetailService.updateProduct({
                product,
                languageCode,
                autoUpdate: (_b = (_a = this.detailForm.get(['product', 'autoUpdateVariantNames'])) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : false,
                productInput,
                variantsInput,
            });
        }))
            .subscribe(result => {
            this.updateSlugAfterSave(result);
            this.detailForm.markAsPristine();
            this.assetChanges = {};
            this.variantAssetChanges = {};
            this.notificationService.success(marker('common.notify-update-success'), {
                entity: 'Product',
            });
            this.changeDetector.markForCheck();
        }, err => {
            this.notificationService.error(marker('common.notify-update-error'), {
                entity: 'Product',
            });
        });
    }
    canDeactivate() {
        return super.canDeactivate() && !this.assetChanges.assets && !this.assetChanges.featuredAsset;
    }
    /**
     * Sets the values of the form on changes to the product or current language.
     */
    setFormValues(product, languageCode) {
        const currentTranslation = findTranslation(product, languageCode);
        this.detailForm.patchValue({
            product: {
                enabled: product.enabled,
                name: currentTranslation ? currentTranslation.name : '',
                slug: currentTranslation ? currentTranslation.slug : '',
                description: currentTranslation ? currentTranslation.description : '',
                facetValueIds: product.facetValues.map(fv => fv.id),
            },
        });
        if (this.customFields.length) {
            this.setCustomFieldFormValues(this.customFields, this.detailForm.get(['product', 'customFields']), product, currentTranslation);
        }
        this.buildVariantFormArray(product.variantList.items, languageCode);
    }
    buildVariantFormArray(variants, languageCode) {
        const variantsFormArray = this.detailForm.get('variants');
        variants.forEach((variant, i) => {
            const variantTranslation = findTranslation(variant, languageCode);
            const pendingFacetValueChanges = this.variantFacetValueChanges[variant.id];
            const facetValueIds = pendingFacetValueChanges
                ? pendingFacetValueChanges
                : variant.facetValues.map(fv => fv.id);
            const group = {
                id: variant.id,
                enabled: variant.enabled,
                sku: variant.sku,
                name: variantTranslation ? variantTranslation.name : '',
                price: variant.price,
                priceWithTax: variant.priceWithTax,
                taxCategoryId: variant.taxCategory.id,
                stockOnHand: variant.stockOnHand,
                useGlobalOutOfStockThreshold: variant.useGlobalOutOfStockThreshold,
                outOfStockThreshold: variant.outOfStockThreshold,
                trackInventory: variant.trackInventory,
                facetValueIds,
            };
            let variantFormGroup = variantsFormArray.controls.find(c => c.value.id === variant.id);
            if (variantFormGroup) {
                if (variantFormGroup.pristine) {
                    variantFormGroup.patchValue(group);
                }
            }
            else {
                variantFormGroup = this.formBuilder.group(Object.assign(Object.assign({}, group), { facetValueIds: this.formBuilder.control(facetValueIds) }));
                variantsFormArray.insert(i, variantFormGroup);
            }
            if (this.customVariantFields.length) {
                let customFieldsGroup = variantFormGroup.get(['customFields']);
                if (!customFieldsGroup) {
                    customFieldsGroup = this.formBuilder.group(this.customVariantFields.reduce((hash, field) => (Object.assign(Object.assign({}, hash), { [field.name]: '' })), {}));
                    variantFormGroup.addControl('customFields', customFieldsGroup);
                }
                this.setCustomFieldFormValues(this.customVariantFields, customFieldsGroup, variant, variantTranslation);
            }
        });
    }
    /**
     * Given a product and the value of the detailForm, this method creates an updated copy of the product which
     * can then be persisted to the API.
     */
    getUpdatedProduct(product, productFormGroup, languageCode) {
        var _a, _b;
        const updatedProduct = createUpdatedTranslatable({
            translatable: product,
            updatedFields: productFormGroup.value,
            customFieldConfig: this.customFields,
            languageCode,
            defaultTranslation: {
                languageCode,
                name: product.name || '',
                slug: product.slug || '',
                description: product.description || '',
            },
        });
        return Object.assign(Object.assign({}, updatedProduct), { assetIds: (_a = this.assetChanges.assets) === null || _a === void 0 ? void 0 : _a.map(a => a.id), featuredAssetId: (_b = this.assetChanges.featuredAsset) === null || _b === void 0 ? void 0 : _b.id, facetValueIds: productFormGroup.value.facetValueIds });
    }
    /**
     * Given an array of product variants and the values from the detailForm, this method creates an new array
     * which can be persisted to the API.
     */
    getUpdatedProductVariants(product, variantsFormArray, languageCode, priceIncludesTax) {
        const dirtyFormControls = variantsFormArray.controls.filter(c => c.dirty);
        const dirtyVariants = dirtyFormControls
            .map(c => this.productVariantMap.get(c.value.id))
            .filter(notNullOrUndefined);
        const dirtyVariantValues = dirtyFormControls.map(c => c.value);
        if (dirtyVariants.length !== dirtyVariantValues.length) {
            throw new Error(marker(`error.product-variant-form-values-do-not-match`));
        }
        return dirtyVariants
            .map((variant, i) => {
            var _a, _b;
            const formValue = dirtyVariantValues.find(value => value.id === variant.id);
            const result = createUpdatedTranslatable({
                translatable: variant,
                updatedFields: formValue,
                customFieldConfig: this.customVariantFields,
                languageCode,
                defaultTranslation: {
                    languageCode,
                    name: '',
                },
            });
            result.taxCategoryId = formValue.taxCategoryId;
            result.facetValueIds = formValue.facetValueIds;
            result.price = priceIncludesTax ? formValue.priceWithTax : formValue.price;
            const assetChanges = this.variantAssetChanges[variant.id];
            if (assetChanges) {
                result.featuredAssetId = (_a = assetChanges.featuredAsset) === null || _a === void 0 ? void 0 : _a.id;
                result.assetIds = (_b = assetChanges.assets) === null || _b === void 0 ? void 0 : _b.map(a => a.id);
            }
            return result;
        })
            .filter(notNullOrUndefined);
    }
    getProductFormGroup() {
        return this.detailForm.get('product');
    }
    /**
     * The server may alter the slug value in order to normalize and ensure uniqueness upon saving.
     */
    updateSlugAfterSave(results) {
        const firstResult = results[0];
        const slugControl = this.detailForm.get(['product', 'slug']);
        function isUpdateMutation(input) {
            return input.hasOwnProperty('updateProduct');
        }
        if (slugControl && isUpdateMutation(firstResult)) {
            slugControl.setValue(firstResult.updateProduct.slug, { emitEvent: false });
        }
    }
}
ProductDetailComponent.ɵfac = function ProductDetailComponent_Factory(t) { return new (t || ProductDetailComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService), ɵngcc0.ɵɵdirectiveInject(ProductDetailService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.Location), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
ProductDetailComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProductDetailComponent, selectors: [["vdr-product-detail"]], features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 18, vars: 21, consts: [[1, "flex", "clr-flex-row"], [3, "entity"], [4, "vdrIfPermissions"], [3, "disabled", "availableLanguageCodes", "currentLanguageCode", "languageCodeChange"], ["locationId", "product-detail"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "ngIf", "ngIfElse"], ["updateButton", ""], ["class", "form", 3, "formGroup", 4, "ngIf"], ["type", "checkbox", "clrToggle", "", "name", "enabled", 3, "formControl"], [1, "btn", "btn-primary", 3, "disabled", "click"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "vdrIfPermissions"], [1, "form", 3, "formGroup"], ["type", "submit", "hidden", "", "x-data", "prevents enter key from triggering other buttons"], ["clrTabLink", "", 3, "click"], [4, "clrIfActive"], [4, "ngIf"], [1, "clr-row"], [1, "clr-col"], ["formGroupName", "product", 1, "form-block"], ["for", "name", 3, "label"], ["id", "name", "type", "text", "formControlName", "name", 3, "readonly", "input"], [1, "auto-rename-wrapper"], ["clrCheckbox", "", "type", "checkbox", "id", "auto-update", "formControlName", "autoUpdateVariantNames"], ["for", "slug", 3, "label", "errors"], ["id", "slug", "type", "text", "formControlName", "slug", 3, "readonly"], ["formControlName", "description", 3, "readonly", "label"], ["formGroupName", "customFields", 4, "ngIf"], ["locationId", "product-detail", 3, "entity$", "detailForm"], [1, "clr-col-md-auto"], [3, "assets", "featuredAsset", "updatePermissions", "change"], [1, "facets"], [3, "facetValue", "removable", "remove", 4, "ngFor", "ngForOf"], ["class", "btn btn-sm btn-secondary", 3, "click", 4, "vdrIfPermissions"], [4, "vdrIfMultichannel"], [3, "label", 4, "vdrIfDefaultChannelActive"], [3, "label"], [1, "flex", "channel-assignment"], [4, "ngFor", "ngForOf"], [1, "btn", "btn-sm", 3, "click"], ["shape", "layers"], ["icon", "times-circle", 3, "iconClick", 4, "ngIf"], ["icon", "times-circle", 3, "iconClick"], [3, "channelCode"], ["formGroupName", "customFields"], ["entityName", "Product", 3, "customFields", "customFieldsFormGroup", "readonly"], [3, "facetValue", "removable", "remove"], [1, "btn", "btn-sm", "btn-secondary", 3, "click"], ["shape", "plus"], [3, "variantsChange"], [1, "form-block"], [1, "view-mode"], [1, "btn-group"], [1, "btn", "btn-secondary-outline", 3, "click"], ["shape", "list"], [1, "btn", 3, "click"], ["shape", "table"], [1, "variant-filter"], [3, "formControl", "placeholder"], [1, "icon-button", 3, "click"], ["shape", "times"], [1, "flex-spacer"], ["class", "btn btn-secondary edit-variants-btn", 3, "routerLink", 4, "vdrIfPermissions"], ["class", "pagination-row mt4", 4, "ngIf"], [3, "variants", "paginationConfig", "optionGroups", "channelPriceIncludesTax", "productVariantsFormArray", "pendingAssetChanges", 4, "ngIf"], [3, "variants", "paginationConfig", "channelPriceIncludesTax", "facets", "optionGroups", "productVariantsFormArray", "taxCategories", "customFields", "customOptionFields", "activeLanguage", "pendingAssetChanges", "assignToChannel", "removeFromChannel", "assetChange", "updateProductOption", "selectionChange", "selectFacetValueClick", 4, "ngIf"], [1, "btn", "btn-secondary", "edit-variants-btn", 3, "routerLink"], ["shape", "add-text"], [1, "pagination-row", "mt4"], [3, "itemsPerPage", "itemsPerPageChange"], [3, "id", "currentPage", "itemsPerPage", "pageChange"], [3, "variants", "paginationConfig", "optionGroups", "channelPriceIncludesTax", "productVariantsFormArray", "pendingAssetChanges"], [3, "variants", "paginationConfig", "channelPriceIncludesTax", "facets", "optionGroups", "productVariantsFormArray", "taxCategories", "customFields", "customOptionFields", "activeLanguage", "pendingAssetChanges", "assignToChannel", "removeFromChannel", "assetChange", "updateProductOption", "selectionChange", "selectFacetValueClick"]], template: function ProductDetailComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left");
        ɵngcc0.ɵɵelementStart(2, "div", 0);
        ɵngcc0.ɵɵelement(3, "vdr-entity-info", 1);
        ɵngcc0.ɵɵpipe(4, "async");
        ɵngcc0.ɵɵtemplate(5, ProductDetailComponent_clr_toggle_wrapper_5_Template, 5, 5, "clr-toggle-wrapper", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "vdr-language-selector", 3);
        ɵngcc0.ɵɵlistener("languageCodeChange", function ProductDetailComponent_Template_vdr_language_selector_languageCodeChange_6_listener($event) { return ctx.setLanguage($event); });
        ɵngcc0.ɵɵpipe(7, "async");
        ɵngcc0.ɵɵpipe(8, "async");
        ɵngcc0.ɵɵpipe(9, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(10, "vdr-ab-right");
        ɵngcc0.ɵɵelement(11, "vdr-action-bar-items", 4);
        ɵngcc0.ɵɵtemplate(12, ProductDetailComponent_button_12_Template, 3, 4, "button", 5);
        ɵngcc0.ɵɵpipe(13, "async");
        ɵngcc0.ɵɵtemplate(14, ProductDetailComponent_ng_template_14_Template, 1, 2, "ng-template", null, 6, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(16, ProductDetailComponent_form_16_Template, 11, 10, "form", 7);
        ɵngcc0.ɵɵpipe(17, "async");
    } if (rf & 2) {
        const _r2 = ɵngcc0.ɵɵreference(15);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("entity", ɵngcc0.ɵɵpipeBind1(4, 8, ctx.entity$));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(20, _c18));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("disabled", ɵngcc0.ɵɵpipeBind1(7, 10, ctx.isNew$))("availableLanguageCodes", ɵngcc0.ɵɵpipeBind1(8, 12, ctx.availableLanguages$))("currentLanguageCode", ɵngcc0.ɵɵpipeBind1(9, 14, ctx.languageCode$));
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(13, 16, ctx.isNew$))("ngIfElse", _r2);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(17, 18, ctx.product$));
    } }, directives: function () { return [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.EntityInfoComponent, ɵngcc2.IfPermissionsDirective, ɵngcc2.LanguageSelectorComponent, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc4.NgIf, ɵngcc7.ClrCheckboxWrapper, ɵngcc2.FormFieldControlDirective, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc3.NgControlStatus, ɵngcc3.FormControlDirective, ɵngcc7.ClrLabel, ɵngcc3.ɵNgNoValidate, ɵngcc3.NgControlStatusGroup, ɵngcc3.FormGroupDirective, ɵngcc7.ClrTabs, ɵngcc7.ÇlrTabsWillyWonka, ɵngcc7.ClrTab, ɵngcc7.ClrTabLink, ɵngcc7.ÇlrActiveOompaLoompa, ɵngcc7.ClrIfActive, ɵngcc7.ClrTabContent, ɵngcc3.FormGroupName, ɵngcc2.FormFieldComponent, ɵngcc3.DefaultValueAccessor, ɵngcc3.FormControlName, ɵngcc2.RichTextEditorComponent, ɵngcc2.CustomDetailComponentHostComponent, AssetsComponent, ɵngcc4.NgForOf, ɵngcc2.IfMultichannelDirective, ɵngcc2.IfDefaultChannelActiveDirective, ɵngcc2.FormItemComponent, ɵngcc7.ClrIconCustomTag, ɵngcc2.ChipComponent, ɵngcc2.ChannelBadgeComponent, ɵngcc2.TabbedCustomFieldsComponent, ɵngcc2.FacetValueChipComponent, GenerateProductVariantsComponent, ɵngcc1.RouterLinkWithHref, ɵngcc2.ItemsPerPageControlsComponent, ɵngcc2.PaginationControlsComponent, ProductVariantsTableComponent, ProductVariantsListComponent]; }, pipes: function () { return [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe, ɵngcc2.HasPermissionPipe, ɵngcc2.ChannelLabelPipe]; }, styles: ["[_nghost-%COMP%]     trix-toolbar{top:24px}.facets[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;align-items:center}@media screen and (min-width: 768px){.facets[_ngcontent-%COMP%]{max-width:340px}}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:initial;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap}.auto-rename-wrapper[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible[_ngcontent-%COMP%]{max-height:24px;margin-bottom:12px}.pagination-row[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between}"], changeDetection: 0 });
ProductDetailComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: Router },
    { type: ServerConfigService },
    { type: ProductDetailService },
    { type: FormBuilder },
    { type: ModalService },
    { type: NotificationService },
    { type: DataService },
    { type: Location },
    { type: ChangeDetectorRef }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductDetailComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-product-detail',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <div class=\"flex clr-flex-row\">\r\n            <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n            <clr-toggle-wrapper *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\">\r\n                <input\r\n                    type=\"checkbox\"\r\n                    clrToggle\r\n                    name=\"enabled\"\r\n                    [formControl]=\"detailForm.get(['product', 'enabled'])\"\r\n                />\r\n                <label>{{ 'common.enabled' | translate }}</label>\r\n            </clr-toggle-wrapper>\r\n        </div>\r\n        <vdr-language-selector\r\n            [disabled]=\"isNew$ | async\"\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"languageCode$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"product-detail\"></vdr-action-bar-items>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            *ngIf=\"isNew$ | async; else updateButton\"\r\n            (click)=\"create()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine || !variantsToCreateAreValid()\"\r\n        >\r\n            {{ 'common.create' | translate }}\r\n        </button>\r\n        <ng-template #updateButton>\r\n            <button\r\n                *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\"\r\n                class=\"btn btn-primary\"\r\n                (click)=\"save()\"\r\n                [disabled]=\"\r\n                    (detailForm.invalid || detailForm.pristine) && !assetsChanged() && !variantAssetsChanged()\r\n                \"\r\n            >\r\n                {{ 'common.update' | translate }}\r\n            </button>\r\n        </ng-template>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<form class=\"form\" [formGroup]=\"detailForm\" *ngIf=\"product$ | async as product\">\r\n    <button type=\"submit\" hidden x-data=\"prevents enter key from triggering other buttons\"></button>\r\n    <clr-tabs>\r\n        <clr-tab>\r\n            <button clrTabLink (click)=\"navigateToTab('details')\">\r\n                {{ 'catalog.product-details' | translate }}\r\n            </button>\r\n            <clr-tab-content *clrIfActive=\"(activeTab$ | async) === 'details'\">\r\n                <div class=\"clr-row\">\r\n                    <div class=\"clr-col\">\r\n                        <section class=\"form-block\" formGroupName=\"product\">\r\n                            <ng-container *ngIf=\"!(isNew$ | async)\">\r\n                                <ng-container *vdrIfMultichannel>\r\n                                    <vdr-form-item\r\n                                        [label]=\"'common.channels' | translate\"\r\n                                        *vdrIfDefaultChannelActive\r\n                                    >\r\n                                        <div class=\"flex channel-assignment\">\r\n                                            <ng-container *ngFor=\"let channel of productChannels$ | async\">\r\n                                                <vdr-chip\r\n                                                    *ngIf=\"!isDefaultChannel(channel.code)\"\r\n                                                    icon=\"times-circle\"\r\n                                                    (iconClick)=\"removeFromChannel(channel.id)\"\r\n                                                >\r\n                                                    <vdr-channel-badge\r\n                                                        [channelCode]=\"channel.code\"\r\n                                                    ></vdr-channel-badge>\r\n                                                    {{ channel.code | channelCodeToLabel }}\r\n                                                </vdr-chip>\r\n                                            </ng-container>\r\n                                            <button class=\"btn btn-sm\" (click)=\"assignToChannel()\">\r\n                                                <clr-icon shape=\"layers\"></clr-icon>\r\n                                                {{ 'catalog.assign-to-channel' | translate }}\r\n                                            </button>\r\n                                        </div>\r\n                                    </vdr-form-item>\r\n                                </ng-container>\r\n                            </ng-container>\r\n                            <vdr-form-field [label]=\"'catalog.product-name' | translate\" for=\"name\">\r\n                                <input\r\n                                    id=\"name\"\r\n                                    type=\"text\"\r\n                                    formControlName=\"name\"\r\n                                    [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                    (input)=\"updateSlug($event.target.value)\"\r\n                                />\r\n                            </vdr-form-field>\r\n                            <div\r\n                                class=\"auto-rename-wrapper\"\r\n                                [class.visible]=\"\r\n                                    (isNew$ | async) === false && detailForm.get(['product', 'name'])?.dirty\r\n                                \"\r\n                            >\r\n                                <clr-checkbox-wrapper>\r\n                                    <input\r\n                                        clrCheckbox\r\n                                        type=\"checkbox\"\r\n                                        id=\"auto-update\"\r\n                                        formControlName=\"autoUpdateVariantNames\"\r\n                                    />\r\n                                    <label>{{\r\n                                        'catalog.auto-update-product-variant-name' | translate\r\n                                    }}</label>\r\n                                </clr-checkbox-wrapper>\r\n                            </div>\r\n                            <vdr-form-field\r\n                                [label]=\"'catalog.slug' | translate\"\r\n                                for=\"slug\"\r\n                                [errors]=\"{ pattern: 'catalog.slug-pattern-error' | translate }\"\r\n                            >\r\n                                <input\r\n                                    id=\"slug\"\r\n                                    type=\"text\"\r\n                                    formControlName=\"slug\"\r\n                                    [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                />\r\n                            </vdr-form-field>\r\n                            <vdr-rich-text-editor\r\n                                formControlName=\"description\"\r\n                                [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                [label]=\"'common.description' | translate\"\r\n                            ></vdr-rich-text-editor>\r\n\r\n                            <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n                                <label>{{ 'common.custom-fields' | translate }}</label>\r\n                                <vdr-tabbed-custom-fields\r\n                                    entityName=\"Product\"\r\n                                    [customFields]=\"customFields\"\r\n                                    [customFieldsFormGroup]=\"detailForm.get(['product', 'customFields'])\"\r\n                                    [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                ></vdr-tabbed-custom-fields>\r\n                            </section>\r\n                            <vdr-custom-detail-component-host\r\n                                locationId=\"product-detail\"\r\n                                [entity$]=\"entity$\"\r\n                                [detailForm]=\"detailForm\"\r\n                            ></vdr-custom-detail-component-host>\r\n                        </section>\r\n                    </div>\r\n                    <div class=\"clr-col-md-auto\">\r\n                        <vdr-assets\r\n                            [assets]=\"assetChanges.assets || product.assets\"\r\n                            [featuredAsset]=\"assetChanges.featuredAsset || product.featuredAsset\"\r\n                            [updatePermissions]=\"updatePermissions\"\r\n                            (change)=\"assetChanges = $event\"\r\n                        ></vdr-assets>\r\n                        <div class=\"facets\">\r\n                            <vdr-facet-value-chip\r\n                                *ngFor=\"let facetValue of facetValues$ | async\"\r\n                                [facetValue]=\"facetValue\"\r\n                                [removable]=\"['UpdateCatalog', 'UpdateProduct'] | hasPermission\"\r\n                                (remove)=\"removeProductFacetValue(facetValue.id)\"\r\n                            ></vdr-facet-value-chip>\r\n                            <button\r\n                                class=\"btn btn-sm btn-secondary\"\r\n                                *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\"\r\n                                (click)=\"selectProductFacetValue()\"\r\n                            >\r\n                                <clr-icon shape=\"plus\"></clr-icon>\r\n                                {{ 'catalog.add-facets' | translate }}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div *ngIf=\"isNew$ | async\">\r\n                    <h4>{{ 'catalog.product-variants' | translate }}</h4>\r\n                    <vdr-generate-product-variants\r\n                        (variantsChange)=\"createVariantsConfig = $event\"\r\n                    ></vdr-generate-product-variants>\r\n                </div>\r\n            </clr-tab-content>\r\n        </clr-tab>\r\n        <clr-tab *ngIf=\"!(isNew$ | async)\">\r\n            <button clrTabLink (click)=\"navigateToTab('variants')\">\r\n                {{ 'catalog.product-variants' | translate }}\r\n            </button>\r\n            <clr-tab-content *clrIfActive=\"(activeTab$ | async) === 'variants'\">\r\n                <section class=\"form-block\">\r\n                    <div class=\"view-mode\">\r\n                        <div class=\"btn-group\">\r\n                            <button\r\n                                class=\"btn btn-secondary-outline\"\r\n                                (click)=\"variantDisplayMode = 'card'\"\r\n                                [class.btn-primary]=\"variantDisplayMode === 'card'\"\r\n                            >\r\n                                <clr-icon shape=\"list\"></clr-icon>\r\n                                {{ 'catalog.display-variant-cards' | translate }}\r\n                            </button>\r\n                            <button\r\n                                class=\"btn\"\r\n                                (click)=\"variantDisplayMode = 'table'\"\r\n                                [class.btn-primary]=\"variantDisplayMode === 'table'\"\r\n                            >\r\n                                <clr-icon shape=\"table\"></clr-icon>\r\n                                {{ 'catalog.display-variant-table' | translate }}\r\n                            </button>\r\n                        </div>\r\n                        <div class=\"variant-filter\">\r\n                            <input\r\n                                [formControl]=\"filterInput\"\r\n                                [placeholder]=\"'catalog.filter-by-name-or-sku' | translate\"\r\n                            />\r\n                            <button class=\"icon-button\" (click)=\"filterInput.setValue('')\">\r\n                                <clr-icon shape=\"times\"></clr-icon>\r\n                            </button>\r\n                        </div>\r\n                        <div class=\"flex-spacer\"></div>\r\n                        <a\r\n                            *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\"\r\n                            [routerLink]=\"['./', 'manage-variants']\"\r\n                            class=\"btn btn-secondary edit-variants-btn\"\r\n                        >\r\n                            <clr-icon shape=\"add-text\"></clr-icon>\r\n                            {{ 'catalog.manage-variants' | translate }}\r\n                        </a>\r\n                    </div>\r\n\r\n                    <div class=\"pagination-row mt4\" *ngIf=\"10 < (paginationConfig$ | async)?.totalItems\">\r\n                        <vdr-items-per-page-controls\r\n                            [itemsPerPage]=\"itemsPerPage$ | async\"\r\n                            (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n                        ></vdr-items-per-page-controls>\r\n\r\n                        <vdr-pagination-controls\r\n                            [id]=\"(paginationConfig$ | async)?.id\"\r\n                            [currentPage]=\"currentPage$ | async\"\r\n                            [itemsPerPage]=\"itemsPerPage$ | async\"\r\n                            (pageChange)=\"setPage($event)\"\r\n                        ></vdr-pagination-controls>\r\n                    </div>\r\n\r\n                    <vdr-product-variants-table\r\n                        *ngIf=\"variantDisplayMode === 'table'\"\r\n                        [variants]=\"variants$ | async\"\r\n                        [paginationConfig]=\"paginationConfig$ | async\"\r\n                        [optionGroups]=\"product.optionGroups\"\r\n                        [channelPriceIncludesTax]=\"channelPriceIncludesTax$ | async\"\r\n                        [productVariantsFormArray]=\"detailForm.get('variants')\"\r\n                        [pendingAssetChanges]=\"variantAssetChanges\"\r\n                    ></vdr-product-variants-table>\r\n                    <vdr-product-variants-list\r\n                        *ngIf=\"variantDisplayMode === 'card'\"\r\n                        [variants]=\"variants$ | async\"\r\n                        [paginationConfig]=\"paginationConfig$ | async\"\r\n                        [channelPriceIncludesTax]=\"channelPriceIncludesTax$ | async\"\r\n                        [facets]=\"facets$ | async\"\r\n                        [optionGroups]=\"product.optionGroups\"\r\n                        [productVariantsFormArray]=\"detailForm.get('variants')\"\r\n                        [taxCategories]=\"taxCategories$ | async\"\r\n                        [customFields]=\"customVariantFields\"\r\n                        [customOptionFields]=\"customOptionFields\"\r\n                        [activeLanguage]=\"languageCode$ | async\"\r\n                        [pendingAssetChanges]=\"variantAssetChanges\"\r\n                        (assignToChannel)=\"assignVariantToChannel($event)\"\r\n                        (removeFromChannel)=\"removeVariantFromChannel($event)\"\r\n                        (assetChange)=\"variantAssetChange($event)\"\r\n                        (updateProductOption)=\"updateProductOption($event)\"\r\n                        (selectionChange)=\"selectedVariantIds = $event\"\r\n                        (selectFacetValueClick)=\"selectVariantFacetValue($event)\"\r\n                    ></vdr-product-variants-list>\r\n                </section>\r\n                <div class=\"pagination-row mt4\" *ngIf=\"10 < (paginationConfig$ | async)?.totalItems\">\r\n                    <vdr-items-per-page-controls\r\n                        [itemsPerPage]=\"itemsPerPage$ | async\"\r\n                        (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n                    ></vdr-items-per-page-controls>\r\n\r\n                    <vdr-pagination-controls\r\n                        [id]=\"(paginationConfig$ | async)?.id\"\r\n                        [currentPage]=\"currentPage$ | async\"\r\n                        [itemsPerPage]=\"itemsPerPage$ | async\"\r\n                        (pageChange)=\"setPage($event)\"\r\n                    ></vdr-pagination-controls>\r\n                </div>\r\n            </clr-tab-content>\r\n        </clr-tab>\r\n    </clr-tabs>\r\n</form>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host ::ng-deep trix-toolbar{top:24px}.facets{margin-top:12px;display:flex;flex-wrap:wrap;align-items:center}@media screen and (min-width: 768px){.facets{max-width:340px}}vdr-action-bar clr-toggle-wrapper{margin-top:12px}.variant-filter{flex:1;display:flex}.variant-filter input{flex:1;max-width:initial;border-radius:3px 0 0 3px!important}.variant-filter .icon-button{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name{padding-right:6px}.view-mode{display:flex;justify-content:flex-end;align-items:center}.edit-variants-btn{margin-top:0}.channel-assignment{flex-wrap:wrap}.auto-rename-wrapper{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible{max-height:24px;margin-bottom:12px}.pagination-row{display:flex;align-items:baseline;justify-content:space-between}\n"]
            }]
    }], function () { return [{ type: ɵngcc1.ActivatedRoute }, { type: ɵngcc1.Router }, { type: ɵngcc2.ServerConfigService }, { type: ProductDetailService }, { type: ɵngcc3.FormBuilder }, { type: ɵngcc2.ModalService }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.DataService }, { type: ɵngcc4.Location }, { type: ɵngcc0.ChangeDetectorRef }]; }, null); })();

class ProductListComponent extends BaseListComponent {
    constructor(dataService, modalService, notificationService, jobQueueService, serverConfigService, router, route) {
        super(router, route);
        this.dataService = dataService;
        this.modalService = modalService;
        this.notificationService = notificationService;
        this.jobQueueService = jobQueueService;
        this.serverConfigService = serverConfigService;
        this.searchTerm = '';
        this.facetValueIds = [];
        this.groupByProduct = true;
        this.pendingSearchIndexUpdates = 0;
        this.route.queryParamMap
            .pipe(map(qpm => qpm.get('q')), takeUntil(this.destroy$))
            .subscribe(term => {
            this.searchTerm = term || '';
            if (this.productSearchInput) {
                this.productSearchInput.setSearchTerm(term);
            }
        });
        this.selectedFacetValueIds$ = this.route.queryParamMap.pipe(map(qpm => qpm.getAll('fvids')));
        this.selectedFacetValueIds$.pipe(takeUntil(this.destroy$)).subscribe(ids => {
            this.facetValueIds = ids;
            if (this.productSearchInput) {
                this.productSearchInput.setFacetValues(ids);
            }
        });
        super.setQueryFn((...args) => this.dataService.product.searchProducts(this.searchTerm, ...args).refetchOnChannelChange(), data => data.search, 
        // tslint:disable-next-line:no-shadowed-variable
        (skip, take) => ({
            input: {
                skip,
                take,
                term: this.searchTerm,
                facetValueIds: this.facetValueIds,
                facetValueOperator: LogicalOperator.AND,
                groupByProduct: this.groupByProduct,
            },
        }));
    }
    ngOnInit() {
        super.ngOnInit();
        this.facetValues$ = this.result$.pipe(map(data => data.search.facetValues));
        this.facetValues$
            .pipe(take(1), delay(100), withLatestFrom(this.selectedFacetValueIds$))
            .subscribe(([__, ids]) => {
            this.productSearchInput.setFacetValues(ids);
        });
        this.availableLanguages$ = this.serverConfigService.getAvailableLanguages();
        this.contentLanguage$ = this.dataService.client
            .uiState()
            .mapStream(({ uiState }) => uiState.contentLanguage)
            .pipe(tap(() => this.refresh()));
        this.dataService.product
            .getPendingSearchIndexUpdates()
            .mapSingle(({ pendingSearchIndexUpdates }) => pendingSearchIndexUpdates)
            .subscribe(value => (this.pendingSearchIndexUpdates = value));
    }
    ngAfterViewInit() {
        if (this.productSearchInput && this.searchTerm) {
            setTimeout(() => this.productSearchInput.setSearchTerm(this.searchTerm));
        }
    }
    setSearchTerm(term) {
        this.searchTerm = term;
        this.setQueryParam({ q: term || null, page: 1 });
        this.refresh();
    }
    setFacetValueIds(ids) {
        this.facetValueIds = ids;
        this.setQueryParam({ fvids: ids, page: 1 });
        this.refresh();
    }
    rebuildSearchIndex() {
        this.dataService.product.reindex().subscribe(({ reindex }) => {
            this.notificationService.info(marker('catalog.reindexing'));
            this.jobQueueService.addJob(reindex.id, job => {
                if (job.state === JobState.COMPLETED) {
                    const time = new Intl.NumberFormat().format(job.duration || 0);
                    this.notificationService.success(marker('catalog.reindex-successful'), {
                        count: job.result.indexedItemCount,
                        time,
                    });
                    this.refresh();
                }
                else {
                    this.notificationService.error(marker('catalog.reindex-error'));
                }
            });
        });
    }
    runPendingSearchIndexUpdates() {
        this.dataService.product.runPendingSearchIndexUpdates().subscribe(value => {
            this.notificationService.info(marker('catalog.running-search-index-updates'), {
                count: this.pendingSearchIndexUpdates,
            });
            this.pendingSearchIndexUpdates = 0;
        });
    }
    deleteProduct(productId) {
        this.modalService
            .dialog({
            title: marker('catalog.confirm-delete-product'),
            buttons: [
                { type: 'secondary', label: marker('common.cancel') },
                { type: 'danger', label: marker('common.delete'), returnValue: true },
            ],
        })
            .pipe(switchMap(response => (response ? this.dataService.product.deleteProduct(productId) : EMPTY)), 
        // Short delay to allow the product to be removed from the search index before
        // refreshing.
        delay(500))
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-delete-success'), {
                entity: 'Product',
            });
            this.refresh();
        }, err => {
            this.notificationService.error(marker('common.notify-delete-error'), {
                entity: 'Product',
            });
        });
    }
    setLanguage(code) {
        this.dataService.client.setContentLanguage(code).subscribe();
    }
}
ProductListComponent.ɵfac = function ProductListComponent_Factory(t) { return new (t || ProductListComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.JobQueueService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute)); };
ProductListComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProductListComponent, selectors: [["vdr-products-list"]], viewQuery: function ProductListComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c22, 7);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.productSearchInput = _t.first);
    } }, features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 38, vars: 43, consts: [[3, "grow"], [1, "search-form"], [3, "facetValueResults", "searchTermChange", "facetValueChange"], ["productSearchInputComponent", ""], [1, "search-settings-menu", "mr3"], ["type", "button", "vdrDropdownTrigger", "", 1, "icon-button", "search-index-button", 3, "title"], ["shape", "cog"], ["type", "warning", 4, "ngIf"], ["vdrPosition", "bottom-right"], [1, "dropdown-header"], [4, "ngIf"], ["type", "button", "vdrDropdownItem", "", 3, "disabled", "click"], [1, "flex", "wrap"], [1, "mt2"], ["type", "checkbox", "clrCheckbox", "", 3, "ngModel", "ngModelChange"], [3, "availableLanguageCodes", "currentLanguageCode", "languageCodeChange"], ["locationId", "product-list"], ["class", "btn btn-primary", 3, "routerLink", 4, "vdrIfPermissions"], [3, "items", "itemsPerPage", "totalItems", "currentPage", "pageChange", "itemsPerPageChange"], ["type", "warning"], ["type", "button", "vdrDropdownItem", "", 1, "run-updates-button", 3, "disabled", "click"], [1, "dropdown-divider"], [1, "btn", "btn-primary", 3, "routerLink"], ["shape", "plus"], [1, "full-label"], [1, "left", "align-middle"], [1, "image-placeholder"], [3, "src", 4, "ngIf", "ngIfElse"], ["imagePlaceholder", ""], [1, "align-middle"], [1, "right", "align-middle"], ["iconShape", "edit", 3, "label", "linkTo"], ["type", "button", "vdrDropdownTrigger", "", 1, "btn", "btn-link", "btn-sm"], ["shape", "caret down"], ["type", "button", "vdrDropdownItem", "", 1, "delete-button", 3, "disabled", "click"], ["shape", "trash", 1, "is-danger"], [3, "src"], [1, "placeholder"], ["shape", "image", "size", "48"]], template: function ProductListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left", 0);
        ɵngcc0.ɵɵelementStart(2, "div", 1);
        ɵngcc0.ɵɵelementStart(3, "vdr-product-search-input", 2, 3);
        ɵngcc0.ɵɵlistener("searchTermChange", function ProductListComponent_Template_vdr_product_search_input_searchTermChange_3_listener($event) { return ctx.setSearchTerm($event); })("facetValueChange", function ProductListComponent_Template_vdr_product_search_input_facetValueChange_3_listener($event) { return ctx.setFacetValueIds($event); });
        ɵngcc0.ɵɵpipe(5, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "vdr-dropdown", 4);
        ɵngcc0.ɵɵelementStart(7, "button", 5);
        ɵngcc0.ɵɵpipe(8, "translate");
        ɵngcc0.ɵɵelement(9, "clr-icon", 6);
        ɵngcc0.ɵɵtemplate(10, ProductListComponent_vdr_status_badge_10_Template, 1, 0, "vdr-status-badge", 7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "vdr-dropdown-menu", 8);
        ɵngcc0.ɵɵelementStart(12, "h4", 9);
        ɵngcc0.ɵɵtext(13);
        ɵngcc0.ɵɵpipe(14, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(15, ProductListComponent_ng_container_15_Template, 7, 10, "ng-container", 10);
        ɵngcc0.ɵɵelementStart(16, "button", 11);
        ɵngcc0.ɵɵlistener("click", function ProductListComponent_Template_button_click_16_listener() { return ctx.rebuildSearchIndex(); });
        ɵngcc0.ɵɵpipe(17, "hasPermission");
        ɵngcc0.ɵɵtext(18);
        ɵngcc0.ɵɵpipe(19, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(20, "div", 12);
        ɵngcc0.ɵɵelementStart(21, "clr-checkbox-wrapper", 13);
        ɵngcc0.ɵɵelementStart(22, "input", 14);
        ɵngcc0.ɵɵlistener("ngModelChange", function ProductListComponent_Template_input_ngModelChange_22_listener($event) { return ctx.groupByProduct = $event; })("ngModelChange", function ProductListComponent_Template_input_ngModelChange_22_listener() { return ctx.refresh(); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(23, "label");
        ɵngcc0.ɵɵtext(24);
        ɵngcc0.ɵɵpipe(25, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(26, "vdr-language-selector", 15);
        ɵngcc0.ɵɵlistener("languageCodeChange", function ProductListComponent_Template_vdr_language_selector_languageCodeChange_26_listener($event) { return ctx.setLanguage($event); });
        ɵngcc0.ɵɵpipe(27, "async");
        ɵngcc0.ɵɵpipe(28, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(29, "vdr-ab-right");
        ɵngcc0.ɵɵelement(30, "vdr-action-bar-items", 16);
        ɵngcc0.ɵɵtemplate(31, ProductListComponent_a_31_Template, 5, 5, "a", 17);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(32, "vdr-data-table", 18);
        ɵngcc0.ɵɵlistener("pageChange", function ProductListComponent_Template_vdr_data_table_pageChange_32_listener($event) { return ctx.setPageNumber($event); })("itemsPerPageChange", function ProductListComponent_Template_vdr_data_table_itemsPerPageChange_32_listener($event) { return ctx.setItemsPerPage($event); });
        ɵngcc0.ɵɵpipe(33, "async");
        ɵngcc0.ɵɵpipe(34, "async");
        ɵngcc0.ɵɵpipe(35, "async");
        ɵngcc0.ɵɵpipe(36, "async");
        ɵngcc0.ɵɵtemplate(37, ProductListComponent_ng_template_37_Template, 24, 30, "ng-template");
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("grow", true);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("facetValueResults", ɵngcc0.ɵɵpipeBind1(5, 17, ctx.facetValues$));
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(8, 19, ctx.pendingSearchIndexUpdates ? "catalog.pending-search-index-updates" : "catalog.search-index-controls"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", ctx.pendingSearchIndexUpdates);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(14, 21, "catalog.search-index-controls"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.pendingSearchIndexUpdates);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("disabled", !ɵngcc0.ɵɵpipeBind1(17, 23, ɵngcc0.ɵɵpureFunction0(41, _c18)));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(19, 25, "catalog.rebuild-search-index"), " ");
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngModel", ctx.groupByProduct);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(25, 27, "catalog.group-by-product"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("availableLanguageCodes", ɵngcc0.ɵɵpipeBind1(27, 29, ctx.availableLanguages$))("currentLanguageCode", ɵngcc0.ɵɵpipeBind1(28, 31, ctx.contentLanguage$));
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵproperty("vdrIfPermissions", ɵngcc0.ɵɵpureFunction0(42, _c24));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("items", ɵngcc0.ɵɵpipeBind1(33, 33, ctx.items$))("itemsPerPage", ɵngcc0.ɵɵpipeBind1(34, 35, ctx.itemsPerPage$))("totalItems", ɵngcc0.ɵɵpipeBind1(35, 37, ctx.totalItems$))("currentPage", ɵngcc0.ɵɵpipeBind1(36, 39, ctx.currentPage$));
    } }, directives: function () { return [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ProductSearchInputComponent, ɵngcc2.DropdownComponent, ɵngcc2.DropdownTriggerDirective, ɵngcc7.ClrIconCustomTag, ɵngcc4.NgIf, ɵngcc2.DropdownMenuComponent, ɵngcc2.DropdownItemDirective, ɵngcc7.ClrCheckboxWrapper, ɵngcc2.FormFieldControlDirective, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, ɵngcc7.ClrLabel, ɵngcc2.LanguageSelectorComponent, ɵngcc2.ActionBarRightComponent, ɵngcc2.ActionBarItemsComponent, ɵngcc2.IfPermissionsDirective, ɵngcc2.DataTableComponent, ɵngcc2.StatusBadgeComponent, ɵngcc1.RouterLinkWithHref, ɵngcc2.TableRowActionComponent, ɵngcc2.ChipComponent]; }, pipes: function () { return [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe, ɵngcc2.HasPermissionPipe, ɵngcc2.AssetPreviewPipe]; }, styles: [".image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width: 768px){.search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.search-index-button[_ngcontent-%COMP%]{position:relative}.search-index-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{right:0;top:0}.run-updates-button[_ngcontent-%COMP%]{position:relative}.run-updates-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{left:10px;top:10px}"] });
ProductListComponent.ctorParameters = () => [
    { type: DataService },
    { type: ModalService },
    { type: NotificationService },
    { type: JobQueueService },
    { type: ServerConfigService },
    { type: Router },
    { type: ActivatedRoute }
];
ProductListComponent.propDecorators = {
    productSearchInput: [{ type: ViewChild, args: ['productSearchInputComponent', { static: true },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductListComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-products-list',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left [grow]=\"true\">\r\n        <div class=\"search-form\">\r\n            <vdr-product-search-input\r\n                #productSearchInputComponent\r\n                [facetValueResults]=\"facetValues$ | async\"\r\n                (searchTermChange)=\"setSearchTerm($event)\"\r\n                (facetValueChange)=\"setFacetValueIds($event)\"\r\n            ></vdr-product-search-input>\r\n            <vdr-dropdown class=\"search-settings-menu mr3\">\r\n                <button\r\n                    type=\"button\"\r\n                    class=\"icon-button search-index-button\"\r\n                    [title]=\"\r\n                        (pendingSearchIndexUpdates\r\n                            ? 'catalog.pending-search-index-updates'\r\n                            : 'catalog.search-index-controls'\r\n                        ) | translate\r\n                    \"\r\n                    vdrDropdownTrigger\r\n                >\r\n                    <clr-icon shape=\"cog\"></clr-icon>\r\n                    <vdr-status-badge *ngIf=\"pendingSearchIndexUpdates\" type=\"warning\"> </vdr-status-badge>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <h4 class=\"dropdown-header\">{{ 'catalog.search-index-controls' | translate }}</h4>\r\n                    <ng-container *ngIf=\"pendingSearchIndexUpdates\">\r\n                        <button\r\n                            type=\"button\"\r\n                            class=\"run-updates-button\"\r\n                            vdrDropdownItem\r\n                            (click)=\"runPendingSearchIndexUpdates()\"\r\n                            [disabled]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                        >\r\n                            <vdr-status-badge type=\"warning\"> </vdr-status-badge>\r\n                            {{\r\n                                'catalog.run-pending-search-index-updates'\r\n                                    | translate: { count: pendingSearchIndexUpdates }\r\n                            }}\r\n                        </button>\r\n                        <div class=\"dropdown-divider\"></div>\r\n                    </ng-container>\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        (click)=\"rebuildSearchIndex()\"\r\n                        [disabled]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                    >\r\n                        {{ 'catalog.rebuild-search-index' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </div>\r\n        <div class=\"flex wrap\">\r\n            <clr-checkbox-wrapper class=\"mt2\">\r\n                <input type=\"checkbox\" clrCheckbox [(ngModel)]=\"groupByProduct\" (ngModelChange)=\"refresh()\" />\r\n                <label>{{ 'catalog.group-by-product' | translate }}</label>\r\n            </clr-checkbox-wrapper>\r\n            <vdr-language-selector\r\n                [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n                [currentLanguageCode]=\"contentLanguage$ | async\"\r\n                (languageCodeChange)=\"setLanguage($event)\"\r\n            ></vdr-language-selector>\r\n        </div>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"product-list\"></vdr-action-bar-items>\r\n        <a\r\n            class=\"btn btn-primary\"\r\n            [routerLink]=\"['./create']\"\r\n            *vdrIfPermissions=\"['CreateCatalog', 'CreateProduct']\"\r\n        >\r\n            <clr-icon shape=\"plus\"></clr-icon>\r\n            <span class=\"full-label\">{{ 'catalog.create-new-product' | translate }}</span>\r\n        </a>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<vdr-data-table\r\n    [items]=\"items$ | async\"\r\n    [itemsPerPage]=\"itemsPerPage$ | async\"\r\n    [totalItems]=\"totalItems$ | async\"\r\n    [currentPage]=\"currentPage$ | async\"\r\n    (pageChange)=\"setPageNumber($event)\"\r\n    (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n>\r\n    <ng-template let-result=\"item\">\r\n        <td class=\"left align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <div class=\"image-placeholder\">\r\n                <img\r\n                    *ngIf=\"\r\n                        groupByProduct\r\n                            ? result.productAsset\r\n                            : result.productVariantAsset || result.productAsset as asset;\r\n                        else imagePlaceholder\r\n                    \"\r\n                    [src]=\"asset | assetPreview: 'tiny'\"\r\n                />\r\n                <ng-template #imagePlaceholder>\r\n                    <div class=\"placeholder\">\r\n                        <clr-icon shape=\"image\" size=\"48\"></clr-icon>\r\n                    </div>\r\n                </ng-template>\r\n            </div>\r\n        </td>\r\n        <td class=\"left align-middle\" [class.disabled]=\"!result.enabled\">\r\n            {{ groupByProduct ? result.productName : result.productVariantName }}\r\n        </td>\r\n        <td class=\"align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <vdr-chip *ngIf=\"!result.enabled\">{{ 'common.disabled' | translate }}</vdr-chip>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <vdr-table-row-action\r\n                iconShape=\"edit\"\r\n                [label]=\"'common.edit' | translate\"\r\n                [linkTo]=\"['./', result.productId]\"\r\n            ></vdr-table-row-action>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <vdr-dropdown>\r\n                <button type=\"button\" class=\"btn btn-link btn-sm\" vdrDropdownTrigger>\r\n                    {{ 'common.actions' | translate }}\r\n                    <clr-icon shape=\"caret down\"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <button\r\n                        type=\"button\"\r\n                        class=\"delete-button\"\r\n                        (click)=\"deleteProduct(result.productId)\"\r\n                        [disabled]=\"!(['DeleteCatalog', 'DeleteProduct'] | hasPermission)\"\r\n                        vdrDropdownItem\r\n                    >\r\n                        <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                        {{ 'common.delete' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n",
                styles: [".image-placeholder{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder .placeholder{text-align:center;color:var(--color-grey-300)}.search-form{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input{min-width:300px}@media screen and (max-width: 768px){.search-input{min-width:100px}}.search-settings-menu{margin:0 12px}td.disabled{background-color:var(--color-component-bg-200)}.search-index-button{position:relative}.search-index-button vdr-status-badge{right:0;top:0}.run-updates-button{position:relative}.run-updates-button vdr-status-badge{left:10px;top:10px}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.DataService }, { type: ɵngcc2.ModalService }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.JobQueueService }, { type: ɵngcc2.ServerConfigService }, { type: ɵngcc1.Router }, { type: ɵngcc1.ActivatedRoute }]; }, { productSearchInput: [{
            type: ViewChild,
            args: ['productSearchInputComponent', { static: true }]
        }] }); })();

class ProductOptionsEditorComponent extends BaseDetailComponent {
    constructor(route, router, serverConfigService, dataService, productDetailService, formBuilder, changeDetector, notificationService) {
        super(route, router, serverConfigService, dataService);
        this.route = route;
        this.router = router;
        this.serverConfigService = serverConfigService;
        this.dataService = dataService;
        this.productDetailService = productDetailService;
        this.formBuilder = formBuilder;
        this.changeDetector = changeDetector;
        this.notificationService = notificationService;
        this.autoUpdateVariantNames = true;
        this.updatePermission = [Permission.UpdateCatalog, Permission.UpdateProduct];
        this.optionGroupCustomFields = this.getCustomFieldConfig('ProductOptionGroup');
        this.optionCustomFields = this.getCustomFieldConfig('ProductOption');
    }
    ngOnInit() {
        this.optionGroups$ = this.route.snapshot.data.entity.pipe(map((product) => product.optionGroups));
        this.detailForm = new FormGroup({
            optionGroups: new FormArray([]),
        });
        super.init();
    }
    getOptionGroups() {
        const optionGroups = this.detailForm.get('optionGroups');
        return optionGroups.controls;
    }
    getOptions(optionGroup) {
        const options = optionGroup.get('options');
        return options.controls;
    }
    save() {
        if (this.detailForm.invalid || this.detailForm.pristine) {
            return;
        }
        // tslint:disable-next-line:no-non-null-assertion
        const $product = this.dataService.product.getProduct(this.id).mapSingle(data => data.product);
        combineLatest(this.entity$, this.languageCode$, $product)
            .pipe(take(1), mergeMap(([{ optionGroups }, languageCode, product]) => {
            var _a, _b, _c, _d, _e;
            const updateOperations = [];
            for (const optionGroupForm of this.getOptionGroups()) {
                if (((_a = optionGroupForm.get('name')) === null || _a === void 0 ? void 0 : _a.dirty) || ((_b = optionGroupForm.get('code')) === null || _b === void 0 ? void 0 : _b.dirty)) {
                    const optionGroupEntity = optionGroups.find(og => og.id === optionGroupForm.value.id);
                    if (optionGroupEntity) {
                        const input = this.getUpdatedOptionGroup(optionGroupEntity, optionGroupForm, languageCode);
                        updateOperations.push(this.dataService.product.updateProductOptionGroup(input));
                    }
                }
                for (const optionForm of this.getOptions(optionGroupForm)) {
                    if (((_c = optionForm.get('name')) === null || _c === void 0 ? void 0 : _c.dirty) || ((_d = optionForm.get('code')) === null || _d === void 0 ? void 0 : _d.dirty)) {
                        const optionGroup = (_e = optionGroups
                            .find(og => og.id === optionGroupForm.value.id)) === null || _e === void 0 ? void 0 : _e.options.find(o => o.id === optionForm.value.id);
                        if (optionGroup) {
                            const input = this.getUpdatedOption(optionGroup, optionForm, languageCode);
                            updateOperations.push(this.productDetailService.updateProductOption(Object.assign(Object.assign({}, input), { autoUpdate: this.autoUpdateVariantNames }), product, languageCode));
                        }
                    }
                }
            }
            return forkJoin(updateOperations);
        }))
            .subscribe(() => {
            this.detailForm.markAsPristine();
            this.changeDetector.markForCheck();
            this.notificationService.success(marker('common.notify-update-success'), {
                entity: 'ProductOptionGroup',
            });
        }, err => {
            this.notificationService.error(marker('common.notify-update-error'), {
                entity: 'ProductOptionGroup',
            });
        });
    }
    getUpdatedOptionGroup(optionGroup, optionGroupFormGroup, languageCode) {
        const input = createUpdatedTranslatable({
            translatable: optionGroup,
            updatedFields: optionGroupFormGroup.value,
            customFieldConfig: this.optionGroupCustomFields,
            languageCode,
            defaultTranslation: {
                languageCode,
                name: optionGroup.name || '',
            },
        });
        return input;
    }
    getUpdatedOption(option, optionFormGroup, languageCode) {
        const input = createUpdatedTranslatable({
            translatable: option,
            updatedFields: optionFormGroup.value,
            customFieldConfig: this.optionGroupCustomFields,
            languageCode,
            defaultTranslation: {
                languageCode,
                name: option.name || '',
            },
        });
        return input;
    }
    setFormValues(entity, languageCode) {
        const groupsFormArray = new FormArray([]);
        for (const optionGroup of entity.optionGroups) {
            const groupTranslation = findTranslation(optionGroup, languageCode);
            const group = {
                id: optionGroup.id,
                createdAt: optionGroup.createdAt,
                updatedAt: optionGroup.updatedAt,
                code: optionGroup.code,
                name: groupTranslation ? groupTranslation.name : '',
            };
            const optionsFormArray = new FormArray([]);
            for (const option of optionGroup.options) {
                const optionTranslation = findTranslation(option, languageCode);
                const optionControl = this.formBuilder.group({
                    id: option.id,
                    createdAt: option.createdAt,
                    updatedAt: option.updatedAt,
                    code: option.code,
                    name: optionTranslation ? optionTranslation.name : '',
                });
                optionsFormArray.push(optionControl);
            }
            const groupControl = this.formBuilder.group(group);
            groupControl.addControl('options', optionsFormArray);
            groupsFormArray.push(groupControl);
        }
        this.detailForm.setControl('optionGroups', groupsFormArray);
    }
}
ProductOptionsEditorComponent.ɵfac = function ProductOptionsEditorComponent_Factory(t) { return new (t || ProductOptionsEditorComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ServerConfigService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ProductDetailService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService)); };
ProductOptionsEditorComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProductOptionsEditorComponent, selectors: [["vdr-product-options-editor"]], features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 16, vars: 14, consts: [[3, "availableLanguageCodes", "currentLanguageCode", "languageCodeChange"], [1, "flex", "center"], [1, "mr2"], ["clrCheckbox", "", "type", "checkbox", "id", "auto-update", 3, "ngModel", "ngModelChange"], ["class", "btn btn-primary", 3, "disabled", "click", 4, "vdrIfPermissions"], ["class", "form", 3, "formGroup", 4, "ngIf"], [1, "btn", "btn-primary", 3, "disabled", "click"], [1, "form", 3, "formGroup"], ["formGroupName", "optionGroups", 1, "clr-row"], ["class", "clr-col-12 clr-col-xl-6", 4, "ngFor", "ngForOf"], [1, "clr-col-12", "clr-col-xl-6"], [1, "card", 3, "formArrayName"], [1, "card-header", "option-group-header"], [3, "entity"], [1, "ml2"], [1, "card-block"], ["for", "name", 3, "label"], ["type", "text", "formControlName", "name", 3, "id", "readonly"], ["for", "code", 3, "label"], ["type", "text", "formControlName", "code", 3, "id", "readonly"], ["formGroupName", "options", 1, "facet-values-list", "table", "mt2", "mb4"], ["class", "facet-value", 3, "formGroupName", 4, "ngFor", "ngForOf"], [1, "facet-value", 3, "formGroupName"], [1, "align-middle"], ["type", "text", "formControlName", "name", 3, "readonly"], ["type", "text", "formControlName", "code"]], template: function ProductOptionsEditorComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-left");
        ɵngcc0.ɵɵelementStart(2, "vdr-language-selector", 0);
        ɵngcc0.ɵɵlistener("languageCodeChange", function ProductOptionsEditorComponent_Template_vdr_language_selector_languageCodeChange_2_listener($event) { return ctx.setLanguage($event); });
        ɵngcc0.ɵɵpipe(3, "async");
        ɵngcc0.ɵɵpipe(4, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(5, "vdr-ab-right");
        ɵngcc0.ɵɵelementStart(6, "div", 1);
        ɵngcc0.ɵɵelementStart(7, "div", 2);
        ɵngcc0.ɵɵelementStart(8, "clr-checkbox-wrapper");
        ɵngcc0.ɵɵelementStart(9, "input", 3);
        ɵngcc0.ɵɵlistener("ngModelChange", function ProductOptionsEditorComponent_Template_input_ngModelChange_9_listener($event) { return ctx.autoUpdateVariantNames = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(10, "label");
        ɵngcc0.ɵɵtext(11);
        ɵngcc0.ɵɵpipe(12, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(13, ProductOptionsEditorComponent_button_13_Template, 3, 4, "button", 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(14, ProductOptionsEditorComponent_form_14_Template, 3, 2, "form", 5);
        ɵngcc0.ɵɵpipe(15, "async");
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("availableLanguageCodes", ɵngcc0.ɵɵpipeBind1(3, 6, ctx.availableLanguages$))("currentLanguageCode", ɵngcc0.ɵɵpipeBind1(4, 8, ctx.languageCode$));
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵproperty("ngModel", ctx.autoUpdateVariantNames);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(12, 10, "catalog.auto-update-product-variant-name"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("vdrIfPermissions", ctx.updatePermission);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(15, 12, ctx.optionGroups$));
    } }, directives: [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarLeftComponent, ɵngcc2.LanguageSelectorComponent, ɵngcc2.ActionBarRightComponent, ɵngcc7.ClrCheckboxWrapper, ɵngcc2.FormFieldControlDirective, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, ɵngcc7.ClrLabel, ɵngcc2.IfPermissionsDirective, ɵngcc4.NgIf, ɵngcc3.ɵNgNoValidate, ɵngcc3.NgControlStatusGroup, ɵngcc3.FormGroupDirective, ɵngcc3.FormGroupName, ɵngcc4.NgForOf, ɵngcc3.FormArrayName, ɵngcc2.EntityInfoComponent, ɵngcc2.FormFieldComponent, ɵngcc3.DefaultValueAccessor, ɵngcc3.FormControlName], pipes: [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe, ɵngcc2.HasPermissionPipe], styles: [".option-group-header[_ngcontent-%COMP%]{display:flex;align-items:baseline}"], changeDetection: 0 });
ProductOptionsEditorComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: Router },
    { type: ServerConfigService },
    { type: DataService },
    { type: ProductDetailService },
    { type: FormBuilder },
    { type: ChangeDetectorRef },
    { type: NotificationService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductOptionsEditorComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-product-options-editor',
                template: "<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-language-selector\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"languageCode$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <div class=\"flex center\">\r\n            <div class=\"mr2\">\r\n                <clr-checkbox-wrapper>\r\n                    <input\r\n                        clrCheckbox\r\n                        type=\"checkbox\"\r\n                        id=\"auto-update\"\r\n                        [(ngModel)]=\"autoUpdateVariantNames\"\r\n                    />\r\n                    <label>{{ 'catalog.auto-update-product-variant-name' | translate }}</label>\r\n                </clr-checkbox-wrapper>\r\n            </div>\r\n            <button\r\n                *vdrIfPermissions=\"updatePermission\"\r\n                class=\"btn btn-primary\"\r\n                (click)=\"save()\"\r\n                [disabled]=\"detailForm.pristine || detailForm.invalid\"\r\n            >\r\n                {{ 'common.update' | translate }}\r\n            </button>\r\n        </div>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n<form class=\"form\" [formGroup]=\"detailForm\" *ngIf=\"optionGroups$ | async as optionGroups\">\r\n    <div formGroupName=\"optionGroups\" class=\"clr-row\">\r\n        <div class=\"clr-col-12 clr-col-xl-6\" *ngFor=\"let optionGroup of getOptionGroups(); index as i\">\r\n            <section class=\"card\" [formArrayName]=\"i\">\r\n                <div class=\"card-header option-group-header\">\r\n                    <vdr-entity-info [entity]=\"optionGroup.value\"></vdr-entity-info>\r\n                    <div class=\"ml2\">{{ optionGroup.value.code }}</div>\r\n                </div>\r\n                <div class=\"card-block\">\r\n                    <vdr-form-field [label]=\"'common.name' | translate\" for=\"name\">\r\n                        <input\r\n                            [id]=\"'name-' + i\"\r\n                            type=\"text\"\r\n                            formControlName=\"name\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                        />\r\n                    </vdr-form-field>\r\n                    <vdr-form-field [label]=\"'common.code' | translate\" for=\"code\">\r\n                        <input\r\n                            [id]=\"'code-' + i\"\r\n                            type=\"text\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                            formControlName=\"code\"\r\n                        />\r\n                    </vdr-form-field>\r\n                </div>\r\n                <section class=\"card-block\">\r\n                    <table class=\"facet-values-list table mt2 mb4\" formGroupName=\"options\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th></th>\r\n                                <th>{{ 'common.name' | translate }}</th>\r\n                                <th>{{ 'common.code' | translate }}</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr\r\n                                class=\"facet-value\"\r\n                                *ngFor=\"let option of getOptions(optionGroup); let i = index\"\r\n                                [formGroupName]=\"i\"\r\n                            >\r\n                                <td class=\"align-middle\">\r\n                                    <vdr-entity-info [entity]=\"option.value\"></vdr-entity-info>\r\n                                </td>\r\n                                <td class=\"align-middle\">\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        formControlName=\"name\"\r\n                                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                    />\r\n                                </td>\r\n                                <td class=\"align-middle\"><input type=\"text\" formControlName=\"code\" /></td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </section>\r\n            </section>\r\n        </div>\r\n    </div>\r\n</form>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".option-group-header{display:flex;align-items:baseline}\n"]
            }]
    }], function () { return [{ type: ɵngcc1.ActivatedRoute }, { type: ɵngcc1.Router }, { type: ɵngcc2.ServerConfigService }, { type: ɵngcc2.DataService }, { type: ProductDetailService }, { type: ɵngcc3.FormBuilder }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.NotificationService }]; }, null); })();

class ConfirmVariantDeletionDialogComponent {
    constructor() {
        this.variants = [];
    }
    confirm() {
        this.resolveWith(true);
    }
    cancel() {
        this.resolveWith();
    }
}
ConfirmVariantDeletionDialogComponent.ɵfac = function ConfirmVariantDeletionDialogComponent_Factory(t) { return new (t || ConfirmVariantDeletionDialogComponent)(); };
ConfirmVariantDeletionDialogComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ConfirmVariantDeletionDialogComponent, selectors: [["vdr-confirm-variant-deletion-dialog"]], decls: 6, vars: 4, consts: [["vdrDialogTitle", ""], [4, "ngFor", "ngForOf"], ["vdrDialogButtons", ""], ["type", "button", 1, "btn", 3, "click"], ["type", "submit", 1, "btn", "btn-primary", 3, "click"]], template: function ConfirmVariantDeletionDialogComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, ConfirmVariantDeletionDialogComponent_ng_template_0_Template, 2, 3, "ng-template", 0);
        ɵngcc0.ɵɵtext(1);
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵelementStart(3, "ul");
        ɵngcc0.ɵɵtemplate(4, ConfirmVariantDeletionDialogComponent_li_4_Template, 2, 2, "li", 1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(5, ConfirmVariantDeletionDialogComponent_ng_template_5_Template, 6, 6, "ng-template", 2);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1("\n", ɵngcc0.ɵɵpipeBind1(2, 2, "catalog.confirm-deletion-of-unused-variants-body"), "\n");
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.variants);
    } }, directives: [ɵngcc2.DialogTitleDirective, ɵngcc4.NgForOf, ɵngcc2.DialogButtonsDirective], pipes: [ɵngcc5.TranslatePipe], styles: [""], changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ConfirmVariantDeletionDialogComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-confirm-variant-deletion-dialog',
                template: "<ng-template vdrDialogTitle>\r\n    {{ 'catalog.confirm-deletion-of-unused-variants-title' | translate }}\r\n</ng-template>\r\n{{ 'catalog.confirm-deletion-of-unused-variants-body' | translate }}\r\n<ul>\r\n    <li *ngFor=\"let variant of variants\">{{ variant.name }} ({{ variant.sku }})</li>\r\n</ul>\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button type=\"submit\" (click)=\"confirm()\" class=\"btn btn-primary\">\r\n        {{ 'common.confirm' | translate }}\r\n    </button>\r\n</ng-template>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [""]
            }]
    }], function () { return []; }, null); })();

class GeneratedVariant {
    constructor(config) {
        for (const key of Object.keys(config)) {
            this[key] = config[key];
        }
    }
}
class ProductVariantsEditorComponent {
    constructor(route, dataService, productDetailService, notificationService, modalService) {
        this.route = route;
        this.dataService = dataService;
        this.productDetailService = productDetailService;
        this.notificationService = notificationService;
        this.modalService = modalService;
        this.formValueChanged = false;
        this.generatedVariants = [];
    }
    ngOnInit() {
        this.initOptionsAndVariants();
        this.languageCode =
            this.route.snapshot.paramMap.get('lang') || getDefaultUiLanguage();
        this.dataService.settings.getActiveChannel().single$.subscribe(data => {
            this.currencyCode = data.activeChannel.currencyCode;
        });
    }
    onFormChanged(variantInfo) {
        this.formValueChanged = true;
        variantInfo.enabled = true;
    }
    canDeactivate() {
        return !this.formValueChanged;
    }
    getVariantsToAdd() {
        return this.generatedVariants.filter(v => !v.existing && v.enabled);
    }
    getVariantName(variant) {
        return variant.options.length === 0
            ? marker('catalog.default-variant')
            : variant.options.map(o => o.name).join(' ');
    }
    addOption() {
        this.optionGroups.push({
            isNew: true,
            name: '',
            values: [],
        });
    }
    generateVariants() {
        const groups = this.optionGroups.map(g => g.values);
        const previousVariants = this.generatedVariants;
        const generatedVariantFactory = (isDefault, options, existingVariant, prototypeVariant) => {
            var _a, _b, _c, _d, _e, _f;
            const prototype = this.getVariantPrototype(options, previousVariants);
            return new GeneratedVariant({
                enabled: true,
                existing: !!existingVariant,
                productVariantId: existingVariant === null || existingVariant === void 0 ? void 0 : existingVariant.id,
                isDefault,
                options,
                price: (_b = (_a = existingVariant === null || existingVariant === void 0 ? void 0 : existingVariant.price) !== null && _a !== void 0 ? _a : prototypeVariant === null || prototypeVariant === void 0 ? void 0 : prototypeVariant.price) !== null && _b !== void 0 ? _b : prototype.price,
                sku: (_d = (_c = existingVariant === null || existingVariant === void 0 ? void 0 : existingVariant.sku) !== null && _c !== void 0 ? _c : prototypeVariant === null || prototypeVariant === void 0 ? void 0 : prototypeVariant.sku) !== null && _d !== void 0 ? _d : prototype.sku,
                stock: (_f = (_e = existingVariant === null || existingVariant === void 0 ? void 0 : existingVariant.stockOnHand) !== null && _e !== void 0 ? _e : prototypeVariant === null || prototypeVariant === void 0 ? void 0 : prototypeVariant.stockOnHand) !== null && _f !== void 0 ? _f : prototype.stock,
            });
        };
        this.generatedVariants = groups.length
            ? generateAllCombinations(groups).map(options => {
                const existingVariant = this.product.variants.find(v => this.optionsAreEqual(v.options, options));
                const prototypeVariant = this.product.variants.find(v => this.optionsAreSubset(v.options, options));
                return generatedVariantFactory(false, options, existingVariant, prototypeVariant);
            })
            : [generatedVariantFactory(true, [], this.product.variants[0])];
    }
    /**
     * Returns one of the existing variants to base the newly-generated variant's
     * details off.
     */
    getVariantPrototype(options, previousVariants) {
        const variantsWithSimilarOptions = previousVariants.filter(v => options.map(o => o.name).filter(name => v.options.map(o => o.name).includes(name)));
        if (variantsWithSimilarOptions.length) {
            return pick(previousVariants[0], ['sku', 'price', 'stock']);
        }
        return {
            sku: '',
            price: 0,
            stock: 0,
        };
    }
    deleteVariant(id) {
        this.modalService
            .dialog({
            title: marker('catalog.confirm-delete-product-variant'),
            buttons: [
                { type: 'secondary', label: marker('common.cancel') },
                { type: 'danger', label: marker('common.delete'), returnValue: true },
            ],
        })
            .pipe(switchMap(response => response ? this.productDetailService.deleteProductVariant(id, this.product.id) : EMPTY), switchMap(() => this.reFetchProduct(null)))
            .subscribe(() => {
            this.notificationService.success(marker('common.notify-delete-success'), {
                entity: 'ProductVariant',
            });
            this.initOptionsAndVariants();
        }, err => {
            this.notificationService.error(marker('common.notify-delete-error'), {
                entity: 'ProductVariant',
            });
        });
    }
    save() {
        const newOptionGroups = this.optionGroups
            .filter(og => og.isNew)
            .map(og => ({
            name: og.name,
            values: [],
        }));
        this.checkUniqueSkus()
            .pipe(mergeMap(() => this.confirmDeletionOfObsoleteVariants()), mergeMap(() => this.productDetailService.createProductOptionGroups(newOptionGroups, this.languageCode)), mergeMap(createdOptionGroups => this.addOptionGroupsToProduct(createdOptionGroups)), mergeMap(createdOptionGroups => this.addNewOptionsToGroups(createdOptionGroups)), mergeMap(groupsIds => this.fetchOptionGroups(groupsIds)), mergeMap(groups => this.createNewProductVariants(groups)), mergeMap(res => this.deleteObsoleteVariants(res.createProductVariants)), mergeMap(variants => this.reFetchProduct(variants)))
            .subscribe({
            next: variants => {
                this.formValueChanged = false;
                this.notificationService.success(marker('catalog.created-new-variants-success'), {
                    count: variants.length,
                });
                this.initOptionsAndVariants();
            },
        });
    }
    checkUniqueSkus() {
        const withDuplicateSkus = this.generatedVariants.filter((variant, index) => {
            return this.generatedVariants.find(gv => gv.sku.trim() === variant.sku.trim() && gv !== variant);
        });
        if (withDuplicateSkus.length) {
            return this.modalService
                .dialog({
                title: marker('catalog.duplicate-sku-warning'),
                body: unique(withDuplicateSkus.map(v => `${v.sku}`)).join(', '),
                buttons: [{ label: marker('common.close'), returnValue: false, type: 'primary' }],
            })
                .pipe(mergeMap(res => EMPTY));
        }
        else {
            return of(true);
        }
    }
    confirmDeletionOfObsoleteVariants() {
        const obsoleteVariants = this.getObsoleteVariants();
        if (obsoleteVariants.length) {
            return this.modalService
                .fromComponent(ConfirmVariantDeletionDialogComponent, {
                locals: {
                    variants: obsoleteVariants,
                },
            })
                .pipe(mergeMap(res => {
                return res === true ? of(true) : EMPTY;
            }));
        }
        else {
            return of(true);
        }
    }
    getObsoleteVariants() {
        return this.product.variants.filter(variant => !this.generatedVariants.find(gv => gv.productVariantId === variant.id));
    }
    hasOnlyDefaultVariant(product) {
        return product.variants.length === 1 && product.optionGroups.length === 0;
    }
    addOptionGroupsToProduct(createdOptionGroups) {
        if (createdOptionGroups.length) {
            return forkJoin(createdOptionGroups.map(optionGroup => {
                return this.dataService.product.addOptionGroupToProduct({
                    productId: this.product.id,
                    optionGroupId: optionGroup.id,
                });
            })).pipe(map(() => createdOptionGroups));
        }
        else {
            return of([]);
        }
    }
    addNewOptionsToGroups(createdOptionGroups) {
        const newOptions = this.optionGroups
            .map(og => {
            const createdGroup = createdOptionGroups.find(cog => cog.name === og.name);
            const productOptionGroupId = createdGroup ? createdGroup.id : og.id;
            if (!productOptionGroupId) {
                throw new Error('Could not get a productOptionGroupId');
            }
            return og.values
                .filter(v => !v.locked)
                .map(v => ({
                productOptionGroupId,
                code: normalizeString(v.name, '-'),
                translations: [{ name: v.name, languageCode: this.languageCode }],
            }));
        })
            .reduce((flat, options) => [...flat, ...options], []);
        const allGroupIds = [
            ...createdOptionGroups.map(g => g.id),
            ...this.optionGroups.map(g => g.id).filter(notNullOrUndefined),
        ];
        if (newOptions.length) {
            return forkJoin(newOptions.map(input => this.dataService.product.addOptionToGroup(input))).pipe(map(() => allGroupIds));
        }
        else {
            return of(allGroupIds);
        }
    }
    fetchOptionGroups(groupsIds) {
        return forkJoin(groupsIds.map(id => this.dataService.product
            .getProductOptionGroup(id)
            .mapSingle(data => data.productOptionGroup)
            .pipe(filter(notNullOrUndefined))));
    }
    createNewProductVariants(groups) {
        const options = groups
            .filter(notNullOrUndefined)
            .map(og => og.options)
            .reduce((flat, o) => [...flat, ...o], []);
        const variants = this.generatedVariants
            .filter(v => v.enabled && !v.existing)
            .map(v => ({
            price: v.price,
            sku: v.sku,
            stock: v.stock,
            optionIds: v.options
                .map(name => options.find(o => o.name === name.name))
                .filter(notNullOrUndefined)
                .map(o => o.id),
        }));
        return this.productDetailService.createProductVariants(this.product, variants, options, this.languageCode);
    }
    deleteObsoleteVariants(input) {
        const obsoleteVariants = this.getObsoleteVariants();
        if (obsoleteVariants.length) {
            const deleteOperations = obsoleteVariants.map(v => this.dataService.product.deleteProductVariant(v.id).pipe(map(() => input)));
            return forkJoin(...deleteOperations);
        }
        else {
            return of(input);
        }
    }
    reFetchProduct(input) {
        // Re-fetch the Product to force an update to the view.
        const id = this.route.snapshot.paramMap.get('id');
        if (id) {
            return this.dataService.product.getProduct(id).single$.pipe(map(() => input));
        }
        else {
            return of(input);
        }
    }
    initOptionsAndVariants() {
        this.dataService.product
            // tslint:disable-next-line:no-non-null-assertion
            .getProductVariantsOptions(this.route.snapshot.paramMap.get('id'))
            // tslint:disable-next-line:no-non-null-assertion
            .mapSingle(({ product }) => product)
            .subscribe(p => {
            this.product = p;
            this.optionGroups = p.optionGroups.map(og => {
                return {
                    id: og.id,
                    isNew: false,
                    name: og.name,
                    values: og.options.map(o => ({
                        id: o.id,
                        name: o.name,
                        locked: true,
                    })),
                };
            });
            this.generateVariants();
        });
    }
    optionsAreEqual(a, b) {
        return this.toOptionString(a) === this.toOptionString(b);
    }
    optionsAreSubset(a, b) {
        return this.toOptionString(b).includes(this.toOptionString(a));
    }
    toOptionString(o) {
        return o
            .map(x => x.name)
            .sort()
            .join('|');
    }
}
ProductVariantsEditorComponent.ɵfac = function ProductVariantsEditorComponent_Factory(t) { return new (t || ProductVariantsEditorComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService), ɵngcc0.ɵɵdirectiveInject(ProductDetailService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NotificationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService)); };
ProductVariantsEditorComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProductVariantsEditorComponent, selectors: [["vdr-product-variants-editor"]], decls: 31, vars: 27, consts: [[1, "btn", "btn-primary", 3, "disabled", "click"], ["class", "option-groups", 4, "ngFor", "ngForOf"], [1, "btn", "btn-primary-outline", "btn-sm", 3, "click"], ["shape", "plus"], [1, "variants-preview"], [1, "table"], [3, "disabled", 4, "ngFor", "ngForOf"], [1, "option-groups"], [1, "name"], ["clrInput", "", "name", "name", 3, "ngModel", "readonly", "ngModelChange"], [1, "values"], [3, "ngModel", "groupName", "disabled", "ngModelChange"], ["optionValueInputComponent", ""], ["type", "checkbox", "name", "enabled", "clrCheckbox", "", 3, "ngModel", "ngModelChange", 4, "ngIf"], [4, "ngIf"], ["type", "checkbox", "name", "enabled", "clrCheckbox", "", 3, "ngModel", "ngModelChange"], ["clrInput", "", "type", "text", "name", "sku", "required", "", 3, "ngModel", "placeholder", "ngModelChange"], ["clrInput", "", "name", "price", 3, "ngModel", "currencyCode", "ngModelChange"], ["clrInput", "", "type", "number", "name", "stock", "min", "0", "step", "1", 3, "ngModel", "ngModelChange"], ["vdrDropdownTrigger", "", 1, "icon-button"], ["shape", "ellipsis-vertical"], ["vdrPosition", "bottom-right"], ["type", "button", "vdrDropdownItem", "", 1, "delete-button", 3, "click"], ["shape", "trash", 1, "is-danger"]], template: function ProductVariantsEditorComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "vdr-action-bar");
        ɵngcc0.ɵɵelementStart(1, "vdr-ab-right");
        ɵngcc0.ɵɵelementStart(2, "button", 0);
        ɵngcc0.ɵɵlistener("click", function ProductVariantsEditorComponent_Template_button_click_2_listener() { return ctx.save(); });
        ɵngcc0.ɵɵtext(3);
        ɵngcc0.ɵɵpipe(4, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(5, ProductVariantsEditorComponent_div_5_Template, 12, 11, "div", 1);
        ɵngcc0.ɵɵelementStart(6, "button", 2);
        ɵngcc0.ɵɵlistener("click", function ProductVariantsEditorComponent_Template_button_click_6_listener() { return ctx.addOption(); });
        ɵngcc0.ɵɵelement(7, "clr-icon", 3);
        ɵngcc0.ɵɵtext(8);
        ɵngcc0.ɵɵpipe(9, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(10, "div", 4);
        ɵngcc0.ɵɵelementStart(11, "table", 5);
        ɵngcc0.ɵɵelementStart(12, "thead");
        ɵngcc0.ɵɵelementStart(13, "tr");
        ɵngcc0.ɵɵelementStart(14, "th");
        ɵngcc0.ɵɵtext(15);
        ɵngcc0.ɵɵpipe(16, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(17, "th");
        ɵngcc0.ɵɵtext(18);
        ɵngcc0.ɵɵpipe(19, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(20, "th");
        ɵngcc0.ɵɵtext(21);
        ɵngcc0.ɵɵpipe(22, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(23, "th");
        ɵngcc0.ɵɵtext(24);
        ɵngcc0.ɵɵpipe(25, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(26, "th");
        ɵngcc0.ɵɵtext(27);
        ɵngcc0.ɵɵpipe(28, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(29, "th");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(30, ProductVariantsEditorComponent_tr_30_Template, 17, 13, "tr", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("disabled", !ctx.formValueChanged || ctx.getVariantsToAdd().length === 0);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind2(4, 10, "common.add-new-variants", ɵngcc0.ɵɵpureFunction1(25, _c5, ctx.getVariantsToAdd().length)), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.optionGroups);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(9, 13, "catalog.add-option"), "\n");
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(16, 15, "common.create"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(19, 17, "catalog.variant"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(22, 19, "catalog.sku"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(25, 21, "catalog.price"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(28, 23, "catalog.stock-on-hand"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.generatedVariants);
    } }, directives: function () { return [ɵngcc2.ActionBarComponent, ɵngcc2.ActionBarRightComponent, ɵngcc4.NgForOf, ɵngcc7.ClrIconCustomTag, ɵngcc7.ClrLabel, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc7.ClrInput, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, OptionValueInputComponent, ɵngcc4.NgIf, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc7.ClrInputContainer, ɵngcc3.RequiredValidator, ɵngcc2.CurrencyInputComponent, ɵngcc3.MinValidator, ɵngcc3.NumberValueAccessor, ɵngcc2.DropdownComponent, ɵngcc2.DropdownTriggerDirective, ɵngcc2.DropdownMenuComponent, ɵngcc2.DropdownItemDirective]; }, pipes: function () { return [ɵngcc5.TranslatePipe, ɵngcc2.LocaleCurrencyPipe]; }, styles: [".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"] });
ProductVariantsEditorComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: DataService },
    { type: ProductDetailService },
    { type: NotificationService },
    { type: ModalService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductVariantsEditorComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-product-variants-editor',
                template: "<vdr-action-bar>\r\n    <vdr-ab-right>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            (click)=\"save()\"\r\n            [disabled]=\"!formValueChanged || getVariantsToAdd().length === 0\"\r\n        >\r\n            {{ 'common.add-new-variants' | translate: { count: getVariantsToAdd().length } }}\r\n        </button>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<div *ngFor=\"let group of optionGroups\" class=\"option-groups\">\r\n    <div class=\"name\">\r\n        <label>{{ 'catalog.option' | translate }}</label>\r\n        <input clrInput [(ngModel)]=\"group.name\" name=\"name\" [readonly]=\"!group.isNew\" />\r\n    </div>\r\n    <div class=\"values\">\r\n        <label>{{ 'catalog.option-values' | translate }}</label>\r\n        <vdr-option-value-input\r\n            #optionValueInputComponent\r\n            [(ngModel)]=\"group.values\"\r\n            (ngModelChange)=\"generateVariants()\"\r\n            [groupName]=\"group.name\"\r\n            [disabled]=\"group.name === ''\"\r\n        ></vdr-option-value-input>\r\n    </div>\r\n</div>\r\n<button\r\n    class=\"btn btn-primary-outline btn-sm\"\r\n    (click)=\"addOption()\"\r\n>\r\n    <clr-icon shape=\"plus\"></clr-icon>\r\n    {{ 'catalog.add-option' | translate }}\r\n</button>\r\n\r\n<div class=\"variants-preview\">\r\n    <table class=\"table\">\r\n        <thead>\r\n            <tr>\r\n                <th>{{ 'common.create' | translate }}</th>\r\n                <th>{{ 'catalog.variant' | translate }}</th>\r\n                <th>{{ 'catalog.sku' | translate }}</th>\r\n                <th>{{ 'catalog.price' | translate }}</th>\r\n                <th>{{ 'catalog.stock-on-hand' | translate }}</th>\r\n                <th></th>\r\n            </tr>\r\n        </thead>\r\n        <tr *ngFor=\"let variant of generatedVariants\" [class.disabled]=\"!variant.enabled || variant.existing\">\r\n            <td>\r\n                <input\r\n                    type=\"checkbox\"\r\n                    *ngIf=\"!variant.existing\"\r\n                    [(ngModel)]=\"variant.enabled\"\r\n                    name=\"enabled\"\r\n                    clrCheckbox\r\n                    (ngModelChange)=\"formValueChanged = true\"\r\n                />\r\n            </td>\r\n            <td>\r\n                {{ getVariantName(variant) | translate }}\r\n            </td>\r\n            <td>\r\n                <clr-input-container *ngIf=\"!variant.existing\">\r\n                    <input\r\n                        clrInput\r\n                        type=\"text\"\r\n                        [(ngModel)]=\"variant.sku\"\r\n                        [placeholder]=\"'catalog.sku' | translate\"\r\n                        name=\"sku\"\r\n                        required\r\n                        (ngModelChange)=\"onFormChanged(variant)\"\r\n                    />\r\n                </clr-input-container>\r\n                <span *ngIf=\"variant.existing\">{{ variant.sku }}</span>\r\n            </td>\r\n            <td>\r\n                <clr-input-container *ngIf=\"!variant.existing\">\r\n                    <vdr-currency-input\r\n                        clrInput\r\n                        [(ngModel)]=\"variant.price\"\r\n                        name=\"price\"\r\n                        [currencyCode]=\"currencyCode\"\r\n                        (ngModelChange)=\"onFormChanged(variant)\"\r\n                    ></vdr-currency-input>\r\n                </clr-input-container>\r\n                <span *ngIf=\"variant.existing\">{{ variant.price | localeCurrency: currencyCode }}</span>\r\n            </td>\r\n            <td>\r\n                <clr-input-container *ngIf=\"!variant.existing\">\r\n                    <input\r\n                        clrInput\r\n                        type=\"number\"\r\n                        [(ngModel)]=\"variant.stock\"\r\n                        name=\"stock\"\r\n                        min=\"0\"\r\n                        step=\"1\"\r\n                        (ngModelChange)=\"onFormChanged(variant)\"\r\n                    />\r\n                </clr-input-container>\r\n                <span *ngIf=\"variant.existing\">{{ variant.stock }}</span>\r\n            </td>\r\n            <td>\r\n                <vdr-dropdown *ngIf=\"variant.productVariantId as productVariantId\">\r\n                    <button class=\"icon-button\" vdrDropdownTrigger>\r\n                        <clr-icon shape=\"ellipsis-vertical\"></clr-icon>\r\n                    </button>\r\n                    <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                        <button\r\n                            type=\"button\"\r\n                            class=\"delete-button\"\r\n                            (click)=\"deleteVariant(productVariantId)\"\r\n                            vdrDropdownItem\r\n                        >\r\n                            <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                            {{ 'common.delete' | translate }}\r\n                        </button>\r\n                    </vdr-dropdown-menu>\r\n                </vdr-dropdown>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.Default,
                styles: [".option-groups{display:flex}.option-groups:first-of-type{margin-top:24px}.values{flex:1;margin:0 6px}.variants-preview tr.disabled td{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}\n"]
            }]
    }], function () { return [{ type: ɵngcc1.ActivatedRoute }, { type: ɵngcc2.DataService }, { type: ProductDetailService }, { type: ɵngcc2.NotificationService }, { type: ɵngcc2.ModalService }]; }, null); })();

class AssetResolver extends BaseEntityResolver {
    constructor(router, dataService) {
        super(router, {
            __typename: 'Asset',
            id: '',
            createdAt: '',
            updatedAt: '',
            name: '',
            type: AssetType.IMAGE,
            fileSize: 0,
            mimeType: '',
            width: 0,
            height: 0,
            source: '',
            preview: '',
            focalPoint: null,
        }, id => dataService.product.getAsset(id).mapStream(data => data.asset));
    }
}
AssetResolver.ɵfac = function AssetResolver_Factory(t) { return new (t || AssetResolver)(ɵngcc0.ɵɵinject(ɵngcc1.Router), ɵngcc0.ɵɵinject(ɵngcc2.DataService)); };
AssetResolver.ɵprov = i0.ɵɵdefineInjectable({ factory: function AssetResolver_Factory() { return new AssetResolver(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.DataService)); }, token: AssetResolver, providedIn: "root" });
AssetResolver.ctorParameters = () => [
    { type: Router },
    { type: DataService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(AssetResolver, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc2.DataService }]; }, null); })();

class CollectionResolver extends BaseEntityResolver {
    constructor(router, dataService) {
        super(router, {
            __typename: 'Collection',
            id: '',
            createdAt: '',
            updatedAt: '',
            languageCode: getDefaultUiLanguage(),
            name: '',
            slug: '',
            isPrivate: false,
            description: '',
            featuredAsset: null,
            assets: [],
            translations: [],
            filters: [],
            parent: {},
            children: null,
        }, id => dataService.collection.getCollection(id).mapStream(data => data.collection));
    }
}
CollectionResolver.ɵfac = function CollectionResolver_Factory(t) { return new (t || CollectionResolver)(ɵngcc0.ɵɵinject(ɵngcc1.Router), ɵngcc0.ɵɵinject(ɵngcc2.DataService)); };
CollectionResolver.ɵprov = i0.ɵɵdefineInjectable({ factory: function CollectionResolver_Factory() { return new CollectionResolver(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.DataService)); }, token: CollectionResolver, providedIn: "root" });
CollectionResolver.ctorParameters = () => [
    { type: Router },
    { type: DataService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CollectionResolver, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc2.DataService }]; }, null); })();

class FacetResolver extends BaseEntityResolver {
    constructor(router, dataService) {
        super(router, {
            __typename: 'Facet',
            id: '',
            createdAt: '',
            updatedAt: '',
            isPrivate: false,
            languageCode: getDefaultUiLanguage(),
            name: '',
            code: '',
            translations: [],
            values: [],
        }, (id) => dataService.facet.getFacet(id).mapStream((data) => data.facet));
    }
}
FacetResolver.ɵfac = function FacetResolver_Factory(t) { return new (t || FacetResolver)(ɵngcc0.ɵɵinject(ɵngcc1.Router), ɵngcc0.ɵɵinject(ɵngcc2.DataService)); };
FacetResolver.ɵprov = i0.ɵɵdefineInjectable({ factory: function FacetResolver_Factory() { return new FacetResolver(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.DataService)); }, token: FacetResolver, providedIn: "root" });
FacetResolver.ctorParameters = () => [
    { type: Router },
    { type: DataService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(FacetResolver, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc2.DataService }]; }, null); })();

class ProductResolver extends BaseEntityResolver {
    constructor(dataService, router) {
        super(router, {
            __typename: 'Product',
            id: '',
            createdAt: '',
            updatedAt: '',
            enabled: true,
            languageCode: getDefaultUiLanguage(),
            name: '',
            slug: '',
            featuredAsset: null,
            assets: [],
            description: '',
            translations: [],
            optionGroups: [],
            facetValues: [],
            variantList: { items: [], totalItems: 0 },
            channels: [],
        }, id => dataService.product
            .getProduct(id, { take: 10 })
            .refetchOnChannelChange()
            .mapStream(data => data.product));
    }
}
ProductResolver.ɵfac = function ProductResolver_Factory(t) { return new (t || ProductResolver)(ɵngcc0.ɵɵinject(ɵngcc2.DataService), ɵngcc0.ɵɵinject(ɵngcc1.Router)); };
ProductResolver.ɵprov = i0.ɵɵdefineInjectable({ factory: function ProductResolver_Factory() { return new ProductResolver(i0.ɵɵinject(i2.DataService), i0.ɵɵinject(i1.Router)); }, token: ProductResolver, providedIn: "root" });
ProductResolver.ctorParameters = () => [
    { type: DataService },
    { type: Router }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductResolver, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc2.DataService }, { type: ɵngcc1.Router }]; }, null); })();

class ProductVariantsResolver extends BaseEntityResolver {
    constructor(router, dataService) {
        super(router, {
            __typename: 'Product',
            id: '',
            createdAt: '',
            updatedAt: '',
            name: '',
            optionGroups: [],
            variants: [],
        }, id => dataService.product.getProductVariantsOptions(id).mapStream(data => data.product));
    }
}
ProductVariantsResolver.ɵfac = function ProductVariantsResolver_Factory(t) { return new (t || ProductVariantsResolver)(ɵngcc0.ɵɵinject(ɵngcc1.Router), ɵngcc0.ɵɵinject(ɵngcc2.DataService)); };
ProductVariantsResolver.ɵprov = i0.ɵɵdefineInjectable({ factory: function ProductVariantsResolver_Factory() { return new ProductVariantsResolver(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.DataService)); }, token: ProductVariantsResolver, providedIn: "root" });
ProductVariantsResolver.ctorParameters = () => [
    { type: Router },
    { type: DataService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductVariantsResolver, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc2.DataService }]; }, null); })();

const ɵ0$1 = {
    breadcrumb: marker('breadcrumb.products'),
}, ɵ1 = {
    breadcrumb: productBreadcrumb,
}, ɵ2 = {
    breadcrumb: productVariantEditorBreadcrumb,
}, ɵ3 = {
    breadcrumb: productOptionsEditorBreadcrumb,
}, ɵ4 = {
    breadcrumb: marker('breadcrumb.facets'),
}, ɵ5 = {
    breadcrumb: facetBreadcrumb,
}, ɵ6 = {
    breadcrumb: marker('breadcrumb.collections'),
}, ɵ7 = {
    breadcrumb: collectionBreadcrumb,
}, ɵ8 = {
    breadcrumb: marker('breadcrumb.assets'),
}, ɵ9 = {
    breadcrumb: assetBreadcrumb,
};
const catalogRoutes = [
    {
        path: 'products',
        component: ProductListComponent,
        data: ɵ0$1,
    },
    {
        path: 'products/:id',
        component: ProductDetailComponent,
        resolve: createResolveData(ProductResolver),
        canDeactivate: [CanDeactivateDetailGuard],
        data: ɵ1,
    },
    {
        path: 'products/:id/manage-variants',
        component: ProductVariantsEditorComponent,
        resolve: createResolveData(ProductVariantsResolver),
        canDeactivate: [CanDeactivateDetailGuard],
        data: ɵ2,
    },
    {
        path: 'products/:id/options',
        component: ProductOptionsEditorComponent,
        resolve: createResolveData(ProductVariantsResolver),
        canDeactivate: [CanDeactivateDetailGuard],
        data: ɵ3,
    },
    {
        path: 'facets',
        component: FacetListComponent,
        data: ɵ4,
    },
    {
        path: 'facets/:id',
        component: FacetDetailComponent,
        resolve: createResolveData(FacetResolver),
        canDeactivate: [CanDeactivateDetailGuard],
        data: ɵ5,
    },
    {
        path: 'collections',
        component: CollectionListComponent,
        data: ɵ6,
    },
    {
        path: 'collections/:id',
        component: CollectionDetailComponent,
        resolve: createResolveData(CollectionResolver),
        canDeactivate: [CanDeactivateDetailGuard],
        data: ɵ7,
    },
    {
        path: 'assets',
        component: AssetListComponent,
        data: ɵ8,
    },
    {
        path: 'assets/:id',
        component: AssetDetailComponent,
        resolve: createResolveData(AssetResolver),
        data: ɵ9,
    },
];
function productBreadcrumb(data, params) {
    return detailBreadcrumb({
        entity: data.entity,
        id: params.id,
        breadcrumbKey: 'breadcrumb.products',
        getName: product => product.name,
        route: 'products',
    });
}
function productVariantEditorBreadcrumb(data, params) {
    return data.entity.pipe(map((entity) => {
        return [
            {
                label: marker('breadcrumb.products'),
                link: ['../', 'products'],
            },
            {
                label: `${entity.name}`,
                link: ['../', 'products', params.id, { tab: 'variants' }],
            },
            {
                label: marker('breadcrumb.manage-variants'),
                link: ['manage-variants'],
            },
        ];
    }));
}
function productOptionsEditorBreadcrumb(data, params) {
    return data.entity.pipe(map((entity) => {
        return [
            {
                label: marker('breadcrumb.products'),
                link: ['../', 'products'],
            },
            {
                label: `${entity.name}`,
                link: ['../', 'products', params.id, { tab: 'variants' }],
            },
            {
                label: marker('breadcrumb.product-options'),
                link: ['options'],
            },
        ];
    }));
}
function facetBreadcrumb(data, params) {
    return detailBreadcrumb({
        entity: data.entity,
        id: params.id,
        breadcrumbKey: 'breadcrumb.facets',
        getName: facet => facet.name,
        route: 'facets',
    });
}
function collectionBreadcrumb(data, params) {
    return detailBreadcrumb({
        entity: data.entity,
        id: params.id,
        breadcrumbKey: 'breadcrumb.collections',
        getName: collection => collection.name,
        route: 'collections',
    });
}
function assetBreadcrumb(data, params) {
    return detailBreadcrumb({
        entity: data.entity,
        id: params.id,
        breadcrumbKey: 'breadcrumb.assets',
        getName: asset => asset.name,
        route: 'assets',
    });
}

/**
 * A component which displays the Assets, and allows assets to be removed and
 * added, and for the featured asset to be set.
 *
 * Note: rather complex code for drag drop is due to a limitation of the default CDK implementation
 * which is addressed by a work-around from here: https://github.com/angular/components/issues/13372#issuecomment-483998378
 */
class AssetsComponent {
    constructor(modalService, changeDetector) {
        this.modalService = modalService;
        this.changeDetector = changeDetector;
        this.compact = false;
        this.change = new EventEmitter();
        this.assets = [];
    }
    set assetsSetter(val) {
        // create a new non-readonly array of assets
        this.assets = (val || []).slice();
    }
    selectAssets() {
        this.modalService
            .fromComponent(AssetPickerDialogComponent, {
            size: 'xl',
        })
            .subscribe(result => {
            if (result && result.length) {
                this.assets = unique(this.assets.concat(result), 'id');
                if (!this.featuredAsset) {
                    this.featuredAsset = result[0];
                }
                this.emitChangeEvent(this.assets, this.featuredAsset);
                this.changeDetector.markForCheck();
            }
        });
    }
    setAsFeatured(asset) {
        this.featuredAsset = asset;
        this.emitChangeEvent(this.assets, asset);
    }
    isFeatured(asset) {
        return !!this.featuredAsset && this.featuredAsset.id === asset.id;
    }
    previewAsset(asset) {
        this.modalService
            .fromComponent(AssetPreviewDialogComponent, {
            size: 'xl',
            closable: true,
            locals: { asset },
        })
            .subscribe();
    }
    removeAsset(asset) {
        this.assets = this.assets.filter(a => a.id !== asset.id);
        if (this.featuredAsset && this.featuredAsset.id === asset.id) {
            this.featuredAsset = this.assets.length > 0 ? this.assets[0] : undefined;
        }
        this.emitChangeEvent(this.assets, this.featuredAsset);
    }
    emitChangeEvent(assets, featuredAsset) {
        this.change.emit({
            assets,
            featuredAsset,
        });
    }
    dropListDropped(event) {
        moveItemInArray(this.assets, event.previousContainer.data, event.container.data);
        this.emitChangeEvent(this.assets, this.featuredAsset);
    }
}
AssetsComponent.ɵfac = function AssetsComponent_Factory(t) { return new (t || AssetsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
AssetsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: AssetsComponent, selectors: [["vdr-assets"]], hostVars: 2, hostBindings: function AssetsComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("compact", ctx.compact);
    } }, inputs: { compact: "compact", assetsSetter: ["assets", "assetsSetter"], featuredAsset: "featuredAsset", updatePermissions: "updatePermissions" }, outputs: { change: "change" }, decls: 5, vars: 2, consts: [["class", "card", 4, "ngIf", "ngIfElse"], ["compactView", ""], ["assetList", ""], [1, "card"], [1, "card-img"], [1, "featured-asset"], [3, "src", "click", 4, "ngIf"], ["class", "placeholder", 3, "click", 4, "ngIf"], [1, "card-block"], [4, "ngTemplateOutlet"], ["class", "card-footer", 4, "vdrIfPermissions"], [3, "src", "click"], [1, "placeholder", 3, "click"], ["shape", "image", "size", "128"], [1, "card-footer"], [1, "btn", 3, "click"], ["shape", "attachment"], [1, "featured-asset", "compact"], ["class", "compact-select btn btn-icon btn-sm btn-block", 3, "title", "click", 4, "vdrIfPermissions"], ["shape", "image", "size", "150"], [1, "compact-select", "btn", "btn-icon", "btn-sm", "btn-block", 3, "title", "click"], ["cdkDropListGroup", "", 1, "all-assets"], ["class", "drop-list", "cdkDropList", "", "cdkDropListOrientation", "horizontal", 3, "cdkDropListData", "cdkDropListDisabled", "cdkDropListDropped", 4, "ngFor", "ngForOf"], ["cdkDropList", "", "cdkDropListOrientation", "horizontal", 1, "drop-list", 3, "cdkDropListData", "cdkDropListDisabled", "cdkDropListDropped"], ["cdkDrag", ""], ["vdrDropdownTrigger", "", "tabindex", "0", 1, "asset-thumb", 3, "title"], [3, "src"], ["vdrPosition", "bottom-right"], ["type", "button", "vdrDropdownItem", "", 3, "click"], ["type", "button", "vdrDropdownItem", "", 3, "disabled", "click"], [1, "dropdown-divider"], ["type", "button", "vdrDropdownItem", "", 1, "remove-asset", 3, "disabled", "click"]], template: function AssetsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, AssetsComponent_div_0_Template, 8, 4, "div", 0);
        ɵngcc0.ɵɵtemplate(1, AssetsComponent_ng_template_1_Template, 5, 4, "ng-template", null, 1, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵtemplate(3, AssetsComponent_ng_template_3_Template, 2, 3, "ng-template", null, 2, ɵngcc0.ɵɵtemplateRefExtractor);
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(2);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.compact)("ngIfElse", _r1);
    } }, directives: [ɵngcc4.NgIf, ɵngcc4.NgTemplateOutlet, ɵngcc2.IfPermissionsDirective, ɵngcc7.ClrIconCustomTag, ɵngcc8.CdkDropListGroup, ɵngcc4.NgForOf, ɵngcc8.CdkDropList, ɵngcc2.DropdownComponent, ɵngcc8.CdkDrag, ɵngcc2.DropdownTriggerDirective, ɵngcc2.DropdownMenuComponent, ɵngcc2.DropdownItemDirective], pipes: [ɵngcc2.AssetPreviewPipe, ɵngcc5.TranslatePipe, ɵngcc2.HasPermissionPipe], styles: ["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:60px}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:54px}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{width:50px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){display:none}"], changeDetection: 0 });
AssetsComponent.ctorParameters = () => [
    { type: ModalService },
    { type: ChangeDetectorRef }
];
AssetsComponent.propDecorators = {
    assetsSetter: [{ type: Input, args: ['assets',] }],
    featuredAsset: [{ type: Input }],
    compact: [{ type: HostBinding, args: ['class.compact',] }, { type: Input }],
    change: [{ type: Output }],
    updatePermissions: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(AssetsComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-assets',
                template: "<div class=\"card\" *ngIf=\"!compact; else compactView\">\r\n    <div class=\"card-img\">\r\n        <div class=\"featured-asset\">\r\n            <img\r\n                *ngIf=\"featuredAsset\"\r\n                [src]=\"featuredAsset | assetPreview:'small'\"\r\n                (click)=\"previewAsset(featuredAsset)\"\r\n            />\r\n            <div class=\"placeholder\" *ngIf=\"!featuredAsset\" (click)=\"selectAssets()\">\r\n                <clr-icon shape=\"image\" size=\"128\"></clr-icon>\r\n                <div>{{ 'catalog.no-featured-asset' | translate }}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"card-block\"><ng-container *ngTemplateOutlet=\"assetList\"></ng-container></div>\r\n    <div class=\"card-footer\" *vdrIfPermissions=\"updatePermissions\">\r\n        <button class=\"btn\" (click)=\"selectAssets()\">\r\n            <clr-icon shape=\"attachment\"></clr-icon>\r\n            {{ 'asset.add-asset' | translate }}\r\n        </button>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #compactView>\r\n    <div class=\"featured-asset compact\">\r\n        <img\r\n            *ngIf=\"featuredAsset\"\r\n            [src]=\"featuredAsset | assetPreview:'thumb'\"\r\n            (click)=\"previewAsset(featuredAsset)\"\r\n        />\r\n\r\n        <div class=\"placeholder\" *ngIf=\"!featuredAsset\" (click)=\"selectAssets()\"><clr-icon shape=\"image\" size=\"150\"></clr-icon></div>\r\n    </div>\r\n    <ng-container *ngTemplateOutlet=\"assetList\"></ng-container>\r\n    <button\r\n        *vdrIfPermissions=\"updatePermissions\"\r\n        class=\"compact-select btn btn-icon btn-sm btn-block\"\r\n        [title]=\"'asset.add-asset' | translate\"\r\n        (click)=\"selectAssets()\"\r\n    >\r\n        <clr-icon shape=\"attachment\"></clr-icon>\r\n        {{ 'asset.add-asset' | translate }}\r\n    </button>\r\n</ng-template>\r\n\r\n<ng-template #assetList>\r\n    <div class=\"all-assets\" [class.compact]=\"compact\" cdkDropListGroup>\r\n        <div\r\n            *ngFor=\"let asset of assets; let index = index\"\r\n            class=\"drop-list\"\r\n            cdkDropList\r\n            cdkDropListOrientation=\"horizontal\"\r\n            [cdkDropListData]=\"index\"\r\n            [cdkDropListDisabled]=\"!(updatePermissions | hasPermission)\"\r\n            (cdkDropListDropped)=\"dropListDropped($event)\"\r\n        >\r\n            <vdr-dropdown cdkDrag>\r\n                <div\r\n                    class=\"asset-thumb\"\r\n                    vdrDropdownTrigger\r\n                    [class.featured]=\"isFeatured(asset)\"\r\n                    [title]=\"\"\r\n                    tabindex=\"0\"\r\n                >\r\n                    <img [src]=\"asset | assetPreview:'tiny'\" />\r\n                </div>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <button type=\"button\" vdrDropdownItem (click)=\"previewAsset(asset)\">\r\n                        {{ 'asset.preview' | translate }}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        [disabled]=\"isFeatured(asset) || !(updatePermissions | hasPermission)\"\r\n                        vdrDropdownItem\r\n                        (click)=\"setAsFeatured(asset)\"\r\n                    >\r\n                        {{ 'asset.set-as-featured-asset' | translate }}\r\n                    </button>\r\n                    <div class=\"dropdown-divider\"></div>\r\n                    <button\r\n                        type=\"button\"\r\n                        class=\"remove-asset\"\r\n                        vdrDropdownItem\r\n                        [disabled]=\"!(updatePermissions | hasPermission)\"\r\n                        (click)=\"removeAsset(asset)\"\r\n                    >\r\n                        {{ 'asset.remove-asset' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </div>\r\n    </div>\r\n</ng-template>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host{width:340px;display:block}:host.compact{width:162px}.placeholder{text-align:center;color:var(--color-grey-300)}.featured-asset{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset .compact-select{position:absolute;bottom:6px;right:6px;margin:0}.all-assets{display:flex;flex-wrap:wrap}.all-assets .drop-list{min-width:60px}.all-assets .asset-thumb{margin:3px;padding:0;border:2px solid var(--color-component-border-100);cursor:pointer}.all-assets .asset-thumb.featured{border-color:var(--color-primary-500)}.all-assets .remove-asset{color:var(--color-warning-500)}.all-assets.compact .drop-list{min-width:54px}.all-assets.compact .asset-thumb{margin:1px;border-width:1px}.all-assets.compact .cdk-drag-placeholder{width:50px}.all-assets.compact .cdk-drag-placeholder .asset-thumb{width:50px}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box:last-child{border:none}.all-assets.cdk-drop-list-dragging vdr-dropdown:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging>*:not(.cdk-drag-placeholder){display:none}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.ModalService }, { type: ɵngcc0.ChangeDetectorRef }]; }, { compact: [{
            type: HostBinding,
            args: ['class.compact']
        }, {
            type: Input
        }], change: [{
            type: Output
        }], assetsSetter: [{
            type: Input,
            args: ['assets']
        }], featuredAsset: [{
            type: Input
        }], updatePermissions: [{
            type: Input
        }] }); })();

class CollectionContentsComponent {
    constructor(route, router, dataService) {
        this.route = route;
        this.router = router;
        this.dataService = dataService;
        this.filterTermControl = new FormControl('');
        this.collectionIdChange$ = new BehaviorSubject('');
        this.refresh$ = new BehaviorSubject(true);
        this.destroy$ = new Subject();
    }
    ngOnInit() {
        this.contentsCurrentPage$ = this.route.paramMap.pipe(map(qpm => qpm.get('contentsPage')), map(page => (!page ? 1 : +page)), startWith(1), distinctUntilChanged());
        this.contentsItemsPerPage$ = this.route.paramMap.pipe(map(qpm => qpm.get('contentsPerPage')), map(perPage => (!perPage ? 10 : +perPage)), startWith(10), distinctUntilChanged());
        const filterTerm$ = this.filterTermControl.valueChanges.pipe(debounceTime(250), tap(() => this.setContentsPageNumber(1)), startWith(''));
        const collection$ = combineLatest(this.collectionIdChange$, this.contentsCurrentPage$, this.contentsItemsPerPage$, filterTerm$, this.refresh$).pipe(takeUntil(this.destroy$), switchMap(([id, currentPage, itemsPerPage, filterTerm]) => {
            const take = itemsPerPage;
            const skip = (currentPage - 1) * itemsPerPage;
            if (id) {
                return this.dataService.collection
                    .getCollectionContents(id, take, skip, filterTerm)
                    .mapSingle(data => data.collection);
            }
            else {
                return of(null);
            }
        }));
        this.contents$ = collection$.pipe(map(result => (result ? result.productVariants.items : [])));
        this.contentsTotalItems$ = collection$.pipe(map(result => (result ? result.productVariants.totalItems : 0)));
    }
    ngOnChanges(changes) {
        if ('collectionId' in changes) {
            this.collectionIdChange$.next(changes.collectionId.currentValue);
        }
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    setContentsPageNumber(page) {
        this.setParam('contentsPage', page);
    }
    setContentsItemsPerPage(perPage) {
        this.setParam('contentsPerPage', perPage);
    }
    refresh() {
        this.refresh$.next(true);
    }
    setParam(key, value) {
        this.router.navigate(['./', Object.assign(Object.assign({}, this.route.snapshot.params), { [key]: value })], {
            relativeTo: this.route,
            queryParamsHandling: 'merge',
        });
    }
}
CollectionContentsComponent.ɵfac = function CollectionContentsComponent_Factory(t) { return new (t || CollectionContentsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService)); };
CollectionContentsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CollectionContentsComponent, selectors: [["vdr-collection-contents"]], contentQueries: function CollectionContentsComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, TemplateRef, 7);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.headerTemplate = _t.first);
    } }, inputs: { collectionId: "collectionId" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 12, vars: 22, consts: [[1, "contents-header"], [1, "header-title-row"], [4, "ngTemplateOutlet", "ngTemplateOutletContext"], ["type", "text", 3, "placeholder", "formControl"], [3, "items", "itemsPerPage", "totalItems", "currentPage", "pageChange", "itemsPerPageChange"], [1, "left", "align-middle"], [1, "right", "align-middle"], ["iconShape", "edit", 3, "label", "linkTo"]], template: function CollectionContentsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵtemplate(2, CollectionContentsComponent_ng_container_2_Template, 1, 0, "ng-container", 2);
        ɵngcc0.ɵɵpipe(3, "async");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(4, "input", 3);
        ɵngcc0.ɵɵpipe(5, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "vdr-data-table", 4);
        ɵngcc0.ɵɵlistener("pageChange", function CollectionContentsComponent_Template_vdr_data_table_pageChange_6_listener($event) { return ctx.setContentsPageNumber($event); })("itemsPerPageChange", function CollectionContentsComponent_Template_vdr_data_table_itemsPerPageChange_6_listener($event) { return ctx.setContentsItemsPerPage($event); });
        ɵngcc0.ɵɵpipe(7, "async");
        ɵngcc0.ɵɵpipe(8, "async");
        ɵngcc0.ɵɵpipe(9, "async");
        ɵngcc0.ɵɵpipe(10, "async");
        ɵngcc0.ɵɵtemplate(11, CollectionContentsComponent_ng_template_11_Template, 5, 9, "ng-template");
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx.headerTemplate)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(20, _c27, ɵngcc0.ɵɵpipeBind1(3, 8, ctx.contentsTotalItems$)));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind1(5, 10, "catalog.filter-by-name"))("formControl", ctx.filterTermControl);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("items", ɵngcc0.ɵɵpipeBind1(7, 12, ctx.contents$))("itemsPerPage", ɵngcc0.ɵɵpipeBind1(8, 14, ctx.contentsItemsPerPage$))("totalItems", ɵngcc0.ɵɵpipeBind1(9, 16, ctx.contentsTotalItems$))("currentPage", ɵngcc0.ɵɵpipeBind1(10, 18, ctx.contentsCurrentPage$));
    } }, directives: [ɵngcc4.NgTemplateOutlet, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc3.NgControlStatus, ɵngcc3.FormControlDirective, ɵngcc2.DataTableComponent, ɵngcc2.TableRowActionComponent], pipes: [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe], styles: [".contents-header[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     table{margin-top:-1px}"], changeDetection: 0 });
CollectionContentsComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: Router },
    { type: DataService }
];
CollectionContentsComponent.propDecorators = {
    collectionId: [{ type: Input }],
    headerTemplate: [{ type: ContentChild, args: [TemplateRef, { static: true },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CollectionContentsComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-collection-contents',
                template: "<div class=\"contents-header\">\r\n    <div class=\"header-title-row\">\r\n        <ng-container\r\n            *ngTemplateOutlet=\"headerTemplate; context: { $implicit: contentsTotalItems$ | async }\"\r\n        ></ng-container>\r\n    </div>\r\n    <input\r\n        type=\"text\"\r\n        [placeholder]=\"'catalog.filter-by-name' | translate\"\r\n        [formControl]=\"filterTermControl\"\r\n    />\r\n</div>\r\n<vdr-data-table\r\n    [items]=\"contents$ | async\"\r\n    [itemsPerPage]=\"contentsItemsPerPage$ | async\"\r\n    [totalItems]=\"contentsTotalItems$ | async\"\r\n    [currentPage]=\"contentsCurrentPage$ | async\"\r\n    (pageChange)=\"setContentsPageNumber($event)\"\r\n    (itemsPerPageChange)=\"setContentsItemsPerPage($event)\"\r\n>\r\n    <ng-template let-variant=\"item\">\r\n        <td class=\"left align-middle\">{{ variant.name }}</td>\r\n        <td class=\"right align-middle\">\r\n            <vdr-table-row-action\r\n                iconShape=\"edit\"\r\n                [label]=\"'common.edit' | translate\"\r\n                [linkTo]=\"['/catalog/products', variant.productId, { tab: 'variants' }]\"\r\n            ></vdr-table-row-action>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".contents-header{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header .header-title-row{display:flex;justify-content:space-between;align-items:center}.contents-header .clr-input{width:100%}:host ::ng-deep table{margin-top:-1px}\n"]
            }]
    }], function () { return [{ type: ɵngcc1.ActivatedRoute }, { type: ɵngcc1.Router }, { type: ɵngcc2.DataService }]; }, { collectionId: [{
            type: Input
        }], headerTemplate: [{
            type: ContentChild,
            args: [TemplateRef, { static: true }]
        }] }); })();

/**
 * Builds a tree from an array of nodes which have a parent.
 * Based on https://stackoverflow.com/a/31247960/772859, modified to preserve ordering.
 */
function arrayToTree(nodes, currentState) {
    var _a, _b;
    const topLevelNodes = [];
    const mappedArr = {};
    const currentStateMap = treeToMap(currentState);
    // First map the nodes of the array to an object -> create a hash table.
    for (const node of nodes) {
        mappedArr[node.id] = Object.assign(Object.assign({}, node), { children: [] });
    }
    for (const id of nodes.map(n => n.id)) {
        if (mappedArr.hasOwnProperty(id)) {
            const mappedElem = mappedArr[id];
            mappedElem.expanded = (_b = (_a = currentStateMap.get(id)) === null || _a === void 0 ? void 0 : _a.expanded) !== null && _b !== void 0 ? _b : false;
            const parent = mappedElem.parent;
            if (!parent) {
                continue;
            }
            // If the element is not at the root level, add it to its parent array of children.
            const parentIsRoot = !mappedArr[parent.id];
            if (!parentIsRoot) {
                if (mappedArr[parent.id]) {
                    mappedArr[parent.id].children.push(mappedElem);
                }
                else {
                    mappedArr[parent.id] = { children: [mappedElem] };
                }
            }
            else {
                topLevelNodes.push(mappedElem);
            }
        }
    }
    // tslint:disable-next-line:no-non-null-assertion
    const rootId = topLevelNodes.length ? topLevelNodes[0].parent.id : undefined;
    return { id: rootId, children: topLevelNodes };
}
/**
 * Converts an existing tree (as generated by the arrayToTree function) into a flat
 * Map. This is used to persist certain states (e.g. `expanded`) when re-building the
 * tree.
 */
function treeToMap(tree) {
    const nodeMap = new Map();
    function visit(node) {
        nodeMap.set(node.id, node);
        node.children.forEach(visit);
    }
    if (tree) {
        visit(tree);
    }
    return nodeMap;
}

class CollectionTreeComponent {
    constructor() {
        this.expandAll = false;
        this.rearrange = new EventEmitter();
        this.deleteCollection = new EventEmitter();
        this.allMoveListItems = [];
    }
    ngOnChanges(changes) {
        if ('collections' in changes && this.collections) {
            this.collectionTree = arrayToTree(this.collections, this.collectionTree);
            this.allMoveListItems = [];
        }
    }
    onDrop(event) {
        const item = event.item.data;
        const newParent = event.container.data;
        const newParentId = newParent.id;
        if (newParentId == null) {
            throw new Error(`Could not determine the ID of the root Collection`);
        }
        this.rearrange.emit({
            collectionId: item.id,
            parentId: newParentId,
            index: event.currentIndex,
        });
    }
    onMove(event) {
        this.rearrange.emit(event);
    }
    onDelete(id) {
        this.deleteCollection.emit(id);
    }
    getMoveListItems(collection) {
        if (this.allMoveListItems.length === 0) {
            this.allMoveListItems = this.calculateAllMoveListItems();
        }
        return this.allMoveListItems.filter(item => {
            var _a;
            return item.id !== collection.id &&
                !item.ancestorIdPath.has(collection.id) &&
                item.id !== ((_a = collection.parent) === null || _a === void 0 ? void 0 : _a.id);
        });
    }
    calculateAllMoveListItems() {
        const visit = (node, parentPath, ancestorIdPath, output) => {
            const path = parentPath.concat(node.name);
            output.push({ path: path.slice(1).join(' / ') || 'root', id: node.id, ancestorIdPath });
            node.children.forEach(child => visit(child, path, new Set([...ancestorIdPath, node.id]), output));
            return output;
        };
        return visit(this.collectionTree, [], new Set(), []);
    }
    isRootNode(node) {
        return !node.hasOwnProperty('parent');
    }
}
CollectionTreeComponent.ɵfac = function CollectionTreeComponent_Factory(t) { return new (t || CollectionTreeComponent)(); };
CollectionTreeComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CollectionTreeComponent, selectors: [["vdr-collection-tree"]], inputs: { expandAll: "expandAll", collections: "collections", activeCollectionId: "activeCollectionId" }, outputs: { rearrange: "rearrange", deleteCollection: "deleteCollection" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 1, vars: 1, consts: [["cdkDropListGroup", "", 3, "expandAll", "collectionTree", "activeCollectionId", 4, "ngIf"], ["cdkDropListGroup", "", 3, "expandAll", "collectionTree", "activeCollectionId"]], template: function CollectionTreeComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, CollectionTreeComponent_vdr_collection_tree_node_0_Template, 1, 3, "vdr-collection-tree-node", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.collectionTree);
    } }, directives: function () { return [ɵngcc4.NgIf, CollectionTreeNodeComponent, ɵngcc8.CdkDropListGroup]; }, styles: [""], changeDetection: 0 });
CollectionTreeComponent.propDecorators = {
    collections: [{ type: Input }],
    activeCollectionId: [{ type: Input }],
    expandAll: [{ type: Input }],
    rearrange: [{ type: Output }],
    deleteCollection: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CollectionTreeComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-collection-tree',
                template: "<vdr-collection-tree-node\r\n    *ngIf=\"collectionTree\"\r\n    cdkDropListGroup\r\n    [expandAll]=\"expandAll\"\r\n    [collectionTree]=\"collectionTree\"\r\n    [activeCollectionId]=\"activeCollectionId\"\r\n></vdr-collection-tree-node>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [""]
            }]
    }], function () { return []; }, { expandAll: [{
            type: Input
        }], rearrange: [{
            type: Output
        }], deleteCollection: [{
            type: Output
        }], collections: [{
            type: Input
        }], activeCollectionId: [{
            type: Input
        }] }); })();

class CollectionTreeNodeComponent {
    constructor(parent, root, dataService) {
        this.parent = parent;
        this.root = root;
        this.dataService = dataService;
        this.depth = 0;
        this.expandAll = false;
        this.moveListItems = [];
        if (parent) {
            this.depth = parent.depth + 1;
        }
    }
    ngOnInit() {
        this.parentName = this.collectionTree.name || '<root>';
        const permissions$ = this.dataService.client
            .userStatus()
            .mapStream(data => data.userStatus.permissions)
            .pipe(shareReplay(1));
        this.hasUpdatePermission$ = permissions$.pipe(map(perms => perms.includes(Permission.UpdateCatalog) || perms.includes(Permission.UpdateCollection)));
        this.hasDeletePermission$ = permissions$.pipe(map(perms => perms.includes(Permission.DeleteCatalog) || perms.includes(Permission.DeleteCollection)));
    }
    ngOnChanges(changes) {
        const expandAllChange = changes['expandAll'];
        if (expandAllChange) {
            if (expandAllChange.previousValue === true && expandAllChange.currentValue === false) {
                this.collectionTree.children.forEach(c => (c.expanded = false));
            }
        }
    }
    trackByFn(index, item) {
        return item.id;
    }
    getMoveListItems(collection) {
        this.moveListItems = this.root.getMoveListItems(collection);
    }
    move(collection, parentId) {
        this.root.onMove({
            index: 0,
            parentId,
            collectionId: collection.id,
        });
    }
    moveUp(collection, currentIndex) {
        if (!collection.parent) {
            return;
        }
        this.root.onMove({
            index: currentIndex - 1,
            parentId: collection.parent.id,
            collectionId: collection.id,
        });
    }
    moveDown(collection, currentIndex) {
        if (!collection.parent) {
            return;
        }
        this.root.onMove({
            index: currentIndex + 1,
            parentId: collection.parent.id,
            collectionId: collection.id,
        });
    }
    drop(event) {
        moveItemInArray(this.collectionTree.children, event.previousIndex, event.currentIndex);
        this.root.onDrop(event);
    }
    delete(id) {
        this.root.onDelete(id);
    }
}
CollectionTreeNodeComponent.ɵfac = function CollectionTreeNodeComponent_Factory(t) { return new (t || CollectionTreeNodeComponent)(ɵngcc0.ɵɵdirectiveInject(CollectionTreeNodeComponent, 12), ɵngcc0.ɵɵdirectiveInject(CollectionTreeComponent), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService)); };
CollectionTreeNodeComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CollectionTreeNodeComponent, selectors: [["vdr-collection-tree-node"]], inputs: { expandAll: "expandAll", collectionTree: "collectionTree", activeCollectionId: "activeCollectionId" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 4, vars: 6, consts: [["cdkDropList", "", 1, "tree-node", 3, "cdkDropListData", "cdkDropListDisabled", "cdkDropListDropped"], ["dropList", ""], ["class", "collection", "cdkDrag", "", 3, "private", "cdkDragData", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["cdkDrag", "", 1, "collection", 3, "cdkDragData"], [1, "collection-detail", 3, "ngClass"], [1, "name"], ["class", "icon-button folder-button", 3, "disabled", "click", 4, "ngIf", "ngIfElse"], ["folderSpacer", ""], [1, "flex-spacer"], [4, "ngIf"], ["queryParamsHandling", "preserve", 1, "btn", "btn-link", "btn-sm", 3, "routerLink"], ["shape", "view-list"], [1, "btn", "btn-link", "btn-sm", 3, "routerLink"], ["shape", "edit"], ["class", "drag-handle", "cdkDragHandle", "", 4, "vdrIfPermissions"], ["vdrDropdownTrigger", "", 1, "icon-button", 3, "click"], ["shape", "ellipsis-vertical"], ["vdrPosition", "bottom-right"], ["class", "dropdown-item", 3, "routerLink", 4, "vdrIfPermissions"], [1, "dropdown-divider"], ["type", "button", "vdrDropdownItem", "", 3, "disabled", "click"], ["shape", "caret up"], ["shape", "caret down"], [1, "dropdown-header"], ["type", "button", "vdrDropdownItem", "", 3, "disabled", "click", 4, "ngFor", "ngForOf"], ["vdrDropdownItem", "", 1, "button", 3, "disabled", "click"], ["shape", "trash", 1, "is-danger"], [3, "expandAll", "collectionTree", "activeCollectionId", 4, "ngIf"], [1, "icon-button", "folder-button", 3, "disabled", "click"], ["shape", "folder", 4, "ngIf"], ["shape", "folder-open", 4, "ngIf"], ["shape", "folder"], ["shape", "folder-open"], [1, "folder-button-spacer"], ["cdkDragHandle", "", 1, "drag-handle"], ["shape", "drag-handle", "size", "24"], [1, "dropdown-item", 3, "routerLink"], ["shape", "plus"], [1, "move-to-item"], [1, "move-icon"], ["shape", "child-arrow"], [1, "path"], [3, "expandAll", "collectionTree", "activeCollectionId"]], template: function CollectionTreeNodeComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0, 1);
        ɵngcc0.ɵɵlistener("cdkDropListDropped", function CollectionTreeNodeComponent_Template_div_cdkDropListDropped_0_listener($event) { return ctx.drop($event); });
        ɵngcc0.ɵɵpipe(2, "async");
        ɵngcc0.ɵɵtemplate(3, CollectionTreeNodeComponent_div_3_Template, 45, 51, "div", 2);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("cdkDropListData", ctx.collectionTree)("cdkDropListDisabled", !ɵngcc0.ɵɵpipeBind1(2, 4, ctx.hasUpdatePermission$));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.collectionTree.children)("ngForTrackBy", ctx.trackByFn);
    } }, directives: [ɵngcc8.CdkDropList, ɵngcc4.NgForOf, ɵngcc7.ClrDatagridItemsTrackBy, ɵngcc8.CdkDrag, ɵngcc4.NgClass, ɵngcc4.NgIf, ɵngcc1.RouterLinkWithHref, ɵngcc7.ClrIconCustomTag, ɵngcc2.IfPermissionsDirective, ɵngcc2.DropdownComponent, ɵngcc2.DropdownTriggerDirective, ɵngcc2.DropdownMenuComponent, ɵngcc2.DropdownItemDirective, ɵngcc2.ChipComponent, ɵngcc8.CdkDragHandle, CollectionTreeNodeComponent], pipes: [ɵngcc4.AsyncPipe, ɵngcc5.TranslatePipe], styles: ["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background:var(--color-component-bg-100);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.move-to-item[_ngcontent-%COMP%]{display:flex;white-space:normal;align-items:baseline}.move-to-item[_ngcontent-%COMP%]   .move-icon[_ngcontent-%COMP%]{flex:none;margin-right:3px}.move-to-item[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{line-height:18px}"], changeDetection: 0 });
CollectionTreeNodeComponent.ctorParameters = () => [
    { type: CollectionTreeNodeComponent, decorators: [{ type: SkipSelf }, { type: Optional }] },
    { type: CollectionTreeComponent },
    { type: DataService }
];
CollectionTreeNodeComponent.propDecorators = {
    collectionTree: [{ type: Input }],
    activeCollectionId: [{ type: Input }],
    expandAll: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CollectionTreeNodeComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-collection-tree-node',
                template: "<div\r\n    cdkDropList\r\n    class=\"tree-node\"\r\n    #dropList\r\n    [cdkDropListData]=\"collectionTree\"\r\n    [cdkDropListDisabled]=\"!(hasUpdatePermission$ | async)\"\r\n    (cdkDropListDropped)=\"drop($event)\"\r\n>\r\n    <div\r\n        class=\"collection\"\r\n        [class.private]=\"collection.isPrivate\"\r\n        *ngFor=\"let collection of collectionTree.children; index as i; trackBy: trackByFn\"\r\n        cdkDrag\r\n        [cdkDragData]=\"collection\"\r\n    >\r\n        <div\r\n            class=\"collection-detail\"\r\n            [ngClass]=\"'depth-' + depth\"\r\n            [class.active]=\"collection.id === activeCollectionId\"\r\n        >\r\n            <div class=\"name\">\r\n                <button\r\n                    class=\"icon-button folder-button\"\r\n                    [disabled]=\"expandAll\"\r\n                    *ngIf=\"collection.children?.length; else folderSpacer\"\r\n                    (click)=\"collection.expanded = !collection.expanded\"\r\n                >\r\n                    <clr-icon shape=\"folder\" *ngIf=\"!collection.expanded && !expandAll\"></clr-icon>\r\n                    <clr-icon shape=\"folder-open\" *ngIf=\"collection.expanded || expandAll\"></clr-icon>\r\n                </button>\r\n                <ng-template #folderSpacer>\r\n                    <div class=\"folder-button-spacer\"></div>\r\n                </ng-template>\r\n                {{ collection.name }}\r\n            </div>\r\n            <div class=\"flex-spacer\"></div>\r\n            <vdr-chip *ngIf=\"collection.isPrivate\">{{ 'catalog.private' | translate }}</vdr-chip>\r\n            <a\r\n                class=\"btn btn-link btn-sm\"\r\n                [routerLink]=\"['./', { contents: collection.id }]\"\r\n                queryParamsHandling=\"preserve\"\r\n            >\r\n                <clr-icon shape=\"view-list\"></clr-icon>\r\n                {{ 'catalog.view-contents' | translate }}\r\n            </a>\r\n            <a class=\"btn btn-link btn-sm\" [routerLink]=\"['/catalog/collections/', collection.id]\">\r\n                <clr-icon shape=\"edit\"></clr-icon>\r\n                {{ 'common.edit' | translate }}\r\n            </a>\r\n            <div class=\"drag-handle\" cdkDragHandle *vdrIfPermissions=\"['UpdateCatalog', 'UpdateCollection']\">\r\n                <clr-icon shape=\"drag-handle\" size=\"24\"></clr-icon>\r\n            </div>\r\n            <vdr-dropdown>\r\n                <button class=\"icon-button\" vdrDropdownTrigger (click)=\"getMoveListItems(collection)\">\r\n                    <clr-icon shape=\"ellipsis-vertical\"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <a\r\n                        class=\"dropdown-item\"\r\n                        [routerLink]=\"['./', 'create', { parentId: collection.id }]\"\r\n                        *vdrIfPermissions=\"['CreateCatalog', 'CreateCollection']\"\r\n                    >\r\n                        <clr-icon shape=\"plus\"></clr-icon>\r\n                        {{ 'catalog.create-new-collection' | translate }}\r\n                    </a>\r\n                    <div class=\"dropdown-divider\"></div>\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        [disabled]=\"i === 0 || !(hasUpdatePermission$ | async)\"\r\n                        (click)=\"moveUp(collection, i)\"\r\n                    >\r\n                        <clr-icon shape=\"caret up\"></clr-icon>\r\n                        {{ 'catalog.move-up' | translate }}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        [disabled]=\"\r\n                            i === collectionTree.children.length - 1 || !(hasUpdatePermission$ | async)\r\n                        \"\r\n                        (click)=\"moveDown(collection, i)\"\r\n                    >\r\n                        <clr-icon shape=\"caret down\"></clr-icon>\r\n                        {{ 'catalog.move-down' | translate }}\r\n                    </button>\r\n                    <h4 class=\"dropdown-header\">{{ 'catalog.move-to' | translate }}</h4>\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        *ngFor=\"let item of moveListItems\"\r\n                        (click)=\"move(collection, item.id)\"\r\n                        [disabled]=\"!(hasUpdatePermission$ | async)\"\r\n                    >\r\n                        <div class=\"move-to-item\">\r\n                            <div class=\"move-icon\">\r\n                                <clr-icon shape=\"child-arrow\"></clr-icon>\r\n                            </div>\r\n                            <div class=\"path\">\r\n                                {{ item.path }}\r\n                            </div>\r\n                        </div>\r\n                    </button>\r\n                    <div class=\"dropdown-divider\"></div>\r\n                    <button\r\n                        class=\"button\"\r\n                        vdrDropdownItem\r\n                        (click)=\"delete(collection.id)\"\r\n                        [disabled]=\"!(hasDeletePermission$ | async)\"\r\n                    >\r\n                        <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                        {{ 'common.delete' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </div>\r\n        <vdr-collection-tree-node\r\n            *ngIf=\"collection.expanded || expandAll\"\r\n            [expandAll]=\"expandAll\"\r\n            [collectionTree]=\"collection\"\r\n            [activeCollectionId]=\"activeCollectionId\"\r\n        ></vdr-collection-tree-node>\r\n    </div>\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host{display:block}.collection{background-color:var(--color-component-bg-100);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private{background-color:var(--color-component-bg-200)}.collection .collection-detail{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection .collection-detail.active{background-color:var(--clr-global-selection-color)}.collection .collection-detail.depth-1{padding-left:36px}.collection .collection-detail.depth-2{padding-left:60px}.collection .collection-detail.depth-3{padding-left:84px}.collection .collection-detail.depth-4{padding-left:108px}.collection .collection-detail .folder-button-spacer{display:inline-block;width:28px}.tree-node{display:block;background:var(--color-component-bg-100);overflow:hidden}.tree-node.cdk-drop-list-dragging>.collection{border-left-color:var(--color-primary-300)}.drag-placeholder{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-list.cdk-drop-list-dragging .tree-node:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.move-to-item{display:flex;white-space:normal;align-items:baseline}.move-to-item .move-icon{flex:none;margin-right:3px}.move-to-item .path{line-height:18px}\n"]
            }]
    }], function () { return [{ type: CollectionTreeNodeComponent, decorators: [{
                type: SkipSelf
            }, {
                type: Optional
            }] }, { type: CollectionTreeComponent }, { type: ɵngcc2.DataService }]; }, { expandAll: [{
            type: Input
        }], collectionTree: [{
            type: Input
        }], activeCollectionId: [{
            type: Input
        }] }); })();

const DEFAULT_VARIANT_CODE = '__DEFAULT_VARIANT__';
class GenerateProductVariantsComponent {
    constructor(dataService) {
        this.dataService = dataService;
        this.variantsChange = new EventEmitter();
        this.optionGroups = [];
        this.variantFormValues = {};
    }
    ngOnInit() {
        this.dataService.settings.getActiveChannel().single$.subscribe(data => {
            this.currencyCode = data.activeChannel.currencyCode;
        });
        this.generateVariants();
    }
    addOption() {
        this.optionGroups.push({ name: '', values: [] });
    }
    removeOption(name) {
        this.optionGroups = this.optionGroups.filter(g => g.name !== name);
        this.generateVariants();
    }
    generateVariants() {
        const totalValuesCount = this.optionGroups.reduce((sum, group) => sum + group.values.length, 0);
        const groups = totalValuesCount
            ? this.optionGroups.map(g => g.values.map(v => v.name))
            : [[DEFAULT_VARIANT_CODE]];
        this.variants = generateAllCombinations(groups).map(values => ({ id: values.join('|'), values }));
        this.variants.forEach(variant => {
            if (!this.variantFormValues[variant.id]) {
                this.variantFormValues[variant.id] = {
                    optionValues: variant.values,
                    enabled: true,
                    price: this.copyFromDefault(variant.id, 'price', 0),
                    sku: this.copyFromDefault(variant.id, 'sku', ''),
                    stock: this.copyFromDefault(variant.id, 'stock', 0),
                };
            }
        });
        this.onFormChange();
    }
    trackByFn(index, variant) {
        return variant.values.join('|');
    }
    handleEnter(event, optionValueInputComponent) {
        event.preventDefault();
        event.stopPropagation();
        optionValueInputComponent.focus();
    }
    onFormChange() {
        const variantsToCreate = this.variants.map(v => this.variantFormValues[v.id]).filter(v => v.enabled);
        this.variantsChange.emit({
            groups: this.optionGroups.map(og => ({ name: og.name, values: og.values.map(v => v.name) })),
            variants: variantsToCreate,
        });
    }
    copyFromDefault(variantId, prop, value) {
        return variantId !== DEFAULT_VARIANT_CODE
            ? this.variantFormValues[DEFAULT_VARIANT_CODE][prop]
            : value;
    }
}
GenerateProductVariantsComponent.ɵfac = function GenerateProductVariantsComponent_Factory(t) { return new (t || GenerateProductVariantsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService)); };
GenerateProductVariantsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: GenerateProductVariantsComponent, selectors: [["vdr-generate-product-variants"]], outputs: { variantsChange: "variantsChange" }, decls: 21, vars: 17, consts: [["class", "option-groups", 4, "ngFor", "ngForOf"], [1, "btn", "btn-primary-outline", "btn-sm", 3, "click"], ["shape", "plus"], [1, "variants-preview"], [1, "table"], [4, "ngIf"], [3, "disabled", 4, "ngFor", "ngForOf", "ngForTrackBy"], [1, "option-groups"], [1, "name"], ["placeholder", "e.g. Size", "clrInput", "", "name", "name", "required", "", 3, "ngModel", "ngModelChange", "keydown.enter"], [1, "values"], [3, "ngModel", "groupName", "disabled", "ngModelChange"], ["optionValueInputComponent", ""], [1, "remove-group"], [1, "btn", "btn-icon", "btn-warning-outline", 3, "title", "click"], ["shape", "trash"], ["clrInput", "", "type", "text", 3, "ngModel", "placeholder", "change", "ngModelChange"], ["clrInput", "", 3, "ngModel", "currencyCode", "ngModelChange"], ["clrInput", "", "type", "number", "min", "0", "step", "1", 3, "ngModel", "ngModelChange", "change"], ["type", "checkbox", "clrCheckbox", "", 3, "ngModel", "change", "ngModelChange"]], template: function GenerateProductVariantsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, GenerateProductVariantsComponent_div_0_Template, 16, 13, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "button", 1);
        ɵngcc0.ɵɵlistener("click", function GenerateProductVariantsComponent_Template_button_click_1_listener() { return ctx.addOption(); });
        ɵngcc0.ɵɵelement(2, "clr-icon", 2);
        ɵngcc0.ɵɵtext(3);
        ɵngcc0.ɵɵpipe(4, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(5, "div", 3);
        ɵngcc0.ɵɵelementStart(6, "table", 4);
        ɵngcc0.ɵɵelementStart(7, "thead");
        ɵngcc0.ɵɵelementStart(8, "tr");
        ɵngcc0.ɵɵtemplate(9, GenerateProductVariantsComponent_th_9_Template, 3, 3, "th", 5);
        ɵngcc0.ɵɵtemplate(10, GenerateProductVariantsComponent_th_10_Template, 3, 3, "th", 5);
        ɵngcc0.ɵɵelementStart(11, "th");
        ɵngcc0.ɵɵtext(12);
        ɵngcc0.ɵɵpipe(13, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "th");
        ɵngcc0.ɵɵtext(15);
        ɵngcc0.ɵɵpipe(16, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(17, "th");
        ɵngcc0.ɵɵtext(18);
        ɵngcc0.ɵɵpipe(19, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(20, GenerateProductVariantsComponent_tr_20_Template, 13, 11, "tr", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngForOf", ctx.optionGroups);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 9, "catalog.add-option"), "\n");
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngIf", 1 < ctx.variants.length);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", 1 < ctx.variants.length);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(13, 11, "catalog.sku"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(16, 13, "catalog.price"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(19, 15, "catalog.stock-on-hand"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.variants)("ngForTrackBy", ctx.trackByFn);
    } }, directives: function () { return [ɵngcc4.NgForOf, ɵngcc7.ClrIconCustomTag, ɵngcc4.NgIf, ɵngcc7.ClrDatagridItemsTrackBy, ɵngcc7.ClrLabel, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc7.ClrInput, ɵngcc3.RequiredValidator, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, OptionValueInputComponent, ɵngcc7.ClrInputContainer, ɵngcc2.CurrencyInputComponent, ɵngcc3.MinValidator, ɵngcc3.NumberValueAccessor, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox]; }, pipes: function () { return [ɵngcc5.TranslatePipe]; }, styles: ["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"] });
GenerateProductVariantsComponent.ctorParameters = () => [
    { type: DataService }
];
GenerateProductVariantsComponent.propDecorators = {
    variantsChange: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(GenerateProductVariantsComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-generate-product-variants',
                template: "<div *ngFor=\"let group of optionGroups\" class=\"option-groups\">\r\n    <div class=\"name\">\r\n        <label>{{ 'catalog.option' | translate }}</label>\r\n        <input\r\n            placeholder=\"e.g. Size\"\r\n            clrInput\r\n            [(ngModel)]=\"group.name\"\r\n            name=\"name\"\r\n            required\r\n            (keydown.enter)=\"handleEnter($event, optionValueInputComponent)\"\r\n        />\r\n    </div>\r\n    <div class=\"values\">\r\n        <label>{{ 'catalog.option-values' | translate }}</label>\r\n        <vdr-option-value-input\r\n            #optionValueInputComponent\r\n            [(ngModel)]=\"group.values\"\r\n            (ngModelChange)=\"generateVariants()\"\r\n            [groupName]=\"group.name\"\r\n            [disabled]=\"group.name === ''\"\r\n        ></vdr-option-value-input>\r\n    </div>\r\n    <div class=\"remove-group\">\r\n        <button\r\n            class=\"btn btn-icon btn-warning-outline\"\r\n            [title]=\"'catalog.remove-option' | translate\"\r\n            (click)=\"removeOption(group.name)\"\r\n        >\r\n            <clr-icon shape=\"trash\"></clr-icon>\r\n        </button>\r\n    </div>\r\n</div>\r\n<button class=\"btn btn-primary-outline btn-sm\" (click)=\"addOption()\">\r\n    <clr-icon shape=\"plus\"></clr-icon>\r\n    {{ 'catalog.add-option' | translate }}\r\n</button>\r\n\r\n<div class=\"variants-preview\">\r\n    <table class=\"table\">\r\n        <thead>\r\n            <tr>\r\n                <th *ngIf=\"1 < variants.length\">{{ 'common.create' | translate }}</th>\r\n                <th *ngIf=\"1 < variants.length\">{{ 'catalog.variant' | translate }}</th>\r\n                <th>{{ 'catalog.sku' | translate }}</th>\r\n                <th>{{ 'catalog.price' | translate }}</th>\r\n                <th>{{ 'catalog.stock-on-hand' | translate }}</th>\r\n            </tr>\r\n        </thead>\r\n        <tr\r\n            *ngFor=\"let variant of variants; trackBy: trackByFn\"\r\n            [class.disabled]=\"!variantFormValues[variant.id].enabled\"\r\n        >\r\n            <td *ngIf=\"1 < variants.length\">\r\n                <input\r\n                    type=\"checkbox\"\r\n                    (change)=\"onFormChange()\"\r\n                    [(ngModel)]=\"variantFormValues[variant.id].enabled\"\r\n                    clrCheckbox\r\n                />\r\n            </td>\r\n            <td *ngIf=\"1 < variants.length\">\r\n                {{ variant.values.join(' ') }}\r\n            </td>\r\n            <td>\r\n                <clr-input-container>\r\n                    <input\r\n                        clrInput\r\n                        type=\"text\"\r\n                        (change)=\"onFormChange()\"\r\n                        [(ngModel)]=\"variantFormValues[variant.id].sku\"\r\n                        [placeholder]=\"'catalog.sku' | translate\"\r\n                    />\r\n                </clr-input-container>\r\n            </td>\r\n            <td>\r\n                <clr-input-container>\r\n                    <vdr-currency-input\r\n                        clrInput\r\n                        [(ngModel)]=\"variantFormValues[variant.id].price\"\r\n                        (ngModelChange)=\"onFormChange()\"\r\n                        [currencyCode]=\"currencyCode\"\r\n                    ></vdr-currency-input>\r\n                </clr-input-container>\r\n            </td>\r\n            <td>\r\n                <clr-input-container>\r\n                    <input\r\n                        clrInput\r\n                        type=\"number\"\r\n                        [(ngModel)]=\"variantFormValues[variant.id].stock\"\r\n                        (change)=\"onFormChange()\"\r\n                        min=\"0\"\r\n                        step=\"1\"\r\n                    />\r\n                </clr-input-container>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n",
                styles: [":host{display:block;margin-bottom:120px}.option-groups{display:flex}.values{flex:1;margin:0 6px}.remove-group{padding-top:18px}.variants-preview tr.disabled td{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.DataService }]; }, { variantsChange: [{
            type: Output
        }] }); })();

const OPTION_VALUE_INPUT_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => OptionValueInputComponent),
    multi: true,
};
class OptionValueInputComponent {
    constructor(changeDetector) {
        this.changeDetector = changeDetector;
        this.groupName = '';
        this.disabled = false;
        this.input = '';
        this.isFocussed = false;
        this.lastSelected = false;
    }
    registerOnChange(fn) {
        this.onChangeFn = fn;
    }
    registerOnTouched(fn) {
        this.onTouchFn = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
        this.changeDetector.markForCheck();
    }
    writeValue(obj) {
        this.options = obj || [];
    }
    focus() {
        this.textArea.nativeElement.focus();
    }
    removeOption(option) {
        if (!option.locked) {
            this.options = this.options.filter(o => o.name !== option.name);
            this.onChangeFn(this.options);
        }
    }
    handleKey(event) {
        switch (event.key) {
            case ',':
            case 'Enter':
                this.addOptionValue();
                event.preventDefault();
                break;
            case 'Backspace':
                if (this.lastSelected) {
                    this.removeLastOption();
                    this.lastSelected = false;
                }
                else if (this.input === '') {
                    this.lastSelected = true;
                }
                break;
            default:
                this.lastSelected = false;
        }
    }
    handleBlur() {
        this.isFocussed = false;
        this.addOptionValue();
    }
    addOptionValue() {
        this.options = unique([...this.options, ...this.parseInputIntoOptions(this.input)]);
        this.input = '';
        this.onChangeFn(this.options);
    }
    parseInputIntoOptions(input) {
        return input
            .split(/[,\n]/)
            .map(s => s.trim())
            .filter(s => s !== '')
            .map(s => ({ name: s, locked: false }));
    }
    removeLastOption() {
        if (!this.options[this.options.length - 1].locked) {
            this.options = this.options.slice(0, this.options.length - 1);
        }
    }
}
OptionValueInputComponent.ɵfac = function OptionValueInputComponent_Factory(t) { return new (t || OptionValueInputComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
OptionValueInputComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: OptionValueInputComponent, selectors: [["vdr-option-value-input"]], viewQuery: function OptionValueInputComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c33, 7);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.textArea = _t.first);
    } }, inputs: { groupName: "groupName" }, features: [ɵngcc0.ɵɵProvidersFeature([OPTION_VALUE_INPUT_VALUE_ACCESSOR])], decls: 4, vars: 5, consts: [[1, "input-wrapper", 3, "click"], ["class", "chips", 4, "ngIf"], [3, "ngModel", "disabled", "keyup", "focus", "blur", "ngModelChange"], ["textArea", ""], [1, "chips"], [3, "icon", "selected", "locked", "colorFrom", "iconClick", 4, "ngFor", "ngForOf"], [3, "icon", "colorFrom", "iconClick"]], template: function OptionValueInputComponent_Template(rf, ctx) { if (rf & 1) {
        const _r7 = ɵngcc0.ɵɵgetCurrentView();
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵlistener("click", function OptionValueInputComponent_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r7); const _r1 = ɵngcc0.ɵɵreference(3); return _r1.focus(); });
        ɵngcc0.ɵɵtemplate(1, OptionValueInputComponent_div_1_Template, 2, 1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "textarea", 2, 3);
        ɵngcc0.ɵɵlistener("keyup", function OptionValueInputComponent_Template_textarea_keyup_2_listener($event) { return ctx.handleKey($event); })("focus", function OptionValueInputComponent_Template_textarea_focus_2_listener() { return ctx.isFocussed = true; })("blur", function OptionValueInputComponent_Template_textarea_blur_2_listener() { return ctx.handleBlur(); })("ngModelChange", function OptionValueInputComponent_Template_textarea_ngModelChange_2_listener($event) { return ctx.input = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵclassProp("focus", ctx.isFocussed);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", 0 < ctx.options.length);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngModel", ctx.input)("disabled", ctx.disabled);
    } }, directives: [ɵngcc4.NgIf, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, ɵngcc4.NgForOf, ɵngcc2.ChipComponent], styles: [".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}"] });
OptionValueInputComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
OptionValueInputComponent.propDecorators = {
    groupName: [{ type: Input }],
    textArea: [{ type: ViewChild, args: ['textArea', { static: true },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(OptionValueInputComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-option-value-input',
                template: "<div class=\"input-wrapper\" [class.focus]=\"isFocussed\" (click)=\"textArea.focus()\">\r\n    <div class=\"chips\" *ngIf=\"0 < options.length\">\r\n        <vdr-chip\r\n            *ngFor=\"let option of options; last as isLast\"\r\n            [icon]=\"option.locked ? 'lock' : 'times'\"\r\n            [class.selected]=\"isLast && lastSelected\"\r\n            [class.locked]=\"option.locked\"\r\n            [colorFrom]=\"groupName\"\r\n            (iconClick)=\"removeOption(option)\"\r\n        >\r\n            {{ option.name }}\r\n        </vdr-chip>\r\n    </div>\r\n    <textarea\r\n        #textArea\r\n        (keyup)=\"handleKey($event)\"\r\n        (focus)=\"isFocussed = true\"\r\n        (blur)=\"handleBlur()\"\r\n        [(ngModel)]=\"input\"\r\n        [disabled]=\"disabled\"\r\n    ></textarea>\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.Default,
                providers: [OPTION_VALUE_INPUT_VALUE_ACCESSOR],
                styles: [".input-wrapper{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper .chips{padding:5px}.input-wrapper textarea{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper textarea:focus{outline:none}.input-wrapper textarea:disabled{background-color:var(--color-component-bg-100)}vdr-chip ::ng-deep .wrapper{margin:0 3px}vdr-chip.locked{opacity:.8}vdr-chip.selected ::ng-deep .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}\n"]
            }]
    }], function () { return [{ type: ɵngcc0.ChangeDetectorRef }]; }, { groupName: [{
            type: Input
        }], textArea: [{
            type: ViewChild,
            args: ['textArea', { static: true }]
        }] }); })();

const ɵ0 = SingleSearchSelectionModelFactory;
class ProductSearchInputComponent {
    constructor() {
        this.searchTermChange = new EventEmitter();
        this.facetValueChange = new EventEmitter();
        this.lastTerm = '';
        this.lastFacetValueIds = [];
        this.filterFacetResults = (term, item) => {
            if (!this.isFacetValueItem(item)) {
                return false;
            }
            const cix = term.indexOf(':');
            const facetName = cix > -1 ? term.toLowerCase().slice(0, cix) : null;
            const facetVal = cix > -1 ? term.toLowerCase().slice(cix + 1) : term.toLowerCase();
            if (facetName) {
                return (item.facetValue.facet.name.toLowerCase().includes(facetName) &&
                    item.facetValue.name.toLocaleLowerCase().includes(facetVal));
            }
            return (item.facetValue.name.toLowerCase().includes(term.toLowerCase()) ||
                item.facetValue.facet.name.toLowerCase().includes(term.toLowerCase()));
        };
        this.isFacetValueItem = (input) => {
            return typeof input === 'object' && !!input && input.hasOwnProperty('facetValue');
        };
    }
    setSearchTerm(term) {
        if (term) {
            this.selectComponent.select({ label: term, value: { label: term } });
        }
        else {
            const currentTerm = this.selectComponent.selectedItems.find(i => !this.isFacetValueItem(i.value));
            if (currentTerm) {
                this.selectComponent.unselect(currentTerm);
            }
        }
    }
    setFacetValues(ids) {
        const items = this.selectComponent.items;
        this.selectComponent.selectedItems.forEach(item => {
            if (this.isFacetValueItem(item.value) && !ids.includes(item.value.facetValue.id)) {
                this.selectComponent.unselect(item);
            }
        });
        ids.map(id => {
            return items === null || items === void 0 ? void 0 : items.find(item => this.isFacetValueItem(item) && item.facetValue.id === id);
        })
            .filter(notNullOrUndefined)
            .forEach(item => {
            const isSelected = this.selectComponent.selectedItems.find(i => {
                const val = i.value;
                if (this.isFacetValueItem(val)) {
                    return val.facetValue.id === item.facetValue.id;
                }
                return false;
            });
            if (!isSelected) {
                this.selectComponent.select({ label: '', value: item });
            }
        });
    }
    onSelectChange(selectedItems) {
        if (!Array.isArray(selectedItems)) {
            selectedItems = [selectedItems];
        }
        const searchTermItem = selectedItems.find(item => !this.isFacetValueItem(item));
        const searchTerm = searchTermItem ? searchTermItem.label : '';
        const facetValueIds = selectedItems.filter(this.isFacetValueItem).map(i => i.facetValue.id);
        if (searchTerm !== this.lastTerm) {
            this.searchTermChange.emit(searchTerm);
            this.lastTerm = searchTerm;
        }
        if (this.lastFacetValueIds.join(',') !== facetValueIds.join(',')) {
            this.facetValueChange.emit(facetValueIds);
            this.lastFacetValueIds = facetValueIds;
        }
    }
    addTagFn(item) {
        return { label: item };
    }
    isSearchHeaderSelected() {
        return this.selectComponent.itemsList.markedIndex === -1;
    }
}
ProductSearchInputComponent.ɵfac = function ProductSearchInputComponent_Factory(t) { return new (t || ProductSearchInputComponent)(); };
ProductSearchInputComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProductSearchInputComponent, selectors: [["vdr-product-search-input"]], viewQuery: function ProductSearchInputComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c34, 7);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.selectComponent = _t.first);
    } }, inputs: { facetValueResults: "facetValueResults" }, outputs: { searchTermChange: "searchTermChange", facetValueChange: "facetValueChange" }, features: [ɵngcc0.ɵɵProvidersFeature([{ provide: SELECTION_MODEL_FACTORY, useValue: ɵ0 }])], decls: 6, vars: 9, consts: [[3, "addTag", "placeholder", "items", "searchFn", "hideSelected", "multiple", "markFirst", "change"], ["selectComponent", ""], ["ng-header-tmp", ""], ["ng-label-tmp", ""], ["ng-option-tmp", ""], ["class", "search-header", 3, "selected", "click", 4, "ngIf"], [1, "search-header", 3, "click"], [4, "ngIf"], [3, "facetValue", "removable", "remove"], [3, "icon", "iconClick"], [3, "facetValue", "removable"]], template: function ProductSearchInputComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "ng-select", 0, 1);
        ɵngcc0.ɵɵlistener("change", function ProductSearchInputComponent_Template_ng_select_change_0_listener($event) { return ctx.onSelectChange($event); });
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵtemplate(3, ProductSearchInputComponent_ng_template_3_Template, 1, 1, "ng-template", 2);
        ɵngcc0.ɵɵtemplate(4, ProductSearchInputComponent_ng_template_4_Template, 2, 2, "ng-template", 3);
        ɵngcc0.ɵɵtemplate(5, ProductSearchInputComponent_ng_template_5_Template, 1, 1, "ng-template", 4);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("addTag", ctx.addTagFn)("placeholder", ɵngcc0.ɵɵpipeBind1(2, 7, "catalog.search-product-name-or-code"))("items", ctx.facetValueResults)("searchFn", ctx.filterFacetResults)("hideSelected", true)("multiple", true)("markFirst", false);
    } }, directives: [ɵngcc9.NgSelectComponent, ɵngcc9.ɵj, ɵngcc9.ɵh, ɵngcc9.ɵf, ɵngcc4.NgIf, ɵngcc2.FacetValueChipComponent, ɵngcc2.ChipComponent], pipes: [ɵngcc5.TranslatePipe], styles: ["[_nghost-%COMP%]{margin-top:6px;display:block;width:100%}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:none;margin:0}[_nghost-%COMP%]     .ng-dropdown-panel-items div.ng-option:last-child{display:none}[_nghost-%COMP%]     .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select[_ngcontent-%COMP%]{width:100%;min-width:300px;margin-right:12px}.search-header[_ngcontent-%COMP%]{padding:8px 10px;border-bottom:1px solid var(--color-component-border-100);cursor:pointer}.search-header.selected[_ngcontent-%COMP%], .search-header[_ngcontent-%COMP%]:hover{background-color:var(--color-component-bg-200)}"], changeDetection: 0 });
ProductSearchInputComponent.propDecorators = {
    facetValueResults: [{ type: Input }],
    searchTermChange: [{ type: Output }],
    facetValueChange: [{ type: Output }],
    selectComponent: [{ type: ViewChild, args: ['selectComponent', { static: true },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductSearchInputComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-product-search-input',
                template: "<ng-select\r\n    [addTag]=\"addTagFn\"\r\n    [placeholder]=\"'catalog.search-product-name-or-code' | translate\"\r\n    [items]=\"facetValueResults\"\r\n    [searchFn]=\"filterFacetResults\"\r\n    [hideSelected]=\"true\"\r\n    [multiple]=\"true\"\r\n    [markFirst]=\"false\"\r\n    (change)=\"onSelectChange($event)\"\r\n    #selectComponent\r\n>\r\n    <ng-template ng-header-tmp>\r\n        <div\r\n            class=\"search-header\"\r\n            *ngIf=\"selectComponent.searchTerm\"\r\n            [class.selected]=\"isSearchHeaderSelected()\"\r\n            (click)=\"selectComponent.selectTag()\"\r\n        >\r\n            {{ 'catalog.search-for-term' | translate }}: {{ selectComponent.searchTerm }}\r\n        </div>\r\n    </ng-template>\r\n    <ng-template ng-label-tmp let-item=\"item\" let-clear=\"clear\">\r\n        <ng-container *ngIf=\"item.facetValue\">\r\n            <vdr-facet-value-chip\r\n                [facetValue]=\"item.facetValue\"\r\n                [removable]=\"true\"\r\n                (remove)=\"clear(item)\"\r\n            ></vdr-facet-value-chip>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!item.facetValue\">\r\n            <vdr-chip [icon]=\"'times'\" (iconClick)=\"clear(item)\">\"{{ item.label }}\"</vdr-chip>\r\n        </ng-container>\r\n    </ng-template>\r\n    <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\" let-search=\"searchTerm\">\r\n        <ng-container *ngIf=\"item.facetValue\">\r\n            <vdr-facet-value-chip [facetValue]=\"item.facetValue\" [removable]=\"false\"></vdr-facet-value-chip>\r\n        </ng-container>\r\n    </ng-template>\r\n</ng-select>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                providers: [{ provide: SELECTION_MODEL_FACTORY, useValue: ɵ0 }],
                styles: [":host{margin-top:6px;display:block;width:100%}:host ::ng-deep .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:none;margin:0}:host ::ng-deep .ng-dropdown-panel-items div.ng-option:last-child{display:none}:host ::ng-deep .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}:host ::ng-deep .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}:host ::ng-deep .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select{width:100%;min-width:300px;margin-right:12px}.search-header{padding:8px 10px;border-bottom:1px solid var(--color-component-border-100);cursor:pointer}.search-header.selected,.search-header:hover{background-color:var(--color-component-bg-200)}\n"]
            }]
    }], function () { return []; }, { searchTermChange: [{
            type: Output
        }], facetValueChange: [{
            type: Output
        }], facetValueResults: [{
            type: Input
        }], selectComponent: [{
            type: ViewChild,
            args: ['selectComponent', { static: true }]
        }] }); })();

class UpdateProductOptionDialogComponent {
    constructor() {
        this.updateVariantName = true;
        this.codeInputTouched = false;
    }
    ngOnInit() {
        var _a;
        const currentTranslation = this.productOption.translations.find(t => t.languageCode === this.activeLanguage);
        this.name = (_a = currentTranslation === null || currentTranslation === void 0 ? void 0 : currentTranslation.name) !== null && _a !== void 0 ? _a : '';
        this.code = this.productOption.code;
        this.customFieldsForm = new FormGroup({});
        if (this.customFields) {
            const cfCurrentTranslation = (currentTranslation && currentTranslation.customFields) || {};
            for (const fieldDef of this.customFields) {
                const key = fieldDef.name;
                const value = fieldDef.type === 'localeString'
                    ? cfCurrentTranslation[key]
                    : this.productOption.customFields[key];
                this.customFieldsForm.addControl(fieldDef.name, new FormControl(value));
            }
        }
    }
    update() {
        const result = createUpdatedTranslatable({
            translatable: this.productOption,
            languageCode: this.activeLanguage,
            updatedFields: {
                code: this.code,
                name: this.name,
                customFields: this.customFieldsForm.value,
            },
            customFieldConfig: this.customFields,
            defaultTranslation: {
                languageCode: this.activeLanguage,
                name: '',
            },
        });
        this.resolveWith(Object.assign(Object.assign({}, result), { autoUpdate: this.updateVariantName }));
    }
    cancel() {
        this.resolveWith();
    }
    updateCode(nameValue) {
        if (!this.codeInputTouched && !this.productOption.code) {
            this.code = normalizeString(nameValue, '-');
        }
    }
}
UpdateProductOptionDialogComponent.ɵfac = function UpdateProductOptionDialogComponent_Factory(t) { return new (t || UpdateProductOptionDialogComponent)(); };
UpdateProductOptionDialogComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: UpdateProductOptionDialogComponent, selectors: [["vdr-update-product-option-dialog"]], decls: 16, vars: 13, consts: [["vdrDialogTitle", ""], ["for", "name", 3, "label"], ["id", "name", "type", "text", "required", "", 3, "ngModel", "ngModelChange", "input"], ["nameInput", "ngModel"], ["for", "code", 3, "label"], ["id", "code", "type", "text", "required", "", "pattern", "[a-z0-9_-]+", 3, "ngModel", "ngModelChange"], ["codeInput", "ngModel"], ["type", "checkbox", "clrCheckbox", "", 3, "ngModel", "ngModelChange"], [4, "ngIf"], ["vdrDialogButtons", ""], ["entityName", "ProductOption", 3, "customFields", "customFieldsFormGroup", "readonly"], ["type", "button", 1, "btn", 3, "click"], ["type", "submit", 1, "btn", "btn-primary", 3, "disabled", "click"]], template: function UpdateProductOptionDialogComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, UpdateProductOptionDialogComponent_ng_template_0_Template, 2, 3, "ng-template", 0);
        ɵngcc0.ɵɵelementStart(1, "vdr-form-field", 1);
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵelementStart(3, "input", 2, 3);
        ɵngcc0.ɵɵlistener("ngModelChange", function UpdateProductOptionDialogComponent_Template_input_ngModelChange_3_listener($event) { return ctx.name = $event; })("input", function UpdateProductOptionDialogComponent_Template_input_input_3_listener($event) { return ctx.updateCode($event.target.value); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(5, "vdr-form-field", 4);
        ɵngcc0.ɵɵpipe(6, "translate");
        ɵngcc0.ɵɵelementStart(7, "input", 5, 6);
        ɵngcc0.ɵɵlistener("ngModelChange", function UpdateProductOptionDialogComponent_Template_input_ngModelChange_7_listener($event) { return ctx.code = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(9, "clr-checkbox-wrapper");
        ɵngcc0.ɵɵelementStart(10, "input", 7);
        ɵngcc0.ɵɵlistener("ngModelChange", function UpdateProductOptionDialogComponent_Template_input_ngModelChange_10_listener($event) { return ctx.updateVariantName = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "label");
        ɵngcc0.ɵɵtext(12);
        ɵngcc0.ɵɵpipe(13, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(14, UpdateProductOptionDialogComponent_section_14_Template, 6, 9, "section", 8);
        ɵngcc0.ɵɵtemplate(15, UpdateProductOptionDialogComponent_ng_template_15_Template, 6, 7, "ng-template", 9);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(2, 7, "catalog.option-name"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngModel", ctx.name);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(6, 9, "common.code"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngModel", ctx.code);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngModel", ctx.updateVariantName);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(13, 11, "catalog.auto-update-option-variant-name"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.customFields.length);
    } }, directives: [ɵngcc2.DialogTitleDirective, ɵngcc2.FormFieldComponent, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc3.RequiredValidator, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, ɵngcc3.PatternValidator, ɵngcc7.ClrCheckboxWrapper, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc7.ClrLabel, ɵngcc4.NgIf, ɵngcc2.DialogButtonsDirective, ɵngcc2.TabbedCustomFieldsComponent], pipes: [ɵngcc5.TranslatePipe, ɵngcc2.HasPermissionPipe], styles: [""], changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(UpdateProductOptionDialogComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-update-product-option-dialog',
                template: "<ng-template vdrDialogTitle>{{ 'catalog.update-product-option' | translate }}</ng-template>\r\n<vdr-form-field [label]=\"'catalog.option-name' | translate\" for=\"name\">\r\n    <input\r\n        id=\"name\"\r\n        type=\"text\"\r\n        #nameInput=\"ngModel\"\r\n        [(ngModel)]=\"name\"\r\n        required\r\n        (input)=\"updateCode($event.target.value)\"\r\n    />\r\n</vdr-form-field>\r\n<vdr-form-field [label]=\"'common.code' | translate\" for=\"code\">\r\n    <input id=\"code\" type=\"text\" #codeInput=\"ngModel\" required [(ngModel)]=\"code\" pattern=\"[a-z0-9_-]+\" />\r\n</vdr-form-field>\r\n<clr-checkbox-wrapper>\r\n    <input type=\"checkbox\" clrCheckbox [(ngModel)]=\"updateVariantName\" />\r\n    <label>{{ 'catalog.auto-update-option-variant-name' | translate }}</label>\r\n</clr-checkbox-wrapper>\r\n<section *ngIf=\"customFields.length\">\r\n    <label>{{ 'common.custom-fields' | translate }}</label>\r\n    <vdr-tabbed-custom-fields\r\n        entityName=\"ProductOption\"\r\n        [customFields]=\"customFields\"\r\n        [customFieldsFormGroup]=\"customFieldsForm\"\r\n        [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n    ></vdr-tabbed-custom-fields>\r\n</section>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button\r\n        type=\"submit\"\r\n        (click)=\"update()\"\r\n        [disabled]=\"\r\n            nameInput.invalid ||\r\n            codeInput.invalid ||\r\n            (nameInput.pristine && codeInput.pristine && customFieldsForm.pristine)\r\n        \"\r\n        class=\"btn btn-primary\"\r\n    >\r\n        {{ 'catalog.update-product-option' | translate }}\r\n    </button>\r\n</ng-template>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [""]
            }]
    }], function () { return []; }, null); })();

class ProductVariantsListComponent {
    constructor(changeDetector, modalService, dataService) {
        this.changeDetector = changeDetector;
        this.modalService = modalService;
        this.dataService = dataService;
        this.assignToChannel = new EventEmitter();
        this.removeFromChannel = new EventEmitter();
        this.assetChange = new EventEmitter();
        this.selectionChange = new EventEmitter();
        this.selectFacetValueClick = new EventEmitter();
        this.updateProductOption = new EventEmitter();
        this.selectedVariantIds = [];
        this.formGroupMap = new Map();
        this.GlobalFlag = GlobalFlag;
        this.updatePermission = [Permission.UpdateCatalog, Permission.UpdateProduct];
    }
    ngOnInit() {
        this.dataService.settings.getGlobalSettings('cache-first').single$.subscribe(({ globalSettings }) => {
            this.globalTrackInventory = globalSettings.trackInventory;
            this.globalOutOfStockThreshold = globalSettings.outOfStockThreshold;
            this.changeDetector.markForCheck();
        });
        this.subscription = this.formArray.valueChanges.subscribe(() => this.changeDetector.markForCheck());
        this.subscription.add(this.formArray.valueChanges
            .pipe(map(value => value.length), debounceTime(1), distinctUntilChanged())
            .subscribe(() => {
            this.buildFormGroupMap();
        }));
        this.buildFormGroupMap();
    }
    ngOnChanges(changes) {
        if ('facets' in changes && !!changes['facets'].currentValue) {
            this.facetValues = flattenFacetValues(this.facets);
        }
    }
    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
    isDefaultChannel(channelCode) {
        return channelCode === DEFAULT_CHANNEL_CODE;
    }
    trackById(index, item) {
        return item.id;
    }
    inventoryIsNotTracked(formGroup) {
        var _a;
        const trackInventory = (_a = formGroup.get('trackInventory')) === null || _a === void 0 ? void 0 : _a.value;
        return (trackInventory === GlobalFlag.FALSE ||
            (trackInventory === GlobalFlag.INHERIT && this.globalTrackInventory === false));
    }
    getTaxCategoryName(group) {
        const control = group.get(['taxCategoryId']);
        if (control && this.taxCategories) {
            const match = this.taxCategories.find(t => t.id === control.value);
            return match ? match.name : '';
        }
        return '';
    }
    getSaleableStockLevel(variant) {
        const effectiveOutOfStockThreshold = variant.useGlobalOutOfStockThreshold
            ? this.globalOutOfStockThreshold
            : variant.outOfStockThreshold;
        return variant.stockOnHand - variant.stockAllocated - effectiveOutOfStockThreshold;
    }
    areAllSelected() {
        return !!this.variants && this.selectedVariantIds.length === this.variants.length;
    }
    onAssetChange(variantId, event) {
        this.assetChange.emit(Object.assign({ variantId }, event));
        const index = this.variants.findIndex(v => v.id === variantId);
        this.formArray.at(index).markAsDirty();
    }
    toggleSelectAll() {
        if (this.areAllSelected()) {
            this.selectedVariantIds = [];
        }
        else {
            this.selectedVariantIds = this.variants.map(v => v.id);
        }
        this.selectionChange.emit(this.selectedVariantIds);
    }
    toggleSelectVariant(variantId) {
        const index = this.selectedVariantIds.indexOf(variantId);
        if (-1 < index) {
            this.selectedVariantIds.splice(index, 1);
        }
        else {
            this.selectedVariantIds.push(variantId);
        }
        this.selectionChange.emit(this.selectedVariantIds);
    }
    optionGroupName(optionGroupId) {
        var _a;
        const group = this.optionGroups.find(g => g.id === optionGroupId);
        if (group) {
            const translation = (_a = group === null || group === void 0 ? void 0 : group.translations.find(t => t.languageCode === this.activeLanguage)) !== null && _a !== void 0 ? _a : group.translations[0];
            return translation.name;
        }
    }
    optionName(option) {
        var _a;
        const translation = (_a = option.translations.find(t => t.languageCode === this.activeLanguage)) !== null && _a !== void 0 ? _a : option.translations[0];
        return translation.name;
    }
    pendingFacetValues(variant) {
        if (this.facets) {
            const formFacetValueIds = this.getFacetValueIds(variant.id);
            const variantFacetValueIds = variant.facetValues.map(fv => fv.id);
            return formFacetValueIds
                .filter(x => !variantFacetValueIds.includes(x))
                .map(id => this.facetValues.find(fv => fv.id === id))
                .filter(notNullOrUndefined);
        }
        else {
            return [];
        }
    }
    existingFacetValues(variant) {
        const formFacetValueIds = this.getFacetValueIds(variant.id);
        const intersection = [...formFacetValueIds].filter(x => variant.facetValues.map(fv => fv.id).includes(x));
        return intersection
            .map(id => variant.facetValues.find(fv => fv.id === id))
            .filter(notNullOrUndefined);
    }
    removeFacetValue(variant, facetValueId) {
        const formGroup = this.formGroupMap.get(variant.id);
        if (formGroup) {
            const newValue = formGroup.value.facetValueIds.filter(id => id !== facetValueId);
            formGroup.patchValue({
                facetValueIds: newValue,
            });
            formGroup.markAsDirty();
        }
    }
    isVariantSelected(variantId) {
        return -1 < this.selectedVariantIds.indexOf(variantId);
    }
    editOption(option) {
        this.modalService
            .fromComponent(UpdateProductOptionDialogComponent, {
            size: 'md',
            locals: {
                productOption: option,
                activeLanguage: this.activeLanguage,
                customFields: this.customOptionFields,
            },
        })
            .subscribe(result => {
            if (result) {
                this.updateProductOption.emit(result);
            }
        });
    }
    buildFormGroupMap() {
        this.formGroupMap.clear();
        for (const controlGroup of this.formArray.controls) {
            this.formGroupMap.set(controlGroup.value.id, controlGroup);
        }
        this.changeDetector.markForCheck();
    }
    getFacetValueIds(id) {
        var _a;
        const formValue = (_a = this.formGroupMap.get(id)) === null || _a === void 0 ? void 0 : _a.value;
        return formValue.facetValueIds;
    }
}
ProductVariantsListComponent.ɵfac = function ProductVariantsListComponent_Factory(t) { return new (t || ProductVariantsListComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService)); };
ProductVariantsListComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProductVariantsListComponent, selectors: [["vdr-product-variants-list"]], inputs: { formArray: ["productVariantsFormArray", "formArray"], variants: "variants", paginationConfig: "paginationConfig", channelPriceIncludesTax: "channelPriceIncludesTax", taxCategories: "taxCategories", facets: "facets", optionGroups: "optionGroups", customFields: "customFields", customOptionFields: "customOptionFields", activeLanguage: "activeLanguage", pendingAssetChanges: "pendingAssetChanges" }, outputs: { assignToChannel: "assignToChannel", removeFromChannel: "removeFromChannel", assetChange: "assetChange", selectionChange: "selectionChange", selectFacetValueClick: "selectFacetValueClick", updateProductOption: "updateProductOption" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 3, vars: 6, consts: [[1, "variants-list"], ["class", "variant-container card", 3, "disabled", 4, "ngFor", "ngForOf", "ngForTrackBy"], [1, "variant-container", "card"], [3, "formGroup", 4, "ngIf"], [3, "formGroup"], [1, "card-block", "header-row"], [1, "details"], [1, "sku", 3, "readonly"], ["clrInput", "", "type", "text", "formControlName", "sku", 3, "readonly", "placeholder"], [1, "name", 3, "readonly"], ["clrInput", "", "type", "text", "formControlName", "name", 3, "readonly", "placeholder"], [1, "right-controls"], [4, "vdrIfPermissions"], [1, "card-block"], [1, "variant-body"], [1, "assets"], [3, "compact", "assets", "featuredAsset", "updatePermissions", "change"], [1, "variant-form-inputs"], [1, "standard-fields"], [1, "variant-form-input-row"], [1, "tax-category"], [4, "vdrIfPermissions", "vdrIfPermissionsElse"], ["taxCategoryLabel", ""], [1, "price"], ["clrInput", "", "formControlName", "price", 3, "currencyCode", "readonly", 4, "ngIf"], ["clrInput", "", "formControlName", "priceWithTax", 3, "currencyCode", "readonly", 4, "ngIf"], [3, "price", "currencyCode", "priceIncludesTax", "taxCategoryId"], [3, "content"], ["clrInput", "", "type", "number", "min", "0", "step", "1", "formControlName", "stockOnHand", 3, "readonly", "vdrDisabled"], [1, "clr-control-label"], [1, "value"], [1, "out-of-stock-threshold-wrapper"], [1, "flex"], ["clrInput", "", "type", "number", 3, "formControl", "readonly", "vdrDisabled"], ["type", "checkbox", "clrToggle", "", "name", "useGlobalOutOfStockThreshold", "formControlName", "useGlobalOutOfStockThreshold", 3, "vdrDisabled"], [1, "custom-fields"], ["formGroupName", "customFields", 4, "ngIf"], [1, "options-facets"], [3, "entity"], [4, "ngIf"], [1, "flex-spacer"], [1, "facets"], [3, "facetValue", "removable", "remove", 4, "ngFor", "ngForOf"], ["class", "btn btn-sm btn-secondary", 3, "click", 4, "vdrIfPermissions"], [4, "vdrIfMultichannel"], ["type", "checkbox", "clrToggle", "", "name", "enabled", "formControlName", "enabled"], ["clrSelect", "", "name", "options", "formControlName", "taxCategoryId"], [3, "value", 4, "ngFor", "ngForOf"], [3, "value"], [1, "tax-category-label"], ["clrInput", "", "formControlName", "price", 3, "currencyCode", "readonly"], ["clrInput", "", "formControlName", "priceWithTax", 3, "currencyCode", "readonly"], ["clrSelect", "", "name", "options", "formControlName", "trackInventory"], ["formGroupName", "customFields"], ["entityName", "ProductVariant", 3, "customFields", "compact", "customFieldsFormGroup", "readonly"], [1, "options"], [3, "colorFrom", "invert", "icon", "iconClick", 4, "ngFor", "ngForOf"], [1, "btn", "btn-link", "btn-sm", 3, "routerLink"], [3, "colorFrom", "invert", "icon", "iconClick"], [1, "option-group-name"], [3, "facetValue", "removable", "remove"], [1, "btn", "btn-sm", "btn-secondary", 3, "click"], ["shape", "plus"], ["class", "card-block", 4, "vdrIfDefaultChannelActive"], [1, "flex", "channel-assignment"], [4, "ngFor", "ngForOf"], [1, "btn", "btn-sm", 3, "click"], ["shape", "layers"], ["icon", "times-circle", 3, "title", "iconClick", 4, "ngIf"], ["icon", "times-circle", 3, "title", "iconClick"], [3, "channelCode"]], template: function ProductVariantsListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵtemplate(1, ProductVariantsListComponent_div_1_Template, 2, 3, "div", 1);
        ɵngcc0.ɵɵpipe(2, "paginate");
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind2(2, 2, ctx.variants, ctx.paginationConfig || ɵngcc0.ɵɵpureFunction0(5, _c36)))("ngForTrackBy", ctx.trackById);
    } }, directives: function () { return [ɵngcc4.NgForOf, ɵngcc7.ClrDatagridItemsTrackBy, ɵngcc4.NgIf, ɵngcc3.NgControlStatusGroup, ɵngcc3.FormGroupDirective, ɵngcc2.TitleInputComponent, ɵngcc7.ClrInputContainer, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc7.ClrInput, ɵngcc3.NgControlStatus, ɵngcc3.FormControlName, ɵngcc2.IfPermissionsDirective, AssetsComponent, ɵngcc7.ClrLabel, VariantPriceDetailComponent, ɵngcc2.HelpTooltipComponent, ɵngcc3.MinValidator, ɵngcc3.NumberValueAccessor, ɵngcc2.DisabledDirective, ɵngcc3.FormControlDirective, ɵngcc7.ClrCheckboxWrapper, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc2.EntityInfoComponent, ɵngcc2.IfMultichannelDirective, ɵngcc7.ClrSelectContainer, ɵngcc3.SelectControlValueAccessor, ɵngcc7.ClrSelect, ɵngcc3.NgSelectOption, ɵngcc3.ɵNgSelectMultipleOption, ɵngcc2.CurrencyInputComponent, ɵngcc3.FormGroupName, ɵngcc2.TabbedCustomFieldsComponent, ɵngcc1.RouterLinkWithHref, ɵngcc2.ChipComponent, ɵngcc2.FacetValueChipComponent, ɵngcc7.ClrIconCustomTag, ɵngcc2.IfDefaultChannelActiveDirective, ɵngcc2.ChannelBadgeComponent]; }, pipes: function () { return [ɵngcc6.PaginatePipe, ɵngcc2.HasPermissionPipe, ɵngcc5.TranslatePipe, ɵngcc2.SortPipe, ɵngcc2.ChannelLabelPipe]; }, styles: [".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%]{margin-right:12px}.with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s;min-height:330px}.variant-container.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:var(--color-grey-400)}.variant-container[_ngcontent-%COMP%]     .clr-control-container{width:100%}.channel-assignment[_ngcontent-%COMP%]{justify-content:flex-end}.channel-assignment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-left:24px}.inventory-untracked[_ngcontent-%COMP%]{opacity:.5}"], changeDetection: 0 });
ProductVariantsListComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: ModalService },
    { type: DataService }
];
ProductVariantsListComponent.propDecorators = {
    formArray: [{ type: Input, args: ['productVariantsFormArray',] }],
    variants: [{ type: Input }],
    paginationConfig: [{ type: Input }],
    channelPriceIncludesTax: [{ type: Input }],
    taxCategories: [{ type: Input }],
    facets: [{ type: Input }],
    optionGroups: [{ type: Input }],
    customFields: [{ type: Input }],
    customOptionFields: [{ type: Input }],
    activeLanguage: [{ type: Input }],
    pendingAssetChanges: [{ type: Input }],
    assignToChannel: [{ type: Output }],
    removeFromChannel: [{ type: Output }],
    assetChange: [{ type: Output }],
    selectionChange: [{ type: Output }],
    selectFacetValueClick: [{ type: Output }],
    updateProductOption: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductVariantsListComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-product-variants-list',
                template: "<div class=\"variants-list\">\r\n    <div\r\n        class=\"variant-container card\"\r\n        *ngFor=\"\r\n            let variant of variants | paginate: paginationConfig || { itemsPerPage: 10, currentPage: 1 };\r\n            trackBy: trackById;\r\n            let i = index\r\n        \"\r\n        [class.disabled]=\"!formGroupMap.get(variant.id)?.get('enabled')?.value\"\r\n    >\r\n        <ng-container *ngIf=\"formGroupMap.get(variant.id) as formGroup\" [formGroup]=\"formGroup\">\r\n            <div class=\"card-block header-row\">\r\n                <div class=\"details\">\r\n                    <vdr-title-input class=\"sku\" [readonly]=\"!(updatePermission | hasPermission)\">\r\n                        <clr-input-container>\r\n                            <input\r\n                                clrInput\r\n                                type=\"text\"\r\n                                formControlName=\"sku\"\r\n                                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                [placeholder]=\"'catalog.sku' | translate\"\r\n                            />\r\n                        </clr-input-container>\r\n                    </vdr-title-input>\r\n                    <vdr-title-input class=\"name\" [readonly]=\"!(updatePermission | hasPermission)\">\r\n                        <clr-input-container>\r\n                            <input\r\n                                clrInput\r\n                                type=\"text\"\r\n                                formControlName=\"name\"\r\n                                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                [placeholder]=\"'common.name' | translate\"\r\n                            />\r\n                        </clr-input-container>\r\n                    </vdr-title-input>\r\n                </div>\r\n                <div class=\"right-controls\">\r\n                    <clr-toggle-wrapper *vdrIfPermissions=\"updatePermission\">\r\n                        <input type=\"checkbox\" clrToggle name=\"enabled\" formControlName=\"enabled\" />\r\n                        <label>{{ 'common.enabled' | translate }}</label>\r\n                    </clr-toggle-wrapper>\r\n                </div>\r\n            </div>\r\n            <div class=\"card-block\">\r\n                <div class=\"variant-body\">\r\n                    <div class=\"assets\">\r\n                        <vdr-assets\r\n                            [compact]=\"true\"\r\n                            [assets]=\"pendingAssetChanges[variant.id]?.assets || variant.assets\"\r\n                            [featuredAsset]=\"\r\n                                pendingAssetChanges[variant.id]?.featuredAsset || variant.featuredAsset\r\n                            \"\r\n                            [updatePermissions]=\"updatePermission\"\r\n                            (change)=\"onAssetChange(variant.id, $event)\"\r\n                        ></vdr-assets>\r\n                    </div>\r\n                    <div class=\"variant-form-inputs\">\r\n                        <div class=\"standard-fields\">\r\n                            <div class=\"variant-form-input-row\">\r\n                                <div class=\"tax-category\">\r\n                                    <clr-select-container\r\n                                        *vdrIfPermissions=\"updatePermission; else taxCategoryLabel\"\r\n                                    >\r\n                                        <label>{{ 'catalog.tax-category' | translate }}</label>\r\n                                        <select clrSelect name=\"options\" formControlName=\"taxCategoryId\">\r\n                                            <option\r\n                                                *ngFor=\"let taxCategory of taxCategories\"\r\n                                                [value]=\"taxCategory.id\"\r\n                                            >\r\n                                                {{ taxCategory.name }}\r\n                                            </option>\r\n                                        </select>\r\n                                    </clr-select-container>\r\n                                    <ng-template #taxCategoryLabel>\r\n                                        <label class=\"clr-control-label\">{{\r\n                                            'catalog.tax-category' | translate\r\n                                        }}</label>\r\n                                        <div class=\"tax-category-label\">\r\n                                            {{ getTaxCategoryName(formGroup) }}\r\n                                        </div>\r\n                                    </ng-template>\r\n                                </div>\r\n                                <div class=\"price\">\r\n                                    <clr-input-container>\r\n                                        <label>{{ 'catalog.price' | translate }}</label>\r\n                                        <vdr-currency-input\r\n                                            *ngIf=\"!channelPriceIncludesTax\"\r\n                                            clrInput\r\n                                            [currencyCode]=\"variant.currencyCode\"\r\n                                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                            formControlName=\"price\"\r\n                                        ></vdr-currency-input>\r\n                                        <vdr-currency-input\r\n                                            *ngIf=\"channelPriceIncludesTax\"\r\n                                            clrInput\r\n                                            [currencyCode]=\"variant.currencyCode\"\r\n                                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                            formControlName=\"priceWithTax\"\r\n                                        ></vdr-currency-input>\r\n                                    </clr-input-container>\r\n                                </div>\r\n                                <vdr-variant-price-detail\r\n                                    [price]=\"formGroup.get('price')!.value\"\r\n                                    [currencyCode]=\"variant.currencyCode\"\r\n                                    [priceIncludesTax]=\"channelPriceIncludesTax\"\r\n                                    [taxCategoryId]=\"formGroup.get('taxCategoryId')!.value\"\r\n                                ></vdr-variant-price-detail>\r\n                            </div>\r\n                            <div class=\"variant-form-input-row\">\r\n                                <clr-select-container *vdrIfPermissions=\"updatePermission\">\r\n                                    <label\r\n                                        >{{ 'catalog.track-inventory' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.track-inventory-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip>\r\n                                    </label>\r\n                                    <select clrSelect name=\"options\" formControlName=\"trackInventory\">\r\n                                        <option [value]=\"GlobalFlag.TRUE\">\r\n                                            {{ 'catalog.track-inventory-true' | translate }}\r\n                                        </option>\r\n                                        <option [value]=\"GlobalFlag.FALSE\">\r\n                                            {{ 'catalog.track-inventory-false' | translate }}\r\n                                        </option>\r\n                                        <option [value]=\"GlobalFlag.INHERIT\">\r\n                                            {{ 'catalog.track-inventory-inherit' | translate }}\r\n                                        </option>\r\n                                    </select>\r\n                                </clr-select-container>\r\n                                <clr-input-container>\r\n                                    <label\r\n                                        >{{ 'catalog.stock-on-hand' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.stock-on-hand-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <input\r\n                                        [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\"\r\n                                        clrInput\r\n                                        type=\"number\"\r\n                                        min=\"0\"\r\n                                        step=\"1\"\r\n                                        formControlName=\"stockOnHand\"\r\n                                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                        [vdrDisabled]=\"inventoryIsNotTracked(formGroup)\"\r\n                                    />\r\n                                </clr-input-container>\r\n                                <div [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\">\r\n                                    <label class=\"clr-control-label\"\r\n                                        >{{ 'catalog.stock-allocated' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.stock-allocated-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <div class=\"value\">\r\n                                        {{ variant.stockAllocated }}\r\n                                    </div>\r\n                                </div>\r\n                                <div [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\">\r\n                                    <label class=\"clr-control-label\"\r\n                                        >{{ 'catalog.stock-saleable' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.stock-saleable-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <div class=\"value\">\r\n                                        {{ getSaleableStockLevel(variant) }}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div class=\"variant-form-input-row\">\r\n                                <div\r\n                                    class=\"out-of-stock-threshold-wrapper\"\r\n                                    [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\"\r\n                                >\r\n                                    <label class=\"clr-control-label\"\r\n                                        >{{ 'catalog.out-of-stock-threshold' | translate\r\n                                        }}<vdr-help-tooltip\r\n                                            [content]=\"'catalog.out-of-stock-threshold-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <div class=\"flex\">\r\n                                        <clr-input-container>\r\n                                            <input\r\n                                                clrInput\r\n                                                type=\"number\"\r\n                                                [formControl]=\"formGroup.get('outOfStockThreshold')\"\r\n                                                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                                [vdrDisabled]=\"\r\n                                                    formGroup.get('useGlobalOutOfStockThreshold')?.value !==\r\n                                                        false || inventoryIsNotTracked(formGroup)\r\n                                                \"\r\n                                            />\r\n                                        </clr-input-container>\r\n                                        <clr-toggle-wrapper>\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                clrToggle\r\n                                                name=\"useGlobalOutOfStockThreshold\"\r\n                                                formControlName=\"useGlobalOutOfStockThreshold\"\r\n                                                [vdrDisabled]=\"\r\n                                                    !(updatePermission | hasPermission) ||\r\n                                                    inventoryIsNotTracked(formGroup)\r\n                                                \"\r\n                                            />\r\n                                            <label\r\n                                                >{{ 'catalog.use-global-value' | translate }} ({{\r\n                                                    globalOutOfStockThreshold\r\n                                                }})</label\r\n                                            >\r\n                                        </clr-toggle-wrapper>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"custom-fields\">\r\n                            <div class=\"variant-form-input-row\">\r\n                                <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n                                    <vdr-tabbed-custom-fields\r\n                                        entityName=\"ProductVariant\"\r\n                                        [customFields]=\"customFields\"\r\n                                        [compact]=\"true\"\r\n                                        [customFieldsFormGroup]=\"formGroup.get('customFields')\"\r\n                                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                    ></vdr-tabbed-custom-fields>\r\n                                </section>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"card-block\">\r\n                <div class=\"options-facets\">\r\n                    <vdr-entity-info [entity]=\"variant\"></vdr-entity-info>\r\n                    <div *ngIf=\"variant.options.length\">\r\n                        <div class=\"options\">\r\n                            <vdr-chip\r\n                                *ngFor=\"let option of variant.options | sort: 'groupId'\"\r\n                                [colorFrom]=\"optionGroupName(option.groupId)\"\r\n                                [invert]=\"true\"\r\n                                (iconClick)=\"editOption(option)\"\r\n                                [icon]=\"(updatePermission | hasPermission) && 'pencil'\"\r\n                            >\r\n                                <span class=\"option-group-name\">{{ optionGroupName(option.groupId) }}</span>\r\n                                {{ optionName(option) }}\r\n                            </vdr-chip>\r\n                            <a [routerLink]=\"['./', 'options']\" class=\"btn btn-link btn-sm\"\r\n                                >{{ 'catalog.edit-options' | translate }}...</a\r\n                            >\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"flex-spacer\"></div>\r\n                    <div class=\"facets\">\r\n                        <vdr-facet-value-chip\r\n                            *ngFor=\"let facetValue of existingFacetValues(variant)\"\r\n                            [facetValue]=\"facetValue\"\r\n                            [removable]=\"updatePermission | hasPermission\"\r\n                            (remove)=\"removeFacetValue(variant, facetValue.id)\"\r\n                        ></vdr-facet-value-chip>\r\n                        <vdr-facet-value-chip\r\n                            *ngFor=\"let facetValue of pendingFacetValues(variant)\"\r\n                            [facetValue]=\"facetValue\"\r\n                            [removable]=\"updatePermission | hasPermission\"\r\n                            (remove)=\"removeFacetValue(variant, facetValue.id)\"\r\n                        ></vdr-facet-value-chip>\r\n                        <button\r\n                            *vdrIfPermissions=\"updatePermission\"\r\n                            class=\"btn btn-sm btn-secondary\"\r\n                            (click)=\"selectFacetValueClick.emit([variant.id])\"\r\n                        >\r\n                            <clr-icon shape=\"plus\"></clr-icon>\r\n                            {{ 'catalog.add-facets' | translate }}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <ng-container *vdrIfMultichannel>\r\n                <div class=\"card-block\" *vdrIfDefaultChannelActive>\r\n                    <div class=\"flex channel-assignment\">\r\n                        <ng-container *ngFor=\"let channel of variant.channels\">\r\n                            <vdr-chip\r\n                                *ngIf=\"!isDefaultChannel(channel.code)\"\r\n                                icon=\"times-circle\"\r\n                                [title]=\"'catalog.remove-from-channel' | translate\"\r\n                                (iconClick)=\"\r\n                                    removeFromChannel.emit({ channelId: channel.id, variant: variant })\r\n                                \"\r\n                            >\r\n                                <vdr-channel-badge [channelCode]=\"channel.code\"></vdr-channel-badge>\r\n                                {{ channel.code | channelCodeToLabel }}\r\n                            </vdr-chip>\r\n                        </ng-container>\r\n                        <button class=\"btn btn-sm\" (click)=\"assignToChannel.emit(variant)\">\r\n                            <clr-icon shape=\"layers\"></clr-icon>\r\n                            {{ 'catalog.assign-to-channel' | translate }}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </ng-container>\r\n        </ng-container>\r\n    </div>\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".with-selected{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected vdr-select-toggle{margin-right:12px}.with-selected>label{margin-right:12px}.variant-container{transition:background-color .2s;min-height:330px}.variant-container.disabled{background-color:var(--color-component-bg-200)}.variant-container .header-row{display:flex;align-items:center;flex-wrap:wrap}.variant-container .variant-body{display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container .variant-body{flex-direction:row}}.variant-container .details{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width: 768px){.variant-container .details{flex-direction:row;height:36px}}.variant-container .details .name{flex:1}.variant-container .details .name ::ng-deep .clr-control-container{width:100%}.variant-container .details .name ::ng-deep .clr-control-container input.clr-input{min-width:100%}.variant-container .details .sku{width:160px;margin-right:20px;flex:0}.variant-container .details ::ng-deep .name input{min-width:300px}.variant-container .right-controls{display:flex}.variant-container .tax-category-label{margin-top:3px}.variant-container .variant-form-inputs{flex:1;display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container .variant-form-inputs{flex-direction:row}}.variant-container .variant-form-input-row{display:flex;flex-wrap:wrap}@media screen and (min-width: 768px){.variant-container .variant-form-input-row{margin:0 6px 8px 24px}}.variant-container .variant-form-input-row>*{margin-right:24px;margin-bottom:24px}.variant-container .track-inventory-toggle{margin-top:22px}.variant-container .clr-form-control{margin-top:0}.variant-container .facets{display:flex;flex-wrap:wrap;align-items:center}.variant-container .pricing{display:flex}.variant-container .pricing>div{margin-right:12px}.variant-container .option-group-name{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container .options-facets{display:flex;color:var(--color-grey-400)}.variant-container ::ng-deep .clr-control-container{width:100%}.channel-assignment{justify-content:flex-end}.channel-assignment .btn{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper clr-toggle-wrapper{margin-left:24px}.inventory-untracked{opacity:.5}\n"]
            }]
    }], function () { return [{ type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.ModalService }, { type: ɵngcc2.DataService }]; }, { assignToChannel: [{
            type: Output
        }], removeFromChannel: [{
            type: Output
        }], assetChange: [{
            type: Output
        }], selectionChange: [{
            type: Output
        }], selectFacetValueClick: [{
            type: Output
        }], updateProductOption: [{
            type: Output
        }], formArray: [{
            type: Input,
            args: ['productVariantsFormArray']
        }], variants: [{
            type: Input
        }], paginationConfig: [{
            type: Input
        }], channelPriceIncludesTax: [{
            type: Input
        }], taxCategories: [{
            type: Input
        }], facets: [{
            type: Input
        }], optionGroups: [{
            type: Input
        }], customFields: [{
            type: Input
        }], customOptionFields: [{
            type: Input
        }], activeLanguage: [{
            type: Input
        }], pendingAssetChanges: [{
            type: Input
        }] }); })();

class ProductVariantsTableComponent {
    constructor(changeDetector) {
        this.changeDetector = changeDetector;
        this.formGroupMap = new Map();
        this.updatePermission = [Permission.UpdateCatalog, Permission.UpdateProduct];
    }
    ngOnInit() {
        this.subscription = this.formArray.valueChanges
            .pipe(map(value => value.length), debounceTime(1), distinctUntilChanged())
            .subscribe(() => {
            this.buildFormGroupMap();
        });
        this.buildFormGroupMap();
    }
    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
    trackByFn(index, item) {
        if (item.id != null) {
            return item.id;
        }
        else {
            return index;
        }
    }
    getFeaturedAsset(variant) {
        var _a;
        return ((_a = this.pendingAssetChanges[variant.id]) === null || _a === void 0 ? void 0 : _a.featuredAsset) || variant.featuredAsset;
    }
    optionGroupName(optionGroupId) {
        const group = this.optionGroups.find(g => g.id === optionGroupId);
        return group && group.name;
    }
    buildFormGroupMap() {
        this.formGroupMap.clear();
        for (const controlGroup of this.formArray.controls) {
            this.formGroupMap.set(controlGroup.value.id, controlGroup);
        }
        this.changeDetector.markForCheck();
    }
}
ProductVariantsTableComponent.ɵfac = function ProductVariantsTableComponent_Factory(t) { return new (t || ProductVariantsTableComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
ProductVariantsTableComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ProductVariantsTableComponent, selectors: [["vdr-product-variants-table"]], inputs: { formArray: ["productVariantsFormArray", "formArray"], variants: "variants", paginationConfig: "paginationConfig", channelPriceIncludesTax: "channelPriceIncludesTax", optionGroups: "optionGroups", pendingAssetChanges: "pendingAssetChanges" }, decls: 24, vars: 24, consts: [[1, "table"], [4, "ngFor", "ngForOf"], [4, "ngFor", "ngForOf", "ngForTrackBy"], [3, "formGroup", 4, "ngIf"], [3, "formGroup"], [1, "left", "align-middle"], [1, "card-img"], [1, "featured-asset"], [3, "src", 4, "ngIf", "ngIfElse"], ["placeholder", ""], ["clrInput", "", "type", "text", "formControlName", "name", 3, "readonly", "placeholder"], ["clrInput", "", "type", "text", "formControlName", "sku", 3, "readonly", "placeholder"], [1, "left", "align-middle", "price"], ["clrInput", "", "formControlName", "price", 3, "currencyCode", "readonly", 4, "ngIf"], ["clrInput", "", "formControlName", "priceWithTax", 3, "currencyCode", "readonly", 4, "ngIf"], [1, "left", "align-middle", "stock"], ["clrInput", "", "type", "number", "min", "0", "step", "1", "formControlName", "stockOnHand", 3, "readonly"], ["type", "checkbox", "clrToggle", "", "name", "enabled", "formControlName", "enabled", 3, "vdrDisabled"], [3, "src"], [1, "placeholder"], ["shape", "image", "size", "48"], ["clrInput", "", "formControlName", "price", 3, "currencyCode", "readonly"], ["clrInput", "", "formControlName", "priceWithTax", 3, "currencyCode", "readonly"]], template: function ProductVariantsTableComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "table", 0);
        ɵngcc0.ɵɵelementStart(1, "thead");
        ɵngcc0.ɵɵelementStart(2, "tr");
        ɵngcc0.ɵɵelement(3, "th");
        ɵngcc0.ɵɵelementStart(4, "th");
        ɵngcc0.ɵɵtext(5);
        ɵngcc0.ɵɵpipe(6, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "th");
        ɵngcc0.ɵɵtext(8);
        ɵngcc0.ɵɵpipe(9, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(10, ProductVariantsTableComponent_ng_container_10_Template, 3, 1, "ng-container", 1);
        ɵngcc0.ɵɵpipe(11, "sort");
        ɵngcc0.ɵɵelementStart(12, "th");
        ɵngcc0.ɵɵtext(13);
        ɵngcc0.ɵɵpipe(14, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(15, "th");
        ɵngcc0.ɵɵtext(16);
        ɵngcc0.ɵɵpipe(17, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(18, "th");
        ɵngcc0.ɵɵtext(19);
        ɵngcc0.ɵɵpipe(20, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(21, "tbody");
        ɵngcc0.ɵɵtemplate(22, ProductVariantsTableComponent_tr_22_Template, 2, 1, "tr", 2);
        ɵngcc0.ɵɵpipe(23, "paginate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(5);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(6, 8, "common.name"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(9, 10, "catalog.sku"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind2(11, 12, ctx.optionGroups, "id"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(14, 15, "catalog.price"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(17, 17, "catalog.stock-on-hand"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(20, 19, "common.enabled"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind2(23, 21, ctx.variants, ctx.paginationConfig))("ngForTrackBy", ctx.trackByFn);
    } }, directives: [ɵngcc4.NgForOf, ɵngcc7.ClrDatagridItemsTrackBy, ɵngcc4.NgIf, ɵngcc3.NgControlStatusGroup, ɵngcc3.FormGroupDirective, ɵngcc7.ClrInputContainer, ɵngcc2.FormFieldControlDirective, ɵngcc3.DefaultValueAccessor, ɵngcc7.ClrInput, ɵngcc3.NgControlStatus, ɵngcc3.FormControlName, ɵngcc3.MinValidator, ɵngcc3.NumberValueAccessor, ɵngcc7.ClrCheckboxWrapper, ɵngcc3.CheckboxControlValueAccessor, ɵngcc7.ClrCheckbox, ɵngcc2.DisabledDirective, ɵngcc7.ClrIconCustomTag, ɵngcc2.CurrencyInputComponent], pipes: [ɵngcc5.TranslatePipe, ɵngcc2.SortPipe, ɵngcc6.PaginatePipe, ɵngcc2.HasPermissionPipe, ɵngcc2.AssetPreviewPipe, ɵngcc2.StringToColorPipe], styles: [".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"], changeDetection: 0 });
ProductVariantsTableComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
ProductVariantsTableComponent.propDecorators = {
    formArray: [{ type: Input, args: ['productVariantsFormArray',] }],
    variants: [{ type: Input }],
    paginationConfig: [{ type: Input }],
    channelPriceIncludesTax: [{ type: Input }],
    optionGroups: [{ type: Input }],
    pendingAssetChanges: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ProductVariantsTableComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-product-variants-table',
                template: "<table class=\"table\">\r\n    <thead>\r\n        <tr>\r\n            <th></th>\r\n            <th>{{ 'common.name' | translate }}</th>\r\n            <th>{{ 'catalog.sku' | translate }}</th>\r\n            <ng-container *ngFor=\"let optionGroup of optionGroups | sort: 'id'\">\r\n                <th>{{ optionGroup.name }}</th>\r\n            </ng-container>\r\n            <th>{{ 'catalog.price' | translate }}</th>\r\n            <th>{{ 'catalog.stock-on-hand' | translate }}</th>\r\n            <th>{{ 'common.enabled' | translate }}</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr *ngFor=\"let variant of variants | paginate: paginationConfig; index as i; trackBy: trackByFn\">\r\n            <ng-container *ngIf=\"formGroupMap.get(variant.id) as formGroup\" [formGroup]=\"formGroup\">\r\n                <td class=\"left align-middle\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                    <div class=\"card-img\">\r\n                        <div class=\"featured-asset\">\r\n                            <img\r\n                                *ngIf=\"getFeaturedAsset(variant) as featuredAsset; else placeholder\"\r\n                                [src]=\"featuredAsset | assetPreview: 'tiny'\"\r\n                            />\r\n                            <ng-template #placeholder>\r\n                                <div class=\"placeholder\">\r\n                                    <clr-icon shape=\"image\" size=\"48\"></clr-icon>\r\n                                </div>\r\n                            </ng-template>\r\n                        </div>\r\n                    </div>\r\n                </td>\r\n                <td class=\"left align-middle\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                    <clr-input-container>\r\n                        <input\r\n                            clrInput\r\n                            type=\"text\"\r\n                            formControlName=\"name\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                            [placeholder]=\"'common.name' | translate\"\r\n                        />\r\n                    </clr-input-container>\r\n                </td>\r\n                <td class=\"left align-middle\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                    <clr-input-container>\r\n                        <input\r\n                            clrInput\r\n                            type=\"text\"\r\n                            formControlName=\"sku\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                            [placeholder]=\"'catalog.sku' | translate\"\r\n                        />\r\n                    </clr-input-container>\r\n                </td>\r\n                <ng-container *ngFor=\"let option of variant.options | sort: 'groupId'\">\r\n                    <td\r\n                        class=\"left align-middle\"\r\n                        [class.disabled]=\"!formGroup.get('enabled')!.value\"\r\n                        [style.color]=\"optionGroupName(option.groupId) | stringToColor\"\r\n                    >\r\n                        {{ option.name }}\r\n                    </td>\r\n                </ng-container>\r\n                <td class=\"left align-middle price\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                    <clr-input-container>\r\n                        <vdr-currency-input\r\n                            *ngIf=\"!channelPriceIncludesTax\"\r\n                            clrInput\r\n                            [currencyCode]=\"variant.currencyCode\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                            formControlName=\"price\"\r\n                        ></vdr-currency-input>\r\n                        <vdr-currency-input\r\n                            *ngIf=\"channelPriceIncludesTax\"\r\n                            clrInput\r\n                            [currencyCode]=\"variant.currencyCode\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                            formControlName=\"priceWithTax\"\r\n                        ></vdr-currency-input>\r\n                    </clr-input-container>\r\n                </td>\r\n                <td class=\"left align-middle stock\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                    <clr-input-container>\r\n                        <input\r\n                            clrInput\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            step=\"1\"\r\n                            formControlName=\"stockOnHand\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                        />\r\n                    </clr-input-container>\r\n                </td>\r\n                <td class=\"left align-middle stock\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                    <clr-toggle-wrapper>\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            clrToggle\r\n                            name=\"enabled\"\r\n                            formControlName=\"enabled\"\r\n                            [vdrDisabled]=\"!(updatePermission | hasPermission)\"\r\n                        />\r\n                    </clr-toggle-wrapper>\r\n                </td>\r\n            </ng-container>\r\n        </tr>\r\n    </tbody>\r\n</table>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [".placeholder{color:var(--color-grey-300)}.stock input,.price input{max-width:96px}td{transition:background-color .2s}td.disabled{background-color:var(--color-component-bg-200)}\n"]
            }]
    }], function () { return [{ type: ɵngcc0.ChangeDetectorRef }]; }, { formArray: [{
            type: Input,
            args: ['productVariantsFormArray']
        }], variants: [{
            type: Input
        }], paginationConfig: [{
            type: Input
        }], channelPriceIncludesTax: [{
            type: Input
        }], optionGroups: [{
            type: Input
        }], pendingAssetChanges: [{
            type: Input
        }] }); })();

class VariantPriceDetailComponent {
    constructor(dataService) {
        this.dataService = dataService;
        this.priceChange$ = new BehaviorSubject(0);
        this.taxCategoryIdChange$ = new BehaviorSubject('');
    }
    ngOnInit() {
        const taxRates$ = this.dataService.settings
            .getTaxRatesSimple(999, 0, 'cache-first')
            .mapStream(data => data.taxRates.items);
        const activeChannel$ = this.dataService.settings
            .getActiveChannel('cache-first')
            .refetchOnChannelChange()
            .mapStream(data => data.activeChannel);
        this.taxRate$ = combineLatest(activeChannel$, taxRates$, this.taxCategoryIdChange$).pipe(map(([channel, taxRates, taxCategoryId]) => {
            const defaultTaxZone = channel.defaultTaxZone;
            if (!defaultTaxZone) {
                return 0;
            }
            const applicableRate = taxRates.find(taxRate => taxRate.zone.id === defaultTaxZone.id && taxRate.category.id === taxCategoryId);
            if (!applicableRate) {
                return 0;
            }
            return applicableRate.value;
        }));
        this.grossPrice$ = combineLatest(this.taxRate$, this.priceChange$).pipe(map(([taxRate, price]) => {
            return Math.round(price * ((100 + taxRate) / 100));
        }));
    }
    ngOnChanges(changes) {
        if ('price' in changes) {
            this.priceChange$.next(changes.price.currentValue);
        }
        if ('taxCategoryId' in changes) {
            this.taxCategoryIdChange$.next(changes.taxCategoryId.currentValue);
        }
    }
}
VariantPriceDetailComponent.ɵfac = function VariantPriceDetailComponent_Factory(t) { return new (t || VariantPriceDetailComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DataService)); };
VariantPriceDetailComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: VariantPriceDetailComponent, selectors: [["vdr-variant-price-detail"]], inputs: { priceIncludesTax: "priceIncludesTax", price: "price", currencyCode: "currencyCode", taxCategoryId: "taxCategoryId" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 5, vars: 5, consts: [[1, "clr-control-label"], ["class", "value", 4, "ngIf"], [1, "value"]], template: function VariantPriceDetailComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "label", 0);
        ɵngcc0.ɵɵtext(1);
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(3, VariantPriceDetailComponent_div_3_Template, 4, 8, "div", 1);
        ɵngcc0.ɵɵtemplate(4, VariantPriceDetailComponent_div_4_Template, 6, 14, "div", 1);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(2, 3, "catalog.taxes"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.priceIncludesTax);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.priceIncludesTax);
    } }, directives: [ɵngcc7.ClrLabel, ɵngcc4.NgIf], pipes: [ɵngcc5.TranslatePipe, ɵngcc4.AsyncPipe, ɵngcc2.LocaleCurrencyPipe], styles: ["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"], changeDetection: 0 });
VariantPriceDetailComponent.ctorParameters = () => [
    { type: DataService }
];
VariantPriceDetailComponent.propDecorators = {
    priceIncludesTax: [{ type: Input }],
    price: [{ type: Input }],
    currencyCode: [{ type: Input }],
    taxCategoryId: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(VariantPriceDetailComponent, [{
        type: Component,
        args: [{
                selector: 'vdr-variant-price-detail',
                template: "<label class=\"clr-control-label\">{{ 'catalog.taxes' | translate }}</label>\r\n<div *ngIf=\"priceIncludesTax\" class=\"value\">\r\n    {{ 'catalog.price-includes-tax-at' | translate: { rate: taxRate$ | async } }}\r\n</div>\r\n<div *ngIf=\"!priceIncludesTax\" class=\"value\">\r\n    {{\r\n        'catalog.price-with-tax-in-default-zone'\r\n            | translate: { price: grossPrice$ | async | localeCurrency: currencyCode, rate: taxRate$ | async }\r\n    }}\r\n</div>\r\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host{display:flex;flex-direction:column}.value{margin-top:3px}\n"]
            }]
    }], function () { return [{ type: ɵngcc2.DataService }]; }, { priceIncludesTax: [{
            type: Input
        }], price: [{
            type: Input
        }], currencyCode: [{
            type: Input
        }], taxCategoryId: [{
            type: Input
        }] }); })();

const CATALOG_COMPONENTS = [
    ProductListComponent,
    ProductDetailComponent,
    FacetListComponent,
    FacetDetailComponent,
    GenerateProductVariantsComponent,
    ProductVariantsListComponent,
    ApplyFacetDialogComponent,
    AssetListComponent,
    AssetsComponent,
    VariantPriceDetailComponent,
    CollectionListComponent,
    CollectionDetailComponent,
    CollectionTreeComponent,
    CollectionTreeNodeComponent,
    CollectionContentsComponent,
    ProductVariantsTableComponent,
    ProductSearchInputComponent,
    OptionValueInputComponent,
    UpdateProductOptionDialogComponent,
    ProductVariantsEditorComponent,
    AssignProductsToChannelDialogComponent,
    AssetDetailComponent,
    ConfirmVariantDeletionDialogComponent,
    ProductOptionsEditorComponent,
];
class CatalogModule {
}
CatalogModule.ɵfac = function CatalogModule_Factory(t) { return new (t || CatalogModule)(); };
CatalogModule.ɵmod = /*@__PURE__*/ ɵngcc0.ɵɵdefineNgModule({ type: CatalogModule });
CatalogModule.ɵinj = /*@__PURE__*/ ɵngcc0.ɵɵdefineInjector({ imports: [[SharedModule, RouterModule.forChild(catalogRoutes)]] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CatalogModule, [{
        type: NgModule,
        args: [{
                imports: [SharedModule, RouterModule.forChild(catalogRoutes)],
                exports: [...CATALOG_COMPONENTS],
                declarations: [...CATALOG_COMPONENTS]
            }]
    }], null, null); })();
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(CatalogModule, { declarations: function () { return [ProductListComponent, ProductDetailComponent, FacetListComponent, FacetDetailComponent, GenerateProductVariantsComponent, ProductVariantsListComponent, ApplyFacetDialogComponent, AssetListComponent, AssetsComponent, VariantPriceDetailComponent, CollectionListComponent, CollectionDetailComponent, CollectionTreeComponent, CollectionTreeNodeComponent, CollectionContentsComponent, ProductVariantsTableComponent, ProductSearchInputComponent, OptionValueInputComponent, UpdateProductOptionDialogComponent, ProductVariantsEditorComponent, AssignProductsToChannelDialogComponent, AssetDetailComponent, ConfirmVariantDeletionDialogComponent, ProductOptionsEditorComponent]; }, imports: function () { return [SharedModule, ɵngcc1.RouterModule]; }, exports: function () { return [ProductListComponent, ProductDetailComponent, FacetListComponent, FacetDetailComponent, GenerateProductVariantsComponent, ProductVariantsListComponent, ApplyFacetDialogComponent, AssetListComponent, AssetsComponent, VariantPriceDetailComponent, CollectionListComponent, CollectionDetailComponent, CollectionTreeComponent, CollectionTreeNodeComponent, CollectionContentsComponent, ProductVariantsTableComponent, ProductSearchInputComponent, OptionValueInputComponent, UpdateProductOptionDialogComponent, ProductVariantsEditorComponent, AssignProductsToChannelDialogComponent, AssetDetailComponent, ConfirmVariantDeletionDialogComponent, ProductOptionsEditorComponent]; } }); })();

// This file was generated by the build-public-api.ts script

/**
 * Generated bundle index. Do not edit.
 */

export { ApplyFacetDialogComponent, AssetDetailComponent, AssetListComponent, AssetResolver, AssetsComponent, AssignProductsToChannelDialogComponent, CatalogModule, CollectionContentsComponent, CollectionDetailComponent, CollectionListComponent, CollectionResolver, CollectionTreeComponent, CollectionTreeNodeComponent, ConfirmVariantDeletionDialogComponent, FacetDetailComponent, FacetListComponent, FacetResolver, GenerateProductVariantsComponent, GeneratedVariant, OPTION_VALUE_INPUT_VALUE_ACCESSOR, OptionValueInputComponent, ProductDetailComponent, ProductDetailService, ProductListComponent, ProductOptionsEditorComponent, ProductResolver, ProductSearchInputComponent, ProductVariantsEditorComponent, ProductVariantsListComponent, ProductVariantsResolver, ProductVariantsTableComponent, UpdateProductOptionDialogComponent, VariantPriceDetailComponent, arrayToTree, assetBreadcrumb, catalogRoutes, collectionBreadcrumb, facetBreadcrumb, productBreadcrumb, productOptionsEditorBreadcrumb, productVariantEditorBreadcrumb, replaceLast, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9 };

//# sourceMappingURL=vendure-admin-ui-catalog.js.map