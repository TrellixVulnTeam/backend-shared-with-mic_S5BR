import { GET_NEWTORK_STATUS, GET_UI_STATE, GET_USER_STATUS } from '../definitions/client-definitions';
const ɵ0 = (_, args, { cache }) => {
    return updateRequestsInFlight(cache, 1);
}, ɵ1 = (_, args, { cache }) => {
    return updateRequestsInFlight(cache, -1);
}, ɵ2 = (_, args, { cache }) => {
    const { input: { username, loginTime, channels, activeChannelId }, } = args;
    // tslint:disable-next-line:no-non-null-assertion
    const permissions = channels.find(c => c.id === activeChannelId).permissions;
    const data = {
        userStatus: {
            __typename: 'UserStatus',
            username,
            loginTime,
            isLoggedIn: true,
            permissions,
            channels,
            activeChannelId,
        },
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ3 = (_, args, { cache }) => {
    const data = {
        userStatus: {
            __typename: 'UserStatus',
            username: '',
            loginTime: '',
            isLoggedIn: false,
            permissions: [],
            channels: [],
            activeChannelId: null,
        },
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ4 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'language', args.languageCode);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.languageCode;
}, ɵ5 = (_, args, { cache }) => {
    var _a;
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'locale', args.locale);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return (_a = args.locale) !== null && _a !== void 0 ? _a : undefined;
}, ɵ6 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'contentLanguage', args.languageCode);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.languageCode;
}, ɵ7 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'theme', args.theme);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.theme;
}, ɵ8 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'displayUiExtensionPoints', args.display);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.display;
}, ɵ9 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_USER_STATUS });
    const activeChannel = previous.userStatus.channels.find(c => c.id === args.channelId);
    if (!activeChannel) {
        throw new Error('setActiveChannel: Could not find Channel with ID ' + args.channelId);
    }
    const permissions = activeChannel.permissions;
    const data = {
        userStatus: Object.assign(Object.assign({}, previous.userStatus), { permissions, activeChannelId: activeChannel.id }),
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ10 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_USER_STATUS });
    const data = {
        userStatus: Object.assign(Object.assign({}, previous.userStatus), { channels: Array.isArray(args.channels) ? args.channels : [args.channels] }),
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
};
export const clientResolvers = {
    Mutation: {
        requestStarted: ɵ0,
        requestCompleted: ɵ1,
        setAsLoggedIn: ɵ2,
        setAsLoggedOut: ɵ3,
        setUiLanguage: ɵ4,
        setUiLocale: ɵ5,
        setContentLanguage: ɵ6,
        setUiTheme: ɵ7,
        setDisplayUiExtensionPoints: ɵ8,
        setActiveChannel: ɵ9,
        updateUserChannels: ɵ10,
    },
};
function updateUiState(previous, key, value) {
    return {
        uiState: Object.assign(Object.assign({}, previous.uiState), { [key]: value, __typename: 'UiState' }),
    };
}
function updateRequestsInFlight(cache, increment) {
    const previous = cache.readQuery({ query: GET_NEWTORK_STATUS });
    const inFlightRequests = previous ? previous.networkStatus.inFlightRequests + increment : increment;
    const data = {
        networkStatus: {
            __typename: 'NetworkStatus',
            inFlightRequests,
        },
    };
    cache.writeQuery({ query: GET_NEWTORK_STATUS, data });
    return inFlightRequests;
}
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9, ɵ10 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50LXJlc29sdmVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvZGF0YS9jbGllbnQtc3RhdGUvY2xpZW50LXJlc29sdmVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpQkEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztXQWdCOUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQVUsRUFBRTtJQUMzQyxPQUFPLHNCQUFzQixDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM1QyxDQUFDLE9BQ2lCLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFVLEVBQUU7SUFDN0MsT0FBTyxzQkFBc0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM3QyxDQUFDLE9BQ2MsQ0FBQyxDQUFDLEVBQUUsSUFBNkIsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUE0QixFQUFFO0lBQ3JGLE1BQU0sRUFDRixLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsR0FDNUQsR0FBRyxJQUFJLENBQUM7SUFDVCxpREFBaUQ7SUFDakQsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssZUFBZSxDQUFFLENBQUMsV0FBVyxDQUFDO0lBQzlFLE1BQU0sSUFBSSxHQUErQjtRQUNyQyxVQUFVLEVBQUU7WUFDUixVQUFVLEVBQUUsWUFBWTtZQUN4QixRQUFRO1lBQ1IsU0FBUztZQUNULFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFdBQVc7WUFDWCxRQUFRO1lBQ1IsZUFBZTtTQUNsQjtLQUNKLENBQUM7SUFDRixLQUFLLENBQUMsVUFBVSxD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S0FBSyxFQUNaLFVBQVUsRUFBRSxTQUFTLEdBQ3hCO0tBQ0osQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFTLHNCQUFzQixDQUFDLEtBQW9CLEVBQUUsU0FBaUI7SUFDbkUsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBeUIsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO0lBQ3hGLE1BQU0sZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGdCQUFnQixHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQ3BHLE1BQU0sSUFBSSxHQUEyQjtRQUNqQyxhQUFhLEVBQUU7WUFDWCxVQUFVLEVBQUUsZUFBZTtZQUMzQixnQkFBZ0I7U0FDbkI7S0FDSixDQUFDO0lBQ0YsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELE9BQU8sZ0JBQWdCLENBQUM7QUFDNUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluTWVtb3J5Q2FjaGUgfSBmcm9tICdAYXBvbGxvL2NsaWVudC9jb3JlJztcclxuXHJcbmltcG9ydCB7XHJcbiAgICBHZXROZXR3b3JrU3RhdHVzLFxyXG4gICAgR2V0VWlTdGF0ZSxcclxuICAgIEdldFVzZXJTdGF0dXMsXHJcbiAgICBMYW5ndWFnZUNvZGUsXHJcbiAgICBTZXRBY3RpdmVDaGFubmVsLFxyXG4gICAgU2V0QXNMb2dnZWRJbixcclxuICAgIFNldENvbnRlbnRMYW5ndWFnZSxcclxuICAgIFNldERpc3BsYXlVaUV4dGVuc2lvblBvaW50cyxcclxuICAgIFNldFVpTGFuZ3VhZ2UsXHJcbiAgICBTZXRVaUxvY2FsZSxcclxuICAgIFNldFVpVGhlbWUsXHJcbiAgICBVcGRhdGVVc2VyQ2hhbm5lbHMsXHJcbiAgICBVc2VyU3RhdHVzLFxyXG59IGZyb20gJy4uLy4uL2NvbW1vbi9nZW5lcmF0ZWQtdHlwZXMnO1xyXG5pbXBvcnQgeyBHRVRfTkVXVE9SS19TVEFUVVMsIEdFVF9VSV9TVEFURSwgR0VUX1VTRVJfU1RBVFVTIH0gZnJvbSAnLi4vZGVmaW5pdGlvbnMvY2xpZW50LWRlZmluaXRpb25zJztcclxuXHJcbmV4cG9ydCB0eXBlIFJlc29sdmVyQ29udGV4dCA9IHtcclxuICAgIGNhY2hlOiBJbk1lbW9yeUNhY2hlO1xyXG4gICAgb3B0aW1pc3RpY1Jlc3BvbnNlOiBhbnk7XHJcbiAgICBnZXRDYWNoZUtleTogKHN0b3JlT2JqOiBhbnkpID0+IHN0cmluZztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFJlc29sdmVyRGVmaW5pdGlvbiA9IHtcclxuICAgIE11dGF0aW9uOiB7XHJcbiAgICAgICAgW25hbWU6IHN0cmluZ106IChyb290VmFsdWU6IGFueSwgYXJnczogYW55LCBjb250ZXh0OiBSZXNvbHZlckNvbnRleHQsIGluZm8/OiBhbnkpID0+IGFueTtcclxuICAgIH07XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY2xpZW50UmVzb2x2ZXJzOiBSZXNvbHZlckRlZmluaXRpb24gPSB7XHJcbiAgICBNdXRhdGlvbjoge1xyXG4gICAgICAgIHJlcXVlc3RTdGFydGVkOiAoXywgYXJncywgeyBjYWNoZSB9KTogbnVtYmVyID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJlcXVlc3RzSW5GbGlnaHQoY2FjaGUsIDEpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVxdWVzdENvbXBsZXRlZDogKF8sIGFyZ3MsIHsgY2FjaGUgfSk6IG51bWJlciA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVSZXF1ZXN0c0luRmxpZ2h0KGNhY2hlLCAtMSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRBc0xvZ2dlZEluOiAoXywgYXJnczogU2V0QXNMb2dnZWRJbi5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IEdldFVzZXJTdGF0dXMuVXNlclN0YXR1cyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtcclxuICAgICAgICAgICAgICAgIGlucHV0OiB7IHVzZXJuYW1lLCBsb2dpblRpbWUsIGNoYW5uZWxzLCBhY3RpdmVDaGFubmVsSWQgfSxcclxuICAgICAgICAgICAgfSA9IGFyZ3M7XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICAgICAgY29uc3QgcGVybWlzc2lvbnMgPSBjaGFubmVscy5maW5kKGMgPT4gYy5pZCA9PT0gYWN0aXZlQ2hhbm5lbElkKSEucGVybWlzc2lvbnM7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGE6IHsgdXNlclN0YXR1czogVXNlclN0YXR1cyB9ID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlclN0YXR1czoge1xyXG4gICAgICAgICAgICAgICAgICAgIF9fdHlwZW5hbWU6ICdVc2VyU3RhdHVzJyxcclxuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBsb2dpblRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNMb2dnZWRJbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBjaGFubmVscyxcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVDaGFubmVsSWQsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VU0VSX1NUQVRVUywgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldEFzTG9nZ2VkT3V0OiAoXywgYXJncywgeyBjYWNoZSB9KTogR2V0VXNlclN0YXR1cy5Vc2VyU3RhdHVzID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YTogR2V0VXNlclN0YXR1cy5RdWVyeSA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBfX3R5cGVuYW1lOiAnVXNlclN0YXR1cycsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2luVGltZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNMb2dnZWRJbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmVDaGFubmVsSWQ6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VU0VSX1NUQVRVUywgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldFVpTGFuZ3VhZ2U6IChfLCBhcmdzOiBTZXRVaUxhbmd1YWdlLlZhcmlhYmxlcywgeyBjYWNoZSB9KTogTGFuZ3VhZ2VDb2RlID0+IHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVaVN0YXRlLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUgfSkhO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdXBkYXRlVWlTdGF0ZShwcmV2aW91cywgJ2xhbmd1YWdlJywgYXJncy5sYW5ndWFnZUNvZGUpO1xyXG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGFyZ3MubGFuZ3VhZ2VDb2RlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0VWlMb2NhbGU6IChfLCBhcmdzOiBTZXRVaUxvY2FsZS5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8R2V0VWlTdGF0ZS5RdWVyeT4oeyBxdWVyeTogR0VUX1VJX1NUQVRFIH0pITtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHVwZGF0ZVVpU3RhdGUocHJldmlvdXMsICdsb2NhbGUnLCBhcmdzLmxvY2FsZSk7XHJcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VJX1NUQVRFLCBkYXRhIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gYXJncy5sb2NhbGUgPz8gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0Q29udGVudExhbmd1YWdlOiAoXywgYXJnczogU2V0Q29udGVudExhbmd1YWdlLlZhcmlhYmxlcywgeyBjYWNoZSB9KTogTGFuZ3VhZ2VDb2RlID0+IHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVaVN0YXRlLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUgfSkhO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdXBkYXRlVWlTdGF0ZShwcmV2aW91cywgJ2NvbnRlbnRMYW5ndWFnZScsIGFyZ3MubGFuZ3VhZ2VDb2RlKTtcclxuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUsIGRhdGEgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBhcmdzLmxhbmd1YWdlQ29kZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldFVpVGhlbWU6IChfLCBhcmdzOiBTZXRVaVRoZW1lLlZhcmlhYmxlcywgeyBjYWNoZSB9KTogc3RyaW5nID0+IHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVaVN0YXRlLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUgfSkhO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdXBkYXRlVWlTdGF0ZShwcmV2aW91cywgJ3RoZW1lJywgYXJncy50aGVtZSk7XHJcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VJX1NUQVRFLCBkYXRhIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gYXJncy50aGVtZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldERpc3BsYXlVaUV4dGVuc2lvblBvaW50czogKF8sIGFyZ3M6IFNldERpc3BsYXlVaUV4dGVuc2lvblBvaW50cy5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IGJvb2xlYW4gPT4ge1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUucmVhZFF1ZXJ5PEdldFVpU3RhdGUuUXVlcnk+KHsgcXVlcnk6IEdFVF9VSV9TVEFURSB9KSE7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB1cGRhdGVVaVN0YXRlKHByZXZpb3VzLCAnZGlzcGxheVVpRXh0ZW5zaW9uUG9pbnRzJywgYXJncy5kaXNwbGF5KTtcclxuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUsIGRhdGEgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBhcmdzLmRpc3BsYXk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRBY3RpdmVDaGFubmVsOiAoXywgYXJnczogU2V0QWN0aXZlQ2hhbm5lbC5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IFVzZXJTdGF0dXMgPT4ge1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUucmVhZFF1ZXJ5PEdldFVzZXJTdGF0dXMuUXVlcnk+KHsgcXVlcnk6IEdFVF9VU0VSX1NUQVRVUyB9KSE7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUNoYW5uZWwgPSBwcmV2aW91cy51c2VyU3RhdHVzLmNoYW5uZWxzLmZpbmQoYyA9PiBjLmlkID09PSBhcmdzLmNoYW5uZWxJZCk7XHJcbiAgICAgICAgICAgIGlmICghYWN0aXZlQ2hhbm5lbCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXRBY3RpdmVDaGFubmVsOiBDb3VsZCBub3QgZmluZCBDaGFubmVsIHdpdGggSUQgJyArIGFyZ3MuY2hhbm5lbElkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGFjdGl2ZUNoYW5uZWwucGVybWlzc2lvbnM7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGE6IHsgdXNlclN0YXR1czogVXNlclN0YXR1cyB9ID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlclN0YXR1czoge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnByZXZpb3VzLnVzZXJTdGF0dXMsXHJcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlQ2hhbm5lbElkOiBhY3RpdmVDaGFubmVsLmlkLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMsIGRhdGEgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnVzZXJTdGF0dXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB1cGRhdGVVc2VyQ2hhbm5lbHM6IChfLCBhcmdzOiBVcGRhdGVVc2VyQ2hhbm5lbHMuVmFyaWFibGVzLCB7IGNhY2hlIH0pOiBVc2VyU3RhdHVzID0+IHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVc2VyU3RhdHVzLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMgfSkhO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlclN0YXR1czoge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnByZXZpb3VzLnVzZXJTdGF0dXMsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbHM6IEFycmF5LmlzQXJyYXkoYXJncy5jaGFubmVscykgPyBhcmdzLmNoYW5uZWxzIDogW2FyZ3MuY2hhbm5lbHNdLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMsIGRhdGEgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhLnVzZXJTdGF0dXM7XHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbn07XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVVaVN0YXRlPEsgZXh0ZW5kcyBrZXlvZiBHZXRVaVN0YXRlLlF1ZXJ5Wyd1aVN0YXRlJ10+KFxyXG4gICAgcHJldmlvdXM6IEdldFVpU3RhdGUuUXVlcnksXHJcbiAgICBrZXk6IEssXHJcbiAgICB2YWx1ZTogR2V0VWlTdGF0ZS5RdWVyeVsndWlTdGF0ZSddW0tdLFxyXG4pOiBHZXRVaVN0YXRlLlF1ZXJ5IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdWlTdGF0ZToge1xyXG4gICAgICAgICAgICAuLi5wcmV2aW91cy51aVN0YXRlLFxyXG4gICAgICAgICAgICBba2V5XTogdmFsdWUsXHJcbiAgICAgICAgICAgIF9fdHlwZW5hbWU6ICdVaVN0YXRlJyxcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlUmVxdWVzdHNJbkZsaWdodChjYWNoZTogSW5NZW1vcnlDYWNoZSwgaW5jcmVtZW50OiAxIHwgLTEpOiBudW1iZXIge1xyXG4gICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8R2V0TmV0d29ya1N0YXR1cy5RdWVyeT4oeyBxdWVyeTogR0VUX05FV1RPUktfU1RBVFVTIH0pO1xyXG4gICAgY29uc3QgaW5GbGlnaHRSZXF1ZXN0cyA9IHByZXZpb3VzID8gcHJldmlvdXMubmV0d29ya1N0YXR1cy5pbkZsaWdodFJlcXVlc3RzICsgaW5jcmVtZW50IDogaW5jcmVtZW50O1xyXG4gICAgY29uc3QgZGF0YTogR2V0TmV0d29ya1N0YXR1cy5RdWVyeSA9IHtcclxuICAgICAgICBuZXR3b3JrU3RhdHVzOiB7XHJcbiAgICAgICAgICAgIF9fdHlwZW5hbWU6ICdOZXR3b3JrU3RhdHVzJyxcclxuICAgICAgICAgICAgaW5GbGlnaHRSZXF1ZXN0cyxcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxuICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX05FV1RPUktfU1RBVFVTLCBkYXRhIH0pO1xyXG4gICAgcmV0dXJuIGluRmxpZ2h0UmVxdWVzdHM7XHJcbn1cclxuIl19