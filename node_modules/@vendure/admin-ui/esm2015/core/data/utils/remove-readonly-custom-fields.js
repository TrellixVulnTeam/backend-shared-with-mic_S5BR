import { getOperationAST } from 'graphql';
const CREATE_ENTITY_REGEX = /Create([A-Za-z]+)Input/;
const UPDATE_ENTITY_REGEX = /Update([A-Za-z]+)Input/;
/**
 * Checks the current documentNode for an operation with a variable named "Create<Entity>Input" or "Update<Entity>Input"
 * and if a match is found, returns the <Entity> name.
 */
export function isEntityCreateOrUpdateMutation(documentNode) {
    const operationDef = getOperationAST(documentNode, null);
    if (operationDef && operationDef.variableDefinitions) {
        for (const variableDef of operationDef.variableDefinitions) {
            const namedType = extractInputType(variableDef.type);
            const inputTypeName = namedType.name.value;
            // special cases which don't follow the usual pattern
            if (inputTypeName === 'UpdateActiveAdministratorInput') {
                return 'Administrator';
            }
            const createMatch = inputTypeName.match(CREATE_ENTITY_REGEX);
            if (createMatch) {
                return createMatch[1];
            }
            const updateMatch = inputTypeName.match(UPDATE_ENTITY_REGEX);
            if (updateMatch) {
                return updateMatch[1];
            }
        }
    }
}
function extractInputType(type) {
    if (type.kind === 'NonNullType') {
        return extractInputType(type.type);
    }
    if (type.kind === 'ListType') {
        return extractInputType(type.type);
    }
    return type;
}
/**
 * Removes any `readonly` custom fields from an entity (including its translations).
 * To be used before submitting the entity for a create or update request.
 */
export function removeReadonlyCustomFields(variables, customFieldConfig) {
    if (!Array.isArray(variables)) {
        if (Array.isArray(variables.input)) {
            for (const input of variables.input) {
                removeReadonly(input, customFieldConfig);
            }
        }
        else {
            removeReadonly(variables.input, customFieldConfig);
        }
    }
    else {
        for (const input of variables) {
            removeReadonly(input, customFieldConfig);
        }
    }
    return removeReadonly(variables, customFieldConfig);
}
function removeReadonly(input, customFieldConfig) {
    for (const field of customFieldConfig) {
        if (field.readonly) {
            if (field.type === 'localeString') {
                if (hasTranslations(input)) {
                    for (const translation of input.translations) {
                        if (hasCustomFields(translation) &&
                            translation.customFields[field.name] !== undefined) {
                            delete translation.customFields[field.name];
                        }
                    }
                }
            }
            else {
                if (hasCustomFields(input) && input.customFields[field.name] !== undefined) {
                    delete input.customFields[field.name];
                }
            }
        }
    }
    return input;
}
function hasCustomFields(input) {
    return input != null && input.hasOwnProperty('customFields');
}
function hasTranslations(input) {
    return input != null && input.hasOwnProperty('translations');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVtb3ZlLXJlYWRvbmx5LWN1c3RvbS1maWVsZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvcmUvc3JjL2RhdGEvdXRpbHMvcmVtb3ZlLXJlYWRvbmx5LWN1c3RvbS1maWVsZHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFnQixlQUFlLEVBQTJCLE1BQU0sU0FBUyxDQUFDO0FBSWpGLE1BQU0sbUJBQW1CLEdBQUcsd0JBQXdCLENBQUM7QUFDckQsTUFBTSxtQkFBbUIsR0FBRyx3QkFBd0IsQ0FBQztBQWFyRDs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsOEJBQThCLENBQUMsWUFBMEI7SUFDckUsTUFBTSxZQUFZLEdBQUcsZUFBZSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN6RCxJQUFJLFlBQVksSUFBSSxZQUFZLENBQUMsbUJBQW1CLEVBQUU7UUFDbEQsS0FBSyxNQUFNLFdBQVcsSUFBSSxZQUFZLENBQUMsbUJBQW1CLEVBQUU7WUFDeEQsTUFBTSxTQUFTLEdBQUcsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JELE1BQU0sYUFBYSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBRTNDLHFEQUFxRDtZQUNyRCxJQUFJLGFBQWEsS0FBSyxnQ0FBZ0MsRUFBRTtnQkFDcEQsT0FBTyxlQUFlLENBQUM7YUFDMUI7WUFFRCxNQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDN0QsSUFBSSxXQUFXLEVBQUU7Z0JBQ2IsT0FBTyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDekI7WUFDRCxNQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDN0QsSUFBSSxXQUFXLEVBQUU7Z0JBQ2IsT0FBTyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDekI7U0FDSjtLQUNKO0FBQ0wsQ0FBQztBQUVELFNBQVMsZ0JBQWdCLENBQUMsSUFBYztJQUNwQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssYUFBYSxFQUFFO1FBQzdCLE9BQU8sZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3RDO0lBQ0QsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLFVBQVUsRUFBRTtRQUMxQixPQUFPLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUN0QztJQUNELE9BQU8sSUFBSSxDQUFDO0FBQ2hCLENBQUM7QUFFRDs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsMEJBQTBCLENBQ3RDLFNBQWdGLEVBQ2hGLGlCQUFzQztJQUV0QyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtRQUMzQixJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2hDLEtBQUssTUFBTSxLQUFLLElBQUksU0FBUyxDQUFDLEtBQUssRUFBRTtnQkFDakMsY0FBYyxDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO2FBQzVDO1NBQ0o7YUFBTTtZQUNILGNBQWMsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLGlCQUFpQixDQUFDLENBQUM7U0FDdEQ7S0FDSjtTQUFNO1FBQ0gsS0FBSyxNQUFNLEtBQUssSUFBSSxTQUFTLEVBQUU7WUFDM0IsY0FBYyxDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1NBQzVDO0tBQ0o7SUFDRCxPQUFPLGNBQWMsQ0FBQyxTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztBQUN4RCxDQUFDO0FBRUQsU0FBUyxjQUFjLENBQUMsS0FBb0MsRUFBRSxpQkFBc0M7SUFDaEcsS0FBSyxNQUFNLEtBQUssSUFBSSxpQkFBaUIsRUFBRTtRQUNuQyxJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUU7WUFDaEIsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLGNBQWMsRUFBRTtnQkFDL0IsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLEVBQUU7b0JBQ3hCLEtBQUssTUFBTSxXQUFXLElBQUksS0FBSyxDQUFDLFlBQVksRUFBRTt3QkFDMUMsSUFDSSxlQUFlLENBQUMsV0FBVyxDQUFDOzRCQUM1QixXQUFXLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQ3BEOzRCQUNFLE9BQU8sV0FBVyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7eUJBQy9DO3FCQUNKO2lCQUNKO2FBQ0o7aUJBQU07Z0JBQ0gsSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssU0FBUyxFQUFFO29CQUN4RSxPQUFPLEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUN6QzthQUNKO1NBQ0o7S0FDSjtJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2pCLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FBQyxLQUFVO0lBQy9CLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQ2pFLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FBQyxLQUFVO0lBQy9CLE9BQU8sS0FBSyxJQUFJLElBQUksSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQ2pFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzaW1wbGVEZWVwQ2xvbmUgfSBmcm9tICdAdmVuZHVyZS9jb21tb24vbGliL3NpbXBsZS1kZWVwLWNsb25lJztcclxuaW1wb3J0IHsgRG9jdW1lbnROb2RlLCBnZXRPcGVyYXRpb25BU1QsIE5hbWVkVHlwZU5vZGUsIFR5cGVOb2RlIH0gZnJvbSAnZ3JhcGhxbCc7XHJcblxyXG5pbXBvcnQgeyBDdXN0b21GaWVsZENvbmZpZyB9IGZyb20gJy4uLy4uL2NvbW1vbi9nZW5lcmF0ZWQtdHlwZXMnO1xyXG5cclxuY29uc3QgQ1JFQVRFX0VOVElUWV9SRUdFWCA9IC9DcmVhdGUoW0EtWmEtel0rKUlucHV0LztcclxuY29uc3QgVVBEQVRFX0VOVElUWV9SRUdFWCA9IC9VcGRhdGUoW0EtWmEtel0rKUlucHV0LztcclxuXHJcbnR5cGUgSW5wdXRXaXRoT3B0aW9uYWxDdXN0b21GaWVsZHMgPSBSZWNvcmQ8c3RyaW5nLCBhbnk+ICYge1xyXG4gICAgY3VzdG9tRmllbGRzPzogUmVjb3JkPHN0cmluZywgYW55PjtcclxufTtcclxudHlwZSBJbnB1dFdpdGhDdXN0b21GaWVsZHMgPSBSZWNvcmQ8c3RyaW5nLCBhbnk+ICYge1xyXG4gICAgY3VzdG9tRmllbGRzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59O1xyXG5cclxudHlwZSBFbnRpdHlJbnB1dCA9IElucHV0V2l0aE9wdGlvbmFsQ3VzdG9tRmllbGRzICYge1xyXG4gICAgdHJhbnNsYXRpb25zPzogSW5wdXRXaXRoT3B0aW9uYWxDdXN0b21GaWVsZHNbXTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDaGVja3MgdGhlIGN1cnJlbnQgZG9jdW1lbnROb2RlIGZvciBhbiBvcGVyYXRpb24gd2l0aCBhIHZhcmlhYmxlIG5hbWVkIFwiQ3JlYXRlPEVudGl0eT5JbnB1dFwiIG9yIFwiVXBkYXRlPEVudGl0eT5JbnB1dFwiXHJcbiAqIGFuZCBpZiBhIG1hdGNoIGlzIGZvdW5kLCByZXR1cm5zIHRoZSA8RW50aXR5PiBuYW1lLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGlzRW50aXR5Q3JlYXRlT3JVcGRhdGVNdXRhdGlvbihkb2N1bWVudE5vZGU6IERvY3VtZW50Tm9kZSk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICBjb25zdCBvcGVyYXRpb25EZWYgPSBnZXRPcGVyYXRpb25BU1QoZG9jdW1lbnROb2RlLCBudWxsKTtcclxuICAgIGlmIChvcGVyYXRpb25EZWYgJiYgb3BlcmF0aW9uRGVmLnZhcmlhYmxlRGVmaW5pdGlvbnMpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHZhcmlhYmxlRGVmIG9mIG9wZXJhdGlvbkRlZi52YXJpYWJsZURlZmluaXRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5hbWVkVHlwZSA9IGV4dHJhY3RJbnB1dFR5cGUodmFyaWFibGVEZWYudHlwZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0VHlwZU5hbWUgPSBuYW1lZFR5cGUubmFtZS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZXMgd2hpY2ggZG9uJ3QgZm9sbG93IHRoZSB1c3VhbCBwYXR0ZXJuXHJcbiAgICAgICAgICAgIGlmIChpbnB1dFR5cGVOYW1lID09PSAnVXBkYXRlQWN0aXZlQWRtaW5pc3RyYXRvcklucHV0Jykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICdBZG1pbmlzdHJhdG9yJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgY3JlYXRlTWF0Y2ggPSBpbnB1dFR5cGVOYW1lLm1hdGNoKENSRUFURV9FTlRJVFlfUkVHRVgpO1xyXG4gICAgICAgICAgICBpZiAoY3JlYXRlTWF0Y2gpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVNYXRjaFsxXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVNYXRjaCA9IGlucHV0VHlwZU5hbWUubWF0Y2goVVBEQVRFX0VOVElUWV9SRUdFWCk7XHJcbiAgICAgICAgICAgIGlmICh1cGRhdGVNYXRjaCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZU1hdGNoWzFdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0SW5wdXRUeXBlKHR5cGU6IFR5cGVOb2RlKTogTmFtZWRUeXBlTm9kZSB7XHJcbiAgICBpZiAodHlwZS5raW5kID09PSAnTm9uTnVsbFR5cGUnKSB7XHJcbiAgICAgICAgcmV0dXJuIGV4dHJhY3RJbnB1dFR5cGUodHlwZS50eXBlKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlLmtpbmQgPT09ICdMaXN0VHlwZScpIHtcclxuICAgICAgICByZXR1cm4gZXh0cmFjdElucHV0VHlwZSh0eXBlLnR5cGUpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHR5cGU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZW1vdmVzIGFueSBgcmVhZG9ubHlgIGN1c3RvbSBmaWVsZHMgZnJvbSBhbiBlbnRpdHkgKGluY2x1ZGluZyBpdHMgdHJhbnNsYXRpb25zKS5cclxuICogVG8gYmUgdXNlZCBiZWZvcmUgc3VibWl0dGluZyB0aGUgZW50aXR5IGZvciBhIGNyZWF0ZSBvciB1cGRhdGUgcmVxdWVzdC5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVSZWFkb25seUN1c3RvbUZpZWxkcyhcclxuICAgIHZhcmlhYmxlczogeyBpbnB1dD86IEVudGl0eUlucHV0IHwgRW50aXR5SW5wdXRbXSB9IHwgRW50aXR5SW5wdXQgfCBFbnRpdHlJbnB1dFtdLFxyXG4gICAgY3VzdG9tRmllbGRDb25maWc6IEN1c3RvbUZpZWxkQ29uZmlnW10sXHJcbik6IHsgaW5wdXQ/OiBFbnRpdHlJbnB1dCB8IEVudGl0eUlucHV0W10gfSB8IEVudGl0eUlucHV0IHwgRW50aXR5SW5wdXRbXSB7XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFyaWFibGVzKSkge1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhcmlhYmxlcy5pbnB1dCkpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBpbnB1dCBvZiB2YXJpYWJsZXMuaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgIHJlbW92ZVJlYWRvbmx5KGlucHV0LCBjdXN0b21GaWVsZENvbmZpZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZW1vdmVSZWFkb25seSh2YXJpYWJsZXMuaW5wdXQsIGN1c3RvbUZpZWxkQ29uZmlnKTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGZvciAoY29uc3QgaW5wdXQgb2YgdmFyaWFibGVzKSB7XHJcbiAgICAgICAgICAgIHJlbW92ZVJlYWRvbmx5KGlucHV0LCBjdXN0b21GaWVsZENvbmZpZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlbW92ZVJlYWRvbmx5KHZhcmlhYmxlcywgY3VzdG9tRmllbGRDb25maWcpO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVSZWFkb25seShpbnB1dDogSW5wdXRXaXRoT3B0aW9uYWxDdXN0b21GaWVsZHMsIGN1c3RvbUZpZWxkQ29uZmlnOiBDdXN0b21GaWVsZENvbmZpZ1tdKSB7XHJcbiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGN1c3RvbUZpZWxkQ29uZmlnKSB7XHJcbiAgICAgICAgaWYgKGZpZWxkLnJlYWRvbmx5KSB7XHJcbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnbG9jYWxlU3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGhhc1RyYW5zbGF0aW9ucyhpbnB1dCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRyYW5zbGF0aW9uIG9mIGlucHV0LnRyYW5zbGF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNDdXN0b21GaWVsZHModHJhbnNsYXRpb24pICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGlvbi5jdXN0b21GaWVsZHNbZmllbGQubmFtZV0gIT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0cmFuc2xhdGlvbi5jdXN0b21GaWVsZHNbZmllbGQubmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGFzQ3VzdG9tRmllbGRzKGlucHV0KSAmJiBpbnB1dC5jdXN0b21GaWVsZHNbZmllbGQubmFtZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpbnB1dC5jdXN0b21GaWVsZHNbZmllbGQubmFtZV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaW5wdXQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhc0N1c3RvbUZpZWxkcyhpbnB1dDogYW55KTogaW5wdXQgaXMgSW5wdXRXaXRoQ3VzdG9tRmllbGRzIHtcclxuICAgIHJldHVybiBpbnB1dCAhPSBudWxsICYmIGlucHV0Lmhhc093blByb3BlcnR5KCdjdXN0b21GaWVsZHMnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFzVHJhbnNsYXRpb25zKGlucHV0OiBhbnkpOiBpbnB1dCBpcyB7IHRyYW5zbGF0aW9uczogSW5wdXRXaXRoT3B0aW9uYWxDdXN0b21GaWVsZHNbXSB9IHtcclxuICAgIHJldHVybiBpbnB1dCAhPSBudWxsICYmIGlucHV0Lmhhc093blByb3BlcnR5KCd0cmFuc2xhdGlvbnMnKTtcclxufVxyXG4iXX0=